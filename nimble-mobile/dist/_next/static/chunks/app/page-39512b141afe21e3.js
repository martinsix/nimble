(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{829:(e,t,a)=>{"use strict";a.d(t,{ActivityLogService:()=>w,P:()=>j});var i=a(5924);let s=i.Ik({type:i.KC([i.eu(4),i.eu(6),i.eu(8),i.eu(10),i.eu(12),i.eu(20),i.eu(66),i.eu(100)]),result:i.ai().positive(),isCritical:i.zM().optional()}),r=i.Ik({id:i.Yj().min(1),timestamp:i.p6(),description:i.Yj().min(1)}),n=i.Ik({type:i.eu("roll"),dice:i.YO(s),droppedDice:i.YO(s).optional(),modifier:i.ai(),total:i.ai(),isMiss:i.zM().optional(),criticalHits:i.ai().optional(),advantageLevel:i.ai().optional()}).merge(r),o=i.Ik({type:i.eu("damage"),amount:i.ai().positive(),targetType:i.k5(["hp","temp_hp"])}).merge(r),l=i.Ik({type:i.eu("healing"),amount:i.ai().positive()}).merge(r),c=i.Ik({type:i.eu("temp_hp"),amount:i.ai().positive(),previous:i.ai().optional()}).merge(r),d=i.Ik({type:i.eu("initiative"),total:i.ai(),actionsGranted:i.ai().positive()}).merge(r),m=i.Ik({type:i.eu("ability_usage"),abilityName:i.Yj().min(1),frequency:i.k5(["per_turn","per_encounter","per_safe_rest","at_will"]),usesRemaining:i.ai().min(0),maxUses:i.ai().min(0)}).merge(r),u=i.Ik({type:i.eu("safe_rest"),healingAmount:i.ai().min(0),hitDiceRestored:i.ai().min(0),woundsRemoved:i.ai().min(0),abilitiesReset:i.ai().min(0)}).merge(r),h=i.Ik({type:i.eu("catch_breath"),hitDiceSpent:i.ai().min(0),healingAmount:i.ai().min(0),abilitiesReset:i.ai().min(0)}).merge(r),p=i.Ik({type:i.eu("make_camp"),healingAmount:i.ai().min(0),hitDiceRestored:i.ai().min(0),abilitiesReset:i.ai().min(0)}).merge(r),y=i.Ik({type:i.eu("resource"),resourceId:i.Yj().min(1),resourceName:i.Yj().min(1),amount:i.ai().positive(),action:i.k5(["spent","restored"]),currentAmount:i.ai().min(0),maxAmount:i.ai().min(0)}).merge(r),f=i.Ik({type:i.eu("spell_cast"),spellName:i.Yj().min(1),school:i.Yj().min(1),tier:i.ai().min(1).max(9),resourceCost:i.Ik({resourceId:i.Yj().min(1),resourceName:i.Yj().min(1),amount:i.ai().positive()}).optional(),actionCost:i.ai().min(0)}).merge(r),g=i.Ik({type:i.eu("item_consumption"),itemName:i.Yj().min(1),itemType:i.k5(["consumable","ammunition"]),countBefore:i.ai().positive(),countAfter:i.ai().min(0),itemRemoved:i.zM()}).merge(r),x=i.gM("type",[n,o,l,c,d,m,u,h,p,y,f,g]);var v=a(4001),b=a(8720);class w{async getLogEntries(){let e=localStorage.getItem(this.storageKey);if(!e)return[];try{return JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)})).filter(e=>{try{return x.parse(e),!0}catch(t){return console.warn("Invalid log entry found and removed:",e),!1}})}catch(e){return[]}}async addLogEntry(e){try{x.parse(e)}catch(t){throw console.error("Invalid log entry provided:",e,t),Error("Invalid log entry format")}let t=[e,...await this.getLogEntries()].slice(0,this.maxEntries);localStorage.setItem(this.storageKey,JSON.stringify(t)),this.showToastForLogEntry(e)}showToastForLogEntry(e){let{description:t}=e;switch(e.type){case"roll":let a="".concat(t,": ").concat(e.total);e.isMiss?b.o.error(a,{description:"Critical miss!"}):e.criticalHits&&e.criticalHits>0?b.o.success(a,{description:"".concat(e.criticalHits," critical hit").concat(e.criticalHits>1?"s":"","!")}):b.o.info(a);break;case"damage":b.o.error(t);break;case"healing":case"safe_rest":b.o.success(t);break;case"temp_hp":case"initiative":case"ability_usage":case"spell_cast":b.o.info(t);break;case"resource":"spent"===e.action?b.o.warning(t):b.o.success(t);break;default:(0,b.o)(t)}}async clearLogEntries(){localStorage.removeItem(this.storageKey)}createDiceRollEntry(e,t,a,i,s,r,n,o){return{id:crypto.randomUUID(),timestamp:new Date,type:"roll",dice:e,droppedDice:(null==t?void 0:t.length)?t:void 0,modifier:a,total:i,description:s,advantageLevel:0!==r?r:void 0,isMiss:n,criticalHits:o&&o>0?o:void 0}}createDamageEntry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hp";return{id:crypto.randomUUID(),timestamp:new Date,type:"damage",description:"Took ".concat(e," damage").concat("temp_hp"===t?" (temporary HP)":""),amount:e,targetType:t}}createHealingEntry(e){return{id:crypto.randomUUID(),timestamp:new Date,type:"healing",description:"Healed ".concat(e," HP"),amount:e}}createTempHPEntry(e,t){let a=void 0!==t?"Gained ".concat(e," temporary HP (replaced ").concat(t,")"):"Gained ".concat(e," temporary HP");return{id:crypto.randomUUID(),timestamp:new Date,type:"temp_hp",description:a,amount:e,previous:t}}createInitiativeEntry(e,t){return{id:crypto.randomUUID(),timestamp:new Date,type:"initiative",description:"Initiative ".concat(e," - Combat started with ").concat(t," actions"),total:e,actionsGranted:t}}createAbilityUsageEntry(e,t,a,i){let s="per_turn"===t?"per turn":"per_encounter"===t?"per encounter":"per_safe_rest"===t?"per safe rest":"at will",r="at_will"===t?"Used ".concat(e," (").concat(s,")"):"Used ".concat(e," (").concat(s,") - ").concat(a,"/").concat(i," remaining");return{id:crypto.randomUUID(),timestamp:new Date,type:"ability_usage",description:r,abilityName:e,frequency:t,usesRemaining:a,maxUses:i}}createSafeRestEntry(e,t,a,i){let s=[];e>0&&s.push("restored ".concat(e," HP")),t>0&&s.push("restored ".concat(t," hit dice")),a>0&&s.push("removed ".concat(a," wound").concat(1!==a?"s":"")),i>0&&s.push("reset ".concat(i," abilities"));let r=s.length>0?"Safe Rest completed - ".concat(s.join(", ")):"Safe Rest completed";return{id:crypto.randomUUID(),timestamp:new Date,type:"safe_rest",description:r,healingAmount:e,hitDiceRestored:t,woundsRemoved:a,abilitiesReset:i}}createCatchBreathEntry(e,t,a){let i=[];e>0&&i.push("spent ".concat(e," hit dice")),t>0&&i.push("restored ".concat(t," HP")),a>0&&i.push("reset ".concat(a," abilities"));let s=i.length>0?"Catch Breath completed - ".concat(i.join(", ")):"Catch Breath completed";return{id:crypto.randomUUID(),timestamp:new Date,type:"catch_breath",description:s,hitDiceSpent:e,healingAmount:t,abilitiesReset:a}}createMakeCampEntry(e,t,a){let i=[];e>0&&i.push("restored ".concat(e," HP")),t>0&&i.push("restored ".concat(t," hit dice")),a>0&&i.push("reset ".concat(a," abilities"));let s=i.length>0?"Make Camp completed - ".concat(i.join(", ")):"Make Camp completed";return{id:crypto.randomUUID(),timestamp:new Date,type:"make_camp",description:s,healingAmount:e,hitDiceRestored:t,abilitiesReset:a}}createResourceEntry(e,t,a,i,s){let r="spent"===a?"Spent ".concat(t," ").concat(e," (").concat(i,"/").concat(s," remaining)"):"Restored ".concat(t," ").concat(e," (").concat(i,"/").concat(s," current)");return{id:crypto.randomUUID(),timestamp:new Date,type:"resource",description:r,resourceId:e,resourceName:e,amount:t,action:a,currentAmount:i,maxAmount:s}}createSpellCastEntry(e,t,a,i,s){let r=s?" (cost: ".concat(s.amount," ").concat(s.resourceName,")"):"",n=0===i?"bonus action":"".concat(i," action").concat(i>1?"s":""),o="Cast ".concat(e," (").concat(t,", tier ").concat(a,", ").concat(n,")").concat(r);return{id:crypto.randomUUID(),timestamp:new Date,type:"spell_cast",description:o,spellName:e,school:t,tier:a,resourceCost:s,actionCost:i}}constructor(){this.storageKey="nimble-navigator-activity-log",this.maxEntries=v.L.storage.maxRollHistory}}let j=new w},4001:(e,t,a)=>{"use strict";a.d(t,{L:()=>i});let i={dice:{maxCriticalHitsInRow:20},combat:{criticalHitOnMaxRoll:!0,missOnFirstDieOne:!0},character:{attributeRange:{min:-2,max:10},skillModifierRange:{min:0,max:12},initialSkillPoints:4},skills:[{name:"arcana",label:"Arcana",attribute:"intelligence"},{name:"examination",label:"Examination",attribute:"intelligence"},{name:"finesse",label:"Finesse",attribute:"dexterity"},{name:"influence",label:"Influence",attribute:"will"},{name:"insight",label:"Insight",attribute:"will"},{name:"might",label:"Might",attribute:"strength"},{name:"lore",label:"Lore",attribute:"intelligence"},{name:"naturecraft",label:"Naturecraft",attribute:"will"},{name:"perception",label:"Perception",attribute:"will"},{name:"stealth",label:"Stealth",attribute:"dexterity"}],storage:{maxRollHistory:100},equipment:{maxWeaponSize:2}}},5705:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>rI});var i=a(5155),s=a(2115),r=a(2467),n=a(3101),o=a(2821),l=a(5889);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,l.QP)((0,o.$)(t))}let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),m=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:o=!1,...l}=e,m=o?r.DX:"button";return(0,i.jsx)(m,{className:c(d({variant:s,size:n,className:a})),ref:t,...l})});m.displayName="Button";var u=a(4664),h=a(5740),p=a(814),y=a(508),f=a(6617),g=a(4114);class x{register(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.services.set(e,{factory:t,singleton:a})}get(e){let t=this.services.get(e);if(!t)throw Error("Service not registered: ".concat(e));return t.singleton?(this.singletons.has(e)||this.singletons.set(e,t.factory(this)),this.singletons.get(e)):t.factory(this)}clearSingletons(){this.singletons.clear()}constructor(){this.services=new Map,this.singletons=new Map}}let v={CHARACTER_STORAGE:"characterStorage",ACTIVITY_LOG:"activityLog",ABILITY_SERVICE:"abilityService",CHARACTER_SERVICE:"characterService",CLASS_SERVICE:"classService",ANCESTRY_SERVICE:"ancestryService",BACKGROUND_SERVICE:"backgroundService",CHARACTER_CREATION:"characterCreation",DICE_SERVICE:"diceService",SETTINGS_SERVICE:"settingsService"},b=new x;class w{getResourceInstance(e,t){return e.resources.find(e=>e.definition.id===t)||null}getActiveResources(e){return e.resources}addResourceToCharacter(e,t){let a=this.getResourceInstance(e,t.definition.id);return a||(e.resources.push(t),t)}removeResourceFromCharacter(e,t){let a=e.resources.findIndex(e=>e.definition.id===t);return -1!==a&&(e.resources.splice(a,1),!0)}spendResource(e,t,a){let i=e.resources.find(e=>e.definition.id===t);if(!i)return null;let s=Math.min(a,i.current);return i.current=Math.max(i.definition.minValue,i.current-s),{resourceId:t,amount:s,type:"spend",resource:i}}restoreResource(e,t,a){let i=e.resources.find(e=>e.definition.id===t);if(!i)return null;let s=Math.min(a,i.definition.maxValue-i.current);return i.current=Math.min(i.definition.maxValue,i.current+s),{resourceId:t,amount:s,type:"restore",resource:i}}setResource(e,t,a){let i=e.resources.find(e=>e.definition.id===t);return!!i&&(i.current=Math.max(i.definition.minValue,Math.min(a,i.definition.maxValue)),!0)}resetResourcesByCondition(e,t){let a=[];for(let i of e.resources){let e;if(i.definition.resetCondition===t){switch(i.definition.resetType){case"to_max":e=i.definition.maxValue;break;case"to_zero":e=i.definition.minValue;break;case"to_default":e=i.definition.resetValue||i.definition.maxValue;break;default:continue}if(i.current!==e){let t=Math.abs(e-i.current),s=e>i.current?"restore":"spend";i.current=e,a.push({resourceId:i.definition.id,amount:t,type:s,resource:i})}}}return a}resetResourcesOnSafeRest(e){return this.resetResourcesByCondition(e,"safe_rest")}resetResourcesOnEncounterEnd(e){return this.resetResourcesByCondition(e,"encounter_end")}resetResourcesOnTurnEnd(e){return this.resetResourcesByCondition(e,"turn_end")}createResourceLogEntry(e){return{id:"".concat(Date.now(),"-").concat(Math.random()),timestamp:new Date,type:"resource",resourceId:e.resourceId,resourceName:e.resource.definition.name,amount:e.amount,action:"spend"===e.type?"spent":"restored",currentAmount:e.resource.current,maxAmount:e.resource.definition.maxValue,description:"".concat("spend"===e.type?"Spent":"Restored"," ").concat(e.amount," ").concat(e.resource.definition.name)}}}let j=new w;class N{async save(e){let t=await this.list(),a=t.findIndex(t=>t.id===e.id);e.updatedAt=new Date,a>=0?t[a]=e:t.push(e),localStorage.setItem(this.storageKey,JSON.stringify(t))}async load(e){return(await this.list()).find(t=>t.id===e)||null}async list(){let e=localStorage.getItem(this.storageKey);if(!e)return[];try{return JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return[]}}async delete(e){let t=(await this.list()).filter(t=>t.id!==e);localStorage.setItem(this.storageKey,JSON.stringify(t))}async create(e,t){let a={id:t||crypto.randomUUID(),...e,createdAt:new Date,updatedAt:new Date};return await this.save(a),a}constructor(){this.storageKey="nimble-navigator-characters"}}var k=a(5924),S=a(4188),C=a(4001);let A=k.k5(["tiny","small","medium","large","huge","gargantuan"]),_=k.k5(["common","exotic"]),I=k.Ik({type:k.k5(["damage","condition"]).meta({title:"Resistance Type",description:"Type of resistance (damage or condition)"}),name:k.Yj().min(1).meta({title:"Name",description:"Name of what is resisted (e.g., fire, poison, charm)"}),description:k.Yj().optional().meta({title:"Description",description:"Optional description of the resistance"})}).meta({title:"Resistance",description:"Damage or condition resistance"}),T=k.Ik({name:k.Yj().min(1).meta({title:"Name",description:"Feature name"}),description:k.Yj().min(1).meta({title:"Description",description:"Feature description"})}),R=T.extend({type:k.eu("ability"),ability:k.bz()}),D=T.extend({type:k.eu("passive_feature")}),L=T.extend({type:k.eu("stat_boost"),statBoosts:k.YO(k.Ik({attribute:k.k5(["strength","dexterity","intelligence","will"]),amount:k.ai().int().min(-5).max(5)})).meta({title:"Stat Boosts",description:"Attribute modifications"})}),E=T.extend({type:k.eu("proficiency"),proficiencies:k.YO(k.Ik({type:k.k5(["skill","save","tool","language"]),name:k.Yj().min(1),bonus:k.ai().int().optional()})).meta({title:"Proficiencies",description:"Granted proficiencies"})}),P=T.extend({type:k.eu("darkvision"),range:k.ai().int().min(0).meta({title:"Range",description:"Darkvision range in feet"})}),F=T.extend({type:k.eu("resistance"),resistances:k.YO(I).meta({title:"Resistances",description:"Damage or condition resistances"})}),B=k.gM("type",[R,D,L,E,P,F]),M=k.Ik({syllables:k.Ik({prefixes:k.YO(k.Yj().min(1)).meta({title:"Prefixes",description:"Syllable prefixes for name generation"}),middle:k.YO(k.Yj().min(1)).meta({title:"Middle",description:"Middle syllables for name generation"}),suffixes:k.YO(k.Yj().min(1)).meta({title:"Suffixes",description:"Syllable suffixes for name generation"})}).meta({title:"Syllables",description:"Syllable collections for name generation"}),patterns:k.YO(k.Yj().min(1)).meta({title:"Patterns",description:"Name generation patterns (P=prefix, M=middle, S=suffix)"}),constraints:k.Ik({minLength:k.ai().int().min(1).meta({title:"Min Length",description:"Minimum name length"}),maxLength:k.ai().int().min(1).meta({title:"Max Length",description:"Maximum name length"}),syllableCount:k.Ik({min:k.ai().int().min(1).meta({title:"Min Syllables",description:"Minimum syllable count"}),max:k.ai().int().min(1).meta({title:"Max Syllables",description:"Maximum syllable count"})}).meta({title:"Syllable Count",description:"Syllable count constraints"})}).meta({title:"Constraints",description:"Name generation constraints"})}).meta({title:"Name Generator Config",description:"Configuration for generating names"}),W=k.Ik({male:M.optional().meta({title:"Male Names",description:"Configuration for male names"}),female:M.optional().meta({title:"Female Names",description:"Configuration for female names"}),surnames:M.optional().meta({title:"Surnames",description:"Configuration for surnames"}),unisex:M.optional().meta({title:"Unisex Names",description:"Configuration for unisex names"})}).meta({title:"Ancestry Name Config",description:"Name generation configuration for an ancestry"}),Y=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the ancestry"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the ancestry"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the ancestry"}),size:A.meta({title:"Size",description:"Default size category"}),rarity:_.meta({title:"Rarity",description:"Common or exotic ancestry"}),features:k.YO(B).meta({title:"Features",description:"All features provided by this ancestry"}),nameConfig:W.optional().meta({title:"Name Config",description:"Optional name generation configuration"})}).meta({title:"Ancestry Definition",description:"Character ancestry definition with features and traits"}),z=k.Ik({ancestryId:k.Yj().min(1).meta({title:"Ancestry ID",description:"ID of the character's ancestry"}),grantedFeatures:k.YO(k.Yj()).meta({title:"Granted Features",description:"IDs of ancestry features already granted"})}).meta({title:"Ancestry Trait",description:"Character ancestry reference"}),O=k.Ik({name:k.Yj().min(1).meta({title:"Name",description:"Feature name"}),description:k.Yj().min(1).meta({title:"Description",description:"Feature description"})}).extend({type:k.eu("passive_feature")}),U=k.gM("type",[O]),H=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the background"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the background"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the background"}),features:k.YO(U).meta({title:"Features",description:"All features provided by this background"})}).meta({title:"Background Definition",description:"Character background definition with features and traits"}),q=k.Ik({backgroundId:k.Yj().min(1).meta({title:"Background ID",description:"ID of the character's background"}),grantedFeatures:k.YO(k.Yj()).meta({title:"Granted Features",description:"IDs of background features already granted"})}).meta({title:"Background Trait",description:"Character background reference"}),G=k.Ik({count:k.Wh().int().min(1).max(20).meta({title:"Dice Count",description:"Number of dice to roll (integer)"}),sides:k.KC([k.eu(4),k.eu(6),k.eu(8),k.eu(10),k.eu(12),k.eu(20),k.eu(66),k.eu(100)]).meta({title:"Dice Type",description:"Type of dice (d4, d6, d8, d10, d12, d20, d66, d100)"})}).meta({title:"Dice Expression",description:"Dice expression for rolling"}),V=k.Ik({dice:G.meta({title:"Dice",description:"Dice to roll for this ability"}),modifier:k.Wh().int().optional().meta({title:"Modifier",description:"Fixed modifier to add to the roll (integer)"}),attribute:k.k5(["strength","dexterity","intelligence","will"]).optional().meta({title:"Attribute",description:"Attribute to add to the roll"})}).meta({title:"Ability Roll",description:"Roll configuration for abilities"}),K=k.gM("type",[k.Ik({type:k.eu("fixed").meta({title:"Fixed Cost",description:"Fixed resource cost"}),resourceId:k.Yj().meta({title:"Resource ID",description:"ID of the resource to consume"}),amount:k.Wh().int().min(0).meta({title:"Amount",description:"Amount of resource to consume (integer)"})}),k.Ik({type:k.eu("variable").meta({title:"Variable Cost",description:"Variable resource cost"}),resourceId:k.Yj().meta({title:"Resource ID",description:"ID of the resource to consume"}),minAmount:k.Wh().int().min(0).meta({title:"Minimum Amount",description:"Minimum amount of resource to consume (integer)"}),maxAmount:k.Wh().int().min(0).meta({title:"Maximum Amount",description:"Maximum amount of resource to consume (integer)"})})]).meta({title:"Resource Cost",description:"Resource cost for using this ability"}),J=k.KC([k.Ik({type:k.eu("cloth")}),k.Ik({type:k.eu("leather")}),k.Ik({type:k.eu("mail")}),k.Ik({type:k.eu("plate")}),k.Ik({type:k.eu("shields")}),k.Ik({type:k.eu("freeform"),name:k.Yj().min(1)})]),X=k.KC([k.Ik({type:k.eu("strength_weapons")}),k.Ik({type:k.eu("dexterity_weapons")}),k.Ik({type:k.eu("freeform"),name:k.Yj().min(1)})]),Z=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the ability"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the ability"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of what the ability does"}),type:k.eu("action").meta({title:"Type",description:'Must be "action" for action abilities'}),frequency:k.k5(["per_turn","per_encounter","per_safe_rest","at_will"]).meta({title:"Frequency",description:"How often the ability can be used"}),maxUses:k.ai().int().min(0).optional().meta({title:"Max Uses",description:"Maximum uses per frequency period (integer)"}),currentUses:k.ai().int().min(0).optional().meta({title:"Current Uses",description:"Current remaining uses (integer)"}),roll:V.optional().meta({title:"Roll",description:"Dice roll configuration for the ability"}),actionCost:k.ai().int().min(0).max(2).optional().meta({title:"Action Cost",description:"Action cost (0=bonus, 1=action, 2=full turn, integer)"}),resourceCost:K.optional().meta({title:"Resource Cost",description:"Resource cost to use the ability"})}).meta({title:"Action Ability",description:"Non-spell ability that characters can use"}),Q=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the spell"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the spell"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the spell's effects"}),type:k.eu("spell").meta({title:"Type",description:'Must be "spell" for spell abilities'}),school:k.Yj().min(1).meta({title:"School",description:"ID of the spell school this belongs to"}),tier:k.ai().int().min(0).max(9).meta({title:"Tier",description:"Spell tier/level (0-9, integer)"}),roll:V.optional().meta({title:"Roll",description:"Dice roll configuration for the spell"}),actionCost:k.ai().int().min(0).max(2).optional().meta({title:"Action Cost",description:"Action cost (0=bonus, 1=action, 2=full turn, integer)"}),resourceCost:K.optional().meta({title:"Resource Cost",description:"Resource cost to cast the spell"})}).meta({title:"Spell Ability",description:"Spell that characters can cast"}),$=k.gM("type",[Z,Q]),ee=k.Ik({id:k.Yj().min(1),level:k.ai().int().min(1).max(20),name:k.Yj().min(1),description:k.Yj().min(1)}),et=ee.extend({type:k.eu("ability"),ability:$}),ea=ee.extend({type:k.eu("passive_feature"),category:k.k5(["combat","exploration","social","utility"]).optional()}),ei=k.Ik({attribute:k.k5(["strength","dexterity","intelligence","will"]),amount:k.ai().int().min(-5).max(5)}),es=ee.extend({type:k.eu("stat_boost"),statBoosts:k.YO(ei)}),er=k.Ik({type:k.k5(["skill","save","tool","language"]),name:k.Yj().min(1),bonus:k.ai().int().optional()}),en=ee.extend({type:k.eu("proficiency"),proficiencies:k.YO(er)}),eo=ee.extend({type:k.eu("resource"),resourceDefinition:k.Ik({id:k.Yj().min(1),name:k.Yj().min(1),description:k.Yj().optional(),colorScheme:k.Yj(),icon:k.Yj().optional(),resetCondition:k.k5(["safe_rest","encounter_end","turn_end","never","manual"]),resetType:k.k5(["to_max","to_zero","to_default"]),resetValue:k.ai().int().optional(),minValue:k.ai().int(),maxValue:k.ai().int()}),startingAmount:k.ai().int().optional()}),el=ee.extend({type:k.eu("spell_school"),spellSchool:k.Ik({schoolId:k.Yj().min(1),name:k.Yj().min(1),description:k.Yj().min(1)})}),ec=ee.extend({type:k.eu("spell_school_choice"),availableSchools:k.YO(k.Yj()).optional(),numberOfChoices:k.ai().int().min(1).optional()}),ed=ee.extend({type:k.eu("utility_spells"),schools:k.YO(k.Yj()).min(1),spellsPerSchool:k.ai().int().min(1).optional()}),em=ee.extend({type:k.eu("spell_tier_access"),maxTier:k.ai().int().min(1).max(9)}),eu=ee.extend({type:k.eu("subclass_choice"),availableSubclasses:k.YO(k.Yj())}),eh=ee.extend({type:k.eu("pick_feature_from_pool"),poolId:k.Yj().min(1),choicesAllowed:k.ai().int().min(1)}),ep=k.gM("type",[et,ea,es,en,eo,el,ec,ed,em,eu,eh]),ey=k.Ik({id:k.Yj().min(1),name:k.Yj().min(1),description:k.Yj().min(1),features:k.YO(ep)}),ef=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the class"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the class"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the class"}),hitDieSize:k.KC([k.eu(4),k.eu(6),k.eu(8),k.eu(10),k.eu(12)]).meta({title:"Hit Die Size",description:"Hit die size for this class (d4, d6, d8, d10, d12, integer)"}),keyAttributes:k.YO(k.k5(["strength","dexterity","intelligence","will"])).meta({title:"Key Attributes",description:"Primary attributes for this class"}),startingHP:k.ai().int().min(1).meta({title:"Starting HP",description:"Base hit points at level 1 (integer)"}),armorProficiencies:k.YO(J).meta({title:"Armor Proficiencies",description:"Types of armor this class can use"}),weaponProficiencies:k.YO(X).meta({title:"Weapon Proficiencies",description:"Types of weapons this class can use"}),saveAdvantages:k.Ik({strength:k.k5(["advantage","disadvantage","normal"]).optional().meta({title:"Strength Saves",description:"Saving throw modifier for strength"}),dexterity:k.k5(["advantage","disadvantage","normal"]).optional().meta({title:"Dexterity Saves",description:"Saving throw modifier for dexterity"}),intelligence:k.k5(["advantage","disadvantage","normal"]).optional().meta({title:"Intelligence Saves",description:"Saving throw modifier for intelligence"}),will:k.k5(["advantage","disadvantage","normal"]).optional().meta({title:"Will Saves",description:"Saving throw modifier for will"})}).meta({title:"Save Advantages",description:"Saving throw advantages/disadvantages"}),startingEquipment:k.YO(k.Yj()).meta({title:"Starting Equipment",description:"Array of repository item IDs for starting equipment"}),features:k.YO(ep).meta({title:"Features",description:"Array of class features by level"}),featurePools:k.YO(ey).optional().meta({title:"Feature Pools",description:"Pools of features for player selection"}),subclasses:k.YO(k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the subclass"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the subclass"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the subclass"}),parentClassId:k.Yj().min(1).meta({title:"Parent Class ID",description:"ID of the parent class"}),features:k.YO(ep).meta({title:"Features",description:"Array of subclass features by level"})})).optional().meta({title:"Subclasses",description:"Available subclasses for this class"})}).meta({title:"Class Definition",description:"Character class definition with features, proficiencies, and progression"}),eg=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the subclass"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the subclass"}),description:k.Yj().min(1).meta({title:"Description",description:"Detailed description of the subclass"}),parentClassId:k.Yj().min(1).meta({title:"Parent Class ID",description:"ID of the parent class"}),features:k.YO(ep).meta({title:"Features",description:"Array of subclass features by level"})}).meta({title:"Subclass Definition",description:"Character subclass specialization"}),ex=k.Ik({id:k.Yj().min(1).meta({title:"ID",description:"Unique identifier for the spell school"}),name:k.Yj().min(1).meta({title:"Name",description:"Display name of the spell school"}),description:k.Yj().min(1).meta({title:"Description",description:"Description of the school's magical focus"}),spells:k.YO(Q).meta({title:"Spells",description:"Array of spells in this school"}),utilitySpells:k.YO(Q).optional().default([]).meta({title:"Utility Spells",description:"Array of utility spells that must be learned separately"})}).meta({title:"Spell School Definition",description:"School of magic with associated spells"}),ev=k.k5(["strength","dexterity","intelligence","will"]),eb=k.k5(["advantage","disadvantage","normal"]),ew=k.Ik({strength:eb.optional(),dexterity:eb.optional(),intelligence:eb.optional(),will:eb.optional()}).default({}),ej=k.Ik({id:k.Yj(),name:k.Yj().min(1),size:k.Wh().min(0),description:k.Yj().optional()}),eN=k.gM("type",[ej.extend({type:k.eu("weapon"),equipped:k.zM().optional(),attribute:ev.optional(),damage:k.Yj().optional(),properties:k.YO(k.Yj()).optional()}),ej.extend({type:k.eu("armor"),equipped:k.zM().optional(),armor:k.Wh().optional(),maxDexBonus:k.Wh().optional(),isMainArmor:k.zM().optional(),properties:k.YO(k.Yj()).optional()}),ej.extend({type:k.eu("freeform")}),ej.extend({type:k.eu("consumable"),count:k.Wh().min(1)}),ej.extend({type:k.eu("ammunition"),count:k.Wh().min(1)})]),ek=k.Ik({maxSize:k.Wh().min(0),items:k.YO(eN)}),eS=k.Ik({strength:k.Wh().min(C.L.character.attributeRange.min).max(C.L.character.attributeRange.max),dexterity:k.Wh().min(C.L.character.attributeRange.min).max(C.L.character.attributeRange.max),intelligence:k.Wh().min(C.L.character.attributeRange.min).max(C.L.character.attributeRange.max),will:k.Wh().min(C.L.character.attributeRange.min).max(C.L.character.attributeRange.max)}),eC=k.Ik({name:k.Yj(),associatedAttribute:ev,modifier:k.Wh().min(C.L.character.skillModifierRange.min).max(C.L.character.skillModifierRange.max)}),eA=k.Ik({current:k.Wh().min(0),max:k.Wh().min(1),temporary:k.Wh().min(0)}),e_=k.Ik({current:k.Wh().min(0),base:k.Wh().min(1),bonus:k.Wh().min(0)}),eI=k.Ik({size:k.KC([k.eu(4),k.eu(6),k.eu(8),k.eu(10),k.eu(12)]),current:k.Wh().min(0),max:k.Wh().min(1)}),eT=k.Ik({current:k.Wh().min(0),max:k.Wh().min(1)}),eR=k.Ik({id:k.Yj().min(1),name:k.Yj().min(1),description:k.Yj().optional(),colorScheme:k.k5(["blue-magic","red-fury","green-nature","purple-arcane","orange-ki","yellow-divine","teal-focus","gray-stamina"]),icon:k.k5(["sparkles","crystal","wand","orb","star","comet","fire","lightning","zap","battery","sun","flame","muscle","heart","droplet","shield","sword","eye","brain","leaf","snowflake","potion","hourglass"]).optional(),resetCondition:k.k5(["safe_rest","encounter_end","turn_end","never","manual"]),resetType:k.k5(["to_max","to_zero","to_default"]),resetValue:k.Wh().optional(),minValue:k.Wh().min(0),maxValue:k.Wh().min(1)}),eD=k.Ik({definition:eR,current:k.Wh().min(0),sortOrder:k.Wh().min(0)}),eL=k.Ik({maxWounds:k.Wh().min(1),maxInventorySize:k.Wh().min(1)}),eE=k.Ik({count:k.Wh().min(1),sides:k.KC([k.eu(4),k.eu(6),k.eu(8),k.eu(10),k.eu(12),k.eu(20),k.eu(100)])}),eP=k.Ik({dice:eE,modifier:k.Wh().optional(),attribute:ev.optional()}),eF=k.Ik({type:k.eu("fixed"),resourceId:k.Yj().min(1),amount:k.Wh().min(1)}),eB=k.Ik({type:k.eu("variable"),resourceId:k.Yj().min(1),minAmount:k.Wh().min(1),maxAmount:k.Wh().min(1)}).refine(e=>e.maxAmount>=e.minAmount,{message:"maxAmount must be greater than or equal to minAmount",path:["maxAmount"]}),eM=k.gM("type",[eF,eB]),eW=k.gM("type",[k.Ik({id:k.Yj(),name:k.Yj().min(1),description:k.Yj(),type:k.eu("freeform")}),k.Ik({id:k.Yj(),name:k.Yj().min(1),description:k.Yj(),type:k.eu("action"),frequency:k.k5(["per_turn","per_encounter","per_safe_rest","at_will"]),maxUses:k.Wh().min(1).optional(),currentUses:k.Wh().min(0).optional(),roll:eP.optional(),actionCost:k.Wh().min(0).optional(),resourceCost:eM.optional()}).refine(e=>"at_will"===e.frequency||void 0!==e.maxUses,{message:"Abilities with frequency other than 'at_will' must specify maxUses",path:["maxUses"]}),k.Ik({id:k.Yj(),name:k.Yj().min(1),description:k.Yj(),type:k.eu("spell"),school:k.Yj().min(1),tier:k.Wh().min(1).max(9),roll:eP.optional(),actionCost:k.Wh().min(0).optional(),resourceCost:eM.optional()})]);k.YO(eW);let eY=k.gM("type",[k.Ik({type:k.eu("cloth")}),k.Ik({type:k.eu("leather")}),k.Ik({type:k.eu("mail")}),k.Ik({type:k.eu("plate")}),k.Ik({type:k.eu("shields")}),k.Ik({type:k.eu("freeform"),name:k.Yj().min(1)})]),ez=k.gM("type",[k.Ik({type:k.eu("strength_weapons")}),k.Ik({type:k.eu("dexterity_weapons")}),k.Ik({type:k.eu("freeform"),name:k.Yj().min(1)})]),eO=k.Ik({armor:k.YO(eY),weapons:k.YO(ez)}),eU=k.Ik({grantedByFeatureId:k.Yj().min(1),selectedAt:S.p6()}),eH=eU.extend({type:k.eu("pool_feature"),poolId:k.Yj().min(1),featureId:k.Yj().min(1),feature:ep}),eq=eU.extend({type:k.eu("spell_school"),schoolId:k.Yj().min(1)}),eG=eU.extend({type:k.eu("stat_boost"),attribute:ev,amount:k.ai().int().positive()}),eV=eU.extend({type:k.eu("utility_spells"),spellIds:k.YO(k.Yj().min(1)),fromSchools:k.YO(k.Yj().min(1))}),eK=k.gM("type",[eH,eq,eG,eV]),eJ=k.Ik({name:k.Yj().min(1).max(50),ancestry:z,background:q,level:k.Wh().min(1).max(20),classId:k.Yj().min(1),subclassId:k.Yj().optional(),grantedFeatures:k.YO(k.Yj()),selectedFeatures:k.YO(eK),spellTierAccess:k.Wh().min(0).max(9),proficiencies:eO,attributes:eS,saveAdvantages:ew,hitPoints:eA,hitDice:eI,wounds:eT,resources:k.YO(eD),config:eL,initiative:eC,actionTracker:e_,inEncounter:k.zM(),skills:k.g1(k.Yj(),eC),inventory:ek,abilities:k.YO(eW)}),eX=k.Ik({id:k.Yj().min(1),name:k.Yj().min(1).max(50),ancestry:z,background:q,level:k.Wh().min(1).max(20),classId:k.Yj().min(1),subclassId:k.Yj().optional(),grantedFeatures:k.YO(k.Yj()),selectedFeatures:k.YO(eK),spellTierAccess:k.Wh().min(0).max(9),proficiencies:eO,attributes:eS,saveAdvantages:ew,hitPoints:eA,hitDice:eI,wounds:eT,resources:k.YO(eD),config:eL,initiative:eC,actionTracker:e_,inEncounter:k.zM(),skills:k.g1(k.Yj(),eC),inventory:ek,abilities:k.YO(eW),createdAt:k.p6(),updatedAt:k.p6()}),eZ=()=>{let e={};return C.L.skills.forEach(t=>{e[t.name]={name:t.label,associatedAttribute:t.attribute,modifier:0}}),e},eQ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{maxSize:C.L.character.skillModifierRange.max-2+e,items:[]}},e$=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return{current:e,max:e,temporary:0}},e0=()=>({name:"Initiative",associatedAttribute:"dexterity",modifier:0}),e1=()=>({current:3,base:3,bonus:0}),e2=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return{size:t,current:e,max:e}},e4=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return{current:0,max:e}},e3=()=>({maxWounds:6,maxInventorySize:10}),e5=e=>({armor:(null==e?void 0:e.armorProficiencies)||[],weapons:(null==e?void 0:e.weaponProficiencies)||[]});class e6{async createCharacter(e,t){let a=eJ.parse(e);return this.repository.create(a,t)}async getCharacter(e){let t=await this.repository.load(e);return t?this.validateOrRecoverCharacter(t,e):null}async getAllCharacters(){try{let e=await this.repository.list(),t=[];for(let a of e){let e=await this.validateOrRecoverCharacter(a,a.id||"recovered-".concat(Date.now()));e&&t.push(e)}return t}catch(e){return console.error("Failed to load character list:",e),[]}}async updateCharacter(e){let t=eX.parse(e);await this.repository.save(t)}async deleteCharacter(e){await this.repository.delete(e)}async updateLastPlayed(e){let t=await this.getCharacter(e);t&&(t.updatedAt=new Date,await this.updateCharacter(t))}async validateOrRecoverCharacter(e,t){try{return eX.parse(e)}catch(a){console.warn("Character ".concat(t," failed validation, attempting recovery by merging with defaults:"),a);try{let a=((e,t)=>{let a=function e(t,a){let i={...t};for(let s in a)null!=a[s]&&("object"!=typeof a[s]||Array.isArray(a[s])||a[s]instanceof Date?i[s]=a[s]:i[s]=e(t[s]||{},a[s]));return i}((()=>{let e={strength:C.L.character.attributeRange.min+2,dexterity:C.L.character.attributeRange.min+2,intelligence:C.L.character.attributeRange.min+2,will:C.L.character.attributeRange.min+2};return{name:"Unnamed Character",level:1,grantedFeatures:[],selectedFeatures:[],spellTierAccess:0,proficiencies:e5(),attributes:e,saveAdvantages:{strength:"normal",dexterity:"normal",intelligence:"normal",will:"normal"},hitPoints:e$(10),hitDice:e2(1,8),wounds:e4(6),resources:[],config:e3(),initiative:e0(),actionTracker:e1(),inEncounter:!1,skills:eZ(),inventory:eQ(0),abilities:[],createdAt:new Date,updatedAt:new Date}})(),e);return a.id=t,a.updatedAt=new Date,a})(e,t),i=eX.parse(a);return await this.repository.save(i),console.info("Successfully recovered character ".concat(t," by merging with defaults")),i}catch(e){return console.error("Failed to recover character ".concat(t," even after merging with defaults:"),e),null}}}constructor(e=new N){this.repository=e,this.characterListStorageKey="nimble-navigator-character-list"}}let e8=new e6;var e7=a(829);class e9{useAbility(e,t,a,i,s,r){let n,o=e.find(e=>e.id===t);if(!o||"action"!==o.type&&"spell"!==o.type)return{updatedAbilities:e,usedAbility:null,success:!1};let l=o.actionCost||0;if(i&&l>0&&(a||0)<l)return{updatedAbilities:e,usedAbility:null,success:!1,actionsRequired:l};if(o.resourceCost&&s){let t,a=o.resourceCost,i=s.find(e=>e.definition.id===a.resourceId);if(!i)return{updatedAbilities:e,usedAbility:null,success:!1,insufficientResource:a.resourceId};if("fixed"===a.type)t=a.amount;else if((t=r||a.minAmount)<a.minAmount||t>a.maxAmount)return{updatedAbilities:e,usedAbility:null,success:!1,insufficientResource:"Invalid amount: ".concat(t," (must be ").concat(a.minAmount,"-").concat(a.maxAmount,")")};if(i.current<t)return{updatedAbilities:e,usedAbility:null,success:!1,insufficientResource:i.definition.name}}if(o.resourceCost){let e,t=o.resourceCost;e="fixed"===t.type?t.amount:r||t.minAmount,n={resourceId:t.resourceId,amount:e}}return"spell"===o.type||"action"===o.type&&"at_will"===o.frequency?{updatedAbilities:e,usedAbility:o,success:!0,actionsRequired:l,resourceCost:n}:"action"===o.type&&(!o.currentUses||o.currentUses<=0)?{updatedAbilities:e,usedAbility:null,success:!1}:{updatedAbilities:e.map(e=>e.id===t&&"action"===e.type?{...e,currentUses:(e.currentUses||1)-1}:e),usedAbility:"action"===o.type?{...o,currentUses:(o.currentUses||1)-1}:o,success:!0,actionsRequired:l,resourceCost:n}}resetAbilities(e,t){return e.map(e=>"action"===e.type&&e.frequency===t&&e.maxUses?{...e,currentUses:e.maxUses}:e)}addAbility(e,t){return[...e,t]}removeAbility(e,t){return e.filter(e=>e.id!==t)}updateAbility(e,t){return e.map(e=>e.id===t.id?t:e)}getActionAbilities(e){return e.filter(e=>"action"===e.type)}getSpellAbilities(e){return e.filter(e=>"spell"===e.type)}getUsableAbilities(e){return e.filter(e=>"action"===e.type||"spell"===e.type)}calculateAbilityRollModifier(e,t){let a=e.modifier||0;return e.attribute&&(a+=t.attributes[e.attribute]),a}getAbilityRollDescription(e,t){let a=["".concat(e.dice.count,"d").concat(e.dice.sides)];if(e.modifier&&a.push(e.modifier>0?"+".concat(e.modifier):"".concat(e.modifier)),e.attribute){let i=t.attributes[e.attribute],s=e.attribute.charAt(0).toUpperCase()+e.attribute.slice(1,3);a.push(i>=0?"+".concat(i," ").concat(s):"".concat(i," ").concat(s))}return a.join(" ")}}let te=new e9;class tt{get character(){return this._character}subscribeToEvent(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t),()=>{let a=this.eventListeners.get(e);if(a){let e=a.indexOf(t);e>-1&&a.splice(e,1)}}}emitEvent(e){let t=this.eventListeners.get(e.type);t&&t.forEach(t=>t(e))}getCurrentCharacter(){return this.character}async loadCharacter(e){let t=await this.storageService.getCharacter(e);if(t){this._character&&(await this.storageService.updateLastPlayed(this._character.id),this.emitEvent({type:"switched",characterId:e,character:t})),this._character=t;let a=t0(),i={...await a.getSettings(),activeCharacterId:e};await a.saveSettings(i),await this.syncCharacterFeatures(),this.notifyCharacterChanged()}return t}notifyCharacterChanged(){this.character&&this.emitEvent({type:"updated",characterId:this.character.id,character:this.character})}async syncCharacterFeatures(){if(!this._character)return;let e=tJ(),t=tX(),a=tZ();await e.syncCharacterFeatures(),await t.grantAncestryFeatures(this._character.id),await a.grantBackgroundFeatures(this._character.id);let i=await this.storageService.getCharacter(this._character.id);i&&(this._character=i)}async saveCharacter(){this.character&&await this.storageService.updateCharacter(this.character)}async applyDamage(e,t){if(!this._character)return;let a=e,i=this._character.hitPoints.temporary,s=this._character.hitPoints.current,r="hp";"hp"!==t&&this._character.hitPoints.temporary>0&&(a>=this._character.hitPoints.temporary?(a-=this._character.hitPoints.temporary,i=0,r=a>0?"hp":"temp_hp"):(i=this._character.hitPoints.temporary-a,a=0,r="temp_hp")),a>0&&(s=Math.max(0,this._character.hitPoints.current-a),r="hp");let n=this._character.hitPoints.current>0&&0===s;this._character={...this._character,hitPoints:{...this._character.hitPoints,current:s,temporary:i},wounds:n&&this._character.wounds.current<this._character.wounds.max?{...this._character.wounds,current:this._character.wounds.current+1}:this._character.wounds},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createDamageEntry(e,r))}async applyHealing(e){if(!this._character)return;let t=Math.min(this._character.hitPoints.max,this._character.hitPoints.current+e);this._character={...this._character,hitPoints:{...this._character.hitPoints,current:t}},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createHealingEntry(e))}async applyTemporaryHP(e){if(!this._character)return;let t=this._character.hitPoints.temporary>0?this._character.hitPoints.temporary:void 0,a=Math.max(this._character.hitPoints.temporary,e);this._character={...this._character,hitPoints:{...this._character.hitPoints,temporary:a}},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createTempHPEntry(e,t))}async updateHitPoints(e,t,a){this._character&&(this._character={...this._character,hitPoints:{current:Math.min(e,t),max:t,temporary:a}},await this.saveCharacter(),this.notifyCharacterChanged())}async updateWounds(e,t){this._character&&(this._character={...this._character,wounds:{current:Math.max(0,Math.min(e,t)),max:Math.max(1,t)}},await this.saveCharacter(),this.notifyCharacterChanged())}async updateActionTracker(e){this._character&&(this._character={...this._character,actionTracker:e},await this.saveCharacter(),this.notifyCharacterChanged())}async updateAbilities(e){this._character&&(this._character={...this._character,abilities:e},await this.saveCharacter(),this.notifyCharacterChanged())}async performSafeRest(){if(!this._character)return;let e=this.abilityService.resetAbilities(this._character.abilities,"per_turn");e=this.abilityService.resetAbilities(e,"per_encounter"),e=this.abilityService.resetAbilities(e,"per_safe_rest");let t=j.resetResourcesByCondition(this._character,"safe_rest"),a=this._character.hitPoints.max-this._character.hitPoints.current,i=this._character.hitDice.max-this._character.hitDice.current,s=+(this._character.wounds.current>0),r=this._character.abilities.filter(e=>"action"===e.type&&"at_will"!==e.frequency&&e.currentUses!==e.maxUses).length;for(let n of(this._character={...this._character,hitPoints:{...this._character.hitPoints,current:this._character.hitPoints.max,temporary:0},hitDice:{...this._character.hitDice,current:this._character.hitDice.max},wounds:{...this._character.wounds,current:Math.max(0,this._character.wounds.current-1)},abilities:e,inEncounter:!1,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.base,bonus:0}},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createSafeRestEntry(a,i,s,r)),t)){let e=j.createResourceLogEntry(n);await this.logService.addLogEntry(e)}}async performCatchBreath(){if(!this._character)return;if(this._character.hitDice.current<=0)return void await this.logService.addLogEntry(this.logService.createCatchBreathEntry(0,0,0));let e=t$(),t=this._character.hitDice.size,a=this._character.attributes.strength,i=e.rollBasicDice(1,t,0),s=Math.max(1,i.dice[0].result+a),r=this._character.hitPoints.current,n=this._character.hitPoints.max,o=Math.min(s,n-r);this._character={...this._character,hitPoints:{...this._character.hitPoints,current:Math.min(n,r+o),temporary:0},hitDice:{...this._character.hitDice,current:this._character.hitDice.current-1},inEncounter:!1,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.base,bonus:0}},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createCatchBreathEntry(1,o,0)),await this.logService.addLogEntry(this.logService.createDiceRollEntry(i.dice,i.droppedDice,a,s,"Catch Breath (d".concat(t," + ").concat(a," STR = ").concat(s," healing)")))}async performMakeCamp(){if(!this._character||this._character.hitDice.current<=0)return;let e=Math.max(1,this._character.hitDice.size+this._character.attributes.strength),t=this._character.hitPoints.current,a=this._character.hitPoints.max,i=Math.min(e,a-t);this._character={...this._character,hitPoints:{...this._character.hitPoints,current:Math.min(a,t+i),temporary:0},hitDice:{...this._character.hitDice,current:this._character.hitDice.current-1},inEncounter:!1,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.base,bonus:0}},await this.saveCharacter(),this.notifyCharacterChanged(),await this.logService.addLogEntry(this.logService.createMakeCampEntry(i,0,0))}async endEncounter(){if(!this._character)return;let e=this.abilityService.resetAbilities(this._character.abilities,"per_encounter");e=this.abilityService.resetAbilities(e,"per_turn");let t=j.resetResourcesByCondition(this._character,"encounter_end");for(let a of(this._character={...this._character,inEncounter:!1,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.base,bonus:0},abilities:e},await this.saveCharacter(),this.notifyCharacterChanged(),t)){let e=j.createResourceLogEntry(a);await this.logService.addLogEntry(e)}}async startEncounter(e){this._character&&(this._character={...this._character,inEncounter:!0,actionTracker:{...this._character.actionTracker,current:e<10?1:e<=20?2:3,base:3,bonus:0}},await this.saveCharacter(),this.notifyCharacterChanged())}async endTurn(){if(!this._character)return;let e=this.abilityService.resetAbilities(this._character.abilities,"per_turn"),t=j.resetResourcesByCondition(this._character,"turn_end");for(let a of(this._character={...this._character,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.base,bonus:0},abilities:e},await this.saveCharacter(),this.notifyCharacterChanged(),t)){let e=j.createResourceLogEntry(a);await this.logService.addLogEntry(e)}}async performAttack(e,t,a,i){if(this._character){if(this._character.inEncounter&&this._character.actionTracker.current<1)return void console.error("Not enough actions to attack (need 1, have "+this._character.actionTracker.current+")");try{let s=t$().rollAttack(t,a,i),r=this.logService.createDiceRollEntry(s.dice,s.droppedDice,a,s.total,"".concat(e," attack"),i,s.isMiss,s.criticalHits);await this.logService.addLogEntry(r),this._character.inEncounter&&(this._character={...this._character,actionTracker:{...this._character.actionTracker,current:this._character.actionTracker.current-1}},await this.saveCharacter(),this.notifyCharacterChanged())}catch(e){console.error("Failed to perform attack:",e)}}}async performUseAbility(e,t){if(this._character)try{let i=this.abilityService.useAbility(this._character.abilities,e,this._character.actionTracker.current,this._character.inEncounter,this._character.resources,t);if(!i.success||!i.usedAbility)return void(i.actionsRequired&&this._character.inEncounter&&this._character.actionTracker.current<i.actionsRequired?console.error("Failed to use ability: not enough actions (need ".concat(i.actionsRequired,", have ").concat(this._character.actionTracker.current,")")):i.insufficientResource?console.error("Failed to use ability: insufficient ".concat(i.insufficientResource)):console.error("Failed to use ability: ability not found or no uses remaining"));let s=i.actionsRequired||0,r=this._character.inEncounter&&s>0?{...this._character.actionTracker,current:this._character.actionTracker.current-s}:this._character.actionTracker,n=this._character.resources;if(i.resourceCost&&(n=this._character.resources.map(e=>e.definition.id===i.resourceCost.resourceId?{...e,current:e.current-i.resourceCost.amount}:e)),this._character={...this._character,abilities:i.updatedAbilities,actionTracker:r,resources:n},await this.saveCharacter(),this.notifyCharacterChanged(),"spell"===i.usedAbility.type){var a;let e=i.usedAbility,t=i.resourceCost?{resourceId:i.resourceCost.resourceId,resourceName:(null==(a=this._character.resources.find(e=>e.definition.id===i.resourceCost.resourceId))?void 0:a.definition.name)||i.resourceCost.resourceId,amount:i.resourceCost.amount}:void 0,s=this.logService.createSpellCastEntry(e.name,e.school,e.tier,i.actionsRequired||0,t);await this.logService.addLogEntry(s)}else{let e=i.usedAbility,t=this.logService.createAbilityUsageEntry(e.name,e.frequency,e.currentUses||0,e.maxUses||0);await this.logService.addLogEntry(t)}if(i.usedAbility.roll){let e=i.usedAbility.roll,t=this.abilityService.calculateAbilityRollModifier(e,this._character),a=t$(),s="".concat(e.dice.count,"d").concat(e.dice.sides),r=a.rollAttack(s,t,0),n=this.logService.createDiceRollEntry(r.dice,r.droppedDice,t,r.total,"".concat(i.usedAbility.name," ability roll"),0);await this.logService.addLogEntry(n)}}catch(e){console.error("Failed to use ability:",e)}}async updateCharacterFields(e){if(!this._character)return;let t={...this._character,...e,updatedAt:new Date};if(e.attributes){var a;let i=null!=(a=e.attributes.strength)?a:this._character.attributes.strength;t={...t,inventory:{...t.inventory,maxSize:10+i}}}this._character=t,await this.saveCharacter(),this.notifyCharacterChanged()}async updateCharacterConfiguration(e){if(!this._character)return;let t={...this._character,config:e,wounds:{...this._character.wounds,max:e.maxWounds}};this._character=t,await this.saveCharacter(),this.notifyCharacterChanged()}async updateCharacter(e){this._character=e,await this.saveCharacter(),this.notifyCharacterChanged()}async addItemToInventory(e){if(!this._character)return;let t={...this._character.inventory,items:[...this._character.inventory.items,e]},a={...this._character,inventory:t};this._character=a,await this.saveCharacter(),this.notifyCharacterChanged()}async deleteCharacterById(e){var t;await this.storageService.deleteCharacter(e),(null==(t=this._character)?void 0:t.id)===e&&(this._character=null),this.emitEvent({type:"deleted",characterId:e})}notifyCharacterCreated(e){this.emitEvent({type:"created",characterId:e.id,character:e})}constructor(e,t,a){this.storageService=e,this.logService=t,this.abilityService=a,this._character=null,this.eventListeners=new Map}}function ta(e,t,a){return{definition:e,current:null!=t?t:e.maxValue,sortOrder:null!=a?a:1}}new tt(e8,e7.P,te);let ti={id:"path-of-the-red-mist",name:"Path of the Red Mist",description:"Berserkers who follow the Path of the Red Mist become avatars of carnage on the battlefield. They gain supernatural awareness through the scent of blood and their fury transforms them into relentless killing machines.",parentClassId:"berserker",features:[{id:"red-mist-blood-frenzy",level:3,type:"ability",name:"Blood Frenzy",description:"(1/turn) While Raging, whenever you crit or kill an enemy, change 1 Fury Die to the maximum.",ability:{id:"blood-frenzy",name:"Blood Frenzy",description:"While Raging, whenever you crit or kill an enemy, change 1 Fury Die to the maximum.",type:"action",frequency:"per_turn",maxUses:1}},{id:"red-mist-savage-awareness",level:3,type:"passive_feature",name:"Savage Awareness",description:"Advantage on Perception checks to notice or track down blood. Blindsight 2 while Raging: you ignore the Blinded condition and can see through darkness and Invisibility within that Range.",category:"exploration"},{id:"red-mist-unstoppable-brutality",level:7,type:"passive_feature",name:"Unstoppable Brutality",description:"While Raging, you may gain 1 Wound to reroll any attack or save.",category:"combat"},{id:"red-mist-opportunistic-frenzy",level:11,type:"passive_feature",name:"Opportunistic Frenzy",description:"While Raging, you can make opportunity attacks without disadvantage, and you may make them whenever an enemy enters your melee weapon's reach.",category:"combat"},{id:"red-mist-onslaught",level:15,type:"passive_feature",name:"Onslaught",description:"While Raging, gain +2 speed. (1/round) you may move for free.",category:"combat"}]},ts={id:"path-of-the-mountainheart",name:"Path of the Mountainheart",description:"Berserkers who follow the Path of the Mountainheart embody the unyielding strength and endurance of mountains themselves. They become nearly impossible to bring down, shrugging off wounds that would fell lesser warriors.",parentClassId:"berserker",features:[{id:"mountainheart-stones-resilience",level:3,type:"passive_feature",name:"Stone's Resilience",description:"Whenever you expend Fury Dice to reduce incoming damage, add the value of the die to the amount reduced.",category:"combat"},{id:"mountainheart-tenacity",level:3,type:"passive_feature",name:"Mountain Tenacity",description:"Whenever you expend your Hit Dice to recover HP, for every 10 HP you would recover, you may heal 1 Wound instead.",category:"utility"},{id:"mountainheart-unbreakable",level:7,type:"ability",name:"Unbreakable",description:"(1/encounter) While Raging, if you would suffer your last Wound or other negative condition of your choice, you don't.",ability:{id:"unbreakable",name:"Unbreakable",description:"While Raging, if you would suffer your last Wound or other negative condition of your choice, you don't.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"mountainheart-titans-fury",level:11,type:"passive_feature",name:"Titan's Fury",description:"After you miss an attack or are crit by an enemy, Rage for free.",category:"combat"},{id:"mountainheart-mountains-endurance",level:15,type:"passive_feature",name:"Mountain's Endurance",description:"While Dying, if an attack against you would be a crit, the attack is rerolled instead (when-crit abilities, such as Titan's Fury, still trigger).",category:"combat"}]},tr={id:"tools-of-the-silent-blade",name:"Tools of the Silent Blade",description:"Cheats who follow the path of the Silent Blade become masters of assassination and stealth. They strike from the shadows with lethal precision, leaving no trace of their presence.",parentClassId:"cheat",features:[{id:"silent-blade-amidst-all-this-commotion",level:3,type:"passive_feature",name:"Amidst All This Commotion...",description:"If a creature dies while you Sneak Attack them, you may turn Invisible until you attack again or until the beginning of your next turn.",category:"combat"},{id:"silent-blade-leave-no-trace",level:3,type:"passive_feature",name:"Leave No Trace",description:"Advantage on Stealth checks when you are at full health.",category:"exploration"},{id:"silent-blade-cunning-strike",level:7,type:"ability",name:"Cunning Strike",description:"(2/encounter) When you land a Sneak Attack, you may force the target to make a STR save (DC 10+INT). On a failure, instead of rolling your Sneak Attack dice, you may do the maximum amount of damage (if your target saves, regain 1 use).",ability:{id:"cunning-strike",name:"Cunning Strike",description:"When you land a Sneak Attack, you may force the target to make a STR save (DC 10+INT). On a failure, instead of rolling your Sneak Attack dice, you may do the maximum amount of damage (if your target saves, regain 1 use).",type:"action",frequency:"per_encounter",maxUses:2}},{id:"silent-blade-professional-skulker",level:11,type:"passive_feature",name:"Professional Skulker",description:"Gain a climbing speed and advantage on Stealth checks (replaces Leave No Trace).",category:"exploration"},{id:"silent-blade-kill",level:15,type:"passive_feature",name:"KILL",description:"When you crit an enemy with fewer max HP than you, it dies.",category:"combat"}]},tn={id:"tools-of-the-scoundrel",name:"Tools of the Scoundrel",description:"Cheats who embrace the path of the Scoundrel become masters of misdirection and dirty tricks. They fight without honor but with incredible effectiveness, always having an escape plan ready.",parentClassId:"cheat",features:[{id:"scoundrel-low-blow",level:3,type:"ability",name:"Low Blow",description:"When you Sneak Attack, you may spend 2 additional actions to Incapacitate your target until the start of your next turn (STR save DC 10+INT). Save or fail, they are Taunted by you until you drop to 0 HP.",ability:{id:"low-blow",name:"Low Blow",description:"When you Sneak Attack, you may spend 2 additional actions to Incapacitate your target until the start of your next turn (STR save DC 10+INT). Save or fail, they are Taunted by you until you drop to 0 HP.",type:"action",frequency:"at_will",actionCost:2}},{id:"scoundrel-sweet-talk",level:3,type:"passive_feature",name:"Sweet Talk",description:"You may gain advantage on all Influence checks with NPC's you've just met for the first time. This lasts until you fail an Influence check with them or until you meet a 2nd time. You have disadvantage on Influence checks with them after you use this ability (until you get back on good terms).",category:"social"},{id:"scoundrel-pocket-sand",level:7,type:"ability",name:"Pocket Sand",description:"(2/encounter-you've got to collect more sand!) When you Defend against a melee attack, Blind the attacker until the start of their next turn and force them to reroll the attack (Blinded creatures attack with disadvantage).",ability:{id:"pocket-sand",name:"Pocket Sand",description:"When you Defend against a melee attack, Blind the attacker until the start of their next turn and force them to reroll the attack (Blinded creatures attack with disadvantage).",type:"action",frequency:"per_encounter",maxUses:2}},{id:"scoundrel-escape-plan",level:11,type:"ability",name:"Escape Plan",description:"(1/Safe Rest) When you would drop to 0 HP or gain a Wound, you don't. Instead, you turn Invisible for 1 minute or until you attack.",ability:{id:"escape-plan",name:"Escape Plan",description:"When you would drop to 0 HP or gain a Wound, you don't. Instead, you turn Invisible for 1 minute or until you attack.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"scoundrel-heads-i-win-tails-you-lose",level:15,type:"ability",name:"Heads I Win, Tails You Lose",description:"(1/encounter) Attacks you make this round don't miss, you crit on 1 less than normally needed, and you gain LVL temp HP.",ability:{id:"heads-i-win-tails-you-lose",name:"Heads I Win, Tails You Lose",description:"Attacks you make this round don't miss, you crit on 1 less than normally needed, and you gain LVL temp HP.",type:"action",frequency:"per_encounter",maxUses:1}}]},to={id:"champion-of-the-bulwark",name:"Champion of the Bulwark",description:"Commanders who become Champions of the Bulwark are immovable defenders who protect their allies with superior armor and shield techniques. They excel at drawing enemy attention and surviving punishment.",parentClassId:"commander",features:[{id:"bulwark-armor-master",level:3,type:"passive_feature",name:"Armor Master",description:"You are proficient with plate armor.",category:"combat"},{id:"bulwark-shield-expert",level:3,type:"passive_feature",name:"Shield Expert",description:"While wearing a shield, you may Defend 2\xd7 each round. The first time each round you block all of the damage from an attack, you may make an opportunity attack against the attacker for free.",category:"combat"},{id:"bulwark-juggernaut",level:7,type:"passive_feature",name:"Juggernaut",description:"When you use Coordinated Strike, you deal extra damage equal to your armor, and you can add 1 to your primary die.",category:"combat"},{id:"bulwark-taunting-strike",level:11,type:"ability",name:"Taunting Strike",description:"(1/turn) You may Taunt a creature you hit until the end of their next turn.",ability:{id:"taunting-strike",name:"Taunting Strike",description:"Taunt a creature you hit until the end of their next turn.",type:"action",frequency:"per_turn",maxUses:1}},{id:"bulwark-shield-wall",level:15,type:"passive_feature",name:"Shield Wall",description:"Allies within 2 spaces gain ALL the benefits of the shield you have equipped.",category:"combat"}]},tl={id:"champion-of-the-vanguard",name:"Champion of the Vanguard",description:"Commanders who become Champions of the Vanguard lead from the front, inspiring allies with aggressive tactics and coordinated assaults. They excel at creating opportunities for their team through superior positioning and timing.",parentClassId:"commander",features:[{id:"vanguard-advance",level:3,type:"ability",name:"Advance!",description:"(1/round) After you move toward an enemy, gain advantage on the first melee attack you make against it. When you use your Coordinated Strike, you and all allies within 12 spaces can first move up to half their speed for free.",ability:{id:"advance",name:"Advance!",description:"After you move toward an enemy, gain advantage on the first melee attack you make against it. When you use your Coordinated Strike, you and all allies within 12 spaces can first move up to half their speed for free.",type:"action",frequency:"per_turn",maxUses:1}},{id:"vanguard-experienced-commander",level:7,type:"passive_feature",name:"Experienced Commander",description:"Your Coordinated Strike may target 1 additional ally. Gain +1 use of Coordinated Strike/Safe Rest.",category:"combat"},{id:"vanguard-survey-the-battlefield",level:11,type:"passive_feature",name:"Survey the Battlefield",description:"When you roll Initiative, regain 1 use of Coordinated Strike. +1 max Combat Dice.",category:"combat"},{id:"vanguard-as-one",level:15,type:"passive_feature",name:"As One!",description:"Attacks made with your Coordinated Strike also grant advantage and ignore all disadvantage. Your chosen allies gain 1 additional action to use on their next turn.",category:"combat"}]},tc={id:"circle-of-sky-and-storm",name:"Circle of Sky & Storm",description:"Stormshifters who focus on mastering elemental magic while shapeshifted, blending spell and beast forms seamlessly.",parentClassId:"stormshifter",features:[{id:"deepening-study",level:3,type:"passive_feature",name:"Deepening Study",description:"Choose the Ice or Radiant school to learn.",category:"combat"},{id:"creature-of-the-fey",level:3,type:"passive_feature",name:"Creature of the Fey",description:"You may cast spells while Beastshifted.",category:"combat"},{id:"attuned-to-nature",level:3,type:"passive_feature",name:"Attuned to Nature",description:"(1/day) Add LVL to any skill check related to nature or weather.",category:"exploration"},{id:"raging-tempest",level:7,type:"ability",name:"Raging Tempest",description:"Whenever you crit with a tiered spell, you may cast a cantrip for free from a school you know and haven't cast any spells from this turn (at the same level of dis/advantage).",ability:{id:"raging-tempest",name:"Raging Tempest",description:"When you crit with a tiered spell, cast a free cantrip from a different school.",type:"action",frequency:"at_will"}},{id:"primordial-force",level:11,type:"passive_feature",name:"Primordial Force",description:"Spending 2+ mana on a spell grants an additional effect: Ice. Gain LVL temp HP | Lightning. Deal additional damage equal to your WIL | Radiant. You may heal a creature within 6 spaces WIL HP | Wind. Gain a flying speed this turn. Move up to 6 spaces for free.",category:"combat"},{id:"master-of-storm",level:15,type:"passive_feature",name:"Master of Storm",description:"You can concentrate on 1 lightning spell and 1 wind spell at the same time. (1/Safe Rest) You can cast Hide the Lightning for 0 mana.",category:"combat"}]},td={id:"circle-of-fang-and-claw",name:"Circle of Fang & Claw",description:"Stormshifters who focus on perfecting their shapeshifting abilities, becoming masters of beast forms and primal combat.",parentClassId:"stormshifter",features:[{id:"swiftshift",level:3,type:"ability",name:"Swiftshift",description:"When you roll Initiative, you may Beastshift or move for free. While transformed, you may shift between different Direbeast forms for free (and as a reaction by spending 1 mana); however, Beastshifting for free does not grant any temp HP.",ability:{id:"swiftshift",name:"Swiftshift",description:"When you roll Initiative, Beastshift or move for free. While transformed, shift between Direbeast forms for free (or as reaction for 1 mana).",type:"action",frequency:"at_will"}},{id:"windborne-protector",level:3,type:"ability",name:"Windborne Protector",description:"(1/encounter) Reaction: when an enemy attacks, spend 2 mana to shift into a Fearsome Beast. Then you may Interpose from up to 12 spaces away and Defend for free (if you have not yet done so this round).",ability:{id:"windborne-protector",name:"Windborne Protector",description:"When an enemy attacks, spend 2 mana to shift into Fearsome Beast. Interpose from up to 12 spaces away and Defend for free.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"friend-of-beasts",level:3,type:"passive_feature",name:"Friend of Beasts",description:"Beasts will not attack you until you first harm them. You may transform into harmless beasts without spending a Beastshift charge.",category:"exploration"},{id:"unleash-the-beast",level:7,type:"ability",name:"Unleash the Beast",description:"(1/encounter) When you miss, you can crit instead.",ability:{id:"unleash-the-beast",name:"Unleash the Beast",description:"When you miss, you can crit instead.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"storm-wake",level:7,type:"ability",name:"Storm Wake",description:"(1/encounter) Action: Spend 3 mana to shift into a Beast of the Pack, then teleport in a straight line up to 12 spaces away, unerringly dealing WIL d8 lightning damage to any creatures adjacent to your path.",ability:{id:"storm-wake",name:"Storm Wake",description:"Spend 3 mana to shift into Beast of the Pack, teleport up to 12 spaces in a straight line, dealing WIL d8 lightning damage to adjacent creatures.",type:"action",frequency:"per_encounter",maxUses:1,actionCost:1}},{id:"master-of-forms",level:11,type:"passive_feature",name:"Master of Forms",description:"Your shapeshift forms can have 2 Chimeric Boons at a time.",category:"combat"},{id:"venomous-gaze",level:11,type:"ability",name:"Venomous Gaze",description:"(1/encounter) Action: Spend 2 mana to shift into a Beast of Nightmares. Then either poison a creature (if you move 2 \xd7 WIL spaces closer to you on a failed WIL save (they will with disadvantage and must repeat until they save or can move no further)). If they end up in the same space as you, you may Sting them for free.",ability:{id:"venomous-gaze",name:"Venomous Gaze",description:"Spend 2 mana to shift into Beast of Nightmares. Force creature to move toward you on failed WIL save, then Sting for free if they reach you.",type:"action",frequency:"per_encounter",maxUses:1,actionCost:1}},{id:"master-of-forms-2",level:15,type:"passive_feature",name:"Master of Forms (2)",description:"You can Beastshift 2 additional times per Safe Rest. Choose 2 additional Chimeric Boons. Your Direbeast forms can have 3 at a time.",category:"combat"}]},tm={id:"way-of-pain",name:"Way of Pain",description:"Zephyrs who embrace pain as a teacher, turning damage taken into power and reflecting suffering back upon their enemies.",parentClassId:"zephyr",features:[{id:"bring-the-pain",level:3,type:"ability",name:"Bring the Pain",description:"(1/round) You may turn any melee attack against you into a crit. Whenever you are crit, reduce the damage by half. The attacker takes the same amount of damage you took (ignoring armor). You may suffer 1 Wound to double the damage the enemy takes.",ability:{id:"bring-the-pain",name:"Bring the Pain",description:"Turn any melee attack into a crit. When crit, take half damage and reflect it to attacker. Suffer 1 Wound to double reflected damage.",type:"action",frequency:"at_will"}},{id:"share-my-pain",level:7,type:"ability",name:"Share My Pain",description:"Your Swiftstrike can also target a 2nd creature within Reach 2.",ability:{id:"share-my-pain",name:"Share My Pain",description:"Swiftstrike can target a 2nd creature within Reach 2.",type:"action",frequency:"at_will"}},{id:"pain-sharpens-the-mind",level:11,type:"passive_feature",name:"Pain Sharpens the Mind",description:"While you are Bloodied, gain advantage on the first attack you make each turn, and on all saves.",category:"combat"},{id:"echoed-agony",level:15,type:"ability",name:"Echoed Agony",description:"Your Swiftstrike can also target a 3rd creature within Reach 4.",ability:{id:"echoed-agony",name:"Echoed Agony",description:"Swiftstrike can target a 3rd creature within Reach 4.",type:"action",frequency:"at_will"}}]},tu={id:"way-of-flame",name:"Way of Flame",description:"Zephyrs who channel their inner fire, burning with passion and leaving trails of destruction in their wake.",parentClassId:"zephyr",features:[{id:"exploding-soul",level:3,type:"ability",name:"Exploding Soul",description:"(1/round) On your turn, you may suffer a Wound. Whenever you gain a Wound, deal STR + Wounds damage to any creatures you choose within 2 spaces (ignoring armor) and give them the Smoldering condition.",ability:{id:"exploding-soul",name:"Exploding Soul",description:"Suffer a Wound to deal STR + Wounds damage to creatures within 2 spaces (ignoring armor) and apply Smoldering.",type:"action",frequency:"at_will"}},{id:"blazing-speed",level:7,type:"passive_feature",name:"Blazing Speed",description:"Gain +2 speed while using Windstep. After you cease movement with Windstep, enemies you passed through take STR + DEX fire damage. You may have Smoldering enemies take double, ending the condition.",category:"combat"},{id:"chain-reaction",level:11,type:"ability",name:"Chain Reaction",description:"(1/turn) When you crit, deal fire damage equal to your STR + Wounds to creatures of your choice within 2 spaces of your target. Repeat any number of times, targeting creatures not yet damaged by this effect within 2 spaces of any already damaged.",ability:{id:"chain-reaction",name:"Chain Reaction",description:"On crit, deal STR + Wounds fire damage to creatures within 2 spaces of target, then chain to new targets.",type:"action",frequency:"at_will"}},{id:"burning-soul",level:15,type:"passive_feature",name:"Burning Soul",description:"Double any fire damage you deal.",category:"combat"}]},th={"berserker-red-mist":ti,"berserker-mountainheart":ts,"cheat-silent-blade":tr,"cheat-scoundrel":tn,"commander-bulwark":to,"commander-vanguard":tl,"hunter-wildheart":{id:"hunter-wildheart",name:"Keeper of the Wild Heart",parentClassId:"hunter",description:"A hunter who channels primal strength and forms deep bonds with the wilderness.",features:[{id:"impressive-form",level:3,type:"passive_feature",name:"Impressive Form",description:"+5 max HP. Upgrade your Hit Dice to d10s.",category:"combat"},{id:"i-have-the-high-ground",level:3,type:"passive_feature",name:"I Have the High Ground",description:"When you roll Initiative or gain one or more Thrill of the Hunt charges, move up to half your speed for free, ignoring difficult terrain.",category:"combat"},{id:"resourceful-herbalist",level:7,type:"passive_feature",name:"Resourceful Herbalist",description:"Whenever you Safe Rest in a location near where plants or fungi can grow, you may spend 4 gold and gain a healing herbs to craft a number of Healing Salves equal to your WIL.",category:"utility"},{id:"healing-salve",level:7,type:"ability",name:"Healing Salve",description:"Heal yourself or an adjacent creature WIL d6 HP. Only you or another Advanced Herbalist may activate these, and they expire whenever you Safe Rest.",ability:{id:"healing-salve",name:"Healing Salve",description:"Heal yourself or an adjacent creature WIL d6 HP. Only you or another Advanced Herbalist may activate these, and they expire whenever you Safe Rest.",type:"action",frequency:"at_will",actionCost:1}},{id:"ha-im-over-here",level:11,type:"ability",name:"Ha! I'm Over Here!",description:"If an attack would cause you to drop to 0 HP, you instead move up to your speed away and take no damage.",ability:{id:"ha-im-over-here",name:"Ha! I'm Over Here!",description:"If an attack would cause you to drop to 0 HP, you instead move up to your speed away and take no damage.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"unparalleled-survivalist",level:15,type:"passive_feature",name:"Unparalleled Survivalist",description:"Gain +WIL armor. When you attack with a ranged weapon, you may first move half your speed for free.",category:"combat"}]},"hunter-shadowpath":{id:"hunter-shadowpath",name:"Keeper of the Shadowpath",parentClassId:"hunter",description:"A hunter who blends stealth and cunning to stalk prey from the shadows.",features:[{id:"ambusher",level:3,type:"passive_feature",name:"Ambusher",description:"When you roll Initiative, you may use Hunter's Mark for free. Gain advantage on the first attack you make each encounter.",category:"combat"},{id:"skilled-tracker",level:3,type:"passive_feature",name:"Skilled Tracker",description:"You have advantage on skill checks to track creatures.",category:"exploration"},{id:"skilled-navigator",level:3,type:"passive_feature",name:"Skilled Navigator",description:"You cannot become lost by nonmagical means.",category:"exploration"},{id:"primal-predator",level:7,type:"ability",name:"Primal Predator",description:"Your weapon attacks ignore cover and armor this turn.",ability:{id:"primal-predator",name:"Primal Predator",description:"Your weapon attacks ignore cover and armor this turn.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"pack-hunter",level:11,type:"passive_feature",name:"Pack Hunter",description:"Whenever you mark a creature, you may also mark another creature within 6 spaces of them for free.",category:"combat"},{id:"apex-predator",level:15,type:"ability",name:"Apex Predator",description:"You may use your Primal Predator ability twice each encounter. Gain 1 Thrill of the Hunt charge when you roll Initiative.",ability:{id:"primal-predator",name:"Primal Predator",description:"Your weapon attacks ignore cover and armor this turn.",type:"action",frequency:"per_encounter",maxUses:2}}]},"mage-chaos":{id:"mage-chaos",name:"Invoker of Chaos",parentClassId:"mage",description:"A mage who embraces the wild, unpredictable nature of magic, channeling chaos for power.",features:[{id:"force-of-chaos",level:3,type:"passive_feature",name:"Force of Chaos",description:"Whenever you cast a spell, you can choose to spend 1 less mana. Whenever you do this and whenever you crit, Invoke Chaos: Roll on the Chaos Table.",category:"combat"},{id:"chaos-table-note",level:3,type:"passive_feature",name:"Chaos Table",description:"Where's the Chaos Table? It's a secret for the GM only! Suffice it to say, rolling a 1 is really bad, but rolling a 20 is AWESOMEbut if you're sure you want to spoil it, you can find it on the back inside cover of the GM's Guide. Let chaos reign!",category:"combat"},{id:"tempest-mage",level:7,type:"passive_feature",name:"Tempest Mage",description:"Learn 1 cantrip and 1 tiered spell from the Wind school.",category:"combat"},{id:"chaos-lash",level:7,type:"ability",name:"Chaos Lash",description:"(1/encounter) Reaction (when an enemy moves adjacent to you): They are pushed back 2 spaces, and on a failed WIL save, knocked Prone as well. Invoke Chaos.",ability:{id:"chaos-lash",name:"Chaos Lash",description:"When an enemy moves adjacent to you: They are pushed back 2 spaces, and on a failed WIL save, knocked Prone as well. Invoke Chaos.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"thrive-in-chaos",level:11,type:"ability",name:"Thrive in Chaos",description:"Whenever you Invoke Chaos, you may roll twice and cause both effects. (1/Safe Rest) You may choose which roll to use instead.",ability:{id:"thrive-in-chaos",name:"Thrive in Chaos - Choose Roll",description:"When you Invoke Chaos, choose which of your two rolls to use.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"master-of-chaos",level:15,type:"passive_feature",name:"Master of Chaos",description:"Whenever you Invoke Chaos, roll with advantage.",category:"combat"}]},"mage-control":{id:"mage-control",name:"Invoker of Control",parentClassId:"mage",description:"A mage who seeks to master and control the forces of magic through careful study and discipline.",features:[{id:"force-of-will",level:3,type:"ability",name:"Force of Will",description:"(1/round) On your turn, you may Demand Control. Choose 1 option from the Control Table which you haven't chosen yet, resets when you roll initiative, or when you have chosen all options once.",ability:{id:"force-of-will",name:"Force of Will - Demand Control",description:"Choose 1 option from the Control Table: I INSIST (Cast a cantrip for free, ignoring all disadvantage, it cannot miss), ELEMENTAL AFFLICTION (A creature of your choice within 12 spaces gains the Charged, Smoldering, or Slowed condition), NO (Choose a creature, it cannot harm a creature of your choice during its next turn), LOSE CONTROL (Do ALL of the above, but the GM chooses each time).",type:"action",frequency:"at_will",maxUses:1}},{id:"control-table",level:3,type:"passive_feature",name:"Control Table",description:"Magic is Dangerous. You can stitch its fraying edges together to your own benefit... for a time.\n\n I INSIST: Cast a cantrip for free, ignoring all disadvantage, it cannot miss.\n ELEMENTAL AFFLICTION: A creature of your choice within 12 spaces gains the Charged, Smoldering, or Slowed condition.\n NO: Choose a creature, it cannot harm a creature of your choice during its next turn.\n LOSE CONTROL: Do ALL of the above, but the GM chooses each time.",category:"combat"},{id:"deny-fate",level:3,type:"passive_feature",name:"Deny Fate",description:"Whenever you miss with a spell or an effect you cause is saved against, you MUST Demand Control.",category:"combat"},{id:"at-any-cost",level:7,type:"passive_feature",name:"At Any Cost",description:"Learn 1 cantrip and 1 tiered spell from the Necrotic school.",category:"combat"},{id:"nullify",level:7,type:"ability",name:"Nullify",description:"(1/encounter) Ignore all disadvantage and other negative effects on your next action this turn, then Demand Control.",ability:{id:"nullify",name:"Nullify",description:"Ignore all disadvantage and other negative effects on your next action this turn, then Demand Control.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"steel-will",level:11,type:"ability",name:"Steel Will",description:"(1/Safe Rest) Whenever you would fail a save, you may succeed instead. Whenever you roll a 1 on an Elemental Surge die, you may reroll it once.",ability:{id:"steel-will",name:"Steel Will",description:"Whenever you would fail a save, you may succeed instead.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"supreme-control",level:15,type:"passive_feature",name:"Supreme Control",description:"Whenever you Demand Control, you may choose to trigger the selected option twice. You may Demand Control as a Reaction.",category:"combat"}]},"oathsworn-vengeance":{id:"oathsworn-vengeance",name:"Oath of Vengeance",parentClassId:"oathsworn",description:"An oath sworn to bring divine justice and retribution to those who have done wrong.",features:[{id:"aura-of-zeal",level:3,type:"passive_feature",name:"Aura of Zeal",description:"Whenever you roll Judgment Dice, roll 1 more. Gain an aura with a Reach of 4. Your Radiant Judgment also triggers when an ally within your aura is attacked while you have no Judgment Dice.",category:"combat"},{id:"sacred-decree-vengeance",level:3,type:"passive_feature",name:"Sacred Decrees",description:"Vengeance Oathsworn learn specific Sacred Decrees:\n\n Blinding Aura (1/Safe Rest) Action: Enemies in your aura are Blinded until the end of their next turn. Dice, roll with advantage (roll one extra and drop the lowest).\n\n Courage! (1/encounter) When you or an ally in your aura would drop to 0 HP, instead they don't.\n\n Explosive Judgment (1/encounter) 2 actions: Expend your Judgment Dice, deal that much radiant damage to all enemies in your aura.\n\n Improved Aura: +2 aura Reach.\n\n Radiant Aura Action: End any single harmful condition or effect on yourself or another willing creature within your aura. You may use this ability WIL times/Safe Rest.\n\n Reliable Justice: Whenever you roll Judgment Dice, roll with advantage (roll one extra and drop the lowest).",category:"combat"},{id:"avenger",level:7,type:"passive_feature",name:"Avenger",description:"Whenever you or an ally within your aura gain any Wounds, change up to that many Judgment Dice to their max. Then, move up to half your speed for free.",category:"combat"},{id:"unerring-judgment",level:11,type:"passive_feature",name:"Unerring Judgment",description:"Increase your primary die rolls on melee attacks by 1 whenever you have Judgment Dice.",category:"combat"},{id:"maximum-judgment",level:15,type:"passive_feature",name:"Maximum Judgment",description:"Whenever you are attacked, set a Judgment Die to its max.",category:"combat"}]},"oathsworn-refuge":{id:"oathsworn-refuge",name:"Oath of Refuge",parentClassId:"oathsworn",description:"An oath sworn to protect the innocent and provide sanctuary to those in need.",features:[{id:"aura-of-refuge",level:3,type:"passive_feature",name:"Aura of Refuge",description:"Your shields gain +WIL armor and count as your spellcasting focus. Gain an aura with a Reach of 4; you can Interpose for an ally anywhere within your aura.",category:"combat"},{id:"sacred-decree-refuge",level:3,type:"passive_feature",name:"Sacred Decrees",description:"Refuge Oathsworn learn specific Sacred Decrees:\n\n Shining Mandate: The first time each round you are attacked while you already have Judgment Dice, select an ally within your aura to roll one and apply it to their next attack. You have advantage on skill checks to see through illusions.\n\n Stand Fast, Friends! When you roll Initiative, grant allies temp HP equal to your STR+WIL. You and allies within your aura have advantage against fear and effects that would move or knock Prone.\n\n Unstoppable Protector: Gain +1 speed. You may Interpose even if you are restrained, stunned, or otherwise incapacitated. If you Interpose for a non-combatant NPC, you may Interpose again this round.\n\n Wall Armored: Whenever you Interpose, gain temp HP equal to your STR.",category:"combat"},{id:"face-me-foul-creature",level:7,type:"ability",name:"Face Me, Foul Creature!",description:"When you Interpose, the attacking enemy is also Taunted by you until the end of their next turn.",ability:{id:"face-me-foul-creature",name:"Face Me, Foul Creature!",description:"When you Interpose, the attacking enemy is also Taunted by you until the end of their next turn.",type:"action",frequency:"at_will"}},{id:"glorious-reprieve",level:11,type:"passive_feature",name:"Glorious Reprieve",description:"You and allies in your aura cannot drop below 1 HP. Whenever this triggers, they gain 1 Wound instead (heroes still die at max Wounds).",category:"combat"},{id:"divine-grace",level:15,type:"passive_feature",name:"Divine Grace",description:"You are resistant to all damage while Interposing.",category:"combat"}]},"stormshifter-sky-storm":tc,"stormshifter-fang-claw":td,"zephyr-pain":tm,"zephyr-flame":tu};function tp(e){return th[e]||null}function ty(e,t){let a=tp(e);return a?a.features.filter(e=>e.level<=t):[]}var tf=a(1685);class tg{static validateClass(e){try{let t=ef.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateSubclass(e){try{let t=eg.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateActionAbility(e){try{let t=Z.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateSpellAbility(e){try{let t=Q.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateSpellSchool(e){try{let t=ex.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateAncestry(e){try{let t=Y.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}static validateBackground(e){try{let t=H.parse(e);return{valid:!0,data:t}}catch(e){if(e instanceof tf.G)return{valid:!1,errors:e.issues.map(e=>"".concat(e.path.join("."),": ").concat(e.message))};return{valid:!1,errors:["Unknown validation error"]}}}}var tx=function(e){return e.CLASS_DEFINITION="class-definition",e.SUBCLASS_DEFINITION="subclass-definition",e.SPELL_SCHOOL_DEFINITION="spell-school-definition",e.ANCESTRY_DEFINITION="ancestry-definition",e.BACKGROUND_DEFINITION="background-definition",e.ACTION_ABILITY="action-ability",e.SPELL_ABILITY="spell-ability",e.ITEM_REPOSITORY="item-repository",e}({});let tv={"class-definition":{title:"Classes",description:"Character classes with features and progression",icon:"Shield"},"subclass-definition":{title:"Subclasses",description:"Specialized paths for character classes",icon:"Zap"},"spell-school-definition":{title:"Spell Schools",description:"Schools of magic with themed spells",icon:"Sparkles"},"ancestry-definition":{title:"Ancestries",description:"Character ancestries with traits and features",icon:"Users"},"background-definition":{title:"Backgrounds",description:"Character backgrounds with passive features",icon:"BookOpen"},"action-ability":{title:"Abilities",description:"Non-spell abilities with resource costs",icon:"FileText"},"spell-ability":{title:"Spells",description:"Magical spells with tiers and schools",icon:"Wand2"},"item-repository":{title:"Items",description:"Weapons, armor, consumables, and equipment",icon:"Package"}},tb={weapons:[{item:{id:"dagger",name:"Dagger",type:"weapon",size:1,attribute:"dexterity",damage:"1d4",properties:["Light","Finesse","Thrown"],description:"A short blade perfect for close combat or throwing."},category:"mundane"},{item:{id:"shortsword",name:"Shortsword",type:"weapon",size:1,attribute:"dexterity",damage:"1d6",properties:["Light","Finesse"],description:"A versatile one-handed blade favored by rogues and dualists."},category:"mundane"},{item:{id:"longsword",name:"Longsword",type:"weapon",size:2,attribute:"strength",damage:"1d8",properties:["Versatile (1d10)"],description:"A classic knightly blade, reliable in both one and two hands."},category:"mundane"},{item:{id:"greatsword",name:"Greatsword",type:"weapon",size:3,attribute:"strength",damage:"2d6",properties:["Two-handed","Heavy"],description:"A massive two-handed sword that cleaves through enemies."},category:"mundane"},{item:{id:"shortbow",name:"Shortbow",type:"weapon",size:2,attribute:"dexterity",damage:"1d6",properties:["Ammunition","Range (80/320)","Two-handed"],description:"A compact bow suitable for hunters and scouts."},category:"mundane"},{item:{id:"longbow",name:"Longbow",type:"weapon",size:3,attribute:"dexterity",damage:"1d8",properties:["Ammunition","Range (150/600)","Two-handed","Heavy"],description:"A powerful bow with exceptional range and accuracy."},category:"mundane"},{item:{id:"crossbow",name:"Light Crossbow",type:"weapon",size:2,attribute:"dexterity",damage:"1d8",properties:["Ammunition","Range (80/320)","Loading","Two-handed"],description:"A mechanical bow that trades speed for power."},category:"mundane"},{item:{id:"club",name:"Club",type:"weapon",size:1,attribute:"strength",damage:"1d4",properties:["Light"],description:"A simple wooden bludgeon, crude but effective."},category:"mundane"},{item:{id:"mace",name:"Mace",type:"weapon",size:2,attribute:"strength",damage:"1d6",properties:[],description:"A heavy metal head on a wooden shaft, designed to crush armor."},category:"mundane"},{item:{id:"warhammer",name:"Warhammer",type:"weapon",size:2,attribute:"strength",damage:"1d8",properties:["Versatile (1d10)"],description:"A balanced hammer perfect for both war and smithing."},category:"mundane"},{item:{id:"battleaxe",name:"Battleaxe",type:"weapon",size:2,attribute:"strength",damage:"1d8",properties:["Versatile (1d10)"],description:"A broad-bladed axe designed for heavy strikes in battle."},category:"mundane"},{item:{id:"hand-axe",name:"Hand Axe",type:"weapon",size:1,attribute:"strength",damage:"1d6",properties:["Light","Thrown"],description:"A small axe balanced for both melee and throwing."},category:"mundane"},{item:{id:"sling",name:"Sling",type:"weapon",size:1,attribute:"dexterity",damage:"1d4",properties:["Ammunition","Range (30/120)"],description:"A simple leather pouch on cords for hurling stones."},category:"mundane"},{item:{id:"flamebrand",name:"Flamebrand",type:"weapon",size:2,attribute:"strength",damage:"1d8+2",properties:["Versatile (1d10+2)","Magic","Fire damage"],description:"A longsword wreathed in eternal flames that never burn the wielder."},category:"magical",rarity:"rare"},{item:{id:"frostbite",name:"Frostbite",type:"weapon",size:1,attribute:"dexterity",damage:"1d6+1",properties:["Light","Finesse","Magic","Cold damage"],description:"A crystalline dagger that leaves trails of frost with each strike."},category:"magical",rarity:"uncommon"},{item:{id:"thunderstrike",name:"Thunderstrike Maul",type:"weapon",size:3,attribute:"strength",damage:"2d6+2",properties:["Two-handed","Heavy","Magic","Thunder damage"],description:"A massive maul that crashes like thunder with each devastating blow."},category:"magical",rarity:"very-rare"},{item:{id:"shadowpiercer",name:"Shadowpiercer",type:"weapon",size:3,attribute:"dexterity",damage:"1d8+2",properties:["Ammunition","Range (150/600)","Two-handed","Magic","Necrotic damage"],description:"A longbow carved from shadowwood that fires arrows of pure darkness."},category:"magical",rarity:"rare"},{item:{id:"dragonslayer",name:"Dragonslayer Greatsword",type:"weapon",size:3,attribute:"strength",damage:"2d6+3",properties:["Two-handed","Heavy","Magic","Dragon Bane"],description:"A legendary blade forged from dragon scales, humming with ancient power."},category:"magical",rarity:"legendary"}],armor:[{item:{id:"leather-armor",name:"Leather Armor",type:"armor",size:2,armor:11,maxDexBonus:10,isMainArmor:!0,properties:["Light"],description:"Supple leather armor that provides basic protection without hindering movement."},category:"mundane"},{item:{id:"studded-leather",name:"Studded Leather",type:"armor",size:2,armor:12,maxDexBonus:10,isMainArmor:!0,properties:["Light"],description:"Leather armor reinforced with metal studs for additional protection."},category:"mundane"},{item:{id:"chain-shirt",name:"Chain Shirt",type:"armor",size:3,armor:13,maxDexBonus:2,isMainArmor:!0,properties:["Medium"],description:"A shirt of interlocking metal rings that covers the torso."},category:"mundane"},{item:{id:"scale-mail",name:"Scale Mail",type:"armor",size:4,armor:14,maxDexBonus:2,isMainArmor:!0,properties:["Medium","Disadvantage on Stealth"],description:"Overlapping metal scales sewn onto a leather backing."},category:"mundane"},{item:{id:"chain-mail",name:"Chain Mail",type:"armor",size:5,armor:16,maxDexBonus:0,isMainArmor:!0,properties:["Heavy","Disadvantage on Stealth"],description:"A full suit of interlocking metal rings from head to toe."},category:"mundane"},{item:{id:"plate-armor",name:"Plate Armor",type:"armor",size:6,armor:18,maxDexBonus:0,isMainArmor:!0,properties:["Heavy","Disadvantage on Stealth"],description:"The finest armor crafted from interlocking metal plates."},category:"mundane"},{item:{id:"shield",name:"Shield",type:"armor",size:2,armor:2,maxDexBonus:10,isMainArmor:!1,properties:[],description:"A wooden or metal barrier held in one hand for protection."},category:"mundane"},{item:{id:"helmet",name:"Helmet",type:"armor",size:1,armor:1,maxDexBonus:10,isMainArmor:!1,properties:[],description:"A protective helm that guards the head from harm."},category:"mundane"},{item:{id:"cheap-hides",name:"Cheap Hides",type:"armor",size:2,armor:10,maxDexBonus:10,isMainArmor:!0,properties:["Light"],description:"Poorly cured animal hides offering minimal protection."},category:"mundane"},{item:{id:"rusty-mail",name:"Rusty Mail",type:"armor",size:4,armor:12,maxDexBonus:2,isMainArmor:!0,properties:["Medium","Disadvantage on Stealth"],description:"Old chain mail covered in rust, still functional but barely."},category:"mundane"},{item:{id:"wooden-buckler",name:"Wooden Buckler",type:"armor",size:1,armor:1,maxDexBonus:10,isMainArmor:!1,properties:[],description:"A small wooden shield offering basic protection."},category:"mundane"},{item:{id:"adventurers-garb",name:"Adventurer's Garb",type:"armor",size:1,armor:10,maxDexBonus:10,isMainArmor:!0,properties:["Unarmored"],description:"Sturdy traveling clothes suitable for adventure."},category:"mundane"},{item:{id:"traveling-robes",name:"Traveling Robes",type:"armor",size:1,armor:10,maxDexBonus:10,isMainArmor:!0,properties:["Unarmored"],description:"Simple robes worn by scholars and wanderers."},category:"mundane"},{item:{id:"dragonscale-armor",name:"Dragonscale Armor",type:"armor",size:4,armor:16,maxDexBonus:2,isMainArmor:!0,properties:["Medium","Magic","Fire Resistance"],description:"Armor crafted from the scales of an ancient red dragon, providing both protection and elemental resistance."},category:"magical",rarity:"very-rare"},{item:{id:"elven-chainmail",name:"Elven Chainmail",type:"armor",size:3,armor:16,maxDexBonus:3,isMainArmor:!0,properties:["Medium","Magic","Silent"],description:"Exceptionally fine chainmail woven by elven smiths, lighter and quieter than normal mail."},category:"magical",rarity:"rare"},{item:{id:"adamantine-plate",name:"Adamantine Plate",type:"armor",size:6,armor:20,maxDexBonus:0,isMainArmor:!0,properties:["Heavy","Magic","Critical Hit Immunity"],description:"Plate armor forged from adamantine, the hardest substance known, that turns critical hits into normal hits."},category:"magical",rarity:"legendary"},{item:{id:"cloak-of-protection",name:"Cloak of Protection",type:"armor",size:1,armor:1,maxDexBonus:10,isMainArmor:!1,properties:["Magic","+1 to all saves"],description:"A shimmering cloak that deflects both physical and magical attacks."},category:"magical",rarity:"uncommon"},{item:{id:"shield-of-reflection",name:"Shield of Reflection",type:"armor",size:2,armor:3,maxDexBonus:10,isMainArmor:!1,properties:["Magic","Spell Reflection"],description:"A polished mirror shield that can reflect spells back at their casters."},category:"magical",rarity:"rare"}],freeform:[{item:{id:"backpack",name:"Backpack",type:"freeform",size:2,description:"A sturdy leather pack with multiple compartments for carrying gear."},category:"mundane"},{item:{id:"bedroll",name:"Bedroll",type:"freeform",size:2,description:"A thick blanket and sleeping pad for resting outdoors."},category:"mundane"},{item:{id:"thieves-tools",name:"Thieves' Tools",type:"freeform",size:1,description:"A set of lock picks, skeleton keys, and other tools for bypassing locks and traps."},category:"mundane"},{item:{id:"grappling-hook",name:"Grappling Hook",type:"freeform",size:2,description:"A three-pronged iron hook attached to a length of rope for climbing."},category:"mundane"},{item:{id:"lantern",name:"Lantern",type:"freeform",size:1,description:"A metal lantern with glass panes that burns oil to provide steady light."},category:"mundane"},{item:{id:"spellbook",name:"Spellbook",type:"freeform",size:2,description:"A leather-bound tome filled with blank pages for recording spells and magical formulae."},category:"mundane"},{item:{id:"healers-kit",name:"Healer's Kit",type:"freeform",size:1,description:"Bandages, herbs, and medical supplies for treating wounds in the field."},category:"mundane"},{item:{id:"tinderbox",name:"Tinderbox",type:"freeform",size:1,description:"Flint, steel, and tinder for starting fires."},category:"mundane"},{item:{id:"chalk",name:"Chalk",type:"freeform",size:0,description:"White chalk for marking surfaces and leaving messages."},category:"mundane"},{item:{id:"javelins-4",name:"Javelins (4)",type:"freeform",size:2,description:"Four light throwing spears used for hunting or combat."},category:"mundane"},{item:{id:"hunting-trap",name:"Hunting Trap",type:"freeform",size:2,description:"A mechanical trap with sharp teeth for catching game or intruders."},category:"mundane"},{item:{id:"soap",name:"Soap",type:"freeform",size:0,description:"A bar of soap for cleaning and hygiene."},category:"mundane"},{item:{id:"manacles",name:"Manacles",type:"freeform",size:1,description:"Iron shackles for restraining prisoners."},category:"mundane"},{item:{id:"shovel",name:"Shovel",type:"freeform",size:2,description:"A sturdy digging tool for excavation."},category:"mundane"},{item:{id:"bell",name:"Bell",type:"freeform",size:0,description:"A small brass bell that rings clearly when shaken."},category:"mundane"},{item:{id:"instrument",name:"Musical Instrument",type:"freeform",size:1,description:"A flute, lute, or other instrument for making music."},category:"mundane"},{item:{id:"mirror",name:"Small Mirror",type:"freeform",size:0,description:"A polished metal mirror for signaling or grooming."},category:"mundane"},{item:{id:"strange-plant",name:"Strange Plant",type:"freeform",size:1,description:"An unusual potted plant with unknown properties."},category:"mundane"},{item:{id:"sandals",name:"Sandals",type:"freeform",size:0,description:"Simple leather sandals for warm weather travel."},category:"mundane"},{item:{id:"bag-of-holding",name:"Bag of Holding",type:"freeform",size:1,description:"A magical satchel that contains an extradimensional space, holding far more than its size suggests."},category:"magical",rarity:"uncommon"},{item:{id:"crystal-ball",name:"Crystal Ball",type:"freeform",size:2,description:"A sphere of pure crystal that allows the user to scry distant locations and people."},category:"magical",rarity:"very-rare"},{item:{id:"wand-of-magic-missiles",name:"Wand of Magic Missiles",type:"freeform",size:1,description:"A slender wand that fires unerring bolts of magical force at enemies."},category:"magical",rarity:"uncommon"},{item:{id:"boots-of-speed",name:"Boots of Speed",type:"freeform",size:1,description:"Enchanted boots that allow the wearer to move with supernatural swiftness."},category:"magical",rarity:"rare"},{item:{id:"ring-of-power",name:"Ring of Power",type:"freeform",size:0,description:"A golden ring inscribed with ancient runes that enhances the magical abilities of its wearer."},category:"magical",rarity:"legendary"},{item:{id:"cloak-of-elvenkind",name:"Cloak of Elvenkind",type:"freeform",size:1,description:"A gray cloak woven by elves that helps its wearer blend into natural surroundings."},category:"magical",rarity:"uncommon"}],consumables:[{item:{id:"healing-potion",name:"Healing Potion",type:"consumable",size:1,count:1,description:"A red liquid that restores 2d4+2 hit points when consumed."},category:"mundane"},{item:{id:"antidote",name:"Antidote",type:"consumable",size:1,count:1,description:"A bitter green potion that neutralizes poison in the body."},category:"mundane"},{item:{id:"rations",name:"Trail Rations",type:"consumable",size:1,count:3,description:"Dried meat, fruits, and hardtack bread. Enough food for one day."},category:"mundane"},{item:{id:"water-flask",name:"Water Flask",type:"consumable",size:1,count:1,description:"A leather flask containing fresh water for one day."},category:"mundane"},{item:{id:"torch",name:"Torch",type:"consumable",size:1,count:5,description:"A wooden stick wrapped in oil-soaked cloth, burns for 1 hour."},category:"mundane"},{item:{id:"oil-flask",name:"Oil Flask",type:"consumable",size:1,count:1,description:"A ceramic flask of oil that can be thrown and ignited."},category:"mundane"},{item:{id:"rope",name:"Hemp Rope (50 ft)",type:"consumable",size:2,count:1,description:"Strong braided rope suitable for climbing and binding."},category:"mundane"},{item:{id:"rations-meat",name:"Preserved Meat",type:"consumable",size:1,count:5,description:"Salted and dried meat that keeps for weeks without spoiling."},category:"mundane"},{item:{id:"greater-healing-potion",name:"Greater Healing Potion",type:"consumable",size:1,count:1,description:"A brilliant red elixir that restores 4d4+4 hit points and glows with inner light."},category:"magical",rarity:"uncommon"},{item:{id:"potion-of-strength",name:"Potion of Giant Strength",type:"consumable",size:1,count:1,description:"A cloudy blue potion that grants the strength of a giant for 1 hour (+4 Strength)."},category:"magical",rarity:"rare"},{item:{id:"potion-of-invisibility",name:"Potion of Invisibility",type:"consumable",size:1,count:1,description:"A shimmering, nearly transparent liquid that renders the drinker invisible for 1 hour."},category:"magical",rarity:"very-rare"},{item:{id:"elixir-of-life",name:"Elixir of Life",type:"consumable",size:1,count:1,description:"A golden liquid that instantly restores the drinker to full health and removes all conditions."},category:"magical",rarity:"legendary"},{item:{id:"scroll-of-fireball",name:"Scroll of Fireball",type:"consumable",size:1,count:1,description:"A parchment inscribed with arcane symbols that unleashes a devastating fireball when read."},category:"magical",rarity:"uncommon"},{item:{id:"phoenix-feather",name:"Phoenix Feather",type:"consumable",size:1,count:1,description:"A brilliant feather that brings the deceased back to life when placed upon their heart."},category:"magical",rarity:"legendary"}],ammunition:[{item:{id:"arrows",name:"Arrows",type:"ammunition",size:1,count:20,description:"Standard wooden arrows with steel tips, suitable for most bows."},category:"mundane"},{item:{id:"crossbow-bolts",name:"Crossbow Bolts",type:"ammunition",size:1,count:20,description:"Heavy bolts designed for crossbows, with broad steel heads."},category:"mundane"},{item:{id:"sling-bullets",name:"Sling Bullets",type:"ammunition",size:1,count:30,description:"Smooth lead bullets crafted for slings."},category:"mundane"},{item:{id:"blowgun-needles",name:"Blowgun Needles",type:"ammunition",size:1,count:50,description:"Thin needles for blowguns, often coated with poison."},category:"mundane"},{item:{id:"silver-arrows",name:"Silver Arrows",type:"ammunition",size:1,count:10,description:"Arrows tipped with pure silver, effective against lycanthropes and undead."},category:"magical",rarity:"uncommon"},{item:{id:"flame-arrows",name:"Arrows of Flame",type:"ammunition",size:1,count:5,description:"Arrows that burst into flame upon impact, dealing additional fire damage."},category:"magical",rarity:"rare"},{item:{id:"seeking-bolts",name:"Seeking Crossbow Bolts",type:"ammunition",size:1,count:3,description:"Enchanted bolts that adjust their flight path to hit their intended target."},category:"magical",rarity:"very-rare"},{item:{id:"dragonslayer-arrow",name:"Dragonslayer Arrow",type:"ammunition",size:1,count:1,description:"A legendary arrow forged to pierce dragon scales and deal massive damage to draconic creatures."},category:"magical",rarity:"legendary"}]},tw={berserker:{id:"berserker",name:"Berserker",description:"A primal warrior who channels rage and fury into devastating combat prowess. Berserkers tap into their savage nature to overwhelm enemies with relentless attacks.",hitDieSize:12,keyAttributes:["strength","dexterity"],startingHP:20,armorProficiencies:[],weaponProficiencies:[{type:"strength_weapons"}],saveAdvantages:{strength:"advantage",intelligence:"disadvantage"},startingEquipment:["battleaxe","rations-meat","rope-50ft"],features:[{id:"berserker-rage",level:1,type:"ability",name:"Rage",description:"Enter a battle fury that enhances your combat prowess.",ability:{id:"rage",name:"Rage",description:"Roll a Fury Die (1d4) and set it aside. Add it to every STR attack you make. You can have a max of KEY Fury Dice; they are lost when your Rage ends.",type:"action",frequency:"per_turn",maxUses:1,actionCost:1,roll:{dice:{count:1,sides:4}}}},{id:"berserker-that-all-you-got",level:2,type:"passive_feature",name:"That All You Got?!",description:"When you are attacked, you may expend 1 or more Fury Dice to reduce the damage taken by STR + DEX for each die spent.",category:"combat"},{id:"berserker-intensifying-fury",level:2,type:"passive_feature",name:"Intensifying Fury",description:"If you are Raging at the beginning of your turn, roll 1 Fury Die for free.",category:"combat"},{id:"berserker-one-with-ancients",level:2,type:"passive_feature",name:"One with the Ancients",description:"(1/Safe Rest) When faced with a decision about which direction or course of action to take, you can call upon your ancestors to guide you toward the most dangerous or challenging path.",category:"exploration"},{id:"berserker-subclass-choice",level:3,type:"subclass_choice",name:"Berserker Subclass",description:"Choose your path of rage and fury.",availableSubclasses:["path-of-the-mountainheart","path-of-the-red-mist"]},{id:"berserker-bloodlust",level:3,type:"passive_feature",name:"Bloodlust",description:"Expend 1 or more Fury Dice on your turn, move DEX spaces per die spent for free.",category:"combat"},{id:"berserker-enduring-rage",level:4,type:"passive_feature",name:"Enduring Rage",description:"While Dying, you Rage automatically for free at the beginning of your turn, have a max of 2 actions instead of 1, and ignore the STR saves to make attacks.",category:"combat"},{id:"berserker-key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or DEX",statBoosts:[{attribute:"strength",amount:1},{attribute:"dexterity",amount:1}]},{id:"berserker-savage-arsenal-1",level:4,type:"pick_feature_from_pool",name:"Savage Arsenal",description:"Choose 1 ability from the Savage Arsenal.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-rage-2",level:5,type:"passive_feature",name:"Rage (2)",description:"Whenever you Rage, gain 2 Fury Dice instead.",category:"combat"},{id:"berserker-secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL",statBoosts:[{attribute:"intelligence",amount:1},{attribute:"will",amount:1}]},{id:"berserker-savage-arsenal-2",level:6,type:"pick_feature_from_pool",name:"Savage Arsenal (2)",description:"Choose a 2nd Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-intensifying-fury-2",level:6,type:"passive_feature",name:"Intensifying Fury (2)",description:"Your Fury Dice are now d6s.",category:"combat"},{id:"berserker-subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Berserker subclass feature.",category:"combat"},{id:"berserker-savage-arsenal-3",level:8,type:"pick_feature_from_pool",name:"Savage Arsenal (3)",description:"Choose a 3rd Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or DEX",statBoosts:[{attribute:"strength",amount:1},{attribute:"dexterity",amount:1}]},{id:"berserker-intensifying-fury-3",level:9,type:"passive_feature",name:"Intensifying Fury (3)",description:"Your Fury Dice are now d8s.",category:"combat"},{id:"berserker-secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL",statBoosts:[{attribute:"intelligence",amount:1},{attribute:"will",amount:1}]},{id:"berserker-savage-arsenal-4",level:10,type:"pick_feature_from_pool",name:"Savage Arsenal (4)",description:"Choose a 4th Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Berserker subclass feature.",category:"combat"},{id:"berserker-savage-arsenal-5",level:12,type:"pick_feature_from_pool",name:"Savage Arsenal (5)",description:"Choose a 5th Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or DEX",statBoosts:[{attribute:"strength",amount:1},{attribute:"dexterity",amount:1}]},{id:"berserker-intensifying-fury-4",level:13,type:"passive_feature",name:"Intensifying Fury (4)",description:"Your Fury Dice are now d10s.",category:"combat"},{id:"berserker-secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL",statBoosts:[{attribute:"intelligence",amount:1},{attribute:"will",amount:1}]},{id:"berserker-savage-arsenal-6",level:14,type:"pick_feature_from_pool",name:"Savage Arsenal (6)",description:"Choose a 6th Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Berserker subclass feature.",category:"combat"},{id:"berserker-savage-arsenal-7",level:16,type:"pick_feature_from_pool",name:"Savage Arsenal (7)",description:"Choose a 7th Savage Arsenal ability.",poolId:"savage-arsenal-pool",choicesAllowed:1},{id:"berserker-key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or DEX",statBoosts:[{attribute:"strength",amount:1},{attribute:"dexterity",amount:1}]},{id:"berserker-intensifying-fury-5",level:17,type:"passive_feature",name:"Intensifying Fury (5)",description:"Your Fury Dice are now d12s.",category:"combat"},{id:"berserker-secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL",statBoosts:[{attribute:"intelligence",amount:1},{attribute:"will",amount:1}]},{id:"berserker-deep-rage",level:18,type:"passive_feature",name:"DEEP RAGE",description:"Dropping to 0 HP does not cause your Rage to end.",category:"combat"},{id:"berserker-epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"berserker-boundless-rage",level:20,type:"passive_feature",name:"BOUNDLESS RAGE",description:"+1 to any 2 of your stats. Anytime you roll less than 6 on a Fury Die, change it to 6 instead.",category:"combat"},{id:"berserker-wrath-and-ruin",level:1,type:"passive_feature",name:"Wrath & Ruin",description:"Whenever you perform a notable act of destruction or feat of strength during a Safe Rest, you may choose different Berserker options available to you.",category:"utility"}],featurePools:[{id:"savage-arsenal-pool",name:"Savage Arsenal",description:"A collection of brutal combat techniques that Berserkers can learn as they progress.",features:[{id:"death-blow",level:1,type:"passive_feature",name:"Death Blow",description:"After you deal damage from a crit, you may expend any number of Fury Dice. Sum the dice and deal double that amount of damage.",category:"combat"},{id:"deathless-rage",level:1,type:"ability",name:"Deathless Rage",description:"(1/turn) While Dying, you may suffer 1 Wound to gain 1 action.",ability:{id:"deathless-rage",name:"Deathless Rage",description:"(1/turn) While Dying, you may suffer 1 Wound to gain 1 action.",type:"action",frequency:"per_turn",maxUses:1}},{id:"eager-for-battle",level:1,type:"passive_feature",name:"Eager for Battle",description:"Gain advantage on Initiative. Move 2 \xd7 DEX spaces for free on your first turn each encounter.",category:"combat"},{id:"into-the-fray",level:1,type:"ability",name:"Into the Fray",description:"Action: Leap up to 2 \xd7 DEX spaces toward an enemy. If you land adjacent to at least 2 enemies, the next attack against 1 of them for free.",ability:{id:"into-the-fray",name:"Into the Fray",description:"Leap up to 2 \xd7 DEX spaces toward an enemy. If you land adjacent to at least 2 enemies, the next attack against 1 of them for free.",type:"action",frequency:"at_will",actionCost:1}},{id:"mighty-endurance",level:1,type:"passive_feature",name:"Mighty Endurance",description:"You can now survive an additional 4 Wounds before death.",category:"combat"},{id:"more-blood",level:1,type:"passive_feature",name:"MORE BLOOD!",description:"Whenever an enemy crits you, gain 1 Fury Die.",category:"combat"},{id:"rampage",level:1,type:"ability",name:"Rampage",description:"(1/turn) After you land a hit, you may treat your next attack this turn as if you rolled that same amount instead of rolling again.",ability:{id:"rampage",name:"Rampage",description:"(1/turn) After you land a hit, you may treat your next attack this turn as if you rolled that same amount instead of rolling again.",type:"action",frequency:"per_turn",maxUses:1}},{id:"swift-fury",level:1,type:"passive_feature",name:"Swift Fury",description:"Whenever you gain one or more Fury Dice, move up to DEX spaces for free, ignoring difficult terrain.",category:"combat"},{id:"thunderous-steps",level:1,type:"passive_feature",name:"Thunderous Steps",description:"After moving at least 4 spaces while Raging, you may deal STR Bludgeoning damage to all adjacent creatures where you stop.",category:"combat"},{id:"unstoppable-force",level:1,type:"passive_feature",name:"Unstoppable Force",description:"While Dying and Raging, taking damage causes 1 Wound (instead of 2) and critical hits inflict 2 Wounds (instead of 3).",category:"combat"},{id:"whirlwind",level:1,type:"ability",name:"Whirlwind",description:"2 actions: Attack ALL targets within your melee weapon's reach.",ability:{id:"whirlwind",name:"Whirlwind",description:"Attack ALL targets within your melee weapon's reach.",type:"action",frequency:"at_will",actionCost:2}},{id:"you-re-next",level:1,type:"ability",name:"You're Next!",description:"Action: While Raging, you can make a Might skill check to demoralize an enemy within Reach 12 (DC: their current HP). On a success, they immediately flee the battle.",ability:{id:"you-re-next",name:"You're Next!",description:"While Raging, you can make a Might skill check to demoralize an enemy within Reach 12 (DC: their current HP). On a success, they immediately flee the battle.",type:"action",frequency:"at_will",actionCost:1}}]}],subclasses:[ts,ti]},cheat:{id:"cheat",name:"The Cheat",description:"A cunning rogue who relies on deception, misdirection, and underhanded tactics to overcome challenges. Cheats excel at exploiting weaknesses and creating opportunities where none existed.",hitDieSize:6,keyAttributes:["dexterity","intelligence"],startingHP:10,armorProficiencies:[{type:"leather"}],weaponProficiencies:[{type:"dexterity_weapons"}],saveAdvantages:{dexterity:"advantage",will:"disadvantage"},startingEquipment:["daggers-2","sling","cheap-hides","chalk"],features:[{id:"cheat-sneak-attack",level:1,type:"ability",name:"Sneak Attack",description:"When you crit, deal +1d6 damage.",ability:{id:"sneak-attack",name:"Sneak Attack",description:"(1/turn) When you crit, deal +1d6 damage.",type:"action",frequency:"per_turn",maxUses:1,roll:{dice:{count:1,sides:6}}}},{id:"cheat-vicious-opportunist",level:1,type:"passive_feature",name:"Vicious Opportunist",description:"(1/turn) When you hit a Distracted target with a melee attack, you may change the Primary Die roll to whatever you like (changing it to the max value counts as a crit).",category:"combat"},{id:"cheat-cheat",level:2,type:"passive_feature",name:"Cheat",description:"You're a well-rounded cheater. Gain the following abilities: (1/round) You may either Move or Hide for free. (1/day) You may change any skill check to 10+INT. If you roll less than 10 on Initiative, you may change it to 10 instead. You may gain advantage on skill checks while playing any games, competitions, or placing wagers. If you're caught though...",category:"utility"},{id:"cheat-subclass-choice",level:3,type:"subclass_choice",name:"Cheat Subclass",description:"Choose your path of deception.",availableSubclasses:["tools-of-the-silent-blade","tools-of-the-scoundrel"]},{id:"cheat-sneak-attack-2",level:3,type:"passive_feature",name:"Sneak Attack (2)",description:"Your Sneak Attack becomes 1d8.",category:"combat"},{id:"cheat-thieves-cant",level:3,type:"passive_feature",name:"Thieves' Cant",description:"You learn the secret language of rogues and scoundrels.",category:"utility"},{id:"cheat-key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or INT",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"intelligence",amount:1}]},{id:"cheat-underhanded-ability-1",level:4,type:"pick_feature_from_pool",name:"Underhanded Ability",description:"Choose an Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-twist-the-blade",level:5,type:"ability",name:"Twist the Blade",description:"Action: Change one of your Sneak Attack dice to whatever you like.",ability:{id:"twist-the-blade",name:"Twist the Blade",description:"Change one of your Sneak Attack dice to whatever you like.",type:"action",frequency:"at_will",actionCost:1}},{id:"cheat-quick-read",level:5,type:"passive_feature",name:"Quick Read",description:"(1/encounter) Gain advantage on an Assess check. (1/day) Gain advantage on an Examination check.",category:"exploration"},{id:"cheat-secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 WIL or STR",statBoosts:[{attribute:"will",amount:1},{attribute:"strength",amount:1}]},{id:"cheat-underhanded-ability-2",level:6,type:"pick_feature_from_pool",name:"Underhanded Ability (2)",description:"Choose a 2nd Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Cheat subclass feature.",category:"combat"},{id:"cheat-sneak-attack-3",level:7,type:"passive_feature",name:"Sneak Attack (3)",description:"Your Sneak Attack becomes 2d8.",category:"combat"},{id:"cheat-underhanded-ability-3",level:8,type:"pick_feature_from_pool",name:"Underhanded Ability (3)",description:"Choose a 3rd Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or INT",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"intelligence",amount:1}]},{id:"cheat-sneak-attack-4",level:9,type:"passive_feature",name:"Sneak Attack (4)",description:"Your Sneak Attack becomes 2d10.",category:"combat"},{id:"cheat-secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 WIL or STR",statBoosts:[{attribute:"will",amount:1},{attribute:"strength",amount:1}]},{id:"cheat-underhanded-ability-4",level:10,type:"pick_feature_from_pool",name:"Underhanded Ability (4)",description:"Choose a 4th Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Cheat subclass feature.",category:"combat"},{id:"cheat-sneak-attack-5",level:11,type:"passive_feature",name:"Sneak Attack (5)",description:"Your Sneak Attack becomes 2d12.",category:"combat"},{id:"cheat-underhanded-ability-5",level:12,type:"pick_feature_from_pool",name:"Underhanded Ability (5)",description:"Choose a 5th Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or INT",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"intelligence",amount:1}]},{id:"cheat-twist-the-blade-2",level:13,type:"ability",name:"Twist the Blade (2)",description:"(1/turn) You can Twist the Blade for free.",ability:{id:"twist-the-blade-2",name:"Twist the Blade (2)",description:"You can Twist the Blade for free.",type:"action",frequency:"per_turn",maxUses:1}},{id:"cheat-secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 WIL or STR",statBoosts:[{attribute:"will",amount:1},{attribute:"strength",amount:1}]},{id:"cheat-underhanded-ability-6",level:14,type:"pick_feature_from_pool",name:"Underhanded Ability (6)",description:"Choose a 6th Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Cheat subclass feature.",category:"combat"},{id:"cheat-sneak-attack-6",level:15,type:"passive_feature",name:"Sneak Attack (6)",description:"Your Sneak Attack becomes 2d20.",category:"combat"},{id:"cheat-underhanded-ability-7",level:16,type:"pick_feature_from_pool",name:"Underhanded Ability (7)",description:"Choose a 7th Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or INT",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"intelligence",amount:1}]},{id:"cheat-sneak-attack-7",level:17,type:"passive_feature",name:"Sneak Attack (7)",description:"Your Sneak Attack becomes 3d20.",category:"combat"},{id:"cheat-secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 WIL or STR",statBoosts:[{attribute:"will",amount:1},{attribute:"strength",amount:1}]},{id:"cheat-underhanded-ability-8",level:18,type:"pick_feature_from_pool",name:"Underhanded Ability (8)",description:"Choose an 8th Underhanded Ability.",poolId:"underhanded-abilities-pool",choicesAllowed:1},{id:"cheat-epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"cheat-supreme-execution",level:20,type:"passive_feature",name:"Supreme Execution",description:"+1 to any 2 of your stats. When you attack with a blade, you do not require targets to be Distracted to trigger Vicious Opportunist.",category:"combat"},{id:"cheat-trade-secrets",level:1,type:"passive_feature",name:"Trade Secrets",description:"Whenever you spend a night talking shop with other roguish types during a Safe Rest, you may choose different Cheat options available to you.",category:"utility"},{id:"cheat-distracted",level:1,type:"passive_feature",name:"Distracted",description:"A target is Distracted if it is adjacent to or Taunted by an ally, or if it cannot see you.",category:"combat"},{id:"cheat-magic",level:2,type:"passive_feature",name:"Magic?",description:"The Cheat has some abilities that look magical-they might be, but don't have to be. You have your ways, okay? No need to explain how you did that, not even to the GM!",category:"utility"}],featurePools:[{id:"underhanded-abilities-pool",name:"Underhanded Abilities",description:"A collection of sneaky tricks and exploits that Cheats can learn as they progress.",features:[{id:"creative-accounting",level:1,type:"ability",name:'"Creative" Accounting',description:"Steal up to INT actions from your next turn (Gain up to INT actions now, the next time you would gain actions, subtract the number stolen). You cannot use this 2 turns in a row.",ability:{id:"creative-accounting",name:'"Creative" Accounting',description:"Steal up to INT actions from your next turn and then move up to half your speed for free.",type:"action",frequency:"at_will"}},{id:"exploit-weakness",level:1,type:"ability",name:"Exploit Weakness",description:"Action: Make a contested INT check against an enemy. If you win, you can use Vicious Opportunist against them, even if they are not Distracted. This lasts for 1 minute or until you use this ability against another target.",ability:{id:"exploit-weakness",name:"Exploit Weakness",description:"Make a contested INT check against an enemy. If you win, you can use Vicious Opportunist against them, even if they are not Distracted. This lasts for 1 minute or until you use this ability against another target.",type:"action",frequency:"at_will",actionCost:1}},{id:"feinting-attack",level:1,type:"passive_feature",name:"Feinting Attack",description:"If you miss for the 2nd time in a single round, you may change the primary die to any result instead.",category:"combat"},{id:"how-d-you-get-here",level:1,type:"ability",name:"How'd YOU get here?!",description:'2 actions: "Teleport" up to 4 spaces away, adjacent to a Distracted target, and make a melee attack against them. If you crit, you may "teleport" again.',ability:{id:"how-d-you-get-here",name:"How'd YOU get here?!",description:'"Teleport" up to 4 spaces away, adjacent to a Distracted target, and make a melee attack against them. If you crit, you may "teleport" again.',type:"action",frequency:"at_will",actionCost:2}},{id:"im-outta-here",level:1,type:"passive_feature",name:"I'm Outta Here!",description:"When an ally within 4 spaces is crit, you may turn invisible until the end of your next turn.",category:"combat"},{id:"misdirection",level:1,type:"passive_feature",name:"Misdirection",description:"Gain INT armor. Whenever you Defend, you may halve the damage instead.",category:"combat"},{id:"steal-tempo",level:1,type:"passive_feature",name:"Steal Tempo",description:"When you land a critical hit for the second time on a turn, your target loses 1 action and you gain 1 action.",category:"combat"},{id:"sunder-armor-medium",level:1,type:"ability",name:"Sunder Armor (Medium)",description:"Action: When you crit an enemy with medium armor, sunder their armor. Until the start of your next turn, ALL melee attacks against that target ignore its armor.",ability:{id:"sunder-armor-medium",name:"Sunder Armor (Medium)",description:"When you crit an enemy with medium armor, sunder their armor. Until the start of your next turn, ALL melee attacks against that target ignore its armor.",type:"action",frequency:"at_will",actionCost:1}},{id:"sunder-armor-heavy",level:1,type:"ability",name:"Sunder Armor (Heavy)",description:"Req. Sunder Armor (Medium). Your Sunder Armor ability now also applies to enemies wearing heavy armor.",ability:{id:"sunder-armor-heavy",name:"Sunder Armor (Heavy)",description:"Your Sunder Armor ability now also applies to enemies wearing heavy armor.",type:"action",frequency:"at_will"}},{id:"trickshot",level:1,type:"passive_feature",name:"Trickshot",description:"When you throw a dagger, it returns back to your hand at the end of your turn. On a hit, it ricochets to another creature within 2 spaces, dealing half as much damage to them.",category:"combat"}]}],subclasses:[tr,tn]},commander:{id:"commander",name:"Commander",description:"A tactical leader who excels at coordinating allies and controlling the battlefield. Commanders inspire their allies and create opportunities through superior tactics and teamwork.",hitDieSize:10,keyAttributes:["strength","intelligence"],startingHP:17,armorProficiencies:[{type:"mail"},{type:"shields"}],weaponProficiencies:[{type:"freeform",name:"All Martial Weapons"}],saveAdvantages:{strength:"advantage",dexterity:"disadvantage"},startingEquipment:["hand-axe","javelins-4","rusty-mail"],features:[{id:"commander-coordinated-strike",level:1,type:"ability",name:"Coordinated Strike!",description:"Gain the Coordinated Strike! Commander's Order.",ability:{id:"coordinated-strike-base",name:"Coordinated Strike!",description:"You and an ally within 6 spaces both immediately make a weapon attack or cast a cantrip for free.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"commander-orders-choice-1",level:2,type:"pick_feature_from_pool",name:"Commander's Orders",description:"Choose 2 Commander's Orders.",poolId:"commanders-orders-pool",choicesAllowed:2},{id:"commander-field-medic",level:2,type:"ability",name:"Field Medic",description:"Roll 1 additional die for any health potion you administer. Whenever you or an ally spend any number of Hit Dice to recover HP, if you spent at least ten minutes examining their wounds, they can add your Examination bonus to the HP recovered.",ability:{id:"field-medic",name:"Field Medic",description:"Roll 1 additional die for any health potion you administer.",type:"action",frequency:"at_will"}},{id:"commander-subclass-choice",level:3,type:"subclass_choice",name:"Commander Subclass",description:"Choose your path of command.",availableSubclasses:["champion-of-the-bulwark","champion-of-the-vanguard"]},{id:"commander-fit-for-any-battlefield-1",level:4,type:"pick_feature_from_pool",name:"Fit for Any Battlefield",description:"Choose a Combat Tactic. When you roll Initiative, gain STR Combat Dice, each a d6. (1/attack) You may expend a Combat Die to perform a special maneuver. Combat Dice are lost when combat ends.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or INT",statBoosts:[{attribute:"strength",amount:1},{attribute:"intelligence",amount:1}]},{id:"commander-master-commander",level:5,type:"passive_feature",name:"Master Commander",description:"When you roll Initiative, regain 1 spent use of Coordinated Strike (it is lost if not spent during that encounter). Attacks made from your Coordinated Strikes also now ignore disadvantage.",category:"combat"},{id:"commander-combat-tactics-dice-1",level:5,type:"passive_feature",name:"Combat Tactics",description:"Your Combat Dice are now d8s.",category:"combat"},{id:"commander-secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or WIL",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"will",amount:1}]},{id:"commander-fit-for-any-battlefield-2",level:6,type:"pick_feature_from_pool",name:"Fit for Any Battlefield (2)",description:"Choose another Combat Ability or gain +1 max Combat Dice.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-weapon-mastery-1",level:6,type:"pick_feature_from_pool",name:"Weapon Mastery",description:"You may sheathe a weapon and draw a different one 2\xd7/round for free. Choose a weapon type to specialize in.",poolId:"weapon-mastery-pool",choicesAllowed:1},{id:"commander-subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Commander subclass feature.",category:"combat"},{id:"commander-fit-for-any-battlefield-3",level:8,type:"pick_feature_from_pool",name:"Fit for Any Battlefield (3)",description:"Choose another Combat Ability or gain +1 max Combat Dice.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or INT",statBoosts:[{attribute:"strength",amount:1},{attribute:"intelligence",amount:1}]},{id:"commander-master-commander-2",level:9,type:"passive_feature",name:"Master Commander (2)",description:"+1 use of Coordinated Strike/Safe Rest.",category:"combat"},{id:"commander-combat-tactics-dice-2",level:9,type:"passive_feature",name:"Combat Tactics (2)",description:"Your Combat Dice are now d10s.",category:"combat"},{id:"commander-secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or WIL",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"will",amount:1}]},{id:"commander-fit-for-any-battlefield-4",level:10,type:"pick_feature_from_pool",name:"Fit for Any Battlefield (4)",description:"Choose another Combat Ability or gain +1 max Combat Dice.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-weapon-mastery-2",level:10,type:"pick_feature_from_pool",name:"Weapon Mastery (2)",description:"Choose a 2nd weapon type to specialize in.",poolId:"weapon-mastery-pool",choicesAllowed:1},{id:"commander-subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Commander subclass feature.",category:"combat"},{id:"commander-fit-for-any-battlefield-5",level:12,type:"pick_feature_from_pool",name:"Fit for Any Battlefield (5)",description:"Choose another Combat Ability or gain +1 max Combat Dice.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or INT",statBoosts:[{attribute:"strength",amount:1},{attribute:"intelligence",amount:1}]},{id:"commander-master-commander-3",level:13,type:"passive_feature",name:"Master Commander (3)",description:"+1 use of Coordinated Strike/Safe Rest.",category:"combat"},{id:"commander-combat-tactics-dice-3",level:13,type:"passive_feature",name:"Combat Tactics (3)",description:"Your Combat Dice are now d12s.",category:"combat"},{id:"commander-secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or WIL",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"will",amount:1}]},{id:"commander-weapon-mastery-3",level:14,type:"passive_feature",name:"Weapon Mastery (3)",description:"You have complete mastery of all weapon types.",category:"combat"},{id:"commander-subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Commander subclass feature.",category:"combat"},{id:"commander-fit-for-any-battlefield-6",level:16,type:"pick_feature_from_pool",name:"Fit for Any Battlefield (6)",description:"Choose another Combat Ability or gain +1 max Combat Dice.",poolId:"combat-tactics-pool",choicesAllowed:1},{id:"commander-key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or INT",statBoosts:[{attribute:"strength",amount:1},{attribute:"intelligence",amount:1}]},{id:"commander-master-commander-4",level:17,type:"passive_feature",name:"Master Commander (4)",description:"+1 use of Coordinated Strike/Safe Rest.",category:"combat"},{id:"commander-combat-tactics-dice-4",level:17,type:"passive_feature",name:"Combat Tactics (4)",description:"Your Combat Dice are now d20s.",category:"combat"},{id:"commander-secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or WIL",statBoosts:[{attribute:"dexterity",amount:1},{attribute:"will",amount:1}]},{id:"commander-unparalleled-tactics",level:18,type:"passive_feature",name:"Unparalleled Tactics",description:"The first time each encounter you use Coordinated Strike, an ally who can hear you also gains 1 action to use on their next turn.",category:"combat"},{id:"commander-epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"commander-captain-of-legions",level:20,type:"passive_feature",name:"Captain of Legions",description:"+1 to any 2 of your stats. The first time each encounter you use Coordinated Strike, EVERY ally within 12 spaces gains +1 action (replaces Unparalleled Tactics).",category:"combat"},{id:"commander-rigorous-training",level:1,type:"passive_feature",name:"Rigorous Training",description:"Whenever you train with your party or other soldiers during a Safe Rest, you may choose different Commander options available to you.",category:"utility"}],featurePools:[{id:"commanders-orders-pool",name:"Commander's Orders",description:"Tactical commands that Commanders can issue to coordinate their allies.",features:[{id:"coordinated-strike-order",level:1,type:"ability",name:"Coordinated Strike!",description:"(1/round) Free action: you and an ally within 6 spaces both immediately make a weapon attack or cast a cantrip for free. You can do this INT times/Safe Rest.",ability:{id:"coordinated-strike",name:"Coordinated Strike!",description:"You and an ally within 6 spaces both immediately make a weapon attack or cast a cantrip for free.",type:"action",frequency:"per_turn",maxUses:1}},{id:"face-me-order",level:1,type:"ability",name:"Face Me!",description:"Reaction (after an ally is crit within 12 spaces): Taunt that enemy until you drop to 0 HP.",ability:{id:"face-me",name:"Face Me!",description:"Taunt that enemy until you drop to 0 HP.",type:"action",frequency:"at_will"}},{id:"hold-the-line-order",level:1,type:"ability",name:"Hold the Line!",description:"(1/encounter) Reaction (when an ally drops to 0 HP): Command them to continue the fight! Set their HP to 3 \xd7 your LVL.",ability:{id:"hold-the-line",name:"Hold the Line!",description:"Command an ally who drops to 0 HP to continue the fight! Set their HP to 3 \xd7 your LVL.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"i-can-do-this-all-day-order",level:1,type:"ability",name:"I Can Do This ALL DAY!",description:"(1/encounter) Reaction (when you would drop to 0 HP): You may expend any number of Hit Dice and set your HP to the sum rolled instead (do not add your STR).",ability:{id:"i-can-do-this-all-day",name:"I Can Do This ALL DAY!",description:"When you would drop to 0 HP, expend any number of Hit Dice and set your HP to the sum rolled instead (do not add your STR).",type:"action",frequency:"per_encounter",maxUses:1}},{id:"move-it-move-it-order",level:1,type:"passive_feature",name:"Move it! Move it!",description:"When you roll Initiative you may give yourself and an ally advantage on the roll and +3 speed for 1 round.",category:"combat"},{id:"reposition-order",level:1,type:"ability",name:"Reposition!",description:"Action/Reaction (on an ally's turn): Command 1 ally to move up to their speed (or 2 allies up to half their speed) for free.",ability:{id:"reposition",name:"Reposition!",description:"Command 1 ally to move up to their speed (or 2 allies up to half their speed) for free.",type:"action",frequency:"at_will",actionCost:1}}]},{id:"combat-tactics-pool",name:"Combat Tactics",description:"Special combat maneuvers that Commanders can perform using Combat Dice.",features:[{id:"attack-tactic",level:1,type:"passive_feature",name:"1/Attack",description:"You can expend a Combat Die to add one of the following effects to your attack.",category:"combat"},{id:"commanding-presence",level:1,type:"ability",name:"Commanding Presence",description:"Action: Shout a command up to 2 words long at an enemy. On a failed WIL save (DC 10+STR), they must spend their entire next turn obeying it to the best of their ability, provided it is not obviously harmful to themselves. They then become immune to this effect for 1 day.",ability:{id:"commanding-presence",name:"Commanding Presence",description:"Shout a command up to 2 words long at an enemy. On a failed WIL save (DC 10+STR), they must spend their entire next turn obeying it.",type:"action",frequency:"at_will",actionCost:1}},{id:"heavy-strike",level:1,type:"passive_feature",name:"Heavy Strike",description:"When you hit, push a Medium creature STR spaces and deal extra damage equal to a roll of your Combat Die. A Small creature is pushed twice as far; Large, pushed half as far (round down).",category:"combat"},{id:"inerrant-strike",level:1,type:"passive_feature",name:"Inerrant Strike",description:"Reroll a missed attack, add 1 to the Primary Die, and deal extra damage equal to a roll of your Combat Die.",category:"combat"},{id:"lunging-strike",level:1,type:"passive_feature",name:"Lunging Strike",description:"Gain +1 Reach on an attack and deal extra damage equal to 2 \xd7 a roll of your Combat Die.",category:"combat"},{id:"sweeping-strike",level:1,type:"passive_feature",name:"Sweeping Strike",description:"2 actions: Select any contiguous area within your weapon's Reach and damage ALL targets there. This attack does not miss on a 1.",category:"combat"}]},{id:"weapon-mastery-pool",name:"Weapon Mastery",description:"Specialized weapon techniques for different damage types.",features:[{id:"slashing-mastery",level:1,type:"passive_feature",name:"Slashing",description:"Your attacks with slashing weapons cannot miss unarmored enemies.",category:"combat"},{id:"bludgeoning-mastery",level:1,type:"passive_feature",name:"Bludgeoning",description:"When your primary die rolls a 7 or higher with a bludgeoning weapon, ignore Heavy Armor.",category:"combat"},{id:"piercing-mastery",level:1,type:"passive_feature",name:"Piercing",description:"Your attacks with piercing weapons ignore Medium Armor.",category:"combat"}]}],subclasses:[to,tl]},hunter:{id:"hunter",name:"Hunter",description:"A master tracker and wilderness survivor who forms a bond with nature and excels at ranged combat.",hitDieSize:8,keyAttributes:["dexterity","will"],startingHP:13,armorProficiencies:[{type:"leather"}],weaponProficiencies:[{type:"dexterity_weapons"}],saveAdvantages:{},startingEquipment:["shortbow","cheap-hides","dagger","hunting-trap"],features:[{id:"hunters-mark",level:1,type:"ability",name:"Hunter's Mark",description:"Mark a creature as your quarry for 1 day. It can't be hidden from you, and your attacks against it gain your choice of advantage OR +1 LVL damage.",ability:{id:"hunters-mark",name:"Hunter's Mark",description:"Mark a creature you can see as your quarry for 1 day (or until you mark another creature). It can't be hidden from you, and your attacks against it gain your choice of advantage OR +1 LVL damage (choose before each attack).",type:"action",frequency:"at_will",actionCost:1}},{id:"forager",level:1,type:"passive_feature",name:"Forager",description:"Gain advantage on skill checks to find food and water in the wild.",category:"exploration"},{id:"thrill-of-the-hunt-resource",level:2,type:"resource",name:"Thrill of the Hunt Charges",description:"Charges used to fuel Thrill of the Hunt abilities. Gain charges when your quarry dies or when you hit your quarry in melee/crit at range.",resourceDefinition:{id:"thrill-of-the-hunt-charges",name:"Thrill of the Hunt",description:"Charges used to fuel Hunter abilities",colorScheme:"green-nature",icon:"zap",resetCondition:"encounter_end",resetType:"to_zero",minValue:0,maxValue:10},startingAmount:0},{id:"thrill-of-the-hunt-1",level:2,type:"passive_feature",name:"Thrill of the Hunt",description:"Choose 2 Thrill of the Hunt (ToH) abilities. Gain a charge to use these abilities during that encounter whenever:\n Your quarry dies.\n You hit your quarry in melee or crit your quarry at range.",category:"combat"},{id:"roll-and-strike",level:2,type:"ability",name:"Roll & Strike",description:"If you have no Thrill of the Hunt charges, move up to your speed toward your quarry. If you end adjacent to them, make a melee attack against them for free.",ability:{id:"roll-and-strike",name:"Roll & Strike",description:"If you have no Thrill of the Hunt charges, move up to your speed toward your quarry. If you end adjacent to them, make a melee attack against them for free.",type:"action",frequency:"at_will",actionCost:1}},{id:"remember-the-wild",level:2,type:"passive_feature",name:"Remember the Wild",description:"Whenever you spend a day in the wilderness during a Safe Rest, you may choose different Hunter options available to you.",category:"utility"},{id:"subclass",level:3,type:"subclass_choice",name:"Hunter Subclass",description:"Choose a Hunter subclass.",availableSubclasses:["hunter-shadowpath","hunter-wildheart"]},{id:"trackers-intuition",level:3,type:"passive_feature",name:"Tracker's Intuition",description:"You can discern the events of a past encounter by studying tracks and other subtle environmental clues, accurately determining the kind and amount of creatures, their direction, key actions, and passage of time.",category:"exploration"},{id:"thrill-of-the-hunt-2",level:4,type:"passive_feature",name:"Thrill of the Hunt (2)",description:"Choose a 3rd Thrill of the Hunt ability.",category:"combat"},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or WIL.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"explorer-of-the-wilds",level:4,type:"passive_feature",name:"Explorer of the Wilds",description:"+2 speed, gain a climbing speed.",category:"exploration"},{id:"hunters-resolve",level:5,type:"passive_feature",name:"Hunter's Resolve",description:"Whenever you have no Thrill of the Hunt charges, gain Hunter's Resolve until the end of your turn: treat all creatures as your quarry for the purposes of movement and melee attacks.",category:"combat"},{id:"final-takedown",level:5,type:"ability",name:"Final Takedown",description:"Spend 1 Thrill of the Hunt charge to make a melee attack against your Bloodied quarry. Turn it into a crit and double the damage of your Hunter's Mark. If they survive, they crit you back.",ability:{id:"final-takedown",name:"Final Takedown",description:"Spend 1 Thrill of the Hunt charge to make a melee attack against your Bloodied quarry. Turn it into a crit and double the damage of your Hunter's Mark. If they survive, they crit you back.",type:"action",frequency:"at_will",actionCost:1}},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"strength",amount:1}]},{id:"versatile-bowmaster",level:6,type:"passive_feature",name:"Versatile Bowmaster",description:"Whenever you attack with a Longbow, you may roll 2d4 instead of 1d8; or with a Crossbow, 2d8 instead of 4d4.",category:"combat"},{id:"thrill-of-the-hunt-3",level:6,type:"passive_feature",name:"Thrill of the Hunt (3)",description:"Choose a 4th Thrill of the Hunt ability.",category:"combat"},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Hunter subclass feature.",category:"combat"},{id:"thrill-of-the-hunt-4",level:8,type:"passive_feature",name:"Thrill of the Hunt (4)",description:"Choose a 5th Thrill of the Hunt ability.",category:"combat"},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or WIL.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"no-escape",level:9,type:"passive_feature",name:"No Escape",description:"Whenever you see one or more allies make an opportunity attack, you may also make a ranged opportunity attack against the same target.",category:"combat"},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"strength",amount:1}]},{id:"veteran-stalker",level:10,type:"passive_feature",name:"Veteran Stalker",description:"Gain a Thrill of the Hunt charge whenever you are first Bloodied in an encounter and for every Wound you gain.",category:"combat"},{id:"keen-eye-steady-hand",level:10,type:"passive_feature",name:"Keen Eye, Steady Hand",description:"Add WIL to your ranged weapon damage.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Hunter subclass feature.",category:"combat"},{id:"thrill-of-the-hunt-5",level:12,type:"passive_feature",name:"Thrill of the Hunt (5)",description:"Choose a 6th Thrill of the Hunt ability.",category:"combat"},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"keen-sight",level:13,type:"passive_feature",name:"Keen Sight",description:"Advantage on Perception checks.",category:"exploration"},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"thrill-of-the-hunt-6",level:14,type:"passive_feature",name:"Thrill of the Hunt (6)",description:"Choose a 7th Thrill of the Hunt ability.",category:"combat"},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Hunter subclass feature.",category:"combat"},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"peerless-hunter",level:17,type:"passive_feature",name:"Peerless Hunter",description:"You can Defend against your quarry for free.",category:"combat"},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"wild-endurance",level:18,type:"passive_feature",name:"Wild Endurance",description:"Gain 1 Thrill of the Hunt charge at the start of your turns.",category:"combat"},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon.",category:"utility"},{id:"nemesis",level:20,type:"passive_feature",name:"Nemesis",description:"+1 to any 2 of your stats. Your Hunter's Mark can target any number of creatures simultaneously.",category:"combat"}]},mage:{id:"mage",name:"Mage",description:"A master of elemental magic who wields fire, ice, and lightning to devastating effect.",hitDieSize:6,keyAttributes:["intelligence","will"],startingHP:10,armorProficiencies:[{type:"cloth"}],weaponProficiencies:[{type:"freeform",name:"Blades, Staves, Wands"}],saveAdvantages:{intelligence:"advantage",strength:"disadvantage"},startingEquipment:["adventurers-garb","staff","soap"],features:[{id:"elemental-spellcasting",level:1,type:"passive_feature",name:"Elemental Spellcasting",description:"You know Fire, Ice, and Lightning cantrips.",category:"combat"},{id:"mana-and-unlock-tier-1-spells",level:2,type:"resource",name:"Mana Pool",description:"You unlock tier 1 Fire, Ice, and Lightning spells and gain a mana pool to cast these spells. This mana pool's maximum is always equal to (INT \xd7 3) + LVL and recharges on a Safe Rest.",resourceDefinition:{id:"mage-mana",name:"Mana",description:"Magical energy used to cast spells",colorScheme:"blue-magic",icon:"sparkles",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:20},startingAmount:7},{id:"talented-researcher",level:2,type:"passive_feature",name:"Talented Researcher",description:"Gain advantage on Arcana or Lore checks when you have access to a large amount of books and time to study them.",category:"exploration"},{id:"subclass",level:3,type:"subclass_choice",name:"Mage Subclass",description:"Choose a Mage subclass.",availableSubclasses:["mage-control","mage-chaos"]},{id:"elemental-mastery",level:3,type:"passive_feature",name:"Elemental Mastery",description:"Learn the Utility Spells from 1 spell school you know.",category:"utility"},{id:"spellshaper",level:4,type:"ability",name:"Spellshaper",description:"You gain the ability to enhance your spells with powerful effects by spending additional mana. Choose 2 Spellshaper abilities.",ability:{id:"spellshaper",name:"Spellshaper",description:"Enhance your spells with powerful effects by spending additional mana.",type:"action",frequency:"at_will"}},{id:"tier-2-spells",level:4,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells and upcast spells at tier 2.",maxTier:2},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"elemental-surge",level:5,type:"passive_feature",name:"Elemental Surge",description:"A surge of adrenaline and your attunement with the elements grants you additional power as combat begins. When you roll Initiative, regain WIL mana (this expires at the end of combat if unused).",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"strength",amount:1}]},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-3-spells",level:6,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells and upcast spells at tier 3.",maxTier:3},{id:"elemental-mastery-2",level:6,type:"passive_feature",name:"Elemental Mastery (2)",description:"Learn the Utility Spells from a 2nd spell school you know.",category:"utility"},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Mage subclass feature.",category:"combat"},{id:"tier-4-spells",level:8,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells and upcast spells at tier 4.",maxTier:4},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"spellshaper-2",level:9,type:"passive_feature",name:"Spellshaper (2)",description:"Choose 1 additional Spellshaper ability.",category:"combat"},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"elemental-surge-2",level:10,type:"passive_feature",name:"Elemental Surge (2)",description:"Your Elemental Surge ability now regains WIL + 1d4 mana.",category:"combat"},{id:"tier-5-spells",level:10,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells and upcast spells at tier 5.",maxTier:5},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Mage subclass feature.",category:"combat"},{id:"tier-6-spells",level:12,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells and upcast spells at tier 6.",maxTier:6},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"spellshaper-3",level:13,type:"passive_feature",name:"Spellshaper (3)",description:"Choose 1 additional Spellshaper ability.",category:"combat"},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"strength",amount:1}]},{id:"tier-7-spells",level:14,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells and upcast spells at tier 7.",maxTier:7},{id:"elemental-mastery-3",level:14,type:"passive_feature",name:"Elemental Mastery (3)",description:"Learn the Utility Spells from a 3rd spell school you know.",category:"utility"},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Mage subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-8-spells",level:16,type:"spell_tier_access",name:"Tier 8 Spells",description:"You may now cast tier 8 spells and upcast spells at tier 8.",maxTier:8},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"elemental-surge-3",level:17,type:"passive_feature",name:"Elemental Surge (3)",description:"Your Elemental Surge ability now regains WIL + 2d4 mana.",category:"combat"},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-9-spells",level:18,type:"spell_tier_access",name:"Tier 9 Spells",description:"You may now cast tier 9 spells and upcast spells at tier 9.",maxTier:9},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon.",category:"utility"},{id:"archmage",level:20,type:"passive_feature",name:"Archmage",description:"+1 to any 2 of your stats. The first tiered spell you cast each encounter costs 1 action less and 5 fewer mana.",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}]},oathsworn:{id:"oathsworn",name:"Oathsworn",description:"A holy warrior bound by sacred oaths, wielding radiant magic and divine judgment.",hitDieSize:10,keyAttributes:["strength","will"],startingHP:17,armorProficiencies:[{type:"cloth"},{type:"leather"},{type:"mail"},{type:"plate"}],weaponProficiencies:[{type:"strength_weapons"}],saveAdvantages:{strength:"advantage",dexterity:"disadvantage"},startingEquipment:["mace","rusty-mail","wooden-buckler","manacles"],features:[{id:"radiant-judgment",level:1,type:"passive_feature",name:"Radiant Judgment",description:"Whenever an enemy attacks you, if you have no Judgment Dice, roll your Judgment dice (2d6). On your next melee attack this encounter, if you hit, deal that much additional radiant damage. The dice are expended whether you hit or miss.",category:"combat"},{id:"lay-on-hands",level:1,type:"ability",name:"Lay on Hands",description:"Gain a magical pool of healing power. This pool's maximum is always equal to 5 \xd7 LVL and recharges on a Safe Rest. Action: Touch a target and spend any amount of remaining healing power to restore that many HP.",ability:{id:"lay-on-hands",name:"Lay on Hands",description:"Touch a target and spend any amount of remaining healing power to restore that many HP.",type:"action",frequency:"at_will",actionCost:1}},{id:"lay-on-hands-pool",level:1,type:"resource",name:"Lay on Hands Pool",description:"Magical healing power that can be spent to restore HP.",resourceDefinition:{id:"lay-on-hands-pool",name:"Lay on Hands",description:"Healing power to restore HP",colorScheme:"yellow-radiant",icon:"heart",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:5},startingAmount:5},{id:"mana-and-radiant-spellcasting",level:2,type:"resource",name:"Mana Pool",description:"You know Radiant cantrips, tier 1 Radiant spells, and gain a mana pool. Your mana pool is equal to WIL + LVL and recharges on a Safe Rest.",resourceDefinition:{id:"oathsworn-mana",name:"Mana",description:"Divine energy used to cast spells",colorScheme:"yellow-radiant",icon:"sun",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:10},startingAmount:4},{id:"zealot",level:2,type:"ability",name:"Zealot",description:"When you melee attack with a melee weapon, you may spend mana (up to your highest unlocked spell tier) to choose one for each mana spent:\n Condemning Strike: Deal +5 radiant damage.\n Blessed Aim: Decrease your target's armor by 1 step for this attack.",ability:{id:"zealot",name:"Zealot",description:"Enhance melee attacks by spending mana for Condemning Strike (+5 radiant damage) or Blessed Aim (decrease target's armor by 1 step).",type:"action",frequency:"at_will"}},{id:"paragon-of-virtue",level:2,type:"passive_feature",name:"Paragon of Virtue",description:"Advantage on Influence checks to convince someone when you are forthrightly telling the truth, disadvantage when misleading.",category:"social"},{id:"subclass",level:3,type:"subclass_choice",name:"Sacred Oath",description:"Commit yourself to an Oath and gain its benefits.",availableSubclasses:["oathsworn-vengeance","oathsworn-refuge"]},{id:"radiant-judgment-2",level:3,type:"passive_feature",name:"Radiant Judgment (2)",description:"Your Judgment Dice are d8s.",category:"combat"},{id:"sacred-decree-1",level:3,type:"passive_feature",name:"Sacred Decree",description:"Learn 1 Sacred Decree.",category:"combat"},{id:"serve-selflessly",level:3,type:"passive_feature",name:"Serve Selflessly",description:"Whenever you perform a notable selfless act during a Safe Rest, you may choose different Oathsworn options available to you.",category:"utility"},{id:"my-life-for-my-friends",level:4,type:"ability",name:"My Life, for My Friends",description:"You can Interpose for free.",ability:{id:"my-life-for-my-friends",name:"My Life, for My Friends",description:"You can Interpose for free.",type:"action",frequency:"at_will"}},{id:"tier-2-spells",level:4,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells and upcast spells at tier 2.",maxTier:2},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"strength",amount:1}]},{id:"radiant-judgment-3",level:5,type:"passive_feature",name:"Radiant Judgment (3)",description:"Your Judgment Dice are d10s.",category:"combat"},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or INT.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-3-spells",level:6,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells and upcast spells at tier 3.",maxTier:3},{id:"sacred-decree-2",level:6,type:"passive_feature",name:"Sacred Decree (2)",description:"Learn a 2nd Sacred Decree.",category:"combat"},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Oathsworn subclass feature.",category:"combat"},{id:"master-of-radiance-1",level:7,type:"passive_feature",name:"Master of Radiance",description:"Choose 1 Radiant Utility Spell.",category:"utility"},{id:"tier-4-spells",level:8,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells and upcast spells at tier 4.",maxTier:4},{id:"radiant-judgment-4",level:8,type:"passive_feature",name:"Radiant Judgment (4)",description:"Your Judgment Dice are d12s.",category:"combat"},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"sacred-decree-3",level:9,type:"passive_feature",name:"Sacred Decree (3)",description:"Learn a 3rd Sacred Decree.",category:"combat"},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"tier-5-spells",level:10,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells and upcast spells at tier 5.",maxTier:5},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"radiant-judgment-5",level:10,type:"passive_feature",name:"Radiant Judgment (5)",description:"Your Judgment Dice are d20s.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Oathsworn subclass feature.",category:"combat"},{id:"master-of-radiance-2",level:11,type:"passive_feature",name:"Master of Radiance (2)",description:"Choose a 2nd Radiant Utility Spell.",category:"utility"},{id:"sacred-decree-4",level:12,type:"passive_feature",name:"Sacred Decree (4)",description:"Learn a 4th Sacred Decree.",category:"combat"},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"strength",amount:1}]},{id:"tier-6-spells",level:13,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells and upcast spells at tier 6.",maxTier:6},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or INT.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"sacred-decree-5",level:14,type:"passive_feature",name:"Sacred Decree (5)",description:"Learn a 5th Sacred Decree.",category:"combat"},{id:"radiant-judgment-6",level:14,type:"passive_feature",name:"Radiant Judgment (6)",description:"Whenever you roll Judgment Dice, roll 1 more.",category:"combat"},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Oathsworn subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"sacred-decree-6",level:16,type:"passive_feature",name:"Sacred Decree (6)",description:"Learn a 6th Sacred Decree.",category:"combat"},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"tier-7-spells",level:17,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells and upcast spells at tier 7.",maxTier:7},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 DEX or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"unending-judgment",level:18,type:"passive_feature",name:"Unending Judgment",description:"While you have no Judgment Dice, gain +5 damage to melee attacks.",category:"combat"},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon.",category:"utility"},{id:"glorious-paragon",level:20,type:"passive_feature",name:"Glorious Paragon",description:"+1 to any 2 of your stats. Defend for free whenever you Interpose.",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}]},shadowmancer:{id:"shadowmancer",name:"Shadowmancer",description:"A dark warlock who has made a pact with a powerful shadow entity, wielding necrotic magic and summoning shadow minions.",hitDieSize:8,keyAttributes:["intelligence","dexterity"],startingHP:13,armorProficiencies:[{type:"cloth"}],weaponProficiencies:[{type:"freeform",name:"Blades, Wands"}],saveAdvantages:{intelligence:"advantage",will:"advantage"},startingEquipment:["adventurers-garb","sickle","shovel"],features:[{id:"conduit-of-shadow",level:1,type:"passive_feature",name:"Conduit of Shadow",description:"Your Patron grants you knowledge of: Shadow Blast (Necrotic cantrip) Action (1/turn) Range: 8 Damage: 1d12 + KEY. High Levels: +1d12 damage every 5 levels.",category:"combat"},{id:"summon-shadows",level:1,type:"ability",name:"Summon Shadows",description:"(Necrotic cantrip) High Levels: +1 Reach every 5 levels. Action: Summon a shadow minion within Reach 1 (you can summon a max of INT or LVL minions this way, whichever is lower). Action (1/turn) Command ALL of your minions to move 6 then attack (Reach 1, 1d12 each).",ability:{id:"summon-shadows",name:"Summon Shadows",description:"Summon a shadow minion within Reach 1. Command ALL minions to move 6 then attack.",type:"action",frequency:"at_will",actionCost:1}},{id:"master-of-darkness",level:2,type:"passive_feature",name:"Master of Darkness",description:"Your Patron grants you knowledge of Necrotic cantrips and tier 1 spells.",category:"combat"},{id:"pilfered-power",level:2,type:"ability",name:"Pilfered Power",description:"You may steal power from your patron to cast tiered spells, always casting them at the highest tier you have unlocked. You can do this DEX times before your patron takes notice. Each time you exceed this limit, your patron damages you for half your max HP as recompense. This limit resets when you commune with your patron during a Safe Rest.",ability:{id:"pilfered-power",name:"Pilfered Power",description:"Cast tiered spells at highest unlocked tier. DEX uses before patron takes notice.",type:"action",frequency:"per_safe_rest"}},{id:"the-pact-is-sealed",level:3,type:"subclass_choice",name:"THE PACT IS SEALED",description:"Choose a subclass and 1 Lesser Shadow Invocation.",availableSubclasses:["shadowmancer-red-dragon","shadowmancer-abyssal-depths"]},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"gift-from-the-master-1",level:4,type:"pick_feature_from_pool",name:"A Gift from the Master",description:"Choose 1 Greater Shadow Invocation.",poolId:"greater-invocations",choicesAllowed:1},{id:"tier-2-spells",level:5,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells; all of your spells are cast at this tier.",maxTier:2},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"gift-from-the-master-2",level:6,type:"pick_feature_from_pool",name:"A Gift from the Master (2)",description:"Choose a 2nd Greater Shadow Invocation. Shadowmastery: Choose 1 Necrotic Utility Spell.",poolId:"greater-invocations",choicesAllowed:1},{id:"shadowmastery-1",level:6,type:"spell_school",name:"Shadowmastery",description:"Choose 1 Necrotic Utility Spell.",spellSchool:{schoolId:"shadow",name:"Shadow Magic",description:"Dark magic that manipulates shadow and necrotic energy."}},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shadowmancer subclass feature.",category:"combat"},{id:"tier-3-spells",level:7,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells; all of your spells are cast at this tier.",maxTier:3},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"lesser-invocation-2",level:8,type:"pick_feature_from_pool",name:"Lesser Invocation (2)",description:"Choose a 2nd Lesser Shadow Invocation.",poolId:"lesser-invocations",choicesAllowed:1},{id:"gift-from-the-master-3",level:9,type:"pick_feature_from_pool",name:"A Gift from the Master (3)",description:"Choose a 3rd Greater Shadow Invocation.",poolId:"greater-invocations",choicesAllowed:1},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"strength",amount:1}]},{id:"tier-4-spells",level:10,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells; all of your spells are cast at this tier.",maxTier:4},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shadowmancer subclass feature.",category:"combat"},{id:"lesser-invocation-3",level:11,type:"pick_feature_from_pool",name:"Lesser Invocation (3)",description:"Choose a 3rd Lesser Shadow Invocation.",poolId:"lesser-invocations",choicesAllowed:1},{id:"greedy-pact",level:12,type:"passive_feature",name:"Greedy Pact",description:"When you would take damage from Pilfer Power, make a STR save: 1-9: Suffer damage as normal. 10-19: Suffer only 10 HP of damage. 20+: Suffer no damage and cast the spell as if it were 1 tier higher.",category:"combat"},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"tier-5-spells",level:13,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells; all of your spells are cast at this tier.",maxTier:5},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"gift-from-the-master-4",level:14,type:"pick_feature_from_pool",name:"A Gift from the Master (4)",description:"Choose a 4th Greater Shadow Invocation.",poolId:"greater-invocations",choicesAllowed:1},{id:"shadowmastery-2",level:14,type:"passive_feature",name:"Shadowmastery (2)",description:"You know all Necrotic Utility Spells.",category:"utility"},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shadowmancer subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-6-spells",level:16,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells; all of your spells are cast at this tier.",maxTier:6},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"dire-shadows",level:17,type:"passive_feature",name:"Dire Shadows",description:"Attacks against your shadow minions are made with disadvantage. They take no damage from successful saves.",category:"combat"},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or WIL.",statBoosts:[{attribute:"strength",amount:1}]},{id:"gift-from-the-master-5",level:18,type:"pick_feature_from_pool",name:"A Gift from the Master (5)",description:"Choose a 5th Greater Shadow Invocation.",poolId:"greater-invocations",choicesAllowed:1},{id:"tier-7-spells",level:19,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells; all of your spells are cast at this tier.",maxTier:7},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"eldritch-usurper",level:20,type:"passive_feature",name:"Eldritch Usurper",description:"+1 to any 2 of your stats. Whenever you summon a single shadow minion, summon 2 instead. They die only when they receive 12 or more damage at one time.",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}],featurePools:[{id:"lesser-invocations",name:"Lesser Shadow Invocations",description:"Minor powers granted by your shadow patron that enhance your abilities outside of combat.",features:[{id:"abhorrent-speech",level:2,type:"passive_feature",name:"Abhorrent Speech",description:"You can communicate with horrible creatures (aberrations, undead, etc.).",category:"social"},{id:"beguiling-influence",level:2,type:"ability",name:"Beguiling Influence",description:"(1/day) You may reroll an Influence check.",ability:{id:"beguiling-influence",name:"Beguiling Influence",description:"Reroll an Influence check.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"blood-sight",level:2,type:"ability",name:"Blood Sight",description:"(1/day) You may reroll an Examination check. Additionally, you can detect traces of blood on a surface, even after it has been cleaned.",ability:{id:"blood-sight",name:"Blood Sight",description:"Reroll an Examination check. You can also detect traces of blood.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"devoted-acolyte",level:2,type:"passive_feature",name:"Devoted Acolyte",description:"Learn 2 of the following languages: Celestial, Draconic, Deep Speak, Infernal, or Primordial. Advantage on Lore checks related to those 2 languages.",category:"exploration"},{id:"eldritch-sense",level:2,type:"passive_feature",name:"Eldritch Sense",description:"You can sense the presence of any shapechanger or creature concealed by magic while within 6 spaces of them.",category:"exploration"},{id:"gaze-of-two-minds",level:2,type:"passive_feature",name:"Gaze of Two Minds",description:"Touch a willing creature and perceive through its senses instead of your own for as long as you hold concentration.",category:"utility"},{id:"knowledge-from-beyond",level:2,type:"ability",name:"Knowledge from Beyond",description:"Whenever you fail an Insight or Arcana check, you may suffer 1 Wound to succeed instead.",ability:{id:"knowledge-from-beyond",name:"Knowledge from Beyond",description:"Suffer 1 Wound to succeed on a failed Insight or Arcana check.",type:"action",frequency:"at_will"}},{id:"my-favored-pet",level:2,type:"passive_feature",name:"My Favored Pet",description:"One shadow minion can begrudgingly tolerate you outside of combat. It can (very creepily) do any menial task a below average commoner could.",category:"utility"},{id:"voice-of-the-dark",level:2,type:"passive_feature",name:"Voice of the Dark",description:"You can communicate telepathically with a humanoid within 6 spaces.",category:"social"},{id:"whispers-of-the-grave",level:2,type:"ability",name:"Whispers of the Grave",description:"(1/day) You can ask a dead creature 3 yes/no questions. It can never be questioned this way again.",ability:{id:"whispers-of-the-grave",name:"Whispers of the Grave",description:"Ask a dead creature 3 yes/no questions.",type:"action",frequency:"per_safe_rest",maxUses:1}}]},{id:"greater-invocations",name:"Greater Shadow Invocations",description:"Major powers granted by your shadow patron that enhance your combat abilities and shadow magic.",features:[{id:"armor-of-shadows",level:2,type:"passive_feature",name:"Armor of Shadows",description:"Reduce all damage you receive by an amount equal to the number of minions you have.",category:"combat"},{id:"fiendish-boon",level:2,type:"stat_boost",name:"Fiendish Boon",description:"Increase your DEX or INT by 1. You have 1 fewer maximum Hit Dice.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"hungering-shadows",level:2,type:"passive_feature",name:"Hungering Shadows",description:"Whenever one of your shadows would crit, the next tiered spell you cast this encounter does not cost any use of Pilfered Power.",category:"combat"},{id:"one-with-shadows",level:2,type:"passive_feature",name:"One with Shadows",description:"Action: When you are in an area of dim light or darkness, you may become Invisible until you move or attack.",category:"combat"},{id:"repelling-blast",level:2,type:"passive_feature",name:"Repelling Blast",description:"When you hit a Medium or smaller creature with Shadow Blast, you can push the creature up to 2 spaces away from yourself.",category:"combat"},{id:"shadow-magus",level:2,type:"passive_feature",name:"Shadow Magus",description:"Your minions gain +4 Reach and deal 1d10 damage instead.",category:"combat"},{id:"shadow-spear",level:2,type:"passive_feature",name:"Shadow Spear",description:"Your Shadow Blast can target creatures twice as far away, it ignores cover, and you may attack Prone targets with advantage while it (instead of disadvantage).",category:"combat"},{id:"shadow-rush",level:2,type:"passive_feature",name:"Shadow Rush",description:"When your shadow minions attack, instead of rolling damage, you may have any of them deal the max amount, then die.",category:"combat"},{id:"shadow-warp",level:2,type:"ability",name:"Shadow Warp",description:"Action: Switch places with a creature within 12 spaces that has been dealt necrotic damage this turn.",ability:{id:"shadow-warp",name:"Shadow Warp",description:"Switch places with a creature within 12 spaces that has been dealt necrotic damage this turn.",type:"action",frequency:"at_will",actionCost:1}},{id:"swarming-shadows",level:2,type:"passive_feature",name:"Swarming Shadows",description:"Whenever one of your shadows would crit, summon another shadow minion adjacent to the target.",category:"combat"},{id:"vengeful-blast",level:2,type:"ability",name:"Vengeful Blast",description:"Whenever a minion dies, you may cast Shadow Blast as a reaction (even if you already cast it this turn).",ability:{id:"vengeful-blast",name:"Vengeful Blast",description:"Cast Shadow Blast as a reaction when a minion dies.",type:"action",frequency:"at_will"}}]}],subclasses:[{id:"shadowmancer-red-dragon",name:"Pact of the Red Dragon",description:"Your patron is a mighty red dragon who grants you fire magic and burning minions.",parentClassId:"shadowmancer",features:[{id:"draconic-crimson-rite",level:3,type:"passive_feature",name:"Draconic Crimson Rite",description:"Your Patron grants you knowledge of Fire spells. Your shadow minions become flaming dragon wyrmling shadows. Your Shadow Blast and minions can deal fire or necrotic damage and inflict Smoldering whenever they would crit.",category:"combat"},{id:"well-all-burn",level:7,type:"passive_feature",name:"We'll ALL Burn!",description:"You may cast Pyroclasm without Pilfered Power by including yourself in the damage. You have advantage on the save. Choose 1 Fire Utility Spell.",category:"combat"},{id:"heart-of-burning-fire",level:11,type:"passive_feature",name:"Heart of Burning Fire",description:"Regain 1 use of Pilfered Power each time you roll Initiative. This expires at the end of combat if unused.",category:"combat"},{id:"enveloped-by-the-master",level:15,type:"passive_feature",name:"Enveloped by the Master",description:"Gain 1d4 Wounds to cast Dragonform.",category:"combat"}]},{id:"shadowmancer-abyssal-depths",name:"Pact of the Abyssal Depths",description:"Your patron is an ancient entity from the frozen depths who grants you ice magic and frost minions.",parentClassId:"shadowmancer",features:[{id:"master-of-nightfrost",level:3,type:"passive_feature",name:"Master of Nightfrost",description:"Your Patron grants you knowledge of Ice spells. Gain the ability to breathe underwater. Your Shadow minions become beings of nightfrost. Your shadow blast and minions can deal cold or necrotic damage, and whenever they would crit, you gain INT + LVL temp HP.",category:"combat"},{id:"shadowfrost",level:7,type:"passive_feature",name:"Shadowfrost",description:"Your Shadow Blast also Slows. You can cast Cryosleep or Rimeblades without Pilfered Power by expending 10 temp HP. Choose 1 Ice Utility Spell.",category:"combat"},{id:"glacial-resilience",level:11,type:"ability",name:"Glacial Resilience",description:"(1/Safe Rest) Reaction (whenever you are attacked or would gain a condition), gain 10 + LVL temp HP and end ALL negative conditions on yourself. At the end of your next turn, any remaining temp HP are lost.",ability:{id:"glacial-resilience",name:"Glacial Resilience",description:"Gain 10 + LVL temp HP and end ALL negative conditions on yourself.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"cryomancers-reprisal",level:15,type:"passive_feature",name:"Cryomancer's Reprisal",description:"Pay half your max HP to cast ANY Ice spell. After casting an Ice spell in this way, you gain an invisible aura. The next creature that hits you with a melee attack this encounter takes cold damage equal to half the HP you spent on this casting.",category:"combat"}]}]},shepherd:{id:"shepherd",name:"Shepherd",description:"A divine warrior who walks the line between life and death, wielding both radiant and necrotic magic to heal allies and harm enemies.",hitDieSize:10,keyAttributes:["will","strength"],startingHP:17,armorProficiencies:[{type:"mail"},{type:"shields"}],weaponProficiencies:[{type:"strength_weapons"},{type:"freeform",name:"Wands"}],saveAdvantages:{will:"advantage",dexterity:"disadvantage"},startingEquipment:["rusty-mail","mace","wooden-buckler","bell"],features:[{id:"keeper-of-life-and-death",level:1,type:"passive_feature",name:"Keeper of Life & Death",description:"You know Radiant and Necrotic cantrips. Searing Light (WIL times/Safe Rest) Action: Heal or Inflict grievous injuries: Heal WIL d8 HP to a Dying creature within Reach 6. OR: Inflict WIL d8 radiant damage to an undead or Bloodied enemy within Reach 6.",category:"combat"},{id:"mana-and-unlock-tier-1-spells",level:2,type:"resource",name:"Mana Pool",description:"You unlock tier 1 Radiant and Necrotic spells and gain a mana pool to cast these spells. This mana pool's maximum is always equal to (WIL \xd7 3) + LVL and recharges on a Safe Rest.",resourceDefinition:{id:"shepherd-mana",name:"Mana",description:"Divine energy used to cast spells",colorScheme:"yellow-divine",icon:"sun",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:20},startingAmount:7},{id:"lifebinding-spirit",level:2,type:"ability",name:"Lifebinding Spirit",description:"(Radiant Spell, Tier 1) Action: Summon a spirit companion that follows you and is immune to harm. It lasts until you cast this spell again, take a Safe Rest, or it heals a number of times equal to the mana spent summoning it. Action: It attacks or heals a creature within Reach 4. It attacks for 1d6+WIL radiant damage (ignoring armor), or heals for the same amount. Upcasting: Increment its die size by 1 (max d12), +1 healing use.",ability:{id:"lifebinding-spirit",name:"Lifebinding Spirit",description:"Summon a spirit companion that can attack or heal.",type:"spell",school:"radiant",tier:1,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:1}}},{id:"subclass",level:3,type:"subclass_choice",name:"Subclass",description:"Choose a Shepherd subclass.",availableSubclasses:["shepherd-mercy","shepherd-malice"]},{id:"master-of-twilight-1",level:3,type:"pick_feature_from_pool",name:"Master of Twilight",description:"Choose 1 Necrotic and 1 Radiant Utility Spell.",poolId:"sacred-graces",choicesAllowed:1},{id:"tier-2-spells",level:4,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells and upcast spells at tier 2.",maxTier:2},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or STR.",statBoosts:[{attribute:"will",amount:1}]},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"sacred-grace-1",level:5,type:"pick_feature_from_pool",name:"Sacred Grace",description:"Choose 2 Sacred Graces.",poolId:"sacred-graces",choicesAllowed:2},{id:"tier-3-spells",level:6,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells and upcast spells at tier 3.",maxTier:3},{id:"master-of-twilight-2",level:6,type:"passive_feature",name:"Master of Twilight (2)",description:"Choose a 2nd Necrotic and Radiant Utility Spell.",category:"utility"},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shepherd subclass feature.",category:"combat"},{id:"tier-4-spells",level:8,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells and upcast spells at tier 4.",maxTier:4},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or STR.",statBoosts:[{attribute:"strength",amount:1}]},{id:"sacred-grace-2",level:9,type:"pick_feature_from_pool",name:"Sacred Grace (2)",description:"Choose a 3rd Sacred Grace.",poolId:"sacred-graces",choicesAllowed:1},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-5-spells",level:10,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells and upcast spells at tier 5.",maxTier:5},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shepherd subclass feature.",category:"combat"},{id:"master-of-twilight-3",level:11,type:"passive_feature",name:"Master of Twilight (3)",description:"You know all Necrotic and Radiant Utility Spells.",category:"utility"},{id:"tier-6-spells",level:12,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells and upcast spells at tier 6.",maxTier:6},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or STR.",statBoosts:[{attribute:"will",amount:1}]},{id:"sacred-grace-3",level:13,type:"pick_feature_from_pool",name:"Sacred Grace (3)",description:"Choose a 4th Sacred Grace.",poolId:"sacred-graces",choicesAllowed:1},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"tier-7-spells",level:14,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells and upcast spells at tier 7.",maxTier:7},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Shepherd subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-8-spells",level:16,type:"spell_tier_access",name:"Tier 8 Spells",description:"You may now cast tier 8 spells and upcast spells at tier 8.",maxTier:8},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or STR.",statBoosts:[{attribute:"strength",amount:1}]},{id:"revitalizing-blessing",level:17,type:"ability",name:"Revitalizing Blessing",description:"(1/round) Whenever you roll a 6 or higher on one or more healing die, the target may recover one Wound.",ability:{id:"revitalizing-blessing",name:"Revitalizing Blessing",description:"When you roll 6+ on healing dice, target may recover one Wound.",type:"action",frequency:"at_will"}},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-9-spells",level:18,type:"spell_tier_access",name:"Tier 9 Spells",description:"You may now cast tier 9 spells and upcast spells at tier 9.",maxTier:9},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"twilight-sage",level:20,type:"passive_feature",name:"Twilight Sage",description:"+1 to any 2 of your stats. Your Lifebinding Spirit rolls twice as many dice.",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}],featurePools:[{id:"sacred-graces",name:"Sacred Graces",description:"Divine gifts that enhance your Lifebinding Spirit and grant special abilities.",features:[{id:"assist-me-my-friend",level:3,type:"ability",name:"Assist Me, My Friend!",description:"Whenever you make your first melee attack each round, you may add your Lifebinding Spirit's damage to the attack.",ability:{id:"assist-me-my-friend",name:"Assist Me, My Friend!",description:"Add your Lifebinding Spirit's damage to your first melee attack each round.",type:"action",frequency:"at_will"}},{id:"empowered-companion",level:3,type:"passive_feature",name:"Empowered Companion",description:"Whenever you spend mana to call forth your Lifebinding Spirit, you cast it as if you spent 1 additional mana (ignoring the typical spell tier restrictions). The maximum die size is now a d20.",category:"combat"},{id:"guiding-spirit",level:3,type:"passive_feature",name:"Guiding Spirit",description:"When your Lifebinding Spirit rolls a 6 or higher on its damage die, the target begins to glow with radiant light. The next attack against that target has advantage.",category:"combat"},{id:"hasty-companion",level:3,type:"passive_feature",name:"Hasty Companion",description:"+4 Reach for your Lifebinding Spirit. It can also act for free when summoned.",category:"combat"},{id:"illuminate-soul",level:3,type:"ability",name:"Illuminate Soul",description:"Action: A creature within 6 spaces begins to glow with radiant light. For 1 Round, attacks against them are made with your choice of advantage or disadvantage. You may do this WIL times per Safe Rest.",ability:{id:"illuminate-soul",name:"Illuminate Soul",description:"Make a creature glow with radiant light. Attacks against them have advantage or disadvantage for 1 round.",type:"action",frequency:"per_safe_rest",actionCost:1}},{id:"light-bearer",level:3,type:"passive_feature",name:"Light Bearer",description:"Regain 1 use of Searing Light when you roll Initiative (this expires if unspent at the end of combat).",category:"combat"},{id:"not-beyond-my-reach",level:3,type:"passive_feature",name:"Not Beyond MY Reach",description:"You may target creatures who have been dead less than 1 round for healing. For every 10 HP a dead creature is healed this way, you may have them recover 1 Wound instead (you must heal at least 1 Wound to revive them).",category:"utility"},{id:"vengeful-spirit",level:3,type:"ability",name:"Vengeful Spirit",description:"Action: Your Lifebinding Spirit sacrifices itself to transform into a swirling vortex of radiant light. At the end of your turn, it damages all enemies within 3 spaces of you, ignoring armor and cover. This lasts for a number of rounds equal to the healing charges left on the Lifebinding Spirit. This effect ends early if you summon your spirit again.",ability:{id:"vengeful-spirit",name:"Vengeful Spirit",description:"Transform your Lifebinding Spirit into a damaging vortex of radiant light.",type:"action",frequency:"at_will",actionCost:1}}]}],subclasses:[{id:"shepherd-mercy",name:"Luminary of Mercy",description:"A divine healer who channels radiant energy to heal and protect allies.",parentClassId:"shepherd",features:[{id:"merciful-healing",level:3,type:"passive_feature",name:"Merciful Healing",description:"When an effect caused by you heals a Dying creature, they are healed for twice as much. (1/round) Your Lifebinding Spirit can act for free while you are Dying. Life is Beautiful: Harmless and lovely creatures such as butterflies and humming birds are attracted to your presence and often follow you. Flowers bloom more vibrantly in your presence.",category:"combat"},{id:"conduit-of-light",level:7,type:"passive_feature",name:"Conduit of Light",description:"When an effect caused by you would heal HP, you may expend 1 use of Searing Light to heal (or damage, ignoring armor) another target within 6 spaces of yourself for the same amount.",category:"combat"},{id:"powerful-healer",level:11,type:"ability",name:"Powerful Healer",description:"(WIL times/Safe Rest) Whenever you would roll dice to heal damage, you may instead heal the max amount you could roll, or give that many temp HP.",ability:{id:"powerful-healer",name:"Powerful Healer",description:"Heal the maximum amount instead of rolling dice.",type:"action",frequency:"per_safe_rest"}},{id:"empowered-conduit",level:15,type:"passive_feature",name:"Empowered Conduit",description:"Your Conduit of Light may target 1 additional creature. Regain 1 charge of Searing Light when you roll Initiative (this expires if unspent at the end of combat).",category:"combat"}]},{id:"shepherd-malice",name:"Luminary of Malice",description:"A dark priest who channels necrotic energy to harm enemies and manipulate death.",parentClassId:"shepherd",features:[{id:"soul-reaper",level:3,type:"passive_feature",name:"Soul Reaper",description:"When you use Searing Light to harm an enemy, make a 2nd enemy within range take the same amount of damage (ignoring armor). Harbinger of Decay: Vibrant colors and lovely smells are suppressed near you. Foods spoil more rapidly in your presence, and you frequently awaken to flies wherever you lodge. You may have your Lifebinding Spirit shift into a deathly version of itself (a zombie dog, a devious imp, etc.) and have its damage type become necrotic.",category:"combat"},{id:"veilwalkers-blessing",level:7,type:"ability",name:"Veilwalker's Blessing",description:"(1/Safe Rest) Reaction (when you would drop to 0 HP): Drop to 1 HP instead and force an enemy within 6 spaces to make a STR save. On a failure, they become Bloodied, or if they are already Bloodied, they drop to 0 HP.",ability:{id:"veilwalkers-blessing",name:"Veilwalker's Blessing",description:"Drop to 1 HP instead of 0 and force an enemy to make a STR save.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"deathbringers-touch",level:11,type:"passive_feature",name:"Deathbringer's Touch",description:"Your first melee attack each round against a Bloodied creature is an automatic critical hit. Your Lifebinding Spirit deals additional damage equal to your STR.",category:"combat"},{id:"conduit-of-death",level:15,type:"passive_feature",name:"Conduit of Death",description:"Your Veilwalker's Blessing ability recharges when you roll Initiative. This charge is lost if unspent at the end of combat.",category:"combat"}]}]},songweaver:{id:"songweaver",name:"Songweaver",description:"A charismatic bard who weaves magic through song and story, inspiring allies and mocking enemies.",hitDieSize:8,keyAttributes:["will","intelligence"],startingHP:13,armorProficiencies:[{type:"cloth"},{type:"leather"}],weaponProficiencies:[{type:"dexterity_weapons"},{type:"freeform",name:"Wands"}],saveAdvantages:{will:"advantage",strength:"disadvantage"},startingEquipment:["adventurers-garb","instrument","dagger","mirror"],features:[{id:"wind-spellcasting",level:1,type:"passive_feature",name:"Wind Spellcasting and...",description:"You know cantrips from the Wind school and 1 other school of your choice. You also know the cantrip Vicious Mockery.",category:"combat"},{id:"vicious-mockery",level:1,type:"ability",name:"Vicious Mockery",description:"(Wind cantrip) Action: Range: 12. Damage: 1d4+INT psychic (ignoring armor). On hit: the target is Taunted during their next turn. High Levels: +2 damage every 5 levels.",ability:{id:"vicious-mockery",name:"Vicious Mockery",description:"Deal psychic damage and taunt the target.",type:"action",frequency:"at_will",actionCost:1,roll:{dice:{count:1,sides:4},attribute:"intelligence"}}},{id:"songweavers-inspiration",level:1,type:"ability",name:"Songweaver's Inspiration",description:"(2\xd7WIL times/Safe Rest) Free Reaction: Allow an ally to reroll a single die related to an attack or save (must keep either result).",ability:{id:"songweavers-inspiration",name:"Songweaver's Inspiration",description:"Allow an ally to reroll a single die for an attack or save.",type:"action",frequency:"per_safe_rest"}},{id:"mana-and-unlock-tier-1-spells",level:2,type:"resource",name:"Mana Pool",description:"You unlock tier 1 spells in the schools you know and gain a mana pool to cast them. This mana pool's maximum is always equal to (INT\xd73)+LVL and recharges on a Safe Rest.",resourceDefinition:{id:"songweaver-mana",name:"Mana",description:"Magical energy used to cast spells",colorScheme:"purple-arcane",icon:"music",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:20},startingAmount:7},{id:"jack-of-all-trades",level:2,type:"passive_feature",name:"Jack of All Trades",description:"When you Safe Rest, you may move a skill point as if you just leveled up.",category:"utility"},{id:"song-of-rest",level:2,type:"passive_feature",name:"Song of Rest",description:"(1/day) Whenever you Field Rest, you may play a song and allow anyone who spends Hit Dice to heal additional HP equal to your WIL.",category:"utility"},{id:"subclass",level:3,type:"subclass_choice",name:"Subclass",description:"Choose a Songweaver subclass.",availableSubclasses:["songweaver-snark","songweaver-courage"]},{id:"quick-wit",level:3,type:"passive_feature",name:"Quick Wit",description:"When you roll Initiative, you may regain 2 spent uses of your Songweaver's Inspiration (these expire at the end of combat if left unused).",category:"combat"},{id:"windbag",level:3,type:"passive_feature",name:"Windbag",description:"Choose 1 Utility Spell from each spell school you know.",category:"utility"},{id:"tier-2-spells",level:4,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells and upcast spells at tier 2.",maxTier:2},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or INT.",statBoosts:[{attribute:"will",amount:1}]},{id:"lyrical-weaponry-1",level:4,type:"pick_feature_from_pool",name:"Lyrical Weaponry",description:"Choose 1 ability from the Lyrical Weaponry list.",poolId:"lyrical-weaponry",choicesAllowed:1},{id:"people-person",level:5,type:"pick_feature_from_pool",name:'A "People" Person',description:"You've met many people in your travels; some have even agreed to come to your aid should you need it. Choose 2 friends you know: you can temporarily summon 1 using song (1/Safe Rest each).",poolId:"people-person",choicesAllowed:2},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"strength",amount:1}]},{id:"tier-3-spells",level:6,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells and upcast spells at tier 3.",maxTier:3},{id:"windbag-2",level:6,type:"passive_feature",name:"Windbag (2)",description:"Choose a 2nd Utility Spell from each spell school you know.",category:"utility"},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Songweaver subclass feature.",category:"combat"},{id:"tier-4-spells",level:8,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells and upcast spells at tier 4.",maxTier:4},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"lyrical-weaponry-2",level:9,type:"pick_feature_from_pool",name:"Lyrical Weaponry (2)",description:"Choose a 2nd ability from the Lyrical Weaponry list.",poolId:"lyrical-weaponry",choicesAllowed:1},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-5-spells",level:10,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells and upcast spells at tier 5.",maxTier:5},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Songweaver subclass feature.",category:"combat"},{id:"tier-6-spells",level:12,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells and upcast spells at tier 6.",maxTier:6},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or INT.",statBoosts:[{attribute:"will",amount:1}]},{id:"lyrical-weaponry-3",level:13,type:"pick_feature_from_pool",name:"Lyrical Weaponry (3)",description:"Choose a 3rd ability from the Lyrical Weaponry list.",poolId:"lyrical-weaponry",choicesAllowed:1},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"strength",amount:1}]},{id:"tier-7-spells",level:14,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells and upcast spells at tier 7.",maxTier:7},{id:"windbag-3",level:14,type:"passive_feature",name:"Windbag (3)",description:"You know all Utility Spells from the spell schools you know.",category:"utility"},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Songweaver subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-8-spells",level:16,type:"spell_tier_access",name:"Tier 8 Spells",description:"You may now cast tier 8 spells and upcast spells at tier 8.",maxTier:8},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"lyrical-weaponry-4",level:17,type:"pick_feature_from_pool",name:"Lyrical Weaponry (4)",description:"Choose a 4th ability from the Lyrical Weaponry list.",poolId:"lyrical-weaponry",choicesAllowed:1},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"tier-9-spells",level:18,type:"spell_tier_access",name:"Tier 9 Spells",description:"You may now cast tier 9 spells and upcast spells at tier 9.",maxTier:9},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"im-so-famous",level:20,type:"passive_feature",name:"I'm So Famous!",description:"+1 to any 2 of your stats. Your Songweaver's Inspiration cannot fail (your target succeeds).",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}],featurePools:[{id:"lyrical-weaponry",name:"Lyrical Weaponry",description:"Musical abilities that weaponize your performances and enhance your bardic magic.",features:[{id:"heroic-ballad",level:4,type:"ability",name:"Heroic Ballad",description:"+2 max Songweaver's Inspiration charges. When used to reroll an attack, your Songweaver's Inspiration also grants them +WIL damage on the attack.",ability:{id:"heroic-ballad",name:"Heroic Ballad",description:"Songweaver's Inspiration grants +WIL damage when used to reroll attacks.",type:"action",frequency:"at_will"}},{id:"inspiring-anthem",level:4,type:"ability",name:"Inspiring Anthem",description:"(1/encounter) Action: Grant all friendly Dying creatures who can hear you 1d4+WIL+1 actions.",ability:{id:"inspiring-anthem",name:"Inspiring Anthem",description:"Grant all friendly Dying creatures who can hear you 1d4+WIL+1 actions.",type:"action",frequency:"per_encounter",maxUses:1,actionCost:1}},{id:"not-my-beautiful-feaaaah",level:4,type:"ability",name:"Not My Beautiful Feaaaah!",description:"(1/encounter) When you Defend, force the attacker to roll again or be defended within range on a failed WIL save (if there is none, the attack fails). If they fail by 5 or more, they attack themselves as punishment for even thinking they could harm you! On save, they attack you with disadvantage.",ability:{id:"not-my-beautiful-feaaaah",name:"Not My Beautiful Feaaaah!",description:"When defending, force attacker to make WIL save or be redirected.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"rhapsody-of-the-normal",level:4,type:"passive_feature",name:"Rhapsody of the Normal",description:"When you roll 4 or more on your Vicious Mockery, you may spend a Songweaver's Inspiration charge to temporarily suppress any special abilities they have until the end of their next turn. They can do what an untrained average villager can do, attack once for 1d4 damage and move up to 6 spaces (no armor, spellcasting, flying, extraordinary or other inherent or trained features).",category:"combat"},{id:"song-of-domination",level:4,type:"ability",name:"Song of Domination",description:"(1/encounter) 2 actions: Play a haunting tune, and all enemies within 6 spaces who hear it must make a WIL save. If they fail, you move them up to 6 spaces in any direction, and they cannot move on their next turn.",ability:{id:"song-of-domination",name:"Song of Domination",description:"Enemies who fail WIL save are moved 6 spaces and cannot move next turn.",type:"action",frequency:"per_encounter",maxUses:1,actionCost:2}}]},{id:"people-person",name:'A "People" Person',description:"Friends and allies you've met in your travels who can be summoned to aid you.",features:[{id:"stompy",level:5,type:"passive_feature",name:"Stompy",description:'3 actions: Summon a huge hill giant for 1 round. As he enters the battlefield adjacent to you, use Stompy\'s Stomp: Make a DC 10 Influence check. On a success, he moves 6 spaces in a direction you choose; on a failure, he moves towards YOU instead ("YOU NOT FRIEND!"). He deals everything in his path damage equal to LVL + Influence check. ANY creature within 6 spaces of Stompy can use this ability once instead of an attack. (advantage if you ask him to do something he would find mischievous or fun, with disadvantage if it is something that hurt good or menial).',category:"combat"},{id:"mal-the-malevolent-imp",level:5,type:"passive_feature",name:"Mal, the Malevolent Imp",description:"Summon a tiny fiend for 1 night. He can find out dangerous information you have no right to know. DC 10 \"Devil's Choice\" of a problem with only the slightest chance of things going wrong. Make an Influence check to convince him to help you. Gran Gran (NOT a hag): When resting, you may summon her for 1 hour to soothe your wounds (and hassle you for not eating enough). She bakes and hands out pastries equal to your WIL+INT. Eating one recovers one mana, Hit Die, or Wound. Eat them while they're warm! They expire in 10 minutes.",category:"utility"},{id:"gran-gran-not-a-hag",level:5,type:"ability",name:"Gran Gran (NOT a hag)",description:"When resting, you may summon her for 1 hour to soothe your wounds (and hassle you for not eating enough). She bakes and hands out pastries equal to your WIL+INT. Eating one recovers one mana, Hit Die, or Wound. Eat them while they're warm! They expire in 10 minutes.",ability:{id:"gran-gran",name:"Gran Gran (NOT a hag)",description:"Summon Gran Gran to bake healing pastries during rest.",type:"action",frequency:"per_safe_rest"}},{id:"linos-the-everfriendly",level:5,type:"passive_feature",name:"Linos, the Everfriendly",description:"Summon a legendary helpful friendly creature to take you and your party wherever you need to go. He may request a very large amount of food as payment.",category:"exploration"}]}],subclasses:[{id:"songweaver-snark",name:"Herald of Snark",description:"A master of cutting words and mockery who uses wit as a weapon.",parentClassId:"songweaver",features:[{id:"opportunistic-snark",level:3,type:"ability",name:"Opportunistic Snark",description:"Reaction (when an enemy within Range 12 misses an attack): You may cast Vicious Mockery at them; it deals double damage when cast this way.",ability:{id:"opportunistic-snark",name:"Opportunistic Snark",description:"Cast Vicious Mockery for double damage when enemy misses.",type:"action",frequency:"at_will"}},{id:"fight-picker",level:7,type:"ability",name:"Fight Picker",description:"(1/turn) When an enemy is damaged by your Vicious Mockery, you may have one of your allies Taunt them until the end of the enemy's turn instead.",ability:{id:"fight-picker",name:"Fight Picker",description:"Transfer Vicious Mockery taunt to an ally.",type:"action",frequency:"at_will"}},{id:"chord-of-chaos",level:11,type:"ability",name:"Chord of Chaos",description:"(1/encounter) Action: You may move ALL creatures within hearing of your song up to 3 spaces as long as they do not move into an obviously dangerous place.",ability:{id:"chord-of-chaos",name:"Chord of Chaos",description:"Move all creatures within hearing up to 3 spaces.",type:"action",frequency:"per_encounter",maxUses:1,actionCost:1}},{id:"words-like-swords",level:15,type:"passive_feature",name:"Words Like Swords",description:"Your Vicious Mockery damage becomes 1d6+INT+WIL.",category:"combat"}]},{id:"songweaver-courage",name:"Herald of Courage",description:"An inspiring leader who bolsters allies with songs of heroism and valor.",parentClassId:"songweaver",features:[{id:"inspiring-presence",level:3,type:"passive_feature",name:"Inspiring Presence",description:"Whenever you use Songweaver's Inspiration, your allies within 12 spaces who can hear you gain WIL temp HP.",category:"combat"},{id:"unfailing-courage",level:7,type:"passive_feature",name:"Unfailing Courage",description:"Your presence inspires others to feats of heroism and courage heard of only in legend. Your Songweaver's Inspiration allows your target to roll with advantage.",category:"combat"},{id:"fire-in-my-bones",level:11,type:"passive_feature",name:"Fire in my Bones",description:"Your Songweaver's Inspiration also grants your target 1 additional action.",category:"combat"},{id:"chorus-of-champions",level:15,type:"ability",name:"Chorus of Champions",description:"(1/encounter) Free Reaction: Give all party members 1 action.",ability:{id:"chorus-of-champions",name:"Chorus of Champions",description:"Give all party members 1 action.",type:"action",frequency:"per_encounter",maxUses:1}}]}]},stormshifter:{id:"stormshifter",name:"Stormshifter",description:"A primal spellcaster who masters the storms and transforms into various beast forms. Stormshifters blend natural magic with shapeshifting abilities to adapt to any situation.",hitDieSize:8,keyAttributes:["will","dexterity"],startingHP:13,armorProficiencies:[{type:"cloth"},{type:"leather"}],weaponProficiencies:[{type:"freeform",name:"Staves"},{type:"freeform",name:"Wands"}],saveAdvantages:{will:"advantage",strength:"disadvantage"},startingEquipment:["cheap-hides","staff","strange-plant"],features:[{id:"master-of-storms",level:1,type:"passive_feature",name:"Master of Storms",description:"You know cantrips from the Lightning and Wind schools.",category:"combat"},{id:"beastshift",level:1,type:"ability",name:"Beastshift",description:"Action: You can transform into a harmless beast (squirrel, pigeon, etc.). While transformed, you can speak with animals. This form lasts until you drop to 0 HP, cast a spell, or if you end the form for free. You have DEX Beastshift charges; they reset on a Safe Rest.",ability:{id:"beastshift",name:"Beastshift",description:"Transform into a harmless beast. While transformed, you can speak with animals. Lasts until you drop to 0 HP, cast a spell, or end it for free.",type:"action",frequency:"per_safe_rest",actionCost:1}},{id:"tiny-beasts",level:1,type:"passive_feature",name:"Tiny Beasts",description:"Whenever you shapeshift into a Tiny beast, attacks against you are made with disadvantage, but ANY damage ends that shapeshift form.",category:"combat"},{id:"direbeast-form",level:2,type:"ability",name:"Direbeast Form",description:"You can Beastshift into a Fearsome Beast.",ability:{id:"direbeast-form",name:"Direbeast Form",description:"Beastshift into a Fearsome Beast.",type:"action",frequency:"per_safe_rest"}},{id:"mana-and-unlock-tier-1-spells",level:2,type:"resource",name:"Mana and Unlock Tier 1 Spells",description:"You unlock tier 1 Wind and Lightning spells and gain a mana pool to cast these spells. This mana pool's maximum is always equal to (WIL \xd7 3) + LVL and recharges on a Safe Rest.",resourceDefinition:{id:"stormshifter-mana",name:"Mana",description:"Natural energy used to cast spells",colorScheme:"cyan-storm",icon:"zap",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:20},startingAmount:7},{id:"subclass",level:3,type:"subclass_choice",name:"Subclass",description:"Choose a Stormshifter subclass.",availableSubclasses:["circle-of-sky-and-storm","circle-of-fang-and-claw"]},{id:"direbeast-form-2",level:3,type:"passive_feature",name:"Direbeast Form (2)",description:"You can Beastshift into a Beast of the Pack.",category:"combat"},{id:"tier-2-spells",level:4,type:"spell_tier_access",name:"Tier 2 Spells",description:"You may now cast tier 2 spells and upcast spells at tier 2.",maxTier:2},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or DEX.",statBoosts:[{attribute:"will",amount:1}]},{id:"stormcaller",level:4,type:"spell_school",name:"Stormcaller",description:"Learn a Utility Spell from each spell school you know.",spellSchool:{schoolId:"storm-utility",name:"Storm Utility",description:"Utility spells from Wind and Lightning schools"}},{id:"be-wild",level:4,type:"passive_feature",name:"Be Wild",description:"Whenever you spend a day with wild animals during a Safe Rest, you may choose different Stormshifter options available to you.",category:"utility"},{id:"direbeast-form-3",level:5,type:"passive_feature",name:"Direbeast Form (3)",description:"You can Beastshift into a Beast of Nightmares.",category:"combat"},{id:"upgraded-cantrips-1",level:5,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"strength",amount:1}]},{id:"chimeric-boon",level:6,type:"pick_feature_from_pool",name:"Chimeric Boon",description:"Choose 2 Chimeric Boons. Whenever you shapeshift into a Direbeast form, you may modify it with 1 Chimeric Boon you know.",poolId:"chimeric-boons-pool",choicesAllowed:2},{id:"expert-shifter",level:6,type:"passive_feature",name:"Expert Shifter",description:"Gain 1 additional use of Beastshift per Safe Rest.",category:"utility"},{id:"tier-3-spells",level:6,type:"spell_tier_access",name:"Tier 3 Spells",description:"You may now cast tier 3 spells and upcast spells at tier 3.",maxTier:3},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Stormshifter subclass feature.",category:"combat"},{id:"stormcaller-2",level:7,type:"passive_feature",name:"Stormcaller (2)",description:"Learn a 2nd Utility Spell from each spell school you know.",category:"utility"},{id:"tier-4-spells",level:8,type:"spell_tier_access",name:"Tier 4 Spells",description:"You may now cast tier 4 spells and upcast spells at tier 4.",maxTier:4},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"stormborn",level:8,type:"passive_feature",name:"Stormborn",description:"Gain resistance to lightning damage. (1/day) You may gain advantage on a Naturecraft check or Concentration check.",category:"combat"},{id:"chimeric-boon-2",level:9,type:"pick_feature_from_pool",name:"Chimeric Boon (2)",description:"Choose a 3rd Chimeric Boon.",poolId:"chimeric-boons-pool",choicesAllowed:1},{id:"expert-shifter-2",level:9,type:"passive_feature",name:"Expert Shifter (2)",description:"Gain 1 additional use of Beastshift per Safe Rest.",category:"utility"},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"tier-5-spells",level:10,type:"spell_tier_access",name:"Tier 5 Spells",description:"You may now cast tier 5 spells and upcast spells at tier 5.",maxTier:5},{id:"upgraded-cantrips-2",level:10,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Stormshifter subclass feature.",category:"combat"},{id:"tier-6-spells",level:12,type:"spell_tier_access",name:"Tier 6 Spells",description:"You may now cast tier 6 spells and upcast spells at tier 6.",maxTier:6},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or DEX.",statBoosts:[{attribute:"will",amount:1}]},{id:"chimeric-boon-4",level:12,type:"pick_feature_from_pool",name:"Chimeric Boon (4)",description:"Select a 4th Chimeric Boon.",poolId:"chimeric-boons-pool",choicesAllowed:1},{id:"expert-shifter-3",level:12,type:"passive_feature",name:"Expert Shifter (3)",description:"Gain 1 additional use of Beastshift per Safe Rest.",category:"utility"},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"strength",amount:1}]},{id:"stormborn-2",level:13,type:"passive_feature",name:"Stormborn (2)",description:"Instead of rolling dice, deal the max damage of a Wind spell by spending a charge of your Beastshift, you may cast a cantrip for free.",category:"combat"},{id:"tier-7-spells",level:14,type:"spell_tier_access",name:"Tier 7 Spells",description:"You may now cast tier 7 spells and upcast spells at tier 7.",maxTier:7},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Stormshifter subclass feature.",category:"combat"},{id:"upgraded-cantrips-3",level:15,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"},{id:"tier-8-spells",level:16,type:"spell_tier_access",name:"Tier 8 Spells",description:"You may now cast tier 8 spells and upcast spells at tier 8.",maxTier:8},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 WIL or DEX.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"chimeric-boon-5",level:17,type:"pick_feature_from_pool",name:"Chimeric Boon (4)",description:"Select a 5th Chimeric Boon.",poolId:"chimeric-boons-pool",choicesAllowed:1},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 STR or INT.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"tier-9-spells",level:18,type:"spell_tier_access",name:"Tier 9 Spells",description:"You may now cast tier 9 spells and upcast spells at tier 9.",maxTier:9},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"archdruid",level:20,type:"passive_feature",name:"Archdruid",description:"+1 to any 2 of your stats. (1/encounter) Cast a spell up to tier 4 for free when you enter or leave a Beastshift form.",category:"combat"},{id:"upgraded-cantrips-4",level:20,type:"passive_feature",name:"Upgraded Cantrips",description:"Your cantrips grow stronger.",category:"combat"}],featurePools:[{id:"chimeric-boons-pool",name:"Chimeric Boons",description:"Special modifications that can be applied to Direbeast forms.",features:[{id:"beast-of-the-sea",level:1,type:"passive_feature",name:"Beast of the Sea",description:"Can move, breathe, and fight underwater without penalty.",category:"exploration"},{id:"climber",level:1,type:"passive_feature",name:"Climber",description:"Can walk across walls and ceilings, ignores difficult terrain.",category:"exploration"},{id:"fleet-footed",level:1,type:"passive_feature",name:"Fleet Footed",description:"+2 speed. Advantage on Stealth checks against the Grappled condition.",category:"exploration"},{id:"earthwalker",level:1,type:"passive_feature",name:"Earthwalker",description:"+2 armor. Can burrow through dirt and unworked rock at half speed (leaving a tunnel behind). Advantage against the Prone condition.",category:"exploration"},{id:"keen-senses",level:1,type:"passive_feature",name:"Keen Senses",description:"Advantage on Perception and Assess checks. Unaffected by Blinded.",category:"exploration"},{id:"leader-of-the-pack",level:1,type:"passive_feature",name:"Leader of the Pack",description:"Advantage against fear and charm effects for yourself and allies within 6 spaces.",category:"combat"},{id:"phasebeast",level:1,type:"passive_feature",name:"Phasebeast",description:"Whenever you shift between this form and your normal form (and vice versa), you may teleport up to 6 spaces away to a place you can see.",category:"utility"},{id:"prehensile-tail",level:1,type:"passive_feature",name:"Prehensile Tail",description:"Creatures you hit in melee that are your size or smaller are Grappled. If you hit a larger creature, you may move with it when it moves.",category:"combat"},{id:"winged",level:1,type:"passive_feature",name:"Winged",description:"Gain a flying speed. Forced movement moves you twice as far while flying.",category:"exploration"}]},{id:"direbeast-forms-pool",name:"Direbeast Forms",description:"Different beast forms that Stormshifters can transform into.",features:[{id:"fearsome-beast",level:2,type:"passive_feature",name:"Fearsome Beast (Large)",description:"Transform into any Large beast. Gain DEX + LVL temp HP (until Beastshift ends), melee attack, armor, Gore. Action: 1d6 + LVL damage, on hit: Gain LVL temp HP. Fearsome. Whenever you Interpose or Defend, you may spend 1 mana to force them to reroll (if you must choose either result).",category:"combat"},{id:"beast-of-the-pack",level:3,type:"passive_feature",name:"Beast of the Pack (Medium)",description:"Transform into a Medium beast. Gain +DEX speed, Supercharge, and the Thunderfang attack. Whenever you crit or kill one or more enemies, Thunderfang gains a cumulative +1d6 damage (resets at end combat). Thunderfang. Action: 1d4 + LVL piercing damage. Supercharge. Spend up to WIL mana, and your next Thunderfang attack deals an additional 1d8 lightning damage per mana spent (you take this damage on a miss).",category:"combat"},{id:"beast-of-nightmares",level:5,type:"passive_feature",name:"Beast of Nightmares (Tiny)",description:"Transform into any Tiny beast or insect (provided it is horrible). Gain the Sting attack and Silent But Deadly. Sting. (1/round) Action: Reach: 0. 1d4 piercing + 3\xd7LVL acid damage (ignoring armor), on crit: 4\xd7LVL damage instead. Silent But Deadly. Speed: 2. You cannot Defend or Interpose. Attackers cannot target you until you become conspicuous (e.g., being seen transforming).",category:"combat"}]}],subclasses:[tc,td]},zephyr:{id:"zephyr",name:"Zephyr",description:"A swift martial artist who combines unarmed combat with incredible speed and agility. Zephyrs master the art of movement and strikes, becoming untouchable whirlwinds in battle.",hitDieSize:8,keyAttributes:["dexterity","strength"],startingHP:13,armorProficiencies:[{type:"freeform",name:"None"}],weaponProficiencies:[{type:"freeform",name:"Melee Weapons"}],saveAdvantages:{dexterity:"advantage",intelligence:"disadvantage"},startingEquipment:["staff","traveling-robes","sandals"],features:[{id:"iron-defense",level:1,type:"passive_feature",name:"Iron Defense",description:"Your armor equals DEX + STR as long as you are unarmored.",category:"combat"},{id:"swift-fists",level:1,type:"passive_feature",name:"Swift Fists",description:"Your unarmed strikes are not subject to disadvantage imposed by Rushed Attacks (see pg. 13 of the Core Rules), and their damage is 1d4 + STR.",category:"combat"},{id:"swift-feet",level:2,type:"passive_feature",name:"Swift Feet",description:"While unarmored, gain +2 speed and +LVL Initiative.",category:"combat"},{id:"burst-of-speed",level:2,type:"ability",name:"Burst of Speed",description:"When you roll Initiative, gain DEX Bursts of Speed to use during that encounter. (1/turn) You may spend 1 Burst of Speed to use any of the following maneuvers for free: Slipstream, Whirling Defense, Swiftstrike, Windstep.",ability:{id:"burst-of-speed",name:"Burst of Speed",description:"Gain DEX Bursts of Speed when rolling Initiative. Spend 1 per turn to use maneuvers for free.",type:"action",frequency:"per_encounter"}},{id:"slipstream",level:2,type:"passive_feature",name:"Slipstream",description:"Defend, and the attack misses.",category:"combat"},{id:"whirling-defense",level:2,type:"passive_feature",name:"Whirling Defense",description:"Defend and apply your armor to every attack this round.",category:"combat"},{id:"swiftstrike",level:2,type:"passive_feature",name:"Swiftstrike",description:"Attack on your turn, and ignore disadvantage from Rushed Attacks.",category:"combat"},{id:"windstep",level:2,type:"passive_feature",name:"Windstep",description:"Move on your turn, ignoring difficult terrain.",category:"exploration"},{id:"subclass",level:3,type:"subclass_choice",name:"Subclass",description:"Choose a Zephyr subclass.",availableSubclasses:["way-of-pain","way-of-flame"]},{id:"kinetic-momentum",level:3,type:"passive_feature",name:"Kinetic Momentum",description:"Whenever you gain a Wound, gain a Burst of Speed.",category:"combat"},{id:"ethereal-projection",level:3,type:"ability",name:"Ethereal Projection",description:"(1/day) By meditating for at least 10 minutes, you can project an ethereal version of yourself up to 30 ft. away, passing through solid objects or barriers. You see through your projection's eyes, and it is visible to other creatures as a translucent version of yourself. It cannot interact physically with the environment but can move freely within the distance limit and lasts for up to 10 minutes.",ability:{id:"ethereal-projection",name:"Ethereal Projection",description:"Project an ethereal version of yourself up to 30 ft. away that can pass through solid objects.",type:"action",frequency:"per_safe_rest",maxUses:1}},{id:"unyielding-resolve",level:4,type:"passive_feature",name:"Unyielding Resolve",description:"Ignore the first Wound you would suffer each encounter (when Wounded abilities, such as Kinetic Momentum, still trigger).",category:"combat"},{id:"key-stat-increase-1",level:4,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or STR.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"martial-master-1",level:4,type:"pick_feature_from_pool",name:"Martial Master",description:"Choose a Martial Arts ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"reverberating-strikes",level:5,type:"passive_feature",name:"Reverberating Strikes",description:"You learn to focus your energy and transfer it as an additional concussive force into your foes. Add LVL bludgeoning damage to all of your melee attacks.",category:"combat"},{id:"secondary-stat-increase-1",level:5,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"martial-master-2",level:6,type:"pick_feature_from_pool",name:"Martial Master (2)",description:"Choose a 2nd Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"infuse-strength",level:6,type:"ability",name:"Infuse Strength",description:"Action: Make an unarmed strike against an ally and infuse them with a portion of your own strength instead of harming them. Expend any number of Hit Dice and roll them as you would heal yourself during a Field Rest (roll them and add your STR to each).",ability:{id:"infuse-strength",name:"Infuse Strength",description:"Strike an ally to heal them by expending Hit Dice and adding STR to each.",type:"action",frequency:"at_will",actionCost:1}},{id:"subclass-feature-7",level:7,type:"passive_feature",name:"Subclass Feature",description:"Gain your Zephyr subclass feature.",category:"combat"},{id:"martial-master-3",level:8,type:"pick_feature_from_pool",name:"Martial Master (3)",description:"Choose a 3rd Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"key-stat-increase-2",level:8,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or STR.",statBoosts:[{attribute:"strength",amount:1}]},{id:"swift-feet-2",level:9,type:"passive_feature",name:"Swift Feet (2)",description:"Gain an additional +2 speed as long as you are unarmored.",category:"combat"},{id:"secondary-stat-increase-2",level:9,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"martial-master-4",level:10,type:"pick_feature_from_pool",name:"Martial Master (4)",description:"Choose a 4th Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"unyielding-resolve-2",level:10,type:"passive_feature",name:"Unyielding Resolve (2)",description:"Ignore the first 2 Wounds you would suffer each encounter.",category:"combat"},{id:"subclass-feature-11",level:11,type:"passive_feature",name:"Subclass Feature",description:"Gain your Zephyr subclass feature.",category:"combat"},{id:"martial-master-5",level:12,type:"pick_feature_from_pool",name:"Martial Master (5)",description:"Choose a 5th Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"key-stat-increase-3",level:12,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or STR.",statBoosts:[{attribute:"dexterity",amount:1}]},{id:"iron-defense-2",level:13,type:"passive_feature",name:"Iron Defense (2)",description:"Your armor is doubled while unarmored.",category:"combat"},{id:"secondary-stat-increase-3",level:13,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"intelligence",amount:1}]},{id:"martial-master-6",level:14,type:"pick_feature_from_pool",name:"Martial Master (6)",description:"Choose a 6th Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"subclass-feature-15",level:15,type:"passive_feature",name:"Subclass Feature",description:"Gain your Zephyr subclass feature.",category:"combat"},{id:"martial-master-7",level:16,type:"pick_feature_from_pool",name:"Martial Master (7)",description:"Choose a 7th Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"key-stat-increase-4",level:16,type:"stat_boost",name:"Key Stat Increase",description:"+1 DEX or STR.",statBoosts:[{attribute:"strength",amount:1}]},{id:"unyielding-resolve-3",level:17,type:"passive_feature",name:"Unyielding Resolve (3)",description:"Ignore the first 3 Wounds you would suffer each encounter. You have advantage on STR saves while Dying.",category:"combat"},{id:"secondary-stat-increase-4",level:17,type:"stat_boost",name:"Secondary Stat Increase",description:"+1 INT or WIL.",statBoosts:[{attribute:"will",amount:1}]},{id:"martial-master-8",level:18,type:"pick_feature_from_pool",name:"Martial Master (8)",description:"Choose an 8th Martial Arts Ability.",poolId:"martial-arts-pool",choicesAllowed:1},{id:"epic-boon",level:19,type:"passive_feature",name:"Epic Boon",description:"Choose an Epic Boon (see pg. 23 of the GM's Guide).",category:"utility"},{id:"windborne",level:20,type:"passive_feature",name:"Windborne",description:"+1 to any 2 of your stats. +1 additional burst of speed when you roll Initiative. Permanently gain 1 action (while Dying, you have a max of 2 actions).",category:"combat"},{id:"focus",level:1,type:"passive_feature",name:"Focus",description:"Whenever you spend time meditating alone in a windy place during a Safe Rest, you may choose different Zephyr options available to you.",category:"utility"}],featurePools:[{id:"martial-arts-pool",name:"Martial Arts Abilities",description:"Special martial arts techniques that Zephyrs can master.",features:[{id:"airshift",level:1,type:"passive_feature",name:"Airshift",description:"You cannot be Grappled while conscious. While moving, you may travel across all terrain as normal ground, ignoring all ill effects (e.g., walls/ceilings, water, treetops, lava, spikes, clouds).",category:"exploration"},{id:"blur",level:1,type:"ability",name:"Blur",description:"(1/encounter) When you Defend, you may first move up to half your speed away, taking no damage if you are now out of range or have Full Cover.",ability:{id:"blur",name:"Blur",description:"When you Defend, first move up to half your speed away. Take no damage if out of range or have Full Cover.",type:"action",frequency:"per_encounter",maxUses:1}},{id:"bodily-discipline",level:1,type:"ability",name:"Bodily Discipline",description:"You may spend 1 action to end any non-Wound condition on yourself.",ability:{id:"bodily-discipline",name:"Bodily Discipline",description:"End any non-Wound condition on yourself.",type:"action",frequency:"at_will",actionCost:1}},{id:"enduring-soul",level:1,type:"passive_feature",name:"Enduring Soul",description:"Each time you roll Initiative, gain Hit Dice equal to the actions you get on your first turn. These Hit Dice expire at the end of combat if unused.",category:"combat"},{id:"i-jump-on-his-back",level:1,type:"passive_feature",name:"I Jump On His Back!",description:"While moving with your Windstep, if you move into the space of a creature your size or larger, you may jump onto its back. While on a creature this way, gain advantage on melee attacks against it, and any damage you avoid is dealt to it instead.",category:"combat"},{id:"kinetic-barrage",level:1,type:"passive_feature",name:"Kinetic Barrage",description:"Whenever you miss an attack, gain a cumulative +STR bonus to all damage you do for the rest of this encounter (a disciplined martial artist does not miss on purpose).",category:"combat"},{id:"mighty-soul",level:1,type:"passive_feature",name:"Mighty Soul",description:"You cannot be moved against your will. Whenever you would fail a saving throw, you may gain a Wound in order to add your STR to the result you rolled. You may repeat this any number of times.",category:"combat"},{id:"quickstrike",level:1,type:"ability",name:"Quickstrike",description:"When you Interpose, you may first make an unarmed strike against the enemy for free.",ability:{id:"quickstrike",name:"Quickstrike",description:"When you Interpose, first make an unarmed strike against the enemy for free.",type:"action",frequency:"at_will"}},{id:"use-momentum",level:1,type:"passive_feature",name:"Use Momentum",description:"Whenever you avoid all of the damage of a melee attack (whether it misses or you Defend), you may swap places with the attacker and then choose another target that is now within the attack's reach, and they are hit instead.",category:"combat"},{id:"vital-rejuvenation",level:1,type:"passive_feature",name:"Vital Rejuvenation",description:"When you receive healing for the first time on a turn, you may heal another target within 6 spaces HP equal to your STR.",category:"combat"},{id:"windstrider",level:1,type:"passive_feature",name:"Windstrider",description:"If you move through the space of a willing creature while using Windstep, they can move with you and choose any space adjacent to your path of movement to end in.",category:"exploration"}]}],subclasses:[tm,tu]}},tj={male:{syllables:{prefixes:["al","ar","bran","cor","dar","ed","gar","har","jon","mar","ric","rob","tha","wil","ae","cel","el","bor","dain","dur"],middle:["an","en","in","on","ar","er","or","ic","rick","bert","win","fred","a","e","i","o"],suffixes:["ard","bert","mund","win","fred","ric","ton","son","den","ley","dir","las","lon","mir"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["al","an","bel","cat","el","ev","gwen","isa","mar","ros","sar","syl","vic","ar","cel","gil"],middle:["a","e","i","an","en","in","ara","ela","ina","lyn","eth","o","ae","ai"],suffixes:["a","e","ine","ara","ella","lyn","beth","wen","dra","lia","iel","wen","wyn","riel"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["ash","black","bright","gold","green","grey","iron","red","stone","white","wolf","silver","moon","star"],middle:["brook","field","ford","hill","wood","water","smith","wright","leaf","song","whisper"],suffixes:["born","ford","ton","wood","field","stone","brook","hill","ridge","vale","song","leaf","wind","star"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:15,syllableCount:{min:1,max:2}}}},tN=[{id:"human",name:"Human",description:"Found in every terrain and environment, their curiosity and ambition drive them to explore every corner of the world, making them a ubiquitous and versatile race.",size:"medium",rarity:"common",features:[{type:"passive_feature",name:"Tenacious",description:"+1 to all skills and Initiative."}],nameConfig:{male:{syllables:{prefixes:["al","ar","bran","cor","dar","ed","gar","har","jon","mar","ric","rob","tha","wil"],middle:["an","en","in","on","ar","er","or","ic","rick","bert","win","fred"],suffixes:["ard","bert","mund","win","fred","ric","ton","son","den","ley"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["al","an","bel","cat","el","ev","gwen","isa","mar","ros","sar","syl","vic"],middle:["a","e","i","an","en","in","ara","ela","ina","lyn","eth"],suffixes:["a","e","ine","ara","ella","lyn","beth","wen","dra","lia"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["ash","black","bright","gold","green","grey","iron","red","stone","white","wolf"],middle:["brook","field","ford","hill","wood","water","smith","wright"],suffixes:["born","ford","ton","wood","field","stone","brook","hill","ridge","vale"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:15,syllableCount:{min:1,max:2}}}}},{id:"elf",name:"Elf",description:"Elves epitomize swiftness and grace. Their tall, slender forms belie their innate speed, grace, and wit. Formidable in both diplomacy and combat, elves strike swiftly, often preventing the worst by acting first.",size:"medium",rarity:"common",features:[{type:"passive_feature",name:"Lithe",description:"Advantage on Initiative, +1 Speed. You know Elvish if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["ae","al","cel","el","en","er","gal","gil","leg","lin","tha","thy","val"],middle:["a","e","i","o","an","en","in","on","ar","or","ad","ed"],suffixes:["dir","las","lon","mir","neth","reth","rond","thil","wen","wing"]},patterns:["PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["al","ar","cel","el","gal","gil","nim","sil","tar","thy","val"],middle:["a","e","i","o","ae","ai","an","ar","el","en","in"],suffixes:["ath","iel","wen","wyn","riel","neth","thil","lia","ara","ina"]},patterns:["PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["bright","silver","moon","star","sun","wind","storm","flame","shadow","mist"],middle:["leaf","song","whisper","dance","flame","stream","light"],suffixes:["song","leaf","wind","star","moon","light","bow","blade","heart","wing"]},patterns:["PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"dwarf",name:"Dwarf",description:'Dwarf, in the old language, means "stone." You are resilient, solid, stout. Even when driven to exhaustion, you will not falter. Forgoing speed, you are gifted with physical vitality and a belly that can handle the finest (and worst) consumables this world has to offer.',size:"medium",rarity:"common",features:[{type:"passive_feature",name:"Stout",description:"+2 max Hit Dice, +1 max Wounds, -1 Speed. You know Dwarvish if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["bor","dain","dur","fal","gim","gro","kil","nor","ori","tho","ulf","bal"],middle:["an","ar","in","or","un","am","im","om","ek","ok","uk"],suffixes:["in","on","un","li","ri","din","dor","dur","grim","helm"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["bal","dar","dor","fal","hil","kira","nala","rial","tova","vera"],middle:["a","e","i","an","en","in","ar","er","or"],suffixes:["a","i","ana","ina","wen","dis","la","ra","wa"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["iron","stone","gold","steel","hammer","forge","mountain","deep","rock","coal"],middle:["beard","fist","hammer","pick","shield","axe"],suffixes:["beard","fist","hammer","pick","shield","axe","born","song","heart","forge"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:18,syllableCount:{min:1,max:2}}}}},{id:"halfling",name:"Halfling",description:"Kind of like a human, but smaller (except for the feet). Where does our luck come from? Well...you know what they say about rabbit feet? Well, we've got feet for days compared to them. Imagine the amount of luck you could fit into these bad boys!",size:"small",rarity:"common",features:[{type:"passive_feature",name:"Elusive",description:"+1 to Stealth. If you fail a save, you can succeed instead, 1/Safe Rest."}],nameConfig:{male:{syllables:{prefixes:["bil","bob","dro","fro","mer","per","pip","sam","ted","tom","ban","pod"],middle:["a","e","i","o","er","ar","in","on","od","id"],suffixes:["bo","do","go","to","rin","ron","son","wich","wick","wise"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:11,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["bell","daisy","hol","lil","may","prim","ros","rue","poppy","pearl"],middle:["a","e","i","o","an","en","in","la","ly"],suffixes:["a","y","ie","ina","ella","wyn","rose","lily","belle"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["bag","took","brand","boff","brown","good","green","under","over","hedge"],middle:["hill","buck","foot","bottom","top","burrow"],suffixes:["gins","buck","foot","bottom","hill","burrow","field","garden","meadow"]},patterns:["PS","PM"],constraints:{minLength:3,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"gnome",name:"Gnome",description:"Eccentric, curious, and perpetually optimistic, gnomes are cheerfulespecially when compared to their typically grumpier and larger kin, the dwarves. Known for their tinkering, spreading cheer, and playful antics, gnomes pursue their passions with a scatterbrained enthusiasm.",size:"small",rarity:"common",features:[{type:"passive_feature",name:"Optimistic",description:"Allow an ally within Reach 6 to reroll any single die, resets when healed to your max HP. -1 Speed. You know Dwarvish if your INT is not negative (but you call it Gnomish, of course)."}],nameConfig:{male:{syllables:{prefixes:["bim","dim","fim","gim","kim","nim","pim","tim","wim","zim","bol","dol","fol"],middle:["ble","dle","gle","ple","tle","bo","do","fo","go","no","po"],suffixes:["wick","dle","nock","bock","lock","sock","rick","nick","tick","zick"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},female:{syllables:{prefixes:["bim","dim","fim","gil","kim","lil","nim","pim","til","wil","zil"],middle:["bel","del","fel","gel","mel","nel","pel","tel"],suffixes:["la","na","da","ta","bella","nella","della","tella","wick","nick"]},patterns:["PM","PS","PMS"],constraints:{minLength:3,maxLength:12,syllableCount:{min:2,max:3}}},surnames:{syllables:{prefixes:["copper","silver","gold","iron","steel","brass","tin","gear","spring","clock"],middle:["whistle","widget","gadget","sprocket","cog","wheel"],suffixes:["bottom","top","worth","shine","spark","twist","turn","spin","click","tick"]},patterns:["PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"bunbun",name:"Bunbun",description:"Bunbun are agile and unpredictable, using their powerful legs to leap great distances and catch foes off guard. Facing a Bunbun means contending with an opponent who can strike from unexpected angles and swiftly reposition themselves in the heat of battle.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Bunny Legs",description:"Before Interposing or after Defending (after damage), hop up to your Speed in any direction for free, 1/encounter."}],nameConfig:{unisex:{syllables:{prefixes:["hop","skip","bounce","fluffy","cotton","whiskers","bunny","carrot","clover","daisy","pepper","ginger","honey","maple","willow"],middle:["tail","paw","ear","nose","hop","bound","jump","spring","leap","dash"],suffixes:["paw","tail","ear","nose","hop","bound","foot","whiskers","cotton","fluff","spring","dash","bounce"]},patterns:["P","PS","PM"],constraints:{minLength:3,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"goblin",name:"Goblin",description:"Green, cunning, and perpetually vilified, Goblins thrive on the edge of chaos. For a Goblin, vanishing into the shadows is not just a skillit's an identity. After all, what kind of Goblin would you be if you couldn't slip away unnoticed?",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Skedaddle",description:"Can move 2 spaces for free after you become the target of an attack or negative effect (after damage, ignoring difficult terrain). You know Goblin if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["grib","grok","grub","snib","snag","skab","brak","krag","guzz","nork","zog","grig","snak","krub"],middle:["ack","ek","ik","ok","ug","ag","ig","og"],suffixes:["bash","gub","nark","grok","snit","mek","tok","kek","nog","gig"]},patterns:["P","PM","PS"],constraints:{minLength:3,maxLength:10,syllableCount:{min:1,max:2}}},female:{syllables:{prefixes:["grizz","sniz","krib","skib","nib","grib","friz","trib","blib","glib"],middle:["a","e","i","ak","ek","ik"],suffixes:["a","ka","na","za","la","ra","ta","ba"]},patterns:["P","PM","PS"],constraints:{minLength:3,maxLength:10,syllableCount:{min:1,max:2}}},surnames:{syllables:{prefixes:["mud","rat","sharp","quick","sly","shadow","sneak","skull","bone","rock","cave","dark"],middle:["tooth","claw","fang","eye","ear"],suffixes:["tooth","claw","fang","eye","ear","foot","hand","nose","back","belly"]},patterns:["P","PS","PM"],constraints:{minLength:3,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"dragonborn",name:"Dragonborn",description:"The soul of a dragon burns within you, the scales of your body are like forged steel. You are a kin and your heritage the coals that stoke your flames. Call upon your wrath, to speak in the tongue of your ancestors and imbue unbridled fury into your attacks.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Draconic Heritage",description:"+1 Armor. When you attack: deal an additional LVL+KEY damage (ignoring armor) divided as you choose among any of your targets; recharges whenever you Safe Rest or gain a Wound. You know Draconic if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["vor","gar","thor","drak","bala","kriv","thar","shen","rhos","akra","naal","qyth","vyr","ghesh"],middle:["an","ar","ash","en","eth","im","in","or","oth","ull"],suffixes:["ash","rax","ghan","naar","thor","vok","soth","krex","morn","keth"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:3}}},female:{syllables:{prefixes:["akra","biri","dari","enna","farideh","harann","kava","korinn","mishann","nala","perra","raiann","sora","surina","thava"],middle:["a","e","i","an","ar","en","eth","in","oth"],suffixes:["a","ah","enna","ideh","ann","ava","inn","ish","ala","erra","ora","ina","ava"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:3}}},surnames:{syllables:{prefixes:["clan","house","blood","fire","steel","gold","silver","bronze","iron","shadow","flame","storm"],middle:["scale","claw","fang","wing","breath","heart","soul"],suffixes:["born","breath","claw","fang","scale","wing","heart","soul","fire","storm","steel","stone"]},patterns:["PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"kobold",name:"Kobold",description:"Small, often maniacal, and dragon-obsessed. Kobolds thrive in the shadows, finding ingenious ways to survive despite their diminutive size. Underestimated by many, Kobolds prove time and again that even the smallest among us can wield great power.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Wily",description:"Force an enemy to reroll a non-critical attack against you, 1/encounter. +3 to Influence friendly characters. Advantage on skill checks related to dragons. You know Draconic if your INT is not negative."}],nameConfig:{unisex:{syllables:{prefixes:["krik","skib","yik","mek","kek","yap","nip","kip","zik","pik","grik","slik","trik","wik"],middle:["ak","ek","ik","ok","uk","a","e","i","o"],suffixes:["yip","kik","tak","nak","lak","rek","dak","zak","pak","bak","gak","mak"]},patterns:["P","PM","PS"],constraints:{minLength:3,maxLength:8,syllableCount:{min:1,max:2}}}}},{id:"fiendkin",name:"Fiendkin",description:"Said to have been born from the union of man and fiend, or from a cursed bloodline, Fiendkin often find themselves outcasts in society. Yet, they embody determination in the face of adversity. Their ancestors didn't emerge from the depths of the Everflame to succumb to minor setbacks!",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Flameborn",description:"1 of your neutral saves is advantaged instead. You know Infernal if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["ash","bane","drak","grim","kael","mal","rath","scar","thorn","vex","zar","neth","vel","mor"],middle:["an","ar","en","er","in","ir","on","or","ak","ek"],suffixes:["ax","eth","oth","ash","ard","orn","ius","ek","ak","us","on","ar"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:12,syllableCount:{min:1,max:3}}},female:{syllables:{prefixes:["ash","bel","dara","lil","nyx","raven","sera","vera","zara","mira","kira","vex","neth"],middle:["a","e","i","an","ar","en","in","ra","na"],suffixes:["a","ah","ina","ara","eth","ith","oth","wyn","ria","lia","ia"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:12,syllableCount:{min:1,max:3}}},surnames:{syllables:{prefixes:["ash","blood","dark","fire","hell","night","shadow","soul","thorn","void","flame","bane"],middle:["heart","soul","mind","eye","hand","wing"],suffixes:["born","bane","heart","soul","mind","eye","hand","wing","thorn","fire","ash","void"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"orc",name:"Orc",description:"Just when you think you've bested a mighty Orc, you've merely succeeded in rousing their anger. Engaging in combat with an Orc is no endeavor for the weak-willed. While others may cower before death's approach, Orcs boldly defy its grasp.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Relentless",description:"When you would drop to 0 HP, you may set your HP to LVL instead, 1/Safe Rest. +1 Might. You know Goblin if your INT is not negative (but you call it Orcish, of course)."}],nameConfig:{male:{syllables:{prefixes:["gra","gro","gru","kro","mor","rog","thra","ugh","urk","var","gur","mag","bru","drak"],middle:["ak","ok","uk","ag","og","ug","ar","or","ur"],suffixes:["ash","gul","mash","nak","narg","rog","ugh","urk","goth","tok","lok","gak"]},patterns:["P","PM","PS"],constraints:{minLength:3,maxLength:10,syllableCount:{min:1,max:2}}},female:{syllables:{prefixes:["gra","kri","mog","rog","sha","ugh","var","yar","zog","bru","dra","mag"],middle:["a","o","u","ak","ok","uk"],suffixes:["a","ash","ga","ka","na","ra","sha","tha","gul","mog"]},patterns:["P","PM","PS"],constraints:{minLength:3,maxLength:10,syllableCount:{min:1,max:2}}},surnames:{syllables:{prefixes:["blood","bone","death","fire","iron","skull","stone","war","wolf","rage","storm","black"],middle:["tooth","claw","fist","axe","blade","hammer"],suffixes:["tooth","claw","fist","axe","blade","hammer","crusher","basher","slayer","bane"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"birdfolk",name:"Birdfolk",description:"Birdfolk find sanctuary not in stone or chains, but within the boundless expanse of the sky. However, the gift of flight comes at a costhollow bones, and commensurate frailty.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Hollow Bones",description:"You have a fly Speed as long as you are wearing armor no heavier than Leather. Crits against you are Vicious (the attacker rolls 1 additional die). Forced movement moves you twice as far."}],nameConfig:{unisex:{syllables:{prefixes:["aer","avi","sky","wing","crow","hawk","eagle","swift","storm","wind","cloud","dawn","dusk","sun","moon"],middle:["wing","song","call","cry","soar","fly","dive","glide","nest","perch"],suffixes:["wing","song","call","cry","soar","flight","feather","beak","talon","nest","perch","sky","air"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"celestial",name:"Celestial",description:"Descendants of divine beings, Celestials carry an aura of nobility and grace. Their innate connection to the higher planes allows them to resist the effects of misfortune, standing strong where others may falter.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Highborn",description:"Your disadvantaged save is Neutral instead. You know Celestial if your INT isn't negative."}],nameConfig:{male:{syllables:{prefixes:["aur","cel","lum","ray","ser","uri","gab","mich","raph","az","el","joph","raguel","rem"],middle:["ae","ai","iel","ael","ial","uel","ith","oth","ien"],suffixes:["el","iel","ael","ial","uel","ith","oth","ien","on","an"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:3}}},female:{syllables:{prefixes:["aur","cel","lum","ray","ser","gab","sar","mir","raph","az","el","joph","zel"],middle:["ae","ai","iel","ael","ial","iel","ith","oth","ien","a","e","i"],suffixes:["a","ah","iel","ael","ial","iel","ith","wen","ien","on","an","ela","ina"]},patterns:["P","PM","PS","PMS"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:3}}},surnames:{syllables:{prefixes:["bright","divine","golden","light","pure","radiant","sacred","silver","star","sun","dawn","heaven"],middle:["wing","song","heart","soul","voice","light","fire"],suffixes:["wing","song","heart","soul","voice","light","fire","born","touched","blessed","sworn"]},patterns:["P","PS","PM"],constraints:{minLength:5,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"changeling",name:"Changeling",description:"Often hunted for their silver blood, Changelings are natural survivors, slipping into new identities with ease. Changelings that shift too often typically aren't long for the worldthey can struggle to remember who they were, becoming little more than reflections of the faces they wear.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"New Place, New Face",description:"+2 shifting skill points. You may take on the appearance of any ancestry. When you do, you may place your 2 shifting skill points into any 1 skill. 1/day."}],nameConfig:{unisex:{syllables:{prefixes:["flux","shift","mist","echo","mirror","shadow","void","drift","phase","blur","vague","wisp","grey","smoke"],middle:["walk","step","face","mask","veil","cloak","shift","turn","bend"],suffixes:["walker","stepper","face","mask","veil","cloak","shifter","turner","bender","ling","born","made"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"crystalborn",name:"Crystalborn",description:"Formed from living crystal, the Crystalborn are beings of dazzling beauty and otherworldly toughness. Their translucent bodies refract light and sound, granting them unique abilities in combat.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Reflective Aura",description:"When you Defend, gain KEY armor and deal KEY damage back to the attacker. 1/encounter."}],nameConfig:{unisex:{syllables:{prefixes:["crystal","prism","quartz","gem","shard","facet","gleam","shine","spark","glint","dazzle","bright"],middle:["song","hum","ring","chime","tone","note","echo"],suffixes:["song","hum","ring","chime","tone","note","echo","born","made","formed","carved"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"dryad",name:"Dryad/Shroomling",description:"Tied to the natural world, Dryads and Shroomlings embody the balance between flora and fauna. Their unique physiology releases toxic spores when harmed, providing a natural defense against those who dare to harm them.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Danger Pollen/Spores",description:"Whenever an enemy causes you one or more Wounds, you excrete soporific spores: all adjacent enemies are Dazed. You know Elvish if your INT is not negative."}],nameConfig:{unisex:{syllables:{prefixes:["oak","ash","elm","willow","birch","moss","fern","leaf","bloom","petal","root","bark","thorn","vine","spore","cap"],middle:["song","whisper","dance","sway","grow","bloom","flow"],suffixes:["song","whisper","dance","sway","grove","bloom","flow","born","wood","leaf","root","branch"]},patterns:["P","PS","PM"],constraints:{minLength:3,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"half-giant",name:"Half-Giant",description:"Towering beings whose strength is as immovable as the mountains they call home. Their sheer size and resilience make them fearsome opponents, capable of surviving even devastating blows.",size:"large",rarity:"exotic",features:[{type:"passive_feature",name:"Strength of Stone",description:"Force an enemy to reroll a crit against you, 1/encounter. +2 Might. You know Dwarvish if your INT is not negative."}],nameConfig:{male:{syllables:{prefixes:["stone","boulder","granite","mountain","cliff","peak","rock","iron","steel","titan","mighty","strong"],middle:["heart","fist","arm","back","chest","jaw"],suffixes:["heart","fist","arm","back","chest","jaw","born","son","crusher","breaker"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}},female:{syllables:{prefixes:["stone","mountain","cliff","peak","iron","mighty","strong","noble","great","vast","tall"],middle:["heart","soul","spirit","voice","song"],suffixes:["heart","soul","spirit","voice","song","born","daughter","maiden","lady"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:16,syllableCount:{min:1,max:2}}}}},{id:"minotaur",name:"Minotaur/Beastfolk",description:"Minotaur and other Beastfolk embody a primal connection to The Wild, combining strength with natural agility. Their powerful build allows them to move swiftly, whether repositioning to outflank foes or charging in with unstoppable force.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Charge",description:"When you move at least 4 spaces, you can push a creature in your path. Medium: 1 space; Small/Tiny: up to 2 spaces. 1/turn."}],nameConfig:{male:{syllables:{prefixes:["bull","horn","thund","storm","rage","fury","wild","beast","strong","might","power","force"],middle:["horn","hoof","charge","rush","strike","crush"],suffixes:["horn","hoof","charge","rush","strike","crusher","born","blood","heart","soul"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}},female:{syllables:{prefixes:["wild","free","swift","grace","moon","star","wind","storm","earth","nature","spirit"],middle:["heart","soul","song","dance","run","leap"],suffixes:["heart","soul","song","dance","runner","leaper","born","maiden","horn","hoof"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"oozeling",name:"Oozeling/Construct",description:"What even is a \"PeOpLe\" anyway? So what if your heart pumps oil instead of blood, so what if you don't even have a heart!? If you can squish yourself into a pair of pants, or swing a sword like everyone else, who's to say you can't be a pEOpLe, too?!",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Odd Constitution",description:"Increment your Hit Dice one step (d6 \xbb d8 \xbb d10 \xbb d12 \xbb d20); they always heal you for the maximum amount. Magical healing always heals you for the minimum amount."}],nameConfig:{unisex:{syllables:{prefixes:["goo","slime","ooze","gel","blob","gloop","squish","splurt","drip","flow","puddle","splash"],middle:["drop","drip","blob","pop","plop","squish","squelch"],suffixes:["drop","drip","blob","pop","plop","squish","squelch","ling","let","kin","born"]},patterns:["P","PS","PM"],constraints:{minLength:3,maxLength:12,syllableCount:{min:1,max:2}}}}},{id:"planarbeing",name:"Planarbeing",description:"You are not from this plane of existenceyour soul is not as strongly tethered to it as others. But with this vulnerability comes power, the ability to temporarily shift from one plane to another in times of dire need.",size:"medium",rarity:"exotic",features:[{type:"passive_feature",name:"Planeshift",description:"Whenever you Defend, you can gain 1 Wound to temporarily phase out of the material plane and ignore the damage. -2 max Wounds."}],nameConfig:{unisex:{syllables:{prefixes:["void","plane","ether","phase","shift","drift","wander","flow","between","beyond","far","distant"],middle:["walk","step","drift","flow","shift","phase","move"],suffixes:["walker","stepper","drifter","shifter","phaser","wanderer","born","touched","made"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"ratfolk",name:"Ratfolk",description:"Ratfolk are survivors, thriving in the shadows of society where others fear to tread. Agile, resourceful, and fiercely loyal to their own, they have a knack for turning scraps into solutions.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Scurry",description:"Gain +2 armor if you moved on your last turn."}],nameConfig:{unisex:{syllables:{prefixes:["squeak","nibble","scurry","whisker","tail","scamper","dash","quick","swift","clever","sly","sharp"],middle:["tail","tooth","claw","nose","ear","eye","paw"],suffixes:["tail","tooth","claw","nose","ear","eye","paw","kin","folk","runner","squeaker"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"stoatling",name:"Stoatling",description:"Stoatlings may be small, but they're far from weak. With fierce determination and warrior hearts, they can take down foes many times their size. Their agility and tenacity let them exploit larger enemies' weaknesses, turning their size into a lethal advantage.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Small But Ferocious",description:"Whenever you make a single-target attack against a creature larger than you, roll 1 additional d6 for each size category it is larger. They do the same."}],nameConfig:{unisex:{syllables:{prefixes:["fierce","brave","bold","quick","dart","dash","leap","bound","small","tiny","swift","nimble"],middle:["claw","tooth","tail","paw","heart","spirit"],suffixes:["claw","tooth","tail","paw","heart","spirit","ling","kin","born","made"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:12,syllableCount:{min:1,max:2}}}}},{id:"turtlefolk",name:"Turtlefolk",description:"Turtlefolk take their time in everything they do; they are patient, sturdy, and slow to anger. They rely on their thick shells for protection, making them difficult to harm, but their cautious movements come at the cost of speed.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Slow & Steady",description:"+4 Armor, -2 speed."}],nameConfig:{unisex:{syllables:{prefixes:["shell","slow","steady","patient","wise","ancient","old","calm","peace","quiet","still","deep"],middle:["shell","back","pace","step","move","flow"],suffixes:["shell","back","pace","stepper","mover","walker","folk","kin","born","made"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}},{id:"wyrdling",name:"Wyrdling",description:"Unpredictable and chaotic, Wyrdlings are the result of magic gone awry. Their bodies pulse with raw arcane energy, and their mere presence often disturbs the balance of magic around them.",size:"small",rarity:"exotic",features:[{type:"passive_feature",name:"Chaotic Surge",description:"Whenever you or a willing ally within Reach 6 casts a tiered spell, you may allow them to roll on the Chaos Table. 1/encounter."}],nameConfig:{unisex:{syllables:{prefixes:["chaos","wild","weird","strange","odd","twist","flux","shift","change","warp","bend","magic"],middle:["spark","surge","burst","flash","pop","crack","twist"],suffixes:["spark","surge","burst","flash","pop","crack","twist","ling","kin","born","made","touched"]},patterns:["P","PS","PM"],constraints:{minLength:4,maxLength:14,syllableCount:{min:1,max:2}}}}}],tk=[{id:"back-out-of-retirement",name:"Back Out of Retirement",description:"You've forgotten more than most adventurers these days know! Talk with your GM, what made you come out of retirement?",features:[{type:"passive_feature",name:"I Remember How to Do This",description:"You may gain 1 Wound to use an ability or cast a spell as if you were 1 level higher."},{type:"passive_feature",name:"These Old Bones",description:"Your age has long since started to show. -1 max Wounds."}]},{id:"devoted-protector",name:"Devoted Protector",description:"Choose 1 ally in your party. You can survive +3 max Wounds as long as they are nearby. Whenever they take a Wound, you do too.",features:[{type:"passive_feature",name:"Protective Bond",description:"You can survive +3 max Wounds as long as your chosen ally is nearby. Whenever they take a Wound, you do too."}]},{id:"academy-dropout",name:"Academy Dropout",description:"School just isn't for everyone! You learn by experience in the real world (or at least that's what you tell yourself). Learn any 1 Utility Spell.",features:[{type:"passive_feature",name:"Street Smart Learning",description:"Learn any 1 Utility Spell of your choice."}]},{id:"made-a-bad-choice",name:"Made a BAD Choice",description:"Start with 500 or 1000 extra gold, or an uncommon/rare magical item (that your GM allows). Gain an equally powerful curse or enemy who wants it back. If you choose this background, your GM may allow you to choose another.",features:[{type:"passive_feature",name:"Ill-Gotten Gains",description:"Start with 500 or 1000 extra gold, or an uncommon/rare magical item (GM's choice). Gain an equally powerful curse or enemy who wants it back."}]},{id:"haunted-past",name:"Haunted Past",description:"You are haunted by voices that occasionally give you cryptic advice. The voices are sometimes VERY helpful. Other times they only want to see you suffer. Advantage against fear.",features:[{type:"passive_feature",name:"Cryptic Voices",description:"You are haunted by voices that occasionally give you cryptic advice. The voices are sometimes VERY helpful. Other times they only want to see you suffer."},{type:"passive_feature",name:"Fearless From Experience",description:"Advantage against fear."}]},{id:"ear-to-the-ground",name:"Ear to the Ground",description:"Advantage on checks to know or obtain gossip for events that will soon happen or have happened less than 1 year ago.",features:[{type:"passive_feature",name:"Information Network",description:"Advantage on checks to know or obtain gossip for events that will soon happen or have happened less than 1 year ago."}]},{id:"what-ive-been-around",name:"What? I've Been Around",description:"1/per location (or at the GM's discretion). You happen to know JUST the person who has the information you're looking for, or could get you out of a jam, and... Roll 1d20:",features:[{type:"passive_feature",name:"Convenient Connections",description:"1/per location (or at GM's discretion). You happen to know JUST the person who has the information you're looking for. Roll 1d20: 1-5. They want you DEAD. 6-12. You owe them money. 13-19. They can be convinced to help you. 20. They are your biggest fan/are madly in love with you."}]},{id:"acrobat",name:"Acrobat",description:"Can be thrown by a larger ally, REALLY far. Half damage from falling and forced movement.",features:[{type:"passive_feature",name:"Acrobatic Training",description:"Can be thrown by a larger ally, REALLY far. Half damage from falling and forced movement."}]},{id:"wild-one",name:"Wild One",description:"Whether it is the sticks or flowers in your hair, your smell, or the way you carry yourself, wild creatures are less frightened of you and more willing to aid you. +1 Naturecraft. While Field Resting, roll your Hit Dice with advantage while in the wild.",features:[{type:"passive_feature",name:"One with Nature",description:"Wild creatures are less frightened of you and more willing to aid you. +1 Naturecraft."},{type:"passive_feature",name:"Wild Rest",description:"While Field Resting, roll your Hit Dice with advantage while in the wild."}]},{id:"fey-touched",name:"Fey Touched",description:"You take half damage from all magical effects, double from weapons made of metal (before armor is applied).",features:[{type:"passive_feature",name:"Fey Resilience",description:"You take half damage from all magical effects, double from weapons made of metal (before armor is applied)."}]},{id:"survivalist",name:"Survivalist",description:"You never run out of your own personal rations. Anything can be food if you try hard enough! Advantage against poison saves. +1 max Hit Die.",features:[{type:"passive_feature",name:"Personal Rations",description:"You never run out of your own personal rations. Anything can be food if you try hard enough!"},{type:"passive_feature",name:"Poison Resistance",description:"Advantage against poison saves."},{type:"passive_feature",name:"Hardy Constitution",description:"+1 max Hit Die."}]},{id:"home-at-sea",name:"Home at Sea",description:"Recover twice as many Wounds and HP while resting on a ship or near water. You can fill in for a first mate or captain in a pinch. Advantage on water-related skill checks.",features:[{type:"passive_feature",name:"Nautical Recovery",description:"Recover twice as many Wounds and HP while resting on a ship or near water."},{type:"passive_feature",name:"Seamanship",description:"You can fill in for a first mate or captain in a pinch. Advantage on water-related skill checks."}]},{id:"at-home-underground",name:"At Home Underground",description:'You can dig twice as fast as others. Safe resting locations underground always count as Lavish lodging for you. You struggle to rest (INT save) while it\'s raining. "Water... from the SKY?!"',features:[{type:"passive_feature",name:"Expert Digger",description:"You can dig twice as fast as others."},{type:"passive_feature",name:"Underground Comfort",description:"Safe resting locations underground always count as Lavish lodging for you."},{type:"passive_feature",name:"Rain Aversion",description:'You struggle to rest (INT save) while it\'s raining. "Water... from the SKY?!"'}]},{id:"raised-by-goblins",name:"Raised by Goblins",description:"You speak Goblin natively (much better than one who has learned it later in life). You automatically notice and can avoid crudely-made traps and have advantage to notice and disarm more sophisticated traps. Change It Up! You can choose any other ancestry to be raised by instead, and exchange the known language and get 1 helpful/iconic ability those people would inculcate (e.g., Dwarves know Dwarvish and are very good with smithing or stonecraft).",features:[{type:"passive_feature",name:"Native Goblin Speaker",description:"You speak Goblin natively (much better than one who has learned it later in life)."},{type:"passive_feature",name:"Trap Sense",description:"You automatically notice and can avoid crudely-made traps and have advantage to notice and disarm more sophisticated traps."}]},{id:"history-buff",name:"History Buff",description:"Advantage on all Lore checks related to knowledge about items, facts, or events that happened more than 100 years ago.",features:[{type:"passive_feature",name:"Ancient Knowledge",description:"Advantage on all Lore checks related to knowledge about items, facts, or events that happened more than 100 years ago."}]},{id:"former-con-artist",name:"(Former) Con Artist",description:"You can forge most documents or mimic voices flawlessly. You have a criminal contact in most major cities. However, your reputation often precedes youuntil you prove yourself to be trustworthy.",features:[{type:"passive_feature",name:"Master Forger",description:"You can forge most documents or mimic voices flawlessly."},{type:"passive_feature",name:"Criminal Network",description:"You have a criminal contact in most major cities."},{type:"passive_feature",name:"Questionable Reputation",description:"Your reputation often precedes youuntil you prove yourself to be trustworthy."}]},{id:"secretly-undead",name:"(Secretly) Undead",description:"Unnatural Resilience: You are immune to disease and do not need to eat, drink, or breathe. Children, animals, and Celestials are uneasy in your presence; many will be horrified to discover your true nature.",features:[{type:"passive_feature",name:"Unnatural Resilience",description:"You are immune to disease and do not need to eat, drink, or breathe."},{type:"passive_feature",name:"Unsettling Presence",description:"Children, animals, and Celestials are uneasy in your presence; many will be horrified to discover your true nature."}]},{id:"taste-for-the-finer-things",name:"Taste for the Finer Things",description:"You always have up-to-date knowledge of the customs and dress of the upper classes and may even know many of their secrets. Advantage on Influence checks with the upper class.",features:[{type:"passive_feature",name:"High Society Knowledge",description:"You always have up-to-date knowledge of the customs and dress of the upper classes and may even know many of their secrets."},{type:"passive_feature",name:"Upper Class Influence",description:"Advantage on Influence checks with the upper class."}]},{id:"fearless",name:"Fearless",description:"You are immune to the Frightened condition. +1 Initiative. -1 Armor.",features:[{type:"passive_feature",name:"Fear Immunity",description:"You are immune to the Frightened condition."},{type:"passive_feature",name:"Quick Reflexes",description:"+1 Initiative."},{type:"passive_feature",name:"Reckless",description:"-1 Armor."}]},{id:"so-dumb-im-smart-sometimes",name:"So Dumb I'm Smart Sometimes",description:"(Req. 0 or negative INT at character creation.) Reroll an INT-related skill check, 1/day. Reroll a failed INT save with advantage, 1/Safe Rest.",features:[{type:"passive_feature",name:"Lucky Stupidity",description:"Reroll an INT-related skill check, 1/day. Reroll a failed INT save with advantage, 1/Safe Rest."}]},{id:"wily-underdog",name:"Wily Underdog",description:"(Req. 0 or negative STR at character creation.) Reroll a failed STR-related roll (e.g., STR attack, STR save, Might check) and use another stat instead, 1/day.",features:[{type:"passive_feature",name:"Creative Problem Solving",description:"Reroll a failed STR-related roll (e.g., STR attack, STR save, Might check) and use another stat instead, 1/day."}]},{id:"bumblewise",name:"Bumblewise",description:"(Req. 0 or negative WIL at character creation.) A result of 1 or less on any WIL-related roll counts as a natural 20 (WIL save, Naturecraft, Perception, Influence, or Insight check).",features:[{type:"passive_feature",name:"Accidental Wisdom",description:"A result of 1 or less on any WIL-related roll counts as a natural 20 (WIL save, Naturecraft, Perception, Influence, or Insight check)."}]},{id:"accidental-acrobat",name:"Accidental Acrobat",description:"(Req. 0 or negative DEX at character creation.) Whenever you fail a DEX-related roll (e.g., DEX attack, DEX save, Stealth check, Finesse check), you may roll again. If you still fail, the consequences are BAD.",features:[{type:"passive_feature",name:"Lucky Clumsiness",description:"Whenever you fail a DEX-related roll (e.g., DEX attack, DEX save, Stealth check, Finesse check), you may roll again. If you still fail, the consequences are BAD."}]},{id:"tradesman-artisan",name:"Tradesman/Artisan",description:"Choose a profession (Baker/Cook, Smith, Stonemason, Weaver, Leatherworker, etc.). Checks you make related to that profession are made with advantage. You also retain special knowledge related to your profession.",features:[{type:"passive_feature",name:"Professional Expertise",description:"Choose a profession (Baker/Cook, Smith, Stonemason, Weaver, Leatherworker, etc.). Checks you make related to that profession are made with advantage."},{type:"passive_feature",name:"Professional Knowledge",description:"You retain special knowledge related to your profession."}]}],tS=[{id:"flame-dart",name:"Flame Dart",description:"Cantrip, 1 Action, Single Target. Range: 8. Damage: 1d10. On crit: Smoldering. High Levels: +5 damage every 5 levels.",type:"spell",school:"fire",tier:0,actionCost:1,roll:{dice:{count:1,sides:10}}},{id:"hearts-fire",name:"Heart's Fire",description:"Cantrip, 1 Action, Single Target. Range: 4. Give an ally within Range an extra action. Spend 1 mana to cast this when it is not your turn. High Levels: +1 Range every 5 levels.",type:"spell",school:"fire",tier:0,actionCost:1},{id:"ignite",name:"Ignite",description:"Tier 1, 2 Actions, Single Target. Range: 8. Damage: 4d10 to a Smoldering target, ending the condition on hit. Upcast: +10 damage.",type:"spell",school:"fire",tier:1,actionCost:2,roll:{dice:{count:4,sides:10}},resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"enchant-weapon",name:"Enchant Weapon",description:"Tier 2, 1 Action, Single Target. Concentration: Up to 1 minute. A weapon you touch is enchanted with magical flame. It deals +KEY damage and inflicts Smoldering on crit. Upcast: +KEY damage.",type:"spell",school:"fire",tier:2,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"flame-barrier",name:"Flame Barrier",description:"Tier 3, 1 Action, Self. Reaction: When attacked. Defend for free. Until the start of your next turn, melee attackers against you take KEY damage (ignoring armor) and gain Smoldering. Upcast: +KEY damage.",type:"spell",school:"fire",tier:3,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"pyroclasm",name:"Pyroclasm",description:"Tier 4, 2 Actions, AoE. Reach: 3. Others within Reach take 2d20+10 damage (ignoring armor) on a failed DEX save. Half damage on save. Smoldering creatures fail. Upcast: +1 Reach, +2 damage.",type:"spell",school:"fire",tier:4,actionCost:2,roll:{dice:{count:2,sides:20},modifier:10},resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"fiery-embrace",name:"Fiery Embrace",description:"Tier 5, 2 Actions, AoE. Concentration: Up to 1 minute. Reach: 3. While within Reach: 1 ally gains the effects of Enchant Weapon. Enemies gain Smoldering, lose damage resistance, and their damage immunity is reduced to resistance. Upcast: +1 ally.",type:"spell",school:"fire",tier:5,actionCost:2,resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"living-inferno",name:"Living Inferno",description:"Tier 7, 3 Actions, Self. The effects of Flame Barrier until your next turn. At the end of this turn and your next turn, cast Pyroclasm for free. Upcast: Upcast Flame Barrier and Pyroclasm.",type:"spell",school:"fire",tier:7,actionCost:3,resourceCost:{type:"fixed",resourceId:"mana",amount:7}},{id:"dragonform",name:"Dragonform",description:"Tier 9, 5 Actions, Self. Transform into a Huge dragon. Gain 3 actions, a fly speed of 12, LVL Armor, 10+LVL temp HP, and: TOOTH & CLAW (Action, Reach 2): 1d20+LVL damage (ignoring armor), inflicts Smoldering. IMMOLATING BREATH (2 Actions, Reach 6, Cone 8): DC 20 DEX save, KEY d20 damage, half on save. Smoldering targets fail. You can maintain this form for as long as the temp HP granted by this spell remain (max. 10 minutes). When it ends, you drop to 0 HP.",type:"spell",school:"fire",tier:9,actionCost:5,resourceCost:{type:"fixed",resourceId:"mana",amount:9}}],tC=[{id:"ice-lance",name:"Ice Lance",description:"Cantrip, 1 Action, Single Target. Range: 12. Damage: 1d6 cold or piercing damage. On hit: Slowed. High Levels: +3 damage every 5 levels.",type:"spell",school:"ice",tier:0,actionCost:1,roll:{dice:{count:1,sides:6}}},{id:"snowblind",name:"Snowblind",description:"Cantrip, 1 Action, Single Target. Reach: 1. Damage: 1d6. On hit: Blinded until the end of their next turn. High Levels: +3 damage every 5 levels.",type:"spell",school:"ice",tier:0,actionCost:1,roll:{dice:{count:1,sides:6}}},{id:"frost-shield",name:"Frost Shield",description:"Tier 1, 1 Action, Self. Reaction: When attacked, Gain 2\xd7KEY temp HP and Defend. Until the 1st time melts and these temp HP are lost at the start of your next turn. Upcast: +2\xd7KEY temp HP.",type:"spell",school:"ice",tier:1,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"shatter",name:"Shatter",description:"Tier 2, 2 Actions, Single Target. Range: 12. Damage: 3d6. If any die rolls the max against a Hampered target, this counts as a crit. On crit: +20 damage. Deal freeze increase the crit range by 1. ANY die by 1. +5 damage on crit.",type:"spell",school:"ice",tier:2,actionCost:2,roll:{dice:{count:3,sides:6}},resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"cryosleep",name:"Cryosleep",description:"Tier 3, 2 Actions, AoE. Reach: 12. Creatures in a 2\xd72 area within Reach are Dazed. On a failed STR save, they fall asleep instead, becoming Incapacitated until their next two turns have passed, until damaged, or until an ally uses an action to wake them. Upcast: +1 area, +1 turn asleep.",type:"spell",school:"ice",tier:3,actionCost:2,resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"rimeblades",name:"Rimeblades",description:"Tier 4, 3 Actions, AoE. Concentration: Up to 1 minute. Reach: 12. Conjure razor-sharp icy spikes in 5 contiguous spaces within Reach. This area is difficult terrain. Creatures that enter these spaces (or who are in the area when you conjure them) suffer 2d6 damage for each space they touch. Upcast: +1 space, +1 damage.",type:"spell",school:"ice",tier:4,actionCost:3,roll:{dice:{count:2,sides:6}},resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"arctic-blast",name:"Arctic Blast",description:"Tier 5, 2 Actions, AoE. Reach: Cone 4. Damage: 4d6+10 damage. This area is difficult terrain until the end of your next turn. Surviving creatures must make a STR save or be frozen in place (Restrained) until the end of their next turn; creatures already Hampered are Incapacitated for 1 turn instead. Upcast: +1 Reach.",type:"spell",school:"ice",tier:5,actionCost:2,roll:{dice:{count:4,sides:6},modifier:10},resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"glacier-strike",name:"Glacier Strike",description:"Tier 8, 3 Actions, AoE. Range: 12. Damage: d66 bludgeoning to creatures in a 3\xd73 area. Creatures adjacent to that area take half as much. The entire area permanently becomes difficult terrain. Upcast: +1 initial area.",type:"spell",school:"ice",tier:8,actionCost:3,roll:{dice:{count:1,sides:66}},resourceCost:{type:"fixed",resourceId:"mana",amount:8}},{id:"arctic-annihilation",name:"Arctic Annihilation",description:"Tier 9, 3 Actions, AoE. Reach: 12. Choose any number of objects or willing creatures within Reach to encase in ice. They are Incapacitated and immune to damage and negative effects until the start of their next turn. All other creatures and objects within Reach take d66 damage. Any surviving creature who took this damage must make a STR save or be Incapacitated for 1 round. Once you cast this spell, you must Safe Rest for 1 week before using it again.",type:"spell",school:"ice",tier:9,actionCost:3,roll:{dice:{count:1,sides:66}},resourceCost:{type:"fixed",resourceId:"mana",amount:9}}],tA=[{id:"zap",name:"Zap",description:"Cantrip, 1 Action, Single Target. Range: 12. Damage: 2d8. On miss: the lightning fails to find ground, and strikes you instead. High Levels: +6 damage every 5 levels.",type:"spell",school:"lightning",tier:0,actionCost:1,roll:{dice:{count:2,sides:8}}},{id:"overload",name:"Overload",description:"Cantrip, 1 Action, AoE. Castiable only if you are Charged, ending the condition. Reach: 2. Damage: 2d8 to others within Reach. High Levels: +4 damage every 5 levels. Charged: Whenever you take lightning damage, you are Charged for 1 minute.",type:"spell",school:"lightning",tier:0,actionCost:1,roll:{dice:{count:2,sides:8}}},{id:"arc-lightning",name:"Arc Lightning",description:"Tier 1, 2 Actions, Single Target. Range: 12. Damage: 3d8. The bolt also damages the next closest creature to your target. On miss: the lightning fails to find ground and strikes you instead. Upcast: +4 damage. Next Closest: If you or an ally is the next closest, they are hit! If 2 creatures are equally close, the GM can roll for it or select the one wearing the most metal.",type:"spell",school:"lightning",tier:1,actionCost:2,roll:{dice:{count:3,sides:8}},resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"alacrity",name:"Alacrity",description:"Tier 2, 1 Action, Self. Range: 4. Reaction: When attacked. Defend for free. After damage is dealt, you gain the Charged condition then teleport anywhere within Range. Upcast: +4 Range.",type:"spell",school:"lightning",tier:2,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"stormlash",name:"Stormlash",description:"Tier 3, 2 Actions, AoE. Line: 12. Damage: 3d8+4 (ignoring metal armor). Surviving creatures are Dazed on a failed STR save, or Incapacitated instead for 1 of their turns if they fail by 5 or more. Creatures with a large amount of metal (e.g., armor or a longsword) roll with disadvantage. Upcast: +4 damage.",type:"spell",school:"lightning",tier:3,actionCost:2,roll:{dice:{count:3,sides:8},modifier:4},resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"electrickery",name:"Electrickery",description:"Tier 4, 3 Actions, 2 Targets. Range: 8. Reaction: When an ally is attacked. Choose another creature within Range to swap places with your ally on a failed WIL save (they become the new target). Costs 1 Action while Charged, ending the condition. Upcast: +2 Range.",type:"spell",school:"lightning",tier:4,actionCost:3,resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"electrocharge",name:"Electrocharge",description:"Tier 5, 2 Actions, Single Target. Concentration: Up to 1 minute. A creature you touch gains the Charged condition, +1 max action, +5 armor, 2x speed, and advantage on DEX saves. Upcast: +4 Range.",type:"spell",school:"lightning",tier:5,actionCost:2,resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"ride-the-lightning",name:"Ride the Lightning",description:"Tier 6, 3 Actions, AoE. Teleport up to 12 spaces away to a spot you can see (if a willing creature is there, swap places with them). Adjacent creatures take d88 damage. Surviving creatures must make a STR save or be hurled back 3 spaces, knocked Prone, and deafened for 1 day. Upcast: +1 DC. D88: Roll 2d8. The leftmost die is the tens place, and the second is the ones (e.g., 4 and 5 deal 45 damage).",type:"spell",school:"lightning",tier:6,actionCost:3,roll:{dice:{count:2,sides:8}},resourceCost:{type:"fixed",resourceId:"mana",amount:6}},{id:"seething-storm",name:"Seething Storm",description:"Tier 9, 3 Actions, AoE. Concentration: Up to 1 minute. Reach: 4. You become a cloud of tempestuous storm. You can fly, move for free 1/round, and attacks against you are made with disadvantage. At the end of each of your turns, strike up to 4 creatures within Reach with a bolt of lightning for d88 damage (a creature can only be struck 1/round). +2 Reach and number of bolts each round. Costs 3 actions each round to maintain. Once you cast this spell, you must Safe Rest for 1 week before you can use it again.",type:"spell",school:"lightning",tier:9,actionCost:3,roll:{dice:{count:2,sides:8}},resourceCost:{type:"fixed",resourceId:"mana",amount:9}}],t_=[{id:"razor-wind",name:"Razor Wind",description:"Cantrip, 1 Action, Single Target. Range: 12. Damage: 1d4 slashing (Vicious: roll 1 additional die whenever you roll crit damage). Also damages up to 1 adjacent target. High Levels: +2 damage every 5 levels.",type:"spell",school:"wind",tier:0,actionCost:1,roll:{dice:{count:1,sides:4}}},{id:"breath-of-life",name:"Breath of Life",description:"Cantrip, 1 Action, Single Target. Range: 6. Restore 1 HP to a Dying creature. High Levels: +2 Range every 5 levels.",type:"spell",school:"wind",tier:0,actionCost:1},{id:"blustery-gale",name:"Blustery Gale",description:"Tier 1, 2 Actions, Single Target. Range: 12. Damage: 3d4 bludgeoning, advantage against flying, Small, or Tiny targets. On hit: Move a Med target 2 spaces away, Small/Tiny twice as far, Large half as far (round down). For each space you would roll due to forced movement from this spell, deal +5 damage instead. Upcast: +1 movement.",type:"spell",school:"wind",tier:1,actionCost:2,roll:{dice:{count:3,sides:4}},resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"barrier-of-wind",name:"Barrier of Wind",description:"Tier 2, 1 Action, Self. Reaction: When attacked at Range. Defend for free. Ranged attacks have disadvantage against you this round (including the triggering attack). Upcast: +3 Armor.",type:"spell",school:"wind",tier:2,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"fly",name:"Fly",description:"Tier 3, 1 Action, Single Target. Concentration: Up to 10 minutes. Touch a creature, grant a flying speed of 12. Upcast: +1 target.",type:"spell",school:"wind",tier:3,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"eye-of-the-storm",name:"Eye of the Storm",description:"Tier 4, 2 Actions, AoE. Reach: 3. Damage: 4d4+10 bludgeoning to enemies within Reach. You may place surviving creatures anywhere within 1 space of the storm's Reach on a failed STR save. Upcast: +1 Reach.",type:"spell",school:"wind",tier:4,actionCost:2,roll:{dice:{count:4,sides:4},modifier:10},resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"updraft",name:"Updraft",description:"Tier 5, 3 Actions, AoE. Reach: 12. Enemies within a 5\xd75 area must repeat a DEX save until they succeed. For each time they failed they suffer 1d6 falling damage and land Prone. Upcast: +2 Range, +1 area.",type:"spell",school:"wind",tier:5,actionCost:3,roll:{dice:{count:1,sides:6}},resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"thousand-cuts",name:"Thousand Cuts",description:"Tier 6, 3 Actions, AoE. Range: 12. Damage: d44 slashing damage (roll with advantage), also damages enemies within Reach 1 of your target. Upcast: +1 Reach. D44 with advantage: Roll 3d4 and drop the lowest die. The leftmost die is the tens place, and the second is the ones (e.g., 2, 3, and 4 deal 34 damage).",type:"spell",school:"wind",tier:6,actionCost:3,roll:{dice:{count:3,sides:4}},resourceCost:{type:"fixed",resourceId:"mana",amount:6}},{id:"boisterous-winds",name:"Boisterous Winds",description:"Tier 7, 2 Actions, Multi-target. Concentration: Up to 1 minute. You and up to 12 allies within Reach 12 gain: Ranged attacks have disadvantage against you, a flying speed of 12, and can move for free 1/round. Upcast: +1 minute or +2 targets. SONGWEAVER ONLY",type:"spell",school:"wind",tier:7,actionCost:2,resourceCost:{type:"fixed",resourceId:"mana",amount:7}},{id:"vicious-mockery",name:"Vicious Mockery",description:"Cantrip, 1 Action, Single Target. Range: 12. Damage: 1d4+INT psychic (ignoring armor). On hit: the target is haunted during their next turn. High Levels: +2 damage every 5 levels. SONGWEAVER ONLY",type:"spell",school:"wind",tier:0,actionCost:1,roll:{dice:{count:1,sides:4},attribute:"intelligence"}}],tI=[{id:"rebuke",name:"Rebuke",description:"Cantrip, 1 Action, Single Target. Reach: 4. Damage: 1d6 (ignoring armor), does not miss. 2\xd7 damage against undead or cowardly (those Frightened or behind cover). High Levels: +2 damage every 5 levels.",type:"spell",school:"radiant",tier:0,actionCost:1,roll:{dice:{count:1,sides:6}}},{id:"true-strike",name:"True Strike",description:"Cantrip, 1 Action, Single Target. Reach: 2. Give a creature advantage on the next attack they make (until the end of their next turn). High Levels: +1 Reach every 5 levels.",type:"spell",school:"radiant",tier:0,actionCost:1},{id:"heal",name:"Heal",description:"Tier 1, 1 Action, Single Target. Reach: 1. Heal a creature 1d6+KEY HP. Upcast: Choose one: +1 target, +4 Reach, +1d6 healing. If 5+ mana is spent, you may also heal 1 negative condition (e.g., Blind, Poisoned, 1 Wound).",type:"spell",school:"radiant",tier:1,actionCost:1,roll:{dice:{count:1,sides:6},attribute:"intelligence"},resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"warding-bond",name:"Warding Bond",description:"Tier 2, 1 Action, Single Target. Designate a willing creature as your ward for 1 minute. They take half damage from all attacks; you are attacked for the other half. Upcast: +1 creature.",type:"spell",school:"radiant",tier:2,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"shield-of-justice",name:"Shield of Justice",description:"Tier 3, 1 Action, Self. Reaction: When attacked, Defend for free and reflect Radiant damage back at the attacker equal to the amount blocked (ignoring armor). Upcast: +5 Armor.",type:"spell",school:"radiant",tier:3,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"condemn",name:"Condemn",description:"Tier 4, 2 Actions, Single Target. Reach: 4. Damage: 30. Can only target an enemy that crit you or an ally since your last turn. Cannot be reduced by any means. The next attack against that enemy is made with advantage. Upcast: +1 Reach, +1 advantage.",type:"spell",school:"radiant",tier:4,actionCost:2,resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"vengeance",name:"Vengeance",description:"Tier 5, 2 Actions, Single Target. Reach: 1. Damage: 1d100, to a creature that attacked a Dying ally or reduced one to 0 HP since your last turn. Upcast: +1 Reach, roll w/ advantage.",type:"spell",school:"radiant",tier:5,actionCost:2,roll:{dice:{count:1,sides:100}},resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"sacrifice",name:"Sacrifice",description:"Tier 6, 1 Action, Special. Reach: 4. Reduce yourself to 0 HP. You cannot have more than 0 HP until you Safe Rest. Heal a number of HP equal to your maximum HP, divided as you choose to any other creatures within Reach. Also revive a creature that has died in the past minute if you give them at least 20 HP (also healing 2 Wounds from them), provided they have not been revived with this spell before. Upcast: +4 Reach.",type:"spell",school:"radiant",tier:6,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:6}},{id:"redeem",name:"Redeem",description:"Tier 7, AoE. Casting Time: 24 hours. Requires: A diamond worth at least 10,000 gp, which this spell consumes. Revive any number of deceased creatures you choosewithin 1 milethat have died in the past year, provided they have not died of old age or been revived with this spell before. SHEPHERD ONLY",type:"spell",school:"radiant",tier:7,actionCost:1,resourceCost:{type:"fixed",resourceId:"mana",amount:7}},{id:"lifebinding-spirit",name:"Lifebinding Spirit",description:"Tier 1, 1 Action. Summon a spirit companion that follows you and is immune to harm. It lasts until you cast this spell again, take a Safe Rest, or it heals a number of times equal to the mana spent summoning it. Action: It attacks or heals a creature within Reach 4. It attacks for 1d6+WIL radiant damage (ignoring armor), or heals for the same amount. Upcast: Increment its die size by 1 (max d12), +1 healing use. SHEPHERD ONLY",type:"spell",school:"radiant",tier:1,actionCost:1,roll:{dice:{count:1,sides:6},attribute:"will"},resourceCost:{type:"fixed",resourceId:"mana",amount:1}}],tT=[{id:"entice",name:"Entice",description:"Cantrip, 1 Action, Single Target. Range: 8. Damage: 1d4 (ignoring armor). On hit: target moves 2 spaces closer to you. High Levels: Increment the die size 1 step every 5 levels (d6  d8  d10  d12).",type:"spell",school:"necrotic",tier:0,actionCost:1,roll:{dice:{count:1,sides:4}}},{id:"withering-touch",name:"Withering Touch",description:"Cantrip, 1 Action, Single Target. Reach: 1. Damage: 1d12. On hit: Target is considered undead for 1 round. High Levels: +6 damage every 5 levels.",type:"spell",school:"necrotic",tier:0,actionCost:1,roll:{dice:{count:1,sides:12}}},{id:"shadow-trap",name:"Shadow Trap",description:"Tier 1, 2 Actions, Single Target. Concentration: Up to 1 minute. The next creature to move adjacent to you suffers 3d12 damage, if Small or Tiny, it is also Restrained by shadow tendrils for as long as you maintain concentration or until they escape. Upcast: +1 size category, +1d12 damage when they escape.",type:"spell",school:"necrotic",tier:1,actionCost:2,roll:{dice:{count:3,sides:12}},resourceCost:{type:"fixed",resourceId:"mana",amount:1}},{id:"dread-visage",name:"Dread Visage",description:"Tier 2, 1 Action, Self. Reaction: When attacked, Defend for free. Melee attackers are Frightened for 1 round. 1d12 damage if they attack you this round. Costs 2 mana less while dying. Upcast: +2 damage, +2 armor.",type:"spell",school:"necrotic",tier:2,actionCost:1,roll:{dice:{count:1,sides:12}},resourceCost:{type:"fixed",resourceId:"mana",amount:2}},{id:"vampiric-greed",name:"Vampiric Greed",description:"Tier 3, 2 Actions, AoE. Gain 1 Wound. 4d12 to all adjacent creatures, and heal HP equal to the damage done. Any surviving creatures make a STR save. Gain 1 additional wound for each creature that saves. Upcast: +1 DC.",type:"spell",school:"necrotic",tier:3,actionCost:2,roll:{dice:{count:4,sides:12}},resourceCost:{type:"fixed",resourceId:"mana",amount:3}},{id:"greater-shadow",name:"Greater Shadow",description:"Tier 4, 2 Actions. Summon a 5d12 Greater Shadow minion (max 1) adjacent to you. When it dies, it explodes into 5 shadow minions (see Summon Shadow). Place them anywhere within 8 spaces. Upcast: +1d12 damage, +1 shadow minion on explosion.",type:"spell",school:"necrotic",tier:4,actionCost:2,roll:{dice:{count:5,sides:12}},resourceCost:{type:"fixed",resourceId:"mana",amount:4}},{id:"gangrenous-burst",name:"Gangrenous Burst",description:"Tier 5, 2 Actions, AoE. Reach: Up to 8. Other damaged creatures must make a STR save or take 3d20 damage (ignoring armor), half on save. The save is rolled with disadvantage while Bloodied. Upcast: +10 damage.",type:"spell",school:"necrotic",tier:5,actionCost:2,roll:{dice:{count:3,sides:20}},resourceCost:{type:"fixed",resourceId:"mana",amount:5}},{id:"unspeakable-word",name:"Unspeakable Word",description:"Tier 6, 2 Actions, Special. Reach: 8. Damage: d66 (with advantage, ignoring armor, does not miss or crit) on a failed INT save. Target rolls with disadvantage if Bloodied or Frightened. On a success, you both take half of this damage instead. Upcast: +1 DC, +10 damage. D66 with advantage: Roll 3d6 and drop the lowest die. The leftmost die is the tens place, and the second is the ones (e.g., 2, 3, and 4 deals 34 damage).",type:"spell",school:"necrotic",tier:6,actionCost:2,roll:{dice:{count:3,sides:6}},resourceCost:{type:"fixed",resourceId:"mana",amount:6}},{id:"creeping-death",name:"Creeping Death",description:"Tier 7, 3 Actions, AoE. Reach: 8. Damage: 4d20. If this kills the creature, it violently erupts and you MUST deal the same amount of damage to another creature within 8 spaces of it that has not yet been damaged by this effect. Repeat until a creature survives this damage or no other creatures are within Reach. Upcast: +1d20 damage.",type:"spell",school:"necrotic",tier:7,actionCost:3,roll:{dice:{count:4,sides:20}},resourceCost:{type:"fixed",resourceId:"mana",amount:7}},{id:"shadow-blast",name:"Shadow Blast",description:"Cantrip, 1 Action, Single Target. Range: 8. Damage: 1d12+KEY. 1/round. High Levels: +1d12 every 5 levels. SHADOWMANCER ONLY",type:"spell",school:"necrotic",tier:0,actionCost:1,roll:{dice:{count:1,sides:12},attribute:"intelligence"}},{id:"summon-shadow",name:"Summon Shadow",description:"Cantrip, 1 Action. Summon a shadow minion within Reach 1 (you can summon a max of WIL or LVL minions, whichever is lower). Your shadow minions follow the normal minion rules: they have 1 HP, no damage bonus, and do not crit. They abandon you immediately outside of combat. Action: 1 (turn) you may command ALL of your minions to move up to 6 then attack (Reach 1, d12 each). High Levels: +1 Reach every 5 levels.",type:"spell",school:"necrotic",tier:0,actionCost:1}],tR={ice:[{id:"ice-disk",name:"Ice Disk",type:"spell",school:"ice",tier:0,description:"Conjure a disk of ice that floats just above the ground and follows you. It can carry up to 250 lbs / 115 kg of weight for 1 hour or until you cast this spell again."},{id:"chillcraft",name:"Chillcraft",type:"spell",school:"ice",tier:0,description:"Harmlessly freeze, thaw, or move a bath-sized amount of water near you. OR: Conjure a sheet of opaque, mirror-like, or transparent ice the size of a window or small door."},{id:"wintry-scrying",name:"Wintry Scrying",type:"spell",school:"ice",tier:0,description:"Turn a small patch of water into a reflective icy mirror. Looking though it grants you vision of any desired location near this same body of water for 10 minutes."}],lightning:[{id:"spark-buddy",name:"Spark Buddy",type:"spell",school:"lightning",tier:0,description:"Conjure a tiny (squirrel-sized) electrical helper for up to 1 hour. It can fetch tiny objects (~1 lb / 500 g max), open unlocked doors, illuminate a small area, or deliver a harmless shock. If it takes damage or moves further than 6 spaces away from you, it dissipates into sparks."},{id:"spark-step",name:"Spark Step",type:"spell",school:"lightning",tier:0,description:"Teleport to a metal object."},{id:"tempests-command",name:"Tempest's Command",type:"spell",school:"lightning",tier:0,description:"A minor magical effect, or temporarily suppress a stronger one (the more powerful an enchantment, the shorter the duration). OR: Your eyes glow and your voice is amplified to a booming, thunder-like volume for 1 minute."}],radiant:[{id:"light",name:"Light",type:"spell",school:"radiant",tier:0,description:"Cause an item to brightly glow as a torch with radiant light for as long as you hold it."},{id:"beautify",name:"Beautify",type:"spell",school:"radiant",tier:0,description:"Clean stains or repair a small tear/break in a non-magical item, or conjure tiny beautiful things: flowers, butterflies, etc."},{id:"bond-of-peace",name:"Bond of Peace",type:"spell",school:"radiant",tier:0,description:"Telepathically communicate simple thoughts or feelings with a friendly creature you can see. OR: Imbue your spoken words with calming magic, granting advantage on any check made to soothe anger or fear in creatures who can hear you."}],fire:[{id:"firebrand",name:"Firebrand",type:"spell",school:"fire",tier:0,description:"Touch a surface and secretly mark it with a symbol or brief message. Speaking a chosen command word while nearby reveals it."},{id:"fire-step",name:"Fire Step",type:"spell",school:"fire",tier:0,description:"Teleport to a fire source you can see."},{id:"kindle",name:"Kindle",type:"spell",school:"fire",tier:0,description:"A minor visual illusion. OR: Ignite a small, unheld item within Range 6."}],wind:[{id:"wind-whisper",name:"Wind Whisper",type:"spell",school:"wind",tier:0,description:"You whisper a message into the wind and it will be secretly carried to a specified target within 100 miles / 160 km."},{id:"helpful-gust",name:"Helpful Gust",type:"spell",school:"wind",tier:0,description:"Gently move a tiny unheld item within Reach in any direction. OR: Generate an illusory scent."},{id:"feather-fall",name:"Feather Fall",type:"spell",school:"wind",tier:0,description:"Reaction: When a creature falls, cause them to gently float to the ground, unharmed."}],necrotic:[{id:"gravecraft",name:"Gravecraft",type:"spell",school:"necrotic",tier:0,description:"Action: Soil a surface with blood, filth, or other disgusting things. OR: Casting time 1 minute: Shape/move a body-sized plot of earth."},{id:"false-face",name:"False Face",type:"spell",school:"necrotic",tier:0,description:"Change your appearance to look like someone else for 10 minutes. Requires a piece of them."},{id:"thought-leech",name:"Thought Leech",type:"spell",school:"necrotic",tier:0,description:"Read the surface thoughts of a creature within Reach. Creatures can sense you doing this and may not like it."}]},tD=[{schoolId:"fire",name:"Fire Magic",description:"Destructive flames and burning magic that harnesses the power of fire and heat"},{schoolId:"radiant",name:"Radiant Magic",description:"Divine light and healing magic that channels holy radiance and positive energy"},{schoolId:"frost",name:"Frost Magic",description:"Ice and cold elemental magic that manipulates temperature and frozen matter"},{schoolId:"nature",name:"Nature Magic",description:"Plant, animal, and natural magic that draws power from the living world"},{schoolId:"shadow",name:"Shadow Magic",description:"Necromancy and dark energy that manipulates death and negative forces"},{schoolId:"arcane",name:"Arcane Magic",description:"Pure magical force and manipulation of raw arcane energy"}],tL={customClasses:"nimble-navigator-custom-classes",customSubclasses:"nimble-navigator-custom-subclasses",customAncestries:"nimble-navigator-custom-ancestries",customBackgrounds:"nimble-navigator-custom-backgrounds",customSpellSchools:"nimble-navigator-custom-spell-schools",customAbilities:"nimble-navigator-custom-abilities",customSpells:"nimble-navigator-custom-spells",customItems:"nimble-navigator-custom-items"};class tE{static getInstance(){return tE.instance||(tE.instance=new tE),tE.instance}getAllClasses(){let e=this.getCustomClasses();return[...Object.values(tw),...e]}getClassDefinition(e){let t=tw[e];return t||this.getCustomClasses().find(t=>t.id===e)||null}getClassFeaturesForLevel(e,t){let a=this.getClassDefinition(e);return a?a.features.filter(e=>e.level===t):[]}getAllClassFeaturesUpToLevel(e,t){let a=this.getClassDefinition(e);return a?a.features.filter(e=>e.level<=t):[]}getAllAncestries(){return[...tN,...this.getCustomAncestries()]}getAncestryDefinition(e){let t=tN.find(t=>t.id===e);return t||this.getCustomAncestries().find(t=>t.id===e)||null}addCustomAncestry(e){return new Promise((t,a)=>{try{let i=this.getCustomAncestries();if(i.some(t=>t.id===e.id))return void a(Error("Ancestry with ID '".concat(e.id,"' already exists")));i.push(e),localStorage.setItem(tL.customAncestries,JSON.stringify(i)),t()}catch(e){a(e)}})}removeCustomAncestry(e){return new Promise((t,a)=>{try{let i=this.getCustomAncestries(),s=i.filter(t=>t.id!==e);if(s.length===i.length)return void a(Error("Custom ancestry with ID '".concat(e,"' not found")));localStorage.setItem(tL.customAncestries,JSON.stringify(s)),t()}catch(e){a(e)}})}getCustomAncestries(){try{let e=localStorage.getItem(tL.customAncestries);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{e&&"object"==typeof e&&e.id&&e.name&&e.description?a.push(e):console.warn("Invalid custom ancestry at index ".concat(t,":"),e)}),a}catch(e){return console.warn("Error reading custom ancestries from storage:",e),[]}}getAllBackgrounds(){return[...tk,...this.getCustomBackgrounds()]}getBackgroundDefinition(e){let t=tk.find(t=>t.id===e);return t||this.getCustomBackgrounds().find(t=>t.id===e)||null}addCustomBackground(e){return new Promise((t,a)=>{try{let i=this.getCustomBackgrounds();if(i.some(t=>t.id===e.id))return void a(Error("Background with ID '".concat(e.id,"' already exists")));i.push(e),localStorage.setItem(tL.customBackgrounds,JSON.stringify(i)),t()}catch(e){a(e)}})}removeCustomBackground(e){return new Promise((t,a)=>{try{let i=this.getCustomBackgrounds(),s=i.filter(t=>t.id!==e);if(s.length===i.length)return void a(Error("Custom background with ID '".concat(e,"' not found")));localStorage.setItem(tL.customBackgrounds,JSON.stringify(s)),t()}catch(e){a(e)}})}getCustomBackgrounds(){try{let e=localStorage.getItem(tL.customBackgrounds);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{e&&"object"==typeof e&&e.id&&e.name&&e.description?a.push(e):console.warn("Invalid custom background at index ".concat(t,":"),e)}),a}catch(e){return console.warn("Error reading custom backgrounds from storage:",e),[]}}uploadAncestries(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateAncestry(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Ancestry ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid ancestry definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomAncestries()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customAncestries,JSON.stringify(r));let n=1===i.length?"Successfully added/updated ancestry: ".concat(i[0].name):"Successfully added/updated ".concat(i.length," ancestries");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}uploadBackgrounds(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateBackground(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Background ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid background definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomBackgrounds()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customBackgrounds,JSON.stringify(r));let n=1===i.length?"Successfully added/updated background: ".concat(i[0].name):"Successfully added/updated ".concat(i.length," backgrounds");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}uploadClasses(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateClass(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Class ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid class definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomClasses()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customClasses,JSON.stringify(r));let n=s.length>0?"Successfully added/updated ".concat(i.length," class(es). ").concat(s.length," invalid entries skipped."):"Successfully added/updated ".concat(i.length," class(es)");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}removeCustomClass(e){let t=this.getCustomClasses(),a=t.filter(t=>t.id!==e);return a.length<t.length&&(localStorage.setItem(tL.customClasses,JSON.stringify(a)),!0)}getCustomClasses(){try{let e=localStorage.getItem(tL.customClasses);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{let i=tg.validateClass(e);i.valid&&i.data?a.push(i.data):console.warn("Invalid class found in storage at index ".concat(t,":"),i.errors)}),a.length!==t.length&&localStorage.setItem(tL.customClasses,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom classes from storage:",e),[]}}getAllSubclasses(){return this.getCustomSubclasses()}getSubclassesForClass(e){return this.getCustomSubclasses().filter(t=>t.parentClassId===e)}uploadSubclasses(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateSubclass(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Subclass ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid subclass definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomSubclasses()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customSubclasses,JSON.stringify(r));let n=s.length>0?"Successfully added/updated ".concat(i.length," subclass(es). ").concat(s.length," invalid entries skipped."):"Successfully added/updated ".concat(i.length," subclass(es)");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getCustomSubclasses(){try{let e=localStorage.getItem(tL.customSubclasses);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{let i=tg.validateSubclass(e);i.valid&&i.data?a.push(i.data):console.warn("Invalid subclass found in storage at index ".concat(t,":"),i.errors)}),a.length!==t.length&&localStorage.setItem(tL.customSubclasses,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom subclasses from storage:",e),[]}}getAllSpellSchools(){return this.initializeBuiltInSchools(),this.getStoredSpellSchools()}initializeBuiltInSchools(){let e=this.getStoredSpellSchools();if(!tD.every(t=>e.some(e=>e.id===t.schoolId))){let t=tD.map(e=>({id:e.schoolId,name:e.name,description:e.description,spells:function(e){switch(e){case"fire":return tS;case"ice":return tC;case"lightning":return tA;case"wind":return t_;case"radiant":return tI;case"necrotic":return tT;default:return[]}}(e.schoolId),utilitySpells:tR[e.schoolId]||[]})),a=[...e];t.forEach(e=>{-1===a.findIndex(t=>t.id===e.id)&&a.push(e)}),localStorage.setItem(tL.customSpellSchools,JSON.stringify(a))}}getSpellSchool(e){return this.getAllSpellSchools().find(t=>t.id===e)||null}getSpellsBySchool(e){let t=this.getSpellSchool(e);if(!t)return[];let a=this.getCustomSpells().filter(t=>t.school===e);return[...t.spells,...a]}getUtilitySpellsForSchool(e){let t=this.getSpellSchool(e);return t&&t.utilitySpells||[]}uploadSpellSchools(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateSpellSchool(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("School ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid spell school definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getStoredSpellSchools()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customSpellSchools,JSON.stringify(r));let n=s.length>0?"Successfully added/updated ".concat(i.length," spell school(s). ").concat(s.length," invalid entries skipped."):"Successfully added/updated ".concat(i.length," spell school(s)");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getStoredSpellSchools(){try{let e=localStorage.getItem(tL.customSpellSchools);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{let i=tg.validateSpellSchool(e);i.valid&&i.data?a.push(i.data):console.warn("Invalid spell school found in storage at index ".concat(t,":"),i.errors)}),a.length!==t.length&&localStorage.setItem(tL.customSpellSchools,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom spell schools from storage:",e),[]}}getAllActionAbilities(){return[...this.getCustomAbilities()]}getActionAbility(e){return this.getAllActionAbilities().find(t=>t.id===e)||null}uploadAbilities(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateActionAbility(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Ability ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid ability definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomAbilities()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customAbilities,JSON.stringify(r));let n=s.length>0?"Successfully added/updated ".concat(i.length," abilit(y/ies). ").concat(s.length," invalid entries skipped."):"Successfully added/updated ".concat(i.length," abilit(y/ies)");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getCustomAbilities(){try{let e=localStorage.getItem(tL.customAbilities);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{let i=tg.validateActionAbility(e);i.valid&&i.data?a.push(i.data):console.warn("Invalid action ability found in storage at index ".concat(t,":"),i.errors)}),a.length!==t.length&&localStorage.setItem(tL.customAbilities,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom abilities from storage:",e),[]}}getAllSpells(){return[...tS,...tC,...tA,...t_,...tI,...tT,...this.getCustomSpells()]}getSpell(e){return this.getAllSpells().find(t=>t.id===e)||null}uploadSpells(e){try{let t=JSON.parse(e),a=Array.isArray(t)?t:[t],i=[],s=[];if(a.forEach((e,t)=>{let a=tg.validateSpellAbility(e);if(a.valid&&a.data)i.push(a.data);else{var r;s.push("Spell ".concat(t+1,": ").concat((null==(r=a.errors)?void 0:r.join(", "))||"Invalid format"))}}),0===i.length)return{success:!1,message:"No valid spell definitions found. Errors: ".concat(s.join("; "))};let r=[...this.getCustomSpells()];i.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);t>=0?r[t]=e:r.push(e)}),localStorage.setItem(tL.customSpells,JSON.stringify(r));let n=s.length>0?"Successfully added/updated ".concat(i.length," spell(s). ").concat(s.length," invalid entries skipped."):"Successfully added/updated ".concat(i.length," spell(s)");return{success:!0,message:n,itemsAdded:i.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getCustomSpells(){try{let e=localStorage.getItem(tL.customSpells);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{let i=tg.validateSpellAbility(e);i.valid&&i.data?a.push(i.data):console.warn("Invalid spell found in storage at index ".concat(t,":"),i.errors)}),a.length!==t.length&&localStorage.setItem(tL.customSpells,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom spells from storage:",e),[]}}getAllItems(){return[...tb.weapons,...tb.armor,...tb.freeform,...tb.consumables,...tb.ammunition,...this.getCustomItems()]}uploadItems(e){try{let t=JSON.parse(e);if(!t.items||!Array.isArray(t.items))return{success:!1,message:'Invalid format: expected an object with "items" array property'};let a=[],i=[];if(t.items.forEach((e,t)=>{e&&"object"==typeof e&&e.item&&e.item.id&&e.item.name&&e.item.type&&e.category&&["mundane","magical"].includes(e.category)?a.push(e):i.push("Item ".concat(t+1,": Invalid repository item format"))}),0===a.length)return{success:!1,message:"No valid item definitions found. Errors: ".concat(i.join("; "))};let s=[...this.getCustomItems()];a.forEach(e=>{let t=s.findIndex(t=>t.item.id===e.item.id);t>=0?s[t]=e:s.push(e)}),localStorage.setItem(tL.customItems,JSON.stringify(s));let r=i.length>0?"Successfully added/updated ".concat(a.length," item(s). ").concat(i.length," invalid entries skipped."):"Successfully added/updated ".concat(a.length," item(s)");return{success:!0,message:r,itemsAdded:a.length}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getCustomItems(){try{let e=localStorage.getItem(tL.customItems);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];let a=[];return t.forEach((e,t)=>{e&&"object"==typeof e&&e.item&&e.item.id&&e.item.name&&e.item.type&&e.category&&["mundane","magical"].includes(e.category)?a.push(e):console.warn("Invalid custom item found in storage at index ".concat(t,":"),e)}),a.length!==t.length&&localStorage.setItem(tL.customItems,JSON.stringify(a)),a}catch(e){return console.warn("Error reading custom items from storage:",e),[]}}clearAllCustomContent(){Object.values(tL).forEach(e=>{localStorage.removeItem(e)})}getCustomContentStats(){let e=this.getCustomClasses(),t=this.getAllSpellSchools(),a=this.getCustomSpells();return{[tx.CLASS_DEFINITION]:e.length,[tx.SUBCLASS_DEFINITION]:this.getCustomSubclasses().length,[tx.SPELL_SCHOOL_DEFINITION]:t.length,[tx.ANCESTRY_DEFINITION]:this.getCustomAncestries().length,[tx.BACKGROUND_DEFINITION]:this.getCustomBackgrounds().length,[tx.ACTION_ABILITY]:this.getCustomAbilities().length,[tx.SPELL_ABILITY]:a.length,[tx.ITEM_REPOSITORY]:this.getAllItems().length}}}class tP{getCharacterClass(e){return this.contentRepository.getClassDefinition(e.classId)}getCharacterSubclass(e){return e.subclassId?tp(e.subclassId):null}getExpectedFeaturesForCharacter(e){let t=this.contentRepository.getAllClassFeaturesUpToLevel(e.classId,e.level);return e.subclassId?[...t,...ty(e.subclassId,e.level)]:t}getMissingFeatures(e){let t=this.getExpectedFeaturesForCharacter(e),a=new Set(e.grantedFeatures);return t.filter(t=>{let i;return i=e.subclassId&&ty(e.subclassId,e.level).some(e=>e.name===t.name&&e.level===t.level)?this.generateSubclassFeatureId(e.subclassId,t.level,t.name):this.generateFeatureId(e.classId,t.level,t.name),!a.has(i)})}getFeaturesForLevel(e,t){return this.contentRepository.getClassFeaturesForLevel(e,t)}generateFeatureId(e,t,a,i){return"".concat(i||e,"-").concat(t,"-").concat(a.toLowerCase().replace(/\s+/g,"-"))}generateSubclassFeatureId(e,t,a){return this.generateFeatureId("",t,a,e)}async levelUpCharacter(e){let t=this.characterService.character;if(!t)throw Error("No character loaded");if(e<=t.level)throw Error("Target level must be higher than current level");let a=[],i=this.getCharacterClass(t);if(!i)throw Error("Class not found: ".concat(t.classId));for(let i=t.level+1;i<=e;i++)for(let e of this.getFeaturesForLevel(t.classId,i)){let s=await this.grantFeature(t,e,i);a.push(s)}let s={...t,level:e,hitDice:{...t.hitDice,size:i.hitDieSize,max:e,current:Math.min(t.hitDice.current+(e-t.level),e)}};return await this.characterService.updateCharacter(s),a}async grantFeature(e,t,a){let i=this.generateFeatureId(e.classId,a,t.name),s={featureId:i,classId:e.classId,level:a,feature:t,grantedAt:new Date},r=[...e.grantedFeatures,i],n={...e,grantedFeatures:r};return n=await this.applyFeatureEffects(n,t),await this.characterService.updateCharacter(n),s}async grantAbilityFeature(e,t){if(e.abilities.find(e=>e.id===t.ability.id))return e;let a=[...e.abilities,t.ability];return{...e,abilities:a}}async grantStatBoostFeature(e,t){let a={...e.attributes};for(let e of t.statBoosts)a[e.attribute]=Math.min(10,a[e.attribute]+e.amount);return{...e,attributes:a}}async grantProficiencyFeature(e,t){return e}syncCharacterSpells(e){let t=this.getExpectedFeaturesForCharacter(e).filter(e=>"spell_school"===e.type),a=[];for(let i of t){let t=this.contentRepository.getSpellsBySchool(i.spellSchool.schoolId).filter(t=>t.tier<=e.spellTierAccess);a.push(...t)}let i=e.abilities.filter(e=>"spell"===e.type),s=new Set(i.map(e=>e.id)),r=a.filter(e=>!s.has(e.id));if(r.length>0){let t=[...e.abilities.filter(e=>"spell"!==e.type),...i,...r];return{...e,abilities:t}}return e}async grantSpellSchoolFeature(e,t){return this.syncCharacterSpells(e)}async grantSpellSchoolChoiceFeature(e,t){return e}async grantUtilitySpellsFeature(e,t){let a=[];for(let e of t.schools){let i=this.contentRepository.getUtilitySpellsForSchool(e);t.spellsPerSchool&&t.spellsPerSchool<i.length?a.push(...i.slice(0,t.spellsPerSchool)):a.push(...i)}if(a.length>0){let t=e.abilities||[],i=a.filter(e=>!t.some(t=>"spell"===t.type&&t.id===e.id));return{...e,abilities:[...t,...i]}}return e}async grantSpellTierAccessFeature(e,t){let a=Math.max(e.spellTierAccess,t.maxTier),i={...e,spellTierAccess:a};return this.syncCharacterSpells(i)}async grantResourceFeature(e,t){let{resourceDefinition:a,startingAmount:i}=t;if(e.resources.find(e=>e.definition.id===a.id))return e;let s=ta(a,i,e.resources.length+1),r=[...e.resources,s];return{...e,resources:r}}async grantSubclassChoiceFeature(e,t){return e}async selectSubclass(e,t){let a=await this.characterService.loadCharacter(e);if(!a)throw Error("Character not found");let i=tp(t);if(!i)throw Error("Subclass not found: ".concat(t));if(i.parentClassId!==a.classId)throw Error("Subclass ".concat(t," is not available for class ").concat(a.classId));if(!this.getExpectedFeaturesForCharacter(a).some(e=>"subclass_choice"===e.type&&e.availableSubclasses.includes(t)))throw Error("Character does not have access to subclass ".concat(t," at their current level"));let s={...a,subclassId:t};return await this.characterService.updateCharacter(s),await this.syncCharacterFeatures(),this.characterService.getCurrentCharacter()}getAvailableSubclassChoices(e){return this.getExpectedFeaturesForCharacter(e).filter(e=>"subclass_choice"===e.type)}canChooseSubclass(e){return!e.subclassId&&this.getAvailableSubclassChoices(e).length>0}async syncCharacterFeatures(){let e=this.characterService.character;if(!e)throw Error("No character loaded");let t=this.getMissingFeatures(e),a=[];for(let i of t){let t=await this.grantFeature(e,i,i.level);if(a.push(t),!(e=this.characterService.getCurrentCharacter()))throw Error("Character became null after granting feature")}return a}async applyFeatureEffects(e,t){switch(t.type){case"ability":return await this.grantAbilityFeature(e,t);case"stat_boost":return await this.grantStatBoostFeature(e,t);case"proficiency":return await this.grantProficiencyFeature(e,t);case"spell_school":return await this.grantSpellSchoolFeature(e,t);case"spell_school_choice":return await this.grantSpellSchoolChoiceFeature(e,t);case"utility_spells":return await this.grantUtilitySpellsFeature(e,t);case"spell_tier_access":return await this.grantSpellTierAccessFeature(e,t);case"resource":return await this.grantResourceFeature(e,t);case"subclass_choice":return await this.grantSubclassChoiceFeature(e,t);case"pick_feature_from_pool":return await this.grantPickFeatureFromPoolFeature(e,t);default:return e}}async grantPickFeatureFromPoolFeature(e,t){return e}getFeaturePool(e,t){var a;let i=this.contentRepository.getClassDefinition(e);return null==i||null==(a=i.featurePools)?void 0:a.find(e=>e.id===t)}getAvailablePoolFeatures(e,t){let a=this.getFeaturePool(e.classId,t);if(!a)return[];let i=new Set((e.selectedFeatures||[]).filter(e=>"pool_feature"===e.type).filter(e=>e.poolId===t).map(e=>e.featureId));return a.features.filter(e=>!i.has(e.id))}getAvailablePoolSelections(e){return this.getExpectedFeaturesForCharacter(e).filter(e=>"pick_feature_from_pool"===e.type).filter(t=>this.getRemainingPoolSelections(e,t)>0)}async selectPoolFeature(e,t,a,i){if(!this.getAvailablePoolFeatures(e,t).some(e=>e.id===a.id))throw Error('Feature "'.concat(a.name,'" is not available for selection from pool "').concat(t,'"'));let s={type:"pool_feature",poolId:t,featureId:a.id,feature:a,selectedAt:new Date,grantedByFeatureId:i},r={...e,selectedFeatures:[...e.selectedFeatures||[],s]},n=await this.applyFeatureEffects(r,a);return await this.characterService.updateCharacter(n),n}hasPendingPoolSelections(e){return this.getAvailablePoolSelections(e).length>0}getRemainingPoolSelections(e,t){let a=this.generateFeatureId(e.classId,t.level,t.name),i=(e.selectedFeatures||[]).filter(e=>"pool_feature"===e.type).filter(e=>e.grantedByFeatureId===a).length;return Math.max(0,t.choicesAllowed-i)}constructor(e){this.characterService=e,this.contentRepository=tE.getInstance()}}class tF{getCharacterAncestry(e){return this.contentRepository.getAncestryDefinition(e.ancestry.ancestryId)}getExpectedFeaturesForCharacter(e){let t=this.getCharacterAncestry(e);return t?t.features:[]}getMissingFeatures(e){let t=this.getExpectedFeaturesForCharacter(e),a=new Set(e.ancestry.grantedFeatures);return t.filter((t,i)=>!a.has("".concat(e.ancestry.ancestryId,"-feature-").concat(i)))}async grantAncestryFeatures(e){let t=await this.characterStorage.getCharacter(e);if(!t)return;let a=this.getMissingFeatures(t);for(let e=0;e<a.length;e++){let i=a[e],s="".concat(t.ancestry.ancestryId,"-feature-").concat(t.ancestry.grantedFeatures.length+e);await this.applyAncestryFeature(t,i,s),t.ancestry.grantedFeatures.push(s)}await this.characterStorage.updateCharacter(t)}async applyAncestryFeature(e,t,a){switch(t.type){case"ability":await this.applyAbilityFeature(e,t);break;case"stat_boost":await this.applyStatBoostFeature(e,t);break;case"proficiency":await this.applyProficiencyFeature(e,t)}}async applyAbilityFeature(e,t){let a=t.ability;e.abilities.push(a)}async applyStatBoostFeature(e,t){for(let a of t.statBoosts)e.attributes[a.attribute]+=a.amount}async applyProficiencyFeature(e,t){for(let a of t.proficiencies)if("skill"===a.type&&a.bonus){let t=a.name;e.skills[t]&&(e.skills[t].modifier+=a.bonus)}}createAncestryTrait(e){return{ancestryId:e,grantedFeatures:[]}}getAvailableAncestries(){return this.contentRepository.getAllAncestries()}async addCustomAncestry(e){return this.contentRepository.addCustomAncestry(e)}async removeCustomAncestry(e){return this.contentRepository.removeCustomAncestry(e)}constructor(e,t){this.characterService=e,this.characterStorage=t,this.contentRepository=tE.getInstance()}}class tB{getCharacterBackground(e){return this.contentRepository.getBackgroundDefinition(e.background.backgroundId)}getExpectedFeaturesForCharacter(e){let t=this.getCharacterBackground(e);return t?t.features:[]}getMissingFeatures(e){let t=this.getExpectedFeaturesForCharacter(e),a=new Set(e.background.grantedFeatures);return t.filter((t,i)=>!a.has("".concat(e.background.backgroundId,"-feature-").concat(i)))}async grantBackgroundFeatures(e){let t=await this.characterStorage.getCharacter(e);if(!t)return;let a=this.getMissingFeatures(t);for(let e=0;e<a.length;e++){let i=a[e],s="".concat(t.background.backgroundId,"-feature-").concat(t.background.grantedFeatures.length+e);await this.applyBackgroundFeature(t,i,s),t.background.grantedFeatures.push(s)}await this.characterStorage.updateCharacter(t)}async applyBackgroundFeature(e,t,a){t.type}createBackgroundTrait(e){return{backgroundId:e,grantedFeatures:[]}}getAvailableBackgrounds(){return this.contentRepository.getAllBackgrounds()}async addCustomBackground(e){return this.contentRepository.addCustomBackground(e)}async removeCustomBackground(e){return this.contentRepository.removeCustomBackground(e)}validateBackgroundDefinition(e){return!!(e.id&&e.name&&e.description&&e.features)}constructor(e,t){this.characterService=e,this.characterStorage=t,this.contentRepository=tE.getInstance()}}var tM=a(4879);class tW{static getInstance(){return tW.instance||(tW.instance=new tW),tW.instance}getAllItems(){return[...tb.weapons,...tb.armor,...tb.freeform,...tb.consumables,...tb.ammunition]}getItemsByType(e){switch(e){case"weapon":return tb.weapons;case"armor":return tb.armor;case"freeform":return tb.freeform;case"consumable":return tb.consumables;case"ammunition":return tb.ammunition;default:return[]}}filterItems(e){let t=this.getAllItems();if(e.type&&(t=t.filter(t=>t.item.type===e.type)),e.category&&(t=t.filter(t=>t.category===e.category)),e.rarity&&(t=t.filter(t=>t.rarity===e.rarity)),e.name){let a=e.name.toLowerCase();t=t.filter(e=>e.item.name.toLowerCase().includes(a)||e.item.description&&e.item.description.toLowerCase().includes(a))}return t}findItemById(e){return this.getAllItems().find(t=>t.item.id===e)}createInventoryItem(e){let t=this.findItemById(e);if(!t)return null;let a="".concat(e,"-").concat((0,tM.A)().slice(0,8));return{...t.item,id:a}}getItemsByCategory(){let e=this.getAllItems();return{mundane:e.filter(e=>"mundane"===e.category),magical:e.filter(e=>"magical"===e.category)}}getItemsGrouped(){let e={};return["weapon","armor","freeform","consumable","ammunition"].forEach(t=>{let a=this.getItemsByType(t);e[t]={mundane:a.filter(e=>"mundane"===e.category),magical:a.filter(e=>"magical"===e.category)}}),e}getItemStats(){let e=this.getAllItems(),t={};["weapon","armor","freeform","consumable","ammunition"].forEach(e=>{t[e]=this.getItemsByType(e).length});let a={mundane:e.filter(e=>"mundane"===e.category).length,magical:e.filter(e=>"magical"===e.category).length};return{total:e.length,byType:t,byCategory:a}}constructor(){}}class tY{async createCharacterWithClass(e){let{name:t,ancestryId:a="human",backgroundId:i="folk-hero",classId:s,level:r=1,attributes:n={strength:0,dexterity:0,intelligence:0,will:0}}=e,o=this.contentRepository.getClassDefinition(s);if(!o)throw Error("Class not found: ".concat(s));if(!this.contentRepository.getAncestryDefinition(a))throw Error("Ancestry not found: ".concat(a));if(!this.contentRepository.getBackgroundDefinition(i))throw Error("Background not found: ".concat(i));let l=this.ancestryService.createAncestryTrait(a),c=this.backgroundService.createBackgroundTrait(i),d=e3(),m=e$(o.startingHP),u=e2(r,o.hitDieSize),h=e5(o),p="character-".concat(Date.now()),y=await this.characterStorage.createCharacter({name:t,ancestry:l,background:c,level:r,classId:s,grantedFeatures:[],selectedFeatures:[],spellTierAccess:0,proficiencies:h,attributes:n,saveAdvantages:{...o.saveAdvantages},hitPoints:m,hitDice:u,wounds:e4(d.maxWounds),resources:[],config:d,initiative:e0(),actionTracker:e1(),inEncounter:!1,skills:eZ(),inventory:eQ(n.strength),abilities:[]},p);return this.characterService.notifyCharacterCreated(y),y}async createCompleteCharacter(e){let{name:t,ancestryId:a,backgroundId:i,classId:s,attributes:r,skillAllocations:n,selectedFeatures:o,selectedEquipment:l}=e,c=this.contentRepository.getClassDefinition(s);if(!c)throw Error("Class not found: ".concat(s));if(!this.contentRepository.getAncestryDefinition(a))throw Error("Ancestry not found: ".concat(a));if(!this.contentRepository.getBackgroundDefinition(i))throw Error("Background not found: ".concat(i));let d=this.ancestryService.createAncestryTrait(a),m=this.backgroundService.createBackgroundTrait(i),u=e3(),h=e$(c.startingHP),p=e2(1,c.hitDieSize),y=e5(c),f=eZ();Object.entries(n).forEach(e=>{let[t,a]=e,i=f[t];i&&(f[t]={...i,modifier:a})});let g=eQ(r.strength);l.length>0&&(g.items=l.map(e=>this.itemService.createInventoryItem(e)).filter(e=>null!==e));let x="character-".concat(Date.now()),v=await this.characterStorage.createCharacter({name:t,ancestry:d,background:m,level:1,classId:s,grantedFeatures:[],selectedFeatures:o,spellTierAccess:0,proficiencies:y,attributes:r,saveAdvantages:{...c.saveAdvantages},hitPoints:h,hitDice:p,wounds:e4(u.maxWounds),resources:[],config:u,initiative:e0(),actionTracker:e1(),inEncounter:!1,skills:f,inventory:g,abilities:[]},x);return await this.characterService.loadCharacter(v.id),await this.ancestryService.grantAncestryFeatures(v.id),await this.backgroundService.grantBackgroundFeatures(v.id),this.characterService.getCurrentCharacter()||v}async createSampleCharacter(e,t){let a=this.contentRepository.getClassDefinition(t),i={strength:1,dexterity:1,intelligence:1,will:1};if(a){let[e,t]=a.keyAttributes;i={strength:"strength"===e||"strength"===t?3:1,dexterity:"dexterity"===e||"dexterity"===t?3:1,intelligence:"intelligence"===e||"intelligence"===t?3:1,will:"will"===e||"will"===t?3:1}}return this.createCharacterWithClass({name:e,classId:t,level:1,attributes:i})}async applyStartingEquipment(e,t){let a=await this.characterStorage.getCharacter(e);if(!a)throw Error("Character not found: ".concat(e));let i=t.map(e=>{let t=this.itemService.createInventoryItem(e);return t||(console.warn("Failed to create inventory item for repository ID: ".concat(e)),null)}).filter(e=>null!==e),s={...a.inventory,items:[...a.inventory.items,...i]},r={...a,inventory:s};await this.characterStorage.updateCharacter(r)}getClassStartingEquipment(e){let t=this.contentRepository.getClassDefinition(e);return(null==t?void 0:t.startingEquipment)||[]}constructor(e,t,a,i){this.characterStorage=e,this.characterService=t,this.ancestryService=a,this.backgroundService=i,this.contentRepository=tE.getInstance(),this.itemService=tW.getInstance()}}function tz(e){let t=e.match(/^(\d+)?d(\d+)$/i);if(!t)return null;let a=t[1]?parseInt(t[1]):1,i=parseInt(t[2]);return[4,6,8,10,12,20,100].includes(i)?{count:a,sides:i}:null}class tO{rollSingleDie(e){return Math.floor(Math.random()*e)+1}rollMultipleDice(e,t){let a=[];for(let i=0;i<e;i++)a.push({type:t,result:this.rollSingleDie(t)});return a}applyAdvantageDisadvantage(e,t){if(0===t)return{finalDice:e,droppedDice:[]};let a=[...e].sort((e,t)=>e.result-t.result);if(t>0){let i=Math.min(t,e.length-1),s=a.slice(0,i);return{finalDice:a.slice(i),droppedDice:s}}{let i=Math.min(Math.abs(t),e.length-1),s=a.slice(-i);return{finalDice:a.slice(0,-i),droppedDice:s}}}rollDiceWithCriticals(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e+Math.abs(a),s=[];for(let e=0;e<i;e++)s.push({type:t,result:this.rollSingleDie(t)});let{finalDice:r,droppedDice:n}=this.applyAdvantageDisadvantage(s,a),o=0;if(r.length>0&&r[0].result===t){r[0].isCritical=!0,o++;let e=0;for(;e<C.L.dice.maxCriticalHitsInRow;){let a={type:t,result:this.rollSingleDie(t)};if(r.push(a),a.result===t)a.isCritical=!0,o++,e++;else break}}return{dice:r,droppedDice:n,criticalHits:o}}rollBasicDice(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e+Math.abs(a),s=[];for(let e=0;e<i;e++)s.push({type:t,result:this.rollSingleDie(t)});let{finalDice:r,droppedDice:n}=this.applyAdvantageDisadvantage(s,a);return{dice:r,droppedDice:n}}rollAttributeCheck(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{dice:a,droppedDice:i}=this.rollBasicDice(1,20,t),s=a.reduce((e,t)=>e+t.result,0);return{dice:a,droppedDice:i,total:s+e,criticalHits:0,isMiss:!1}}rollAttack(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=tz(e);if(!i)throw Error("Invalid dice expression: ".concat(e));let{dice:s,droppedDice:r,criticalHits:n}=this.rollDiceWithCriticals(i.count,i.sides,a),o=s.reduce((e,t)=>e+t.result,0),l=C.L.combat.missOnFirstDieOne&&s.length>0&&1===s[0].result;return{dice:s,droppedDice:r,total:l?0:o+t,criticalHits:n,isMiss:l}}}let tU=new tO;class tH{async getSettings(){let e=localStorage.getItem(this.storageKey);if(!e)return this.getDefaultSettings();try{return JSON.parse(e)}catch(e){return this.getDefaultSettings()}}async saveSettings(e){localStorage.setItem(this.storageKey,JSON.stringify(e))}async updateMode(e){let t=await this.getSettings();await this.saveSettings({...t,mode:e})}async updateActiveCharacter(e){let t=await this.getSettings();await this.saveSettings({...t,activeCharacterId:e})}getDefaultSettings(){return{mode:"full",activeCharacterId:"default-character"}}constructor(){this.storageKey="nimble-navigator-settings"}}let tq=new tH;class tG{static initialize(){this.initialized||(b.register(v.CHARACTER_STORAGE,()=>e8,!0),b.register(v.ACTIVITY_LOG,()=>e7.P,!0),b.register(v.ABILITY_SERVICE,()=>te,!0),b.register(v.DICE_SERVICE,()=>tU,!0),b.register(v.SETTINGS_SERVICE,()=>tq,!0),b.register(v.CHARACTER_SERVICE,e=>new tt(e.get(v.CHARACTER_STORAGE),e.get(v.ACTIVITY_LOG),e.get(v.ABILITY_SERVICE)),!0),b.register(v.CLASS_SERVICE,e=>new tP(e.get(v.CHARACTER_SERVICE)),!0),b.register(v.ANCESTRY_SERVICE,e=>new tF(e.get(v.CHARACTER_SERVICE),e.get(v.CHARACTER_STORAGE)),!0),b.register(v.BACKGROUND_SERVICE,e=>new tB(e.get(v.CHARACTER_SERVICE),e.get(v.CHARACTER_STORAGE)),!0),b.register(v.CHARACTER_CREATION,e=>new tY(e.get(v.CHARACTER_STORAGE),e.get(v.CHARACTER_SERVICE),e.get(v.ANCESTRY_SERVICE),e.get(v.BACKGROUND_SERVICE)),!0),this.initialized=!0)}static getService(e){return this.initialize(),b.get(e)}static reset(){b.clearSingletons(),this.initialized=!1}}tG.initialized=!1;let tV=()=>tG.getService(v.CHARACTER_SERVICE),tK=()=>tG.getService(v.ACTIVITY_LOG),tJ=()=>tG.getService(v.CLASS_SERVICE),tX=()=>tG.getService(v.ANCESTRY_SERVICE),tZ=()=>tG.getService(v.BACKGROUND_SERVICE),tQ=()=>tG.getService(v.CHARACTER_CREATION),t$=()=>tG.getService(v.DICE_SERVICE),t0=()=>tG.getService(v.SETTINGS_SERVICE),t1=()=>tE.getInstance(),t2=()=>tW.getInstance();class t4{get toasts(){return this._toasts}subscribeToToasts(e){return this.toastListeners.push(e),e(this._toasts),()=>{this.toastListeners=this.toastListeners.filter(t=>t!==e)}}notifyListeners(){this.toastListeners.forEach(e=>e(this._toasts))}removeToast(e){this._toasts=this._toasts.filter(t=>t.id!==e),this.notifyListeners()}addToast(e){var t;let a=Math.random().toString(36).substr(2,9),i={...e,id:a};this._toasts=[...this._toasts,i],this.notifyListeners();let s=null!=(t=e.duration)?t:5e3;s>0&&setTimeout(()=>{this.removeToast(a)},s)}showError(e,t){this.addToast({type:"error",title:e,description:t})}showSuccess(e,t){this.addToast({type:"success",title:e,description:t})}showWarning(e,t){this.addToast({type:"warning",title:e,description:t})}showInfo(e,t){this.addToast({type:"info",title:e,description:t})}clearAllToasts(){this._toasts=[],this.notifyListeners()}constructor(){this._toasts=[],this.toastListeners=[]}}let t3=new t4;function t5(){let[e,t]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let e=t3.subscribeToToasts(e=>{t(e)});return t(t3.toasts),e},[]),{toasts:e,addToast:t3.addToast.bind(t3),removeToast:t3.removeToast.bind(t3),showError:t3.showError.bind(t3),showSuccess:t3.showSuccess.bind(t3),showWarning:t3.showWarning.bind(t3),showInfo:t3.showInfo.bind(t3),clearAllToasts:t3.clearAllToasts.bind(t3)}}function t6(){let[e,t]=(0,s.useState)(null),{showError:a,showSuccess:i}=t5();(0,s.useEffect)(()=>{let e=tV(),a=e.subscribeToEvent("updated",e=>{t(e.character||null)}),i=e.subscribeToEvent("switched",e=>{t(e.character||null)}),s=e.subscribeToEvent("created",e=>{t(e.character||null)});return t(e.getCurrentCharacter()),()=>{a(),i(),s()}},[]);let r=tV(),n=(0,s.useCallback)(async e=>{try{return await r.loadCharacter(e)}catch(e){throw console.error("Failed to switch character:",e),a("Failed to switch character","Unable to load the selected character. Please try again."),e}},[r,a]);return{character:e,switchCharacter:n,deleteCharacter:(0,s.useCallback)(async e=>{try{await r.deleteCharacterById(e),i("Character deleted","Character has been deleted successfully.")}catch(e){throw console.error("Failed to delete character:",e),a("Failed to delete character","Unable to delete the character. Please try again."),e}},[r,a,i]),subscribeToEvent:(0,s.useCallback)((e,t)=>r.subscribeToEvent(e,t),[r]),updateCharacter:r.updateCharacter.bind(r),applyDamage:r.applyDamage.bind(r),applyHealing:r.applyHealing.bind(r),applyTemporaryHP:r.applyTemporaryHP.bind(r),updateActionTracker:r.updateActionTracker.bind(r),updateAbilities:r.updateAbilities.bind(r),startEncounter:r.startEncounter.bind(r),endEncounter:r.endEncounter.bind(r),endTurn:r.endTurn.bind(r),performSafeRest:r.performSafeRest.bind(r),performCatchBreath:r.performCatchBreath.bind(r),performMakeCamp:r.performMakeCamp.bind(r),performAttack:r.performAttack.bind(r),performUseAbility:r.performUseAbility.bind(r),updateCharacterConfiguration:r.updateCharacterConfiguration.bind(r)}}let t8=[{id:"combat",label:"Combat",icon:u.A},{id:"spells",label:"Spells",icon:h.A},{id:"skills",label:"Skills",icon:p.A},{id:"character",label:"Character",icon:y.A},{id:"equipment",label:"Equipment",icon:f.A},{id:"log",label:"Log",icon:g.A}];function t7(e){let{activeTab:t,onTabChange:a}=e,{character:s}=t6(),r=t8.filter(e=>"spells"!==e.id||!!s&&s.abilities.some(e=>"spell"===e.type));return(0,i.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[(0,i.jsx)("div",{className:"w-full px-2 sm:px-4",children:(0,i.jsx)("div",{className:"flex justify-around items-center h-16 max-w-(--breakpoint-sm) mx-auto",children:r.map(e=>{let s=e.icon,r=t===e.id;return(0,i.jsxs)(m,{variant:"ghost",size:"sm",onClick:()=>a(e.id),className:"flex flex-col items-center gap-1 h-12 px-1 sm:px-2 min-w-0 flex-1 max-w-20 ".concat(r?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground"),children:[(0,i.jsx)(s,{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0"}),(0,i.jsx)("span",{className:"text-xs font-medium leading-tight truncate",children:e.label})]},e.id)})})}),(0,i.jsx)("div",{className:"border-t bg-muted/30 py-2 px-4 z-40",children:(0,i.jsx)("div",{className:"container mx-auto",children:(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Nimble Navigator is an independent product published under the Nimble 3rd Party Creator License and is not affiliated with Nimble Co. Nimble \xa9 2025 Nimble Co."})})})]})}let t9=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("rounded-xl border bg-card text-card-foreground shadow",a),...s})});t9.displayName="Card";let ae=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("flex flex-col space-y-1.5 p-6",a),...s})});ae.displayName="CardHeader";let at=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("font-semibold leading-none tracking-tight",a),...s})});at.displayName="CardTitle";let aa=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("text-sm text-muted-foreground",a),...s})});aa.displayName="CardDescription";let ai=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("p-6 pt-0",a),...s})});ai.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";var as=a(7520);let ar=as.Kq,an=as.bL,ao=as.l9,al=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...r}=e;return(0,i.jsx)(as.ZL,{children:(0,i.jsx)(as.UC,{ref:t,sideOffset:s,className:c("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-tooltip-content-transform-origin)",a),...r})})});al.displayName=as.UC.displayName;var ac=a(4868),ad=a(2619),am=a(5870),au=a(7125),ah=a(6191),ap=a(9051),ay=a(8314),af=a(908),ag=a(3457),ax=a(4943),av=a(9e3);function ab(){let[e,t]=(0,s.useState)([]),a=(0,s.useMemo)(()=>tK(),[]);return(0,s.useEffect)(()=>{let e=async()=>{try{let e=await a.getLogEntries();t(e)}catch(e){console.error("Failed to refresh log entries:",e)}};e();let i=setInterval(e,1e3);return()=>clearInterval(i)},[a]),{logEntries:e,addLogEntry:async e=>{try{await a.addLogEntry(e),t(t=>[e,...t.slice(0,99)])}catch(e){console.error("Failed to add log entry:",e)}},handleClearRolls:async()=>{try{await a.clearLogEntries(),t([])}catch(e){console.error("Failed to clear log entries:",e)}}}}function aw(){let e=t$(),t=tK(),{addLogEntry:a}=ab(),i=(0,s.useCallback)(async(i,s,r)=>{try{let n=i.charAt(0).toUpperCase()+i.slice(1),o=e.rollAttributeCheck(s,r),l=t.createDiceRollEntry(o.dice,o.droppedDice,s,o.total,"".concat(n," check"),r);await a(l)}catch(e){console.error("Failed to roll dice:",e)}},[e,t,a]),r=(0,s.useCallback)(async(i,s,r)=>{try{let n=i.charAt(0).toUpperCase()+i.slice(1),o=e.rollAttributeCheck(s,r),l=t.createDiceRollEntry(o.dice,o.droppedDice,s,o.total,"".concat(n," save"),r);await a(l)}catch(e){console.error("Failed to roll dice:",e)}},[e,t,a]),n=(0,s.useCallback)(async(i,s,r,n)=>{try{let o=s+r,l=e.rollAttributeCheck(o,n),c=t.createDiceRollEntry(l.dice,l.droppedDice,o,l.total,"".concat(i," skill check"),n);await a(c)}catch(e){console.error("Failed to roll dice:",e)}},[e,t,a]);return{rollAttribute:i,rollSave:r,rollSkill:n,rollInitiative:(0,s.useCallback)(async(i,s)=>{try{let r=e.rollAttributeCheck(i,s),n=Math.max(1,r.total),o=t.createInitiativeEntry(r.total,n);return await a(o),{rollTotal:r.total,actionsGranted:n}}catch(e){return console.error("Failed to roll initiative:",e),{rollTotal:1,actionsGranted:1}}},[e,t,a]),attack:(0,s.useCallback)(async(i,s,r,n)=>{try{let o=e.rollAttack(s,r,n),l=t.createDiceRollEntry(o.dice,o.droppedDice,r,o.total,"".concat(i," attack"),n,o.isMiss,o.criticalHits);await a(l)}catch(e){console.error("Failed to roll attack:",e)}},[e,t,a])}}class aj{get uiState(){return this._uiState}subscribeToUIState(e){return this.uiStateListeners.push(e),this._uiState&&e(this._uiState),()=>{this.uiStateListeners=this.uiStateListeners.filter(t=>t!==e)}}notifyListeners(){this._uiState&&this.uiStateListeners.forEach(e=>e(this._uiState))}async getUIState(){if(this._uiState)return this._uiState;let e=localStorage.getItem(this.storageKey);if(e)try{let t=JSON.parse(e);this._uiState=this.migrateUIState(t)}catch(e){this._uiState=this.getDefaultUIState()}else this._uiState=this.getDefaultUIState();return this._uiState}async saveUIState(e){this._uiState=e,localStorage.setItem(this.storageKey,JSON.stringify(e)),this.notifyListeners()}async updateCollapsibleState(e,t){let a=await this.getUIState(),i={...a,collapsibleSections:{...a.collapsibleSections,[e]:t}};await this.saveUIState(i)}async updateAdvantageLevel(e){let t={...await this.getUIState(),advantageLevel:e};await this.saveUIState(t)}async updateActiveTab(e){let t={...await this.getUIState(),activeTab:e};await this.saveUIState(t)}migrateUIState(e){var t,a,i,s,r,n,o,l,c,d,m,u,h,p,y;let f=e.collapsibleSections||{};return{collapsibleSections:{classInfo:null==(t=f.classInfo)||t,classFeatures:null==(a=f.classFeatures)||a,hitDice:null==(i=f.hitDice)||i,wounds:null==(s=f.wounds)||s,initiative:null==(r=f.initiative)||r,actionTracker:null==(n=f.actionTracker)||n,resources:null==(o=f.resources)||o,attributes:null==(l=f.attributes)||l,skills:null==(c=f.skills)||c,actions:null==(d=f.actions)||d,armor:null==(m=f.armor)||m,abilities:null==(u=f.abilities)||u,inventory:null==(h=f.inventory)||h},advantageLevel:null!=(p=e.advantageLevel)?p:0,activeTab:null!=(y=e.activeTab)?y:"combat"}}getDefaultUIState(){return{collapsibleSections:{classInfo:!0,classFeatures:!0,hitDice:!0,wounds:!0,initiative:!0,actionTracker:!0,resources:!0,attributes:!0,skills:!0,actions:!0,armor:!0,abilities:!0,inventory:!0},advantageLevel:0,activeTab:"combat"}}constructor(){this.storageKey="nimble-navigator-ui-state",this._uiState=null,this.uiStateListeners=[]}}let aN=new aj;function ak(){let[e,t]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=aN.subscribeToUIState(e=>{t(e)});return(async()=>{t(await aN.getUIState())})(),e},[]),{uiState:e||{collapsibleSections:{classInfo:!0,classFeatures:!0,hitPoints:!0,hitDice:!0,wounds:!0,resources:!0,initiative:!0,actionTracker:!0,attributes:!0,skills:!0,actions:!0,armor:!0,abilities:!0,inventory:!0},advantageLevel:0,activeTab:"combat"},updateCollapsibleState:aN.updateCollapsibleState.bind(aN),updateAdvantageLevel:aN.updateAdvantageLevel.bind(aN),updateActiveTab:aN.updateActiveTab.bind(aN)}}let aS=[{id:"blue-magic",name:"Mystic Blue",description:"Classic magical energy (mana, spell slots)",colors:{full:"#3b82f6",high:"#60a5fa",medium:"#93c5fd",low:"#dbeafe",empty:"#f3f4f6"}},{id:"red-fury",name:"Burning Fury",description:"Rage, fury, combat energy",colors:{full:"#dc2626",high:"#ef4444",medium:"#f87171",low:"#fca5a5",empty:"#f3f4f6"}},{id:"green-nature",name:"Natural Vigor",description:"Nature magic, healing, vitality",colors:{full:"#16a34a",high:"#22c55e",medium:"#4ade80",low:"#86efac",empty:"#f3f4f6"}},{id:"purple-arcane",name:"Arcane Purple",description:"Arcane magic, psychic energy",colors:{full:"#9333ea",high:"#a855f7",medium:"#c084fc",low:"#d8b4fe",empty:"#f3f4f6"}},{id:"orange-ki",name:"Burning Ki",description:"Ki, chi, inner energy",colors:{full:"#ea580c",high:"#f97316",medium:"#fb923c",low:"#fdba74",empty:"#f3f4f6"}},{id:"yellow-divine",name:"Divine Light",description:"Divine magic, holy power",colors:{full:"#ca8a04",high:"#eab308",medium:"#facc15",low:"#fde047",empty:"#f3f4f6"}},{id:"teal-focus",name:"Focused Mind",description:"Concentration, focus, mental energy",colors:{full:"#0d9488",high:"#14b8a6",medium:"#2dd4bf",low:"#7dd3fc",empty:"#f3f4f6"}},{id:"gray-stamina",name:"Physical Stamina",description:"Stamina, endurance, physical resources",colors:{full:"#4b5563",high:"#6b7280",medium:"#9ca3af",low:"#d1d5db",empty:"#f3f4f6"}}],aC=[{id:"sparkles",name:"Sparkles",icon:"",category:"magic"},{id:"crystal",name:"Crystal",icon:"\uD83D\uDC8E",category:"magic"},{id:"wand",name:"Magic Wand",icon:"\uD83E\uDE84",category:"magic"},{id:"orb",name:"Crystal Ball",icon:"\uD83D\uDD2E",category:"magic"},{id:"star",name:"Star",icon:"",category:"magic"},{id:"comet",name:"Comet",icon:"",category:"magic"},{id:"fire",name:"Fire",icon:"\uD83D\uDD25",category:"energy"},{id:"lightning",name:"Lightning",icon:"",category:"energy"},{id:"zap",name:"High Voltage",icon:"",category:"energy"},{id:"battery",name:"Battery",icon:"\uD83D\uDD0B",category:"energy"},{id:"sun",name:"Sun",icon:"",category:"energy"},{id:"flame",name:"Flame",icon:"\uD83D\uDD25",category:"energy"},{id:"muscle",name:"Flexed Biceps",icon:"\uD83D\uDCAA",category:"physical"},{id:"heart",name:"Heart",icon:"",category:"physical"},{id:"droplet",name:"Droplet",icon:"\uD83D\uDCA7",category:"physical"},{id:"shield",name:"Shield",icon:"\uD83D\uDEE1",category:"physical"},{id:"sword",name:"Crossed Swords",icon:"",category:"physical"},{id:"eye",name:"Eye",icon:"\uD83D\uDC41",category:"special"},{id:"brain",name:"Brain",icon:"\uD83E\uDDE0",category:"special"},{id:"leaf",name:"Leaf",icon:"\uD83C\uDF43",category:"special"},{id:"snowflake",name:"Snowflake",icon:"",category:"special"},{id:"potion",name:"Potion",icon:"\uD83E\uDDEA",category:"special"},{id:"hourglass",name:"Hourglass",icon:"",category:"special"}],aA=e=>aS.find(t=>t.id===e),a_=e=>aC.find(t=>t.id===e),aI=(e,t)=>{let a=aA(e);return a?t<=0?a.colors.empty:t<=25?a.colors.low:t<=50?a.colors.medium:t<=75?a.colors.high:a.colors.full:"#6b7280"};function aT(){let{character:e}=t6();if(!e)return null;let{current:t,max:a,temporary:s}=e.hitPoints,r=t/a*100,n=a+s,o=n>0?t/n*100:0,l=n>0?s/n*100:0;return(0,i.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,i.jsxs)("span",{className:"font-medium",children:[t,"/",a," HP",s>0&&(0,i.jsxs)("span",{className:"text-blue-600 ml-1",children:["(+",s,")"]})]}),(0,i.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round(r),"%"]})]}),(0,i.jsxs)("div",{className:"w-full bg-gray-200 rounded-full h-3 relative overflow-hidden",children:[(0,i.jsx)("div",{className:"h-3 transition-all duration-300 ".concat(r<=25?"bg-red-500":r<=50?"bg-yellow-500":"bg-green-500"," absolute left-0 top-0 ").concat(s>0?"rounded-l-full":"rounded-full"),style:{width:"".concat(o,"%")}}),s>0&&(0,i.jsx)("div",{className:"h-3 bg-blue-500 transition-all duration-300 absolute top-0 rounded-r-full",style:{left:"".concat(o,"%"),width:"".concat(l,"%")}})]})]})}function aR(){let{character:e}=t6();if(!e)return null;let{wounds:t}=e;if(!(t.max<=8))return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Wounds:"}),(0,i.jsxs)("span",{className:"text-sm font-medium text-gray-600",children:[t.current,"/",t.max]})]});let a=[];for(let e=0;e<t.max;e++){let s=e===t.max-1,r=e<t.current,n=s?ac.A:ad.A;a.push((0,i.jsx)(n,{className:"w-3 h-3 ".concat(r?"text-red-500":"text-gray-300")},e))}return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Wounds:"}),(0,i.jsx)("div",{className:"flex items-center gap-0.5",children:a})]})}function aD(){let{character:e,applyDamage:t,applyHealing:a,applyTemporaryHP:r}=t6(),[n,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)("1");if(!e)return null;let{current:d,max:u}=e.hitPoints,h=e=>{t(e)},p=e=>{a(e)};return(0,i.jsxs)("div",{className:"space-y-3 mb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>h(1),disabled:d<=0,className:"text-xs h-7",children:"-1"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>h(5),disabled:d<=0,className:"text-xs h-7",children:"-5"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>h(10),disabled:d<=0,className:"text-xs h-7",children:"-10"}),(0,i.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>p(1),disabled:d>=u,className:"text-green-600 border-green-600 hover:bg-green-50 text-xs h-7",children:"+1"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>p(5),disabled:d>=u,className:"text-green-600 border-green-600 hover:bg-green-50 text-xs h-7",children:"+5"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>p(10),disabled:d>=u,className:"text-green-600 border-green-600 hover:bg-green-50 text-xs h-7",children:"+10"}),(0,i.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,i.jsxs)(m,{variant:"outline",size:"sm",onClick:()=>o(!n),className:"text-xs h-7",children:[(0,i.jsx)(am.A,{className:"w-3 h-3 mr-1"}),"Custom"]})]}),n&&(0,i.jsx)("div",{className:"mt-3 p-3 border border-gray-200 rounded-lg bg-gray-50",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Custom Amount"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("input",{type:"number",min:"1",value:l,onChange:e=>c(e.target.value),className:"flex-1 px-3 py-1 border border-gray-300 rounded text-sm",placeholder:"Amount"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>{t(parseInt(l)||0),o(!1)},disabled:d<=0,title:"Apply Damage",children:(0,i.jsx)(au.A,{className:"w-4 h-4"})}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>{a(parseInt(l)||0),o(!1)},disabled:d>=u,className:"text-green-600 border-green-600 hover:bg-green-50",title:"Apply Healing",children:(0,i.jsx)(ah.A,{className:"w-4 h-4"})}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>{r(parseInt(l)||0),o(!1)},className:"text-blue-600 border-blue-600 hover:bg-blue-50",title:"Add Temporary HP",children:(0,i.jsx)(ah.A,{className:"w-4 h-4"})})]})]})})]})}function aL(){let{character:e,updateActionTracker:t,endTurn:a}=t6();if(!e||!e.inEncounter)return null;let{actionTracker:s}=e,r=()=>{s.current>0&&t({...s,current:s.current-1})};return(0,i.jsx)(t9,{className:"border border-gray-200",children:(0,i.jsx)(ai,{className:"p-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Actions:"}),(0,i.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let e=[],t=s.base+s.bonus;for(let a=0;a<t;a++){let t=a>=s.base,n=a<s.current;e.push((0,i.jsx)(m,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 rounded-full ".concat(n?t?"bg-blue-500 hover:bg-blue-600 text-white":"bg-green-500 hover:bg-green-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-500"),onClick:n?r:void 0,disabled:!n,title:"".concat(t?"Bonus":"Base"," Action ").concat(n?"(Click to use)":"(Used)"),children:(0,i.jsx)(ap.A,{className:"w-4 h-4",fill:"currentColor"})},a))}return e})()})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m,{onClick:()=>{t({...s,bonus:s.bonus+1,current:s.current+1})},variant:"outline",size:"sm",className:"text-xs h-7",title:"Grant additional action",children:(0,i.jsx)(ah.A,{className:"w-3 h-3"})}),(0,i.jsxs)(m,{onClick:()=>{a()},variant:"default",size:"sm",className:"text-xs h-7",children:[(0,i.jsx)(ay.A,{className:"w-3 h-3 mr-1"}),"End Turn"]}),(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",children:(0,i.jsx)(af.A,{className:"w-4 h-4"})})}),(0,i.jsx)(al,{children:(0,i.jsxs)("div",{className:"text-xs",children:[(0,i.jsx)("p",{children:(0,i.jsx)("strong",{children:"Initiative Rules:"})}),(0,i.jsx)("p",{children:"<10: 1 action  10-20: 2 actions  >20: 3 actions"}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-green-600",children:"Green"})," = base actions, ",(0,i.jsx)("span",{className:"text-blue-600",children:"Blue"})," = bonus actions"]}),(0,i.jsx)("p",{children:"Click actions to use them"})]})})]})]})]})})})}function aE(){let{character:e}=t6();return e&&0!==e.resources.length?(0,i.jsx)(t9,{className:"border border-gray-200",children:(0,i.jsxs)(ai,{className:"p-3",children:[(0,i.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-4 h-4 text-blue-500"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Resources"})]})}),(0,i.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:e.resources.map(e=>{let t=e.definition.maxValue>0?e.current/e.definition.maxValue*100:0,a=aI(e.definition.colorScheme,t);return(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[((e,t,a)=>{let s=t>0?e/t:0,r=2*Math.PI*16;return(0,i.jsxs)("div",{className:"relative w-10 h-10",children:[(0,i.jsxs)("svg",{className:"w-10 h-10 transform -rotate-90",viewBox:"0 0 40 40",children:[(0,i.jsx)("circle",{cx:"20",cy:"20",r:"16",stroke:"#e5e7eb",strokeWidth:"3",fill:"transparent"}),(0,i.jsx)("circle",{cx:"20",cy:"20",r:"16",stroke:a,strokeWidth:"3",fill:"transparent",strokeDasharray:r,strokeDashoffset:r*(1-s),strokeLinecap:"round",className:"transition-all duration-500 ease-in-out"})]}),(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-xs font-medium text-gray-700",children:e})})]})})(e.current,e.definition.maxValue,a),(0,i.jsxs)("div",{className:"mt-1 text-center",children:[(0,i.jsx)("div",{className:"text-xs font-medium text-gray-700 leading-tight",children:e.definition.name}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:[e.current,"/",e.definition.maxValue]})]})]},e.definition.id)})})]})}):null}function aP(){let{character:e,endEncounter:t,startEncounter:a}=t6(),{rollInitiative:s}=aw(),{uiState:r}=ak();if(!e)return null;let{inEncounter:n,initiative:o,attributes:l}=e,c=l.dexterity+o.modifier,d=async()=>{let e=await s(c,r.advantageLevel);await a(e.rollTotal)},u=n?{text:"In Combat",color:"text-red-600"}:{text:"Ready",color:"text-green-600"};return(0,i.jsx)(t9,{className:"border-2 border-gray-200",children:(0,i.jsxs)(ai,{className:"p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(ag.A,{className:"w-4 h-4 text-red-500"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Combat Summary"})]}),(0,i.jsx)("span",{className:"text-sm font-medium ".concat(u.color),children:u.text})]}),(0,i.jsx)(aT,{}),(0,i.jsx)(aD,{}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(aR,{}),(0,i.jsx)("div",{className:"flex items-center gap-3",children:n?(0,i.jsxs)(m,{variant:"destructive",size:"sm",onClick:t,className:"text-xs",children:[(0,i.jsx)(av.A,{className:"w-3 h-3 mr-1"}),"End Combat"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:["Initiative: ",c>0?"+":"",c]}),(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:d,className:"h-8 w-8 p-0",children:(0,i.jsx)(ax.A,{className:"w-4 h-4"})})}),(0,i.jsx)(al,{children:(0,i.jsxs)("p",{children:["Roll Initiative: d20",c>0?"+"+c:c]})})]})]})})]})]})})}function aF(){let{character:e}=t6();return e?(0,i.jsx)(ar,{children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)(aP,{}),(0,i.jsx)(aE,{}),(0,i.jsx)(aL,{})]})}):null}var aB=a(7259);let aM=aB.bL,aW=aB.R6,aY=aB.Ke;var az=a(4033),aO=a(7937),aU=a(7910);function aH(e,t){let a=0;switch(t){case"advantage":a=1;break;case"disadvantage":a=-1;break;default:a=0}return e+a}function aq(){let{character:e,updateCharacter:t}=t6(),{uiState:a,updateCollapsibleState:r}=ak(),{rollSave:n}=aw(),o=a.collapsibleSections.attributes,l=a.advantageLevel;(0,s.useCallback)(async(a,i)=>{if(!e)return;let s={...e,saveAdvantages:{...e.saveAdvantages,[a]:i}};await t(s)},[e,t]);let c=(0,s.useCallback)(t=>{var a;if(!e)return;let i=e.attributes[t],s=aH(l,(null==(a=e.saveAdvantages)?void 0:a[t])||"normal");n(t,i,s)},[e,n,l]),d=e=>e>=0?"+".concat(e):"".concat(e);return e?(0,i.jsx)(ar,{children:(0,i.jsx)(aM,{open:o,onOpenChange:e=>r("attributes",e),children:(0,i.jsxs)(t9,{children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(ae,{className:"cursor-pointer py-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-base",children:"Saving Throws"}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:o?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})})]})})}),(0,i.jsx)(aY,{children:(0,i.jsx)(ai,{className:"pt-0",children:(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{name:"strength",label:"Str"},{name:"dexterity",label:"Dex"},{name:"intelligence",label:"Int"},{name:"will",label:"Will"}].map(t=>{var a;let{name:s,label:r}=t,n=e.attributes[s],o=(null==(a=e.saveAdvantages)?void 0:a[s])||"normal",u=aH(l,o);return(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 rounded border",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium min-w-8",children:r}),(0,i.jsx)("span",{className:"text-sm font-mono",children:d(n)}),"normal"!==o&&(0,i.jsx)("span",{className:"text-xs ".concat((e=>{switch(e){case"advantage":return"text-green-600";case"disadvantage":return"text-red-600";default:return"text-muted-foreground"}})(o)),children:(e=>{switch(e){case"advantage":return"";case"disadvantage":return"";default:return""}})(o)})]}),(0,i.jsx)("div",{className:"flex items-center gap-1",children:(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>c(s),className:"h-7 w-7 p-0",children:(0,i.jsx)(aU.A,{className:"h-3 w-3"})})}),(0,i.jsxs)(al,{children:[(0,i.jsxs)("p",{children:[r," saving throw (",d(n),")"]}),0!==u&&(0,i.jsx)("p",{className:"text-xs",children:u>0?"With advantage":"With disadvantage"})]})]})})]},s)})})})})]})})}):null}function aG(e){return e.filter(e=>"weapon"===e.type&&!0===e.equipped)}function aV(e){return e.find(e=>"armor"===e.type&&!0===e.equipped&&!0===e.isMainArmor)||null}function aK(e){return aG(e).reduce((e,t)=>e+t.size,0)}var aJ=a(6154);let aX=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function aZ(e){let{className:t,variant:a,...s}=e;return(0,i.jsx)("div",{className:c(aX({variant:a}),t),...s})}function aQ(e){let{character:t,onAttack:a,advantageLevel:s}=e,{performAttack:r,performUseAbility:n}=t6(),o=aG(t.inventory.items),l=t.abilities.filter(e=>"action"===e.type),c=e=>e?t.attributes[e]:0,d=async e=>{if(!e.damage)return;if(t.inEncounter&&t.actionTracker.current<1)return void console.error("Not enough actions to attack (need 1, have "+t.actionTracker.current+")");let a=c(e.attribute);await r(e.name,e.damage,a,s)},h=async e=>{if("at_will"!==e.frequency&&(void 0===e.currentUses||e.currentUses<=0))return;let a=e.actionCost||0;if(t.inEncounter&&a>0&&t.actionTracker.current<a)return void console.error("Not enough actions to use ability (need ".concat(a,", have ").concat(t.actionTracker.current,")"));try{await n(e.id)}catch(e){console.error("Failed to use ability:",e)}};return 0===o.length&&0===l.length?(0,i.jsx)(t9,{children:(0,i.jsx)(ai,{className:"p-6 text-center text-muted-foreground",children:"No equipped weapons or action abilities available."})}):(0,i.jsxs)("div",{className:"space-y-4",children:[o.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,i.jsx)(u.A,{className:"w-5 h-5"}),"Weapons"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>{let a=c(e.attribute),s=e.damage&&""!==e.damage.trim(),r=t.inEncounter&&t.actionTracker.current<1;return(0,i.jsxs)(t9,{className:r?"opacity-50":"",children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)(at,{className:"text-center text-base flex items-center justify-center gap-2",children:[(0,i.jsx)(u.A,{className:"w-4 h-4"}),e.name]})}),(0,i.jsxs)(ai,{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"text-center text-sm",children:[(0,i.jsxs)("div",{className:"text-muted-foreground",children:[e.damage||"No damage set",e.attribute&&(0,i.jsxs)("span",{children:[" + ",e.attribute.slice(0,3).toUpperCase()," (",a>=0?"+":"",a,")"]})]}),e.properties&&e.properties.length>0&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.properties.join(", ")}),t.inEncounter&&(0,i.jsx)("div",{className:"flex justify-center mt-2",children:(0,i.jsx)(aZ,{variant:"outline",className:r?"text-red-600":"",children:"1 action"})})]}),(0,i.jsxs)(m,{variant:"destructive",size:"sm",onClick:()=>d(e),disabled:!s||r,className:"w-full",children:[(0,i.jsx)(u.A,{className:"w-4 h-4 mr-2"}),r?"No Actions":"Attack"]})]})]},e.id)})})]}),l.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,i.jsx)(aJ.A,{className:"w-5 h-5"}),"Abilities"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(e=>{var a;let s="at_will"!==e.frequency&&(void 0===e.currentUses||0===e.currentUses),r=e.actionCost||0,n=t.inEncounter&&r>0&&t.actionTracker.current<r,o=(()=>{if(!e.resourceCost)return{canAfford:!0,resourceName:null};let a=t.resources.find(t=>t.definition.id===e.resourceCost.resourceId);if(!a)return{canAfford:!1,resourceName:e.resourceCost.resourceId};let i="fixed"===e.resourceCost.type?e.resourceCost.amount:e.resourceCost.minAmount;return{canAfford:a.current>=i,resourceName:a.definition.name}})(),l=s||n||!o.canAfford;return(0,i.jsxs)(t9,{className:l?"opacity-50":"",children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)(at,{className:"text-center text-base flex items-center justify-center gap-2",children:[(0,i.jsx)(aJ.A,{className:"w-4 h-4"}),e.name]})}),(0,i.jsxs)(ai,{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"text-center text-sm",children:[(0,i.jsx)("div",{className:"text-muted-foreground mb-2",children:e.description}),e.roll&&(0,i.jsxs)("div",{className:"mb-2 p-2 bg-muted/50 rounded text-sm",children:[(0,i.jsx)("strong",{children:"Roll:"})," ",te.getAbilityRollDescription(e.roll,t)]}),(0,i.jsxs)("div",{className:"flex justify-center gap-2 mb-2 flex-wrap",children:[(a=e.frequency,(0,i.jsx)(aZ,{className:{per_turn:"bg-green-100 text-green-800",per_encounter:"bg-blue-100 text-blue-800",per_safe_rest:"bg-orange-100 text-orange-800",at_will:"bg-purple-100 text-purple-800"}[a],children:{per_turn:"Per Turn",per_encounter:"Per Encounter",per_safe_rest:"Per Safe Rest",at_will:"At Will"}[a]})),"at_will"!==e.frequency&&e.maxUses&&(0,i.jsxs)(aZ,{variant:"secondary",children:[e.currentUses,"/",e.maxUses," uses"]}),r>0&&(0,i.jsxs)(aZ,{variant:"outline",className:n?"text-red-600":"",children:[r," action",1!==r?"s":""]}),e.resourceCost&&(0,i.jsx)(aZ,{variant:"outline",className:o.canAfford?"text-blue-600":"text-red-600",children:"fixed"===e.resourceCost.type?"".concat(e.resourceCost.amount," ").concat(o.resourceName):"".concat(e.resourceCost.minAmount,"-").concat(e.resourceCost.maxAmount," ").concat(o.resourceName)})]})]}),(0,i.jsxs)(m,{variant:l?"outline":"default",size:"sm",onClick:()=>h(e),disabled:l,className:"w-full",children:[(0,i.jsx)(aJ.A,{className:"w-4 h-4 mr-2"}),s?"Used":n?"No Actions":o.canAfford?"Use Ability":"Need ".concat(o.resourceName)]})]})]},e.id)})})]})]})}function a$(){let{character:e}=t6(),{attack:t}=aw(),{uiState:a,updateCollapsibleState:s}=ak();if(!e)return null;let r=a.collapsibleSections.actions,n=a.advantageLevel;return(0,i.jsxs)(aM,{open:r,onOpenChange:e=>s("actions",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Actions"}),r?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(aQ,{character:e,onAttack:t,advantageLevel:n})})})]})}function a0(){return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(aF,{}),(0,i.jsx)(aq,{}),(0,i.jsx)(a$,{})]})}var a1=a(6651),a2=a(5937),a4=a(1473),a3=a(4982),a5=a(318),a6=a(1503),a8=a(889),a7=a(532);function a9(){let{character:e}=t6(),{rollSkill:t}=aw(),{uiState:a,updateCollapsibleState:r}=ak(),n=a.collapsibleSections.skills,o=a.advantageLevel,l=(0,s.useCallback)(async(t,a)=>{if(!e)return;let i=e.skills[t].modifier,s=Math.max(0,Math.min(20,i+a));if(s!==i){let a=tV(),i={...e,skills:{...e.skills,[t]:{...e.skills[t],modifier:s}}};await a.updateCharacter(i)}},[e]);return e?(0,i.jsx)(t9,{children:(0,i.jsxs)(aM,{open:n,onOpenChange:e=>r("skills",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-xl font-semibold",children:"Skills"}),n?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})})}),(0,i.jsxs)(aY,{children:[(0,i.jsx)("div",{className:"border-t"}),(0,i.jsx)(ai,{className:"p-0",children:(0,i.jsx)("div",{className:"divide-y",children:Object.entries(e.skills).map((a,s)=>{let[r,n]=a,c=e.attributes[n.associatedAttribute],d=c+n.modifier;return(0,i.jsx)("div",{className:"p-3 flex items-center justify-between",children:(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(()=>{let e={arcana:h.A,examination:a1.A,finesse:p.A,influence:a2.A,insight:a4.A,might:a3.A,lore:a5.A,naturecraft:a6.A,perception:a8.A,stealth:a7.A}[r]||ax.A;return(0,i.jsx)(e,{className:"w-6 h-6 text-muted-foreground shrink-0"})})(),(0,i.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,i.jsxs)("h3",{className:"font-medium text-sm",children:[n.name," (",n.associatedAttribute.slice(0,3).toUpperCase(),")"]}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[c>0?"+":"",c," (",n.associatedAttribute.slice(0,3).toUpperCase(),") + ",n.modifier," (Skill) = ",d>0?"+":"",d]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("div",{className:"flex items-center border rounded",children:[(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>l(r,-1),disabled:n.modifier<=0,className:"h-8 w-8 p-0 rounded-none border-r",children:(0,i.jsx)(au.A,{className:"w-3 h-3"})}),(0,i.jsx)("span",{className:"w-8 h-8 flex items-center justify-center text-sm font-medium bg-background",children:n.modifier}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>l(r,1),disabled:n.modifier>=20,className:"h-8 w-8 p-0 rounded-none border-l",children:(0,i.jsx)(ah.A,{className:"w-3 h-3"})})]}),(0,i.jsxs)(m,{variant:"outline",size:"sm",onClick:()=>t(r,c,n.modifier,o),className:"h-8 px-3",children:[(0,i.jsx)(ax.A,{className:"w-3 h-3 mr-1"}),"Roll"]})]})]})})},r)})})})]})]})}):null}function ie(){return(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsx)(a9,{})})}let it=s.forwardRef((e,t)=>{let{className:a,type:s,...r}=e;return(0,i.jsx)("input",{type:s,className:c("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});it.displayName="Input";var ia=a(2108);function ii(){let{character:e,updateCharacter:t}=t6(),{uiState:a,updateCollapsibleState:r}=ak(),{rollAttribute:n,rollSave:o}=aw(),l=a.collapsibleSections.attributes,c=a.advantageLevel,d=tE.getInstance(),u=e?d.getClassDefinition(e.classId):null,h=(null==u?void 0:u.keyAttributes)||[],p=(0,s.useCallback)(async(a,i)=>{if(!e)return;let s=parseInt(i)||0;if(s>=-2&&s<=10){let i={...e,attributes:{...e.attributes,[a]:s}};await t(i)}},[e,t]),y=(0,s.useCallback)(async(a,i)=>{if(!e)return;let s={...e,saveAdvantages:{...e.saveAdvantages,[a]:i}};await t(s)},[e,t]),f=(0,s.useCallback)(t=>{var a;let i;if(e){switch((null==(a=e.saveAdvantages)?void 0:a[t])||"normal"){case"normal":i="advantage";break;case"advantage":i="disadvantage";break;default:i="normal"}y(t,i)}},[e,y]),g=(t,a)=>{var s;if(!e)return null;let r=h.includes(t),l=e.attributes[t],d=(null==(s=e.saveAdvantages)?void 0:s[t])||"normal";return(0,i.jsxs)(t9,{className:"".concat(r?"ring-2 ring-primary":""," relative"),children:[(0,i.jsxs)(ae,{className:"pb-2",children:[(0,i.jsx)(at,{className:"text-center text-sm ".concat(r?"font-bold underline":""),children:a}),(0,i.jsx)("div",{className:"absolute -top-1 right-2",children:(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>f(t),className:"h-4 w-4 p-0 hover:bg-transparent",children:(e=>{switch(e){case"advantage":return(0,i.jsx)(ia.A,{className:"w-3 h-3 text-green-600"});case"disadvantage":return(0,i.jsx)(az.A,{className:"w-3 h-3 text-red-600"});default:return(0,i.jsx)(au.A,{className:"w-3 h-3 text-gray-400"})}})(d)})}),(0,i.jsx)(al,{children:(0,i.jsx)("p",{children:((e,t)=>{switch(e){case"advantage":return"Advantage on ".concat(t," saves");case"disadvantage":return"Disadvantage on ".concat(t," saves");default:return"Normal ".concat(t," saves")}})(d,a)})})]})})]}),(0,i.jsxs)(ai,{className:"space-y-1",children:[(0,i.jsx)(it,{type:"number",min:"-2",max:"10",value:l,onChange:e=>p(t,e.target.value),className:"text-center text-lg font-bold h-8"}),(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>n(t,l,c),className:"flex-1 h-7 px-2",children:(0,i.jsx)(ax.A,{className:"w-3 h-3"})})}),(0,i.jsx)(al,{children:(0,i.jsxs)("p",{children:["Roll ",a]})})]}),(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)(m,{variant:"secondary",size:"sm",onClick:()=>o(t,l,aH(c,d)),className:"flex-1 h-7 px-2",children:(0,i.jsx)(aU.A,{className:"w-3 h-3"})})}),(0,i.jsx)(al,{children:(0,i.jsxs)("p",{children:["Save ",a]})})]})]})]})]},t)};return e?(0,i.jsx)(ar,{children:(0,i.jsxs)(aM,{open:l,onOpenChange:e=>r("attributes",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Attributes"}),l?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsxs)(aY,{children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-3",children:[g("strength","Strength"),g("dexterity","Dexterity"),g("intelligence","Intelligence"),g("will","Will")]}),h.length>0&&(0,i.jsxs)("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:["Key attributes for ",null==u?void 0:u.name,": ",(0,i.jsx)("span",{className:"font-semibold underline",children:h.join(", ")})]})]})]})}):null}var is=a(489);let ir=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),io=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(is.b,{ref:t,className:c(ir(),a),...s})});io.displayName=is.b.displayName;var il=a(7887),ic=a(1719);let id=il.bL;il.YJ;let im=il.WT,iu=s.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,i.jsxs)(il.l9,{ref:t,className:c("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...r,children:[s,(0,i.jsx)(il.In,{asChild:!0,children:(0,i.jsx)(ic.D3D,{className:"h-4 w-4 opacity-50"})})]})});iu.displayName=il.l9.displayName;let ih=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(il.PP,{ref:t,className:c("flex cursor-default items-center justify-center py-1",a),...s,children:(0,i.jsx)(ic.Mtm,{className:"h-4 w-4"})})});ih.displayName=il.PP.displayName;let ip=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(il.wn,{ref:t,className:c("flex cursor-default items-center justify-center py-1",a),...s,children:(0,i.jsx)(ic.D3D,{className:"h-4 w-4"})})});ip.displayName=il.wn.displayName;let iy=s.forwardRef((e,t)=>{let{className:a,children:s,position:r="popper",...n}=e;return(0,i.jsx)(il.ZL,{children:(0,i.jsxs)(il.UC,{ref:t,className:c("relative z-50 max-h-(--radix-select-content-available-height) min-w-32 overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-select-content-transform-origin)","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...n,children:[(0,i.jsx)(ih,{}),(0,i.jsx)(il.LM,{className:c("p-1","popper"===r&&"h-(--radix-select-trigger-height) w-full min-w-(--radix-select-trigger-width)"),children:s}),(0,i.jsx)(ip,{})]})})});iy.displayName=il.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(il.JU,{ref:t,className:c("px-2 py-1.5 text-sm font-semibold",a),...s})}).displayName=il.JU.displayName;let ig=s.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,i.jsxs)(il.q7,{ref:t,className:c("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",a),...r,children:[(0,i.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(il.VF,{children:(0,i.jsx)(ic.Srz,{className:"h-4 w-4"})})}),(0,i.jsx)(il.p4,{children:s})]})});ig.displayName=il.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(il.wv,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=il.wv.displayName;var ix=a(6645);function iv(){let{character:e,performSafeRest:t,performCatchBreath:a,performMakeCamp:r,updateCharacter:n}=t6(),{uiState:o,updateCollapsibleState:l}=ak(),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)({level:(null==e?void 0:e.level)||1,hitDieSize:(null==e?void 0:e.hitDice.size)||6,currentHitDice:(null==e?void 0:e.hitDice.current)||1});if(!e)return null;let p=o.collapsibleSections.hitDice,y=e.hitDice.current>0;return(0,i.jsx)(aM,{open:p,onOpenChange:e=>l("hitDice",e),children:(0,i.jsxs)(t9,{children:[(0,i.jsx)(aW,{className:"w-full",children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:(0,i.jsxs)(at,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(ag.A,{className:"w-5 h-5 text-red-500"}),"Hit Dice & Level"]}),(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"text-lg font-bold flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"Level"}),(0,i.jsx)("span",{children:e.level})]}),(0,i.jsxs)("div",{className:"text-lg font-bold flex items-center gap-2",children:[(0,i.jsx)(ix.A,{className:"w-4 h-4"}),(0,i.jsxs)("span",{children:[e.hitDice.current,"/",e.hitDice.max]}),(0,i.jsxs)("span",{className:"text-sm text-muted-foreground",children:["d",e.hitDice.size]})]}),p?(0,i.jsx)(az.A,{className:"w-4 h-4"}):(0,i.jsx)(aO.A,{className:"w-4 h-4"})]})]})})}),(0,i.jsx)(aY,{children:(0,i.jsx)(ai,{className:"space-y-4",children:c?(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"level",children:"Character Level"}),(0,i.jsx)(it,{id:"level",type:"number",min:"1",max:"20",value:u.level,onChange:e=>{var t;return t=parseInt(e.target.value)||1,void h(e=>({...e,level:t,currentHitDice:Math.min(e.currentHitDice,t)}))}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"hit-die-size",children:"Hit Die Size"}),(0,i.jsxs)(id,{value:u.hitDieSize.toString(),onValueChange:e=>h(t=>({...t,hitDieSize:parseInt(e)})),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"4",children:"d4"}),(0,i.jsx)(ig,{value:"6",children:"d6"}),(0,i.jsx)(ig,{value:"8",children:"d8"}),(0,i.jsx)(ig,{value:"10",children:"d10"}),(0,i.jsx)(ig,{value:"12",children:"d12"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"current-hit-dice",children:"Current Hit Dice"}),(0,i.jsx)(it,{id:"current-hit-dice",type:"number",min:"0",max:u.level,value:u.currentHitDice,onChange:e=>h(t=>({...t,currentHitDice:Math.max(0,Math.min(parseInt(e.target.value)||0,u.level))}))})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(m,{onClick:()=>{n({...e,level:u.level,hitDice:{size:u.hitDieSize,current:u.currentHitDice,max:u.level}}),d(!1)},children:"Save Changes"}),(0,i.jsx)(m,{variant:"outline",onClick:()=>{h({level:e.level,hitDieSize:e.hitDice.size,currentHitDice:e.hitDice.current}),d(!1)},children:"Cancel"})]})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsxs)("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:e.level}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Level"})]}),(0,i.jsxs)("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[(0,i.jsxs)("div",{className:"text-2xl font-bold",children:["d",e.hitDice.size]}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Hit Die"})]}),(0,i.jsxs)("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:e.hitDice.current}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Available"})]}),(0,i.jsxs)("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:e.hitDice.max}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Maximum"})]})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:["Field Rest Options (d",e.hitDice.size," + STR ",e.attributes.strength>=0?"+":"",e.attributes.strength,")"]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,i.jsxs)(m,{variant:"default",onClick:a,disabled:!y,className:"flex-1",children:[(0,i.jsx)(ix.A,{className:"w-4 h-4 mr-2"}),"Catch Breath",(0,i.jsx)("div",{className:"text-xs ml-2",children:"(Roll + STR)"})]}),(0,i.jsxs)(m,{variant:"secondary",onClick:r,disabled:!y,className:"flex-1",children:[(0,i.jsx)(ag.A,{className:"w-4 h-4 mr-2"}),"Make Camp",(0,i.jsxs)("div",{className:"text-xs ml-2",children:["(",e.hitDice.size," + STR)"]})]})]}),!y&&(0,i.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:"No hit dice available for field rest"}),(0,i.jsxs)("div",{className:"border-t pt-3",children:[(0,i.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground mb-2",children:"Safe Rest"}),(0,i.jsxs)(m,{variant:"default",onClick:t,disabled:!1,className:"w-full bg-green-600 hover:bg-green-700",children:[(0,i.jsx)(aU.A,{className:"w-4 h-4 mr-2"}),"Safe Rest",(0,i.jsx)("div",{className:"text-xs ml-2",children:"(Full Recovery)"})]})]}),(0,i.jsx)(m,{variant:"outline",onClick:()=>d(!0),className:"w-full",children:"Edit Level & Hit Dice"})]})]})})})]})})}let ib=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("textarea",{className:c("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});ib.displayName="Textarea";var iw=a(9715),ij=a(1360);function iN(){var e,t,a,r;let{character:n,updateAbilities:o,performUseAbility:l}=t6(),{uiState:c,updateCollapsibleState:d}=ak(),[u,p]=(0,s.useState)(!1),[y,f]=(0,s.useState)(null),[g,x]=(0,s.useState)({name:"",description:"",type:"freeform",frequency:"per_encounter",maxUses:1,actionCost:0}),[v,b]=(0,s.useState)(1);if(!n)return null;let w=c.collapsibleSections.abilities,j=n.abilities.filter(e=>"spell"!==e.type),N=async(e,t)=>{n&&await l(e,t)},k=e=>{o(j.filter(t=>t.id!==e))};return(0,i.jsx)(aM,{open:w,onOpenChange:e=>d("abilities",e),children:(0,i.jsxs)(t9,{children:[(0,i.jsx)(aW,{className:"w-full",children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:(0,i.jsxs)(at,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5 text-purple-500"}),"Abilities"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-lg font-bold",children:j.length}),w?(0,i.jsx)(az.A,{className:"w-4 h-4"}):(0,i.jsx)(aO.A,{className:"w-4 h-4"})]})]})})}),(0,i.jsx)(aY,{children:(0,i.jsxs)(ai,{className:"space-y-4",children:[(0,i.jsx)("div",{className:"space-y-2",children:0===j.length?(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No abilities yet. Add your first ability below!"}):j.map(e=>{var t,a,s,r;if("freeform"===e.type)return(0,i.jsx)(t9,{className:"mb-2",children:(0,i.jsx)(ai,{className:"p-4",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsx)(iw.A,{className:"w-4 h-4 text-gray-500"}),(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsx)(aZ,{variant:"outline",children:"Freeform"})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>k(e.id),className:"text-red-500 hover:text-red-700",children:(0,i.jsx)(ij.A,{className:"w-4 h-4"})})]})})},e.id);let o="at_will"!==e.frequency&&0===e.currentUses,l=(()=>{if(!e.resourceCost)return{canAfford:!0,resourceName:null};let t=n.resources.find(t=>t.definition.id===e.resourceCost.resourceId);if(!t)return{canAfford:!1,resourceName:e.resourceCost.resourceId};let a="fixed"===e.resourceCost.type?e.resourceCost.amount:e.resourceCost.minAmount;return{canAfford:t.current>=a,resourceName:t.definition.name,resource:t}})(),c=!o&&l.canAfford;return(0,i.jsx)(t9,{className:"mb-2 ".concat(c?"":"opacity-50"),children:(0,i.jsx)(ai,{className:"p-4",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,i.jsx)(aJ.A,{className:"w-4 h-4 text-yellow-500"}),(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(r=e.frequency,(0,i.jsx)(aZ,{className:{per_turn:"bg-green-100 text-green-800",per_encounter:"bg-blue-100 text-blue-800",per_safe_rest:"bg-orange-100 text-orange-800",at_will:"bg-purple-100 text-purple-800"}[r],children:{per_turn:"Per Turn",per_encounter:"Per Encounter",per_safe_rest:"Per Safe Rest",at_will:"At Will"}[r]})),"at_will"!==e.frequency&&e.maxUses&&(0,i.jsxs)(aZ,{variant:"secondary",children:[e.currentUses,"/",e.maxUses," uses"]}),"at_will"===e.frequency&&(0,i.jsx)(aZ,{variant:"outline",children:"At Will"}),e.actionCost&&e.actionCost>0&&(0,i.jsxs)(aZ,{variant:"outline",className:"text-orange-600",children:[e.actionCost," action",e.actionCost>1?"s":""]}),e.resourceCost&&(0,i.jsx)(aZ,{variant:"outline",className:l.canAfford?"text-blue-600":"text-red-600",children:"fixed"===e.resourceCost.type?"".concat(e.resourceCost.amount," ").concat(l.resourceName):"".concat(e.resourceCost.minAmount,"-").concat(e.resourceCost.maxAmount," ").concat(l.resourceName)})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),e.roll&&(0,i.jsxs)("div",{className:"mb-3 p-2 bg-muted/50 rounded text-sm",children:[(0,i.jsx)("strong",{children:"Roll:"})," ",te.getAbilityRollDescription(e.roll,n)]}),e.resourceCost&&"variable"===e.resourceCost.type&&c&&(0,i.jsxs)("div",{className:"mb-3 p-2 border rounded",children:[(0,i.jsx)(io,{className:"text-sm font-medium",children:"Spend Amount:"}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,i.jsx)(it,{type:"number",min:"variable"===e.resourceCost.type?e.resourceCost.minAmount:1,max:"variable"===e.resourceCost.type?Math.min(e.resourceCost.maxAmount,(null==(t=l.resource)?void 0:t.current)||0):(null==(a=l.resource)?void 0:a.current)||0,value:v,onChange:t=>{var a;return b(parseInt(t.target.value)||((null==(a=e.resourceCost)?void 0:a.type)==="variable"?e.resourceCost.minAmount:1))},className:"w-20"}),(0,i.jsxs)("span",{className:"text-sm text-muted-foreground",children:[l.resourceName," (have ",(null==(s=l.resource)?void 0:s.current)||0,")"]})]})]}),(0,i.jsx)(m,{variant:c?"default":"outline",size:"sm",onClick:()=>{var t;return N(e.id,(null==(t=e.resourceCost)?void 0:t.type)==="variable"?v:void 0)},disabled:!c,children:o?"Used":l.canAfford?"Use Ability":"Need ".concat(l.resourceName)})]}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>k(e.id),className:"text-red-500 hover:text-red-700",children:(0,i.jsx)(ij.A,{className:"w-4 h-4"})})]})})},e.id)})}),u?(0,i.jsx)(t9,{className:"border-dashed",children:(0,i.jsxs)(ai,{className:"p-4 space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-name",children:"Ability Name"}),(0,i.jsx)(it,{id:"ability-name",value:g.name,onChange:e=>x({...g,name:e.target.value}),placeholder:"Enter ability name"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-description",children:"Description"}),(0,i.jsx)(ib,{id:"ability-description",value:g.description,onChange:e=>x({...g,description:e.target.value}),placeholder:"Describe what this ability does",rows:3})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-type",children:"Type"}),(0,i.jsxs)(id,{value:g.type,onValueChange:e=>x({...g,type:e}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"freeform",children:"Freeform (Text only)"}),(0,i.jsx)(ig,{value:"action",children:"Action (Limited uses)"})]})]})]}),"action"===g.type&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-frequency",children:"Frequency"}),(0,i.jsxs)(id,{value:g.frequency,onValueChange:e=>x({...g,frequency:e}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"per_turn",children:"Per Turn"}),(0,i.jsx)(ig,{value:"per_encounter",children:"Per Encounter"}),(0,i.jsx)(ig,{value:"per_safe_rest",children:"Per Safe Rest"}),(0,i.jsx)(ig,{value:"at_will",children:"At Will"})]})]})]}),"at_will"!==g.frequency&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-uses",children:"Maximum Uses"}),(0,i.jsx)(it,{id:"ability-uses",type:"number",min:"1",max:"10",value:g.maxUses,onChange:e=>x({...g,maxUses:parseInt(e.target.value)||1})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-action-cost",children:"Action Cost"}),(0,i.jsx)(it,{id:"ability-action-cost",type:"number",min:"0",max:"5",value:g.actionCost||0,onChange:e=>x({...g,actionCost:parseInt(e.target.value)||0})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{children:"Resource Cost (Optional)"}),(0,i.jsxs)("div",{className:"space-y-3 p-3 border rounded-md",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"resource-id",children:"Resource"}),(0,i.jsxs)(id,{value:(null==(e=g.resourceCost)?void 0:e.resourceId)||"none",onValueChange:e=>x({...g,resourceCost:"none"===e?void 0:{type:"fixed",resourceId:e,amount:1}}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"Select resource"})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"none",children:"No resource cost"}),n.resources.map(e=>(0,i.jsx)(ig,{value:e.definition.id,children:e.definition.name},e.definition.id))]})]})]}),g.resourceCost&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{children:"Cost Type"}),(0,i.jsxs)(id,{value:g.resourceCost.type,onValueChange:e=>x({...g,resourceCost:{...g.resourceCost,type:e,..."fixed"===e?{amount:1}:{minAmount:1,maxAmount:5}}}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"fixed",children:"Fixed Amount"}),(0,i.jsx)(ig,{value:"variable",children:"Variable Amount"})]})]})]}),"fixed"===g.resourceCost.type?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"resource-amount",children:"Amount"}),(0,i.jsx)(it,{id:"resource-amount",type:"number",min:"1",max:"10",value:g.resourceCost.amount||1,onChange:e=>x({...g,resourceCost:{...g.resourceCost,amount:parseInt(e.target.value)||1}})})]}):(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"resource-min",children:"Min Amount"}),(0,i.jsx)(it,{id:"resource-min",type:"number",min:"1",max:"10",value:g.resourceCost.minAmount||1,onChange:e=>x({...g,resourceCost:{...g.resourceCost,minAmount:parseInt(e.target.value)||1}})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"resource-max",children:"Max Amount"}),(0,i.jsx)(it,{id:"resource-max",type:"number",min:"1",max:"10",value:g.resourceCost.maxAmount||5,onChange:e=>x({...g,resourceCost:{...g.resourceCost,maxAmount:parseInt(e.target.value)||5}})})]})]})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{children:"Roll Configuration (Optional)"}),(0,i.jsxs)("div",{className:"space-y-3 p-3 border rounded-md",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-dice",children:"Dice (e.g., 2d4, 1d6)"}),(0,i.jsx)(it,{id:"ability-dice",placeholder:"2d4",value:(null==(t=g.roll)?void 0:t.dice)||"",onChange:e=>x({...g,roll:{...g.roll,dice:e.target.value}})})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-modifier",children:"Fixed Modifier"}),(0,i.jsx)(it,{id:"ability-modifier",type:"number",placeholder:"0",value:(null==(a=g.roll)?void 0:a.modifier)||"",onChange:e=>{var t;return x({...g,roll:{dice:(null==(t=g.roll)?void 0:t.dice)||"",...g.roll,modifier:e.target.value?parseInt(e.target.value):void 0}})}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"ability-attribute",children:"Attribute"}),(0,i.jsxs)(id,{value:(null==(r=g.roll)?void 0:r.attribute)||"none",onValueChange:e=>{var t;return x({...g,roll:{dice:(null==(t=g.roll)?void 0:t.dice)||"",...g.roll,attribute:"none"===e?void 0:e}})},children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"None"})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"none",children:"None"}),(0,i.jsx)(ig,{value:"strength",children:"Strength"}),(0,i.jsx)(ig,{value:"dexterity",children:"Dexterity"}),(0,i.jsx)(ig,{value:"intelligence",children:"Intelligence"}),(0,i.jsx)(ig,{value:"will",children:"Will"})]})]})]})]})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(m,{onClick:()=>{g.name.trim()&&(o([...j,"freeform"===g.type?{id:"ability-".concat(Date.now()),name:g.name,description:g.description,type:"freeform"}:{id:"ability-".concat(Date.now()),name:g.name,description:g.description,type:"action",frequency:g.frequency,..."at_will"!==g.frequency&&g.maxUses?{maxUses:g.maxUses,currentUses:g.maxUses}:{},...g.actionCost?{actionCost:g.actionCost}:{},...g.roll&&g.roll.dice?{roll:{dice:tz(g.roll.dice)||{count:1,sides:6},modifier:g.roll.modifier,attribute:g.roll.attribute}}:{},...g.resourceCost&&g.resourceCost.resourceId?{resourceCost:"fixed"===g.resourceCost.type?{type:"fixed",resourceId:g.resourceCost.resourceId,amount:g.resourceCost.amount||1}:{type:"variable",resourceId:g.resourceCost.resourceId,minAmount:g.resourceCost.minAmount||1,maxAmount:g.resourceCost.maxAmount||5}}:{}}]),x({name:"",description:"",type:"freeform",frequency:"per_encounter",maxUses:1,actionCost:0}),p(!1))},disabled:!g.name.trim(),children:"Add Ability"}),(0,i.jsx)(m,{variant:"outline",onClick:()=>{p(!1),x({name:"",description:"",type:"freeform",frequency:"per_encounter",maxUses:1,actionCost:0})},children:"Cancel"})]})]})}):(0,i.jsxs)(m,{variant:"outline",className:"w-full",onClick:()=>p(!0),children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),"Add New Ability"]})]})})]})})}function ik(){let{character:e}=t6(),{uiState:t,updateCollapsibleState:a}=ak(),{activeResources:r,spendResource:n,restoreResource:o,getResourceInstance:l}=function(){let{character:e,updateCharacter:t}=t6(),{addLogEntry:a}=ab(),i=(0,s.useCallback)(async(i,s)=>{if(!e)return;let r=j.spendResource(e,i,s);if(r){await t({...e});let i=j.createResourceLogEntry(r);await a(i)}},[e,t,a]),r=(0,s.useCallback)(async(i,s)=>{if(!e)return;let r=j.restoreResource(e,i,s);if(r){await t({...e});let i=j.createResourceLogEntry(r);await a(i)}},[e,t,a]),n=(0,s.useCallback)(async(a,i)=>{e&&j.setResource(e,a,i)&&await t({...e})},[e,t]),o=(0,s.useCallback)(async a=>{e&&(j.addResourceToCharacter(e,a),await t({...e}))},[e,t]),l=(0,s.useCallback)(async a=>{e&&j.removeResourceFromCharacter(e,a)&&await t({...e})},[e,t]),c=(0,s.useCallback)(async()=>{if(!e)return;let i=j.resetResourcesOnSafeRest(e);if(i.length>0)for(let s of(await t({...e}),i)){let e=j.createResourceLogEntry(s);await a(e)}},[e,t,a]),d=(0,s.useCallback)(async()=>{if(!e)return;let i=j.resetResourcesOnEncounterEnd(e);if(i.length>0)for(let s of(await t({...e}),i)){let e=j.createResourceLogEntry(s);await a(e)}},[e,t,a]),m=(0,s.useCallback)(async()=>{if(!e)return;let i=j.resetResourcesOnTurnEnd(e);if(i.length>0)for(let s of(await t({...e}),i)){let e=j.createResourceLogEntry(s);await a(e)}},[e,t,a]);return{character:e,resources:(null==e?void 0:e.resources)||[],activeResources:e?j.getActiveResources(e):[],spendResource:i,restoreResource:r,setResource:n,addResourceToCharacter:o,removeResourceFromCharacter:l,resetResourcesOnSafeRest:c,resetResourcesOnEncounterEnd:d,resetResourcesOnTurnEnd:m,getResourceInstance:t=>e?j.getResourceInstance(e,t):null}}(),[c,d]=(0,s.useState)({}),[u,p]=(0,s.useState)({});if(!e||0===r.length)return null;let y=t.collapsibleSections.resources,f=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await n(e,t),a&&d(t=>({...t,[e]:"1"}))},g=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await o(e,t),a&&p(t=>({...t,[e]:"1"}))};return(0,i.jsxs)(aM,{open:y,onOpenChange:e=>a("resources",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5 text-blue-500"}),"Resources"]}),y?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"space-y-4",children:r.map(e=>{var t;let a=(e=>{if(e.definition.icon){let t=a_(e.definition.icon);if(t)return t.icon}return"\uD83D\uDC8E"})(e),s=((e,t,a)=>{if(e.definition.colorScheme)return{backgroundColor:aI(e.definition.colorScheme,t/a*100)};let i=t/a*100;return i<=25?{backgroundColor:"#dc2626"}:i<=50?{backgroundColor:"#eab308"}:{backgroundColor:"#3b82f6"}})(e,e.current,e.definition.maxValue),r=e.current/e.definition.maxValue*100,n=e.definition.name,o=c[e.definition.id]||"1",l=u[e.definition.id]||"1";return(0,i.jsxs)(t9,{className:"w-full",children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)(at,{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-lg",children:a}),n]})}),(0,i.jsxs)(ai,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"text-center space-y-2",children:[(0,i.jsxs)("div",{className:"text-3xl font-bold",children:[e.current," / ",e.definition.maxValue,0===e.current&&(0,i.jsx)("span",{className:"text-lg text-red-600 ml-2 font-semibold",children:"(Depleted)"})]}),(0,i.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,i.jsx)("div",{className:"h-3 rounded-full transition-all duration-300",style:{width:"".concat(r,"%"),..."object"==typeof s?s:{}}})}),(null==(t=e.definition)?void 0:t.description)&&(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:e.definition.description})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(io,{className:"text-sm font-medium text-destructive",children:["Spend ",n]}),(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>f(e.definition.id,1),disabled:e.current<=0,children:"-1"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>f(e.definition.id,3),disabled:e.current<=0,children:"-3"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>f(e.definition.id,5),disabled:e.current<=0,children:"-5"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{className:"text-sm font-medium text-green-600",children:"Restore"}),(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>g(e.definition.id,1),disabled:e.current>=e.definition.maxValue,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:"+1"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>g(e.definition.id,3),disabled:e.current>=e.definition.maxValue,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:"+3"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>g(e.definition.id,5),disabled:e.current>=e.definition.maxValue,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:"+5"})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"spend-".concat(e.definition.id),className:"text-sm",children:"Custom Spend"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(it,{id:"spend-".concat(e.definition.id),type:"number",min:"1",value:o,onChange:t=>d(a=>({...a,[e.definition.id]:t.target.value})),className:"flex-1",placeholder:"Amount"}),(0,i.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>(e=>{let t=parseInt(c[e]||"1")||1;f(e,t,!0)})(e.definition.id),disabled:e.current<=0,children:(0,i.jsx)(au.A,{className:"w-4 h-4"})})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"restore-".concat(e.definition.id),className:"text-sm",children:"Custom Restore"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(it,{id:"restore-".concat(e.definition.id),type:"number",min:"1",value:l,onChange:t=>p(a=>({...a,[e.definition.id]:t.target.value})),className:"flex-1",placeholder:"Amount"}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>(e=>{let t=parseInt(u[e]||"1")||1;g(e,t,!0)})(e.definition.id),disabled:e.current>=e.definition.maxValue,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:(0,i.jsx)(ah.A,{className:"w-4 h-4"})})]})]})]})]})]},e.definition.id)})})})]})}var iS=a(9347),iC=a(1524),iA=a(5795),i_=a(9708);function iI(){let{character:e}=t6(),{uiState:t,updateCollapsibleState:a}=ak(),[r,n]=(0,s.useState)({}),o=tE.getInstance();if(!e)return null;let l=t.collapsibleSections.classFeatures;if(!o.getClassDefinition(e.classId))return null;let c=o.getAllClassFeaturesUpToLevel(e.classId,e.level),d=c.filter(e=>"ability"===e.type),u=c.filter(e=>"passive_feature"===e.type),p=c.filter(e=>"stat_boost"===e.type),y=c.filter(e=>"proficiency"===e.type),f=c.filter(e=>"spell_school"===e.type),g=c.filter(e=>"spell_tier_access"===e.type),x=c.filter(e=>"resource"===e.type),v=e=>{switch(e){case"ability":case"resource":return(0,i.jsx)(aJ.A,{className:"w-4 h-4"});case"passive_feature":case"proficiency":case"spell_tier_access":return(0,i.jsx)(iS.A,{className:"w-4 h-4"});case"stat_boost":return(0,i.jsx)(iC.A,{className:"w-4 h-4"});default:return(0,i.jsx)(h.A,{className:"w-4 h-4"})}},b=e=>{switch(e){case"ability":return"bg-blue-100 text-blue-800 border-blue-200";case"passive_feature":return"bg-green-100 text-green-800 border-green-200";case"stat_boost":return"bg-purple-100 text-purple-800 border-purple-200";case"proficiency":return"bg-orange-100 text-orange-800 border-orange-200";case"spell_school":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"spell_tier_access":return"bg-cyan-100 text-cyan-800 border-cyan-200";case"resource":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return(0,i.jsxs)(aM,{open:l,onOpenChange:e=>a("classFeatures",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5 text-yellow-500"}),"Class Features"]}),l?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)(t9,{className:"w-full",children:(0,i.jsx)(ai,{className:"space-y-4 pt-6",children:0===c.length?(0,i.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No class features unlocked yet. Level up to gain new abilities!"}):(0,i.jsxs)("div",{className:"space-y-6",children:[d.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-blue-600 flex items-center gap-2",children:[(0,i.jsx)(aJ.A,{className:"w-5 h-5"}),"Active Abilities (",d.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:d.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),v(e.type)]})},t))})]}),u.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-green-600 flex items-center gap-2",children:[(0,i.jsx)(iS.A,{className:"w-5 h-5"}),"Passive Features (",u.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:u.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),v(e.type)]})},t))})]}),p.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-purple-600 flex items-center gap-2",children:[(0,i.jsx)(iC.A,{className:"w-5 h-5"}),"Stat Improvements (",p.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:p.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),"stat_boost"===e.type&&e.statBoosts&&(0,i.jsx)("div",{className:"flex gap-2 mt-2",children:e.statBoosts.map((e,t)=>(0,i.jsxs)(aZ,{variant:"secondary",className:"text-xs",children:["+",e.amount," ",e.attribute]},t))})]}),v(e.type)]})},t))})]}),y.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-orange-600 flex items-center gap-2",children:[(0,i.jsx)(iS.A,{className:"w-5 h-5"}),"Proficiencies (",y.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:y.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),"proficiency"===e.type&&e.proficiencies&&(0,i.jsx)("div",{className:"flex gap-2 mt-2",children:e.proficiencies.map((e,t)=>(0,i.jsxs)(aZ,{variant:"secondary",className:"text-xs",children:[e.name," (",e.type,")"]},t))})]}),v(e.type)]})},t))})]}),f.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-indigo-600 flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5"}),"Spell Schools (",f.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:f.map((t,a)=>{var s;if("spell_school"!==t.type||!t.spellSchool)return null;let l=t.spellSchool.schoolId,c=null!=(s=r[l])&&s,d=o.getSpellsBySchool(l);return(0,i.jsx)(aM,{open:c,onOpenChange:e=>n(t=>({...t,[l]:e})),children:(0,i.jsxs)("div",{className:"border rounded-lg",children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:(0,i.jsxs)("div",{className:"flex items-start justify-between w-full",children:[(0,i.jsxs)("div",{className:"space-y-1 text-left",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:t.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(t.type),children:["Level ",t.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:t.description}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:t.spellSchool.name}),(0,i.jsxs)(aZ,{variant:"secondary",className:"text-xs",children:[d.length," spells"]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[v(t.type),c?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})]})})}),(0,i.jsx)(aY,{children:(0,i.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,i.jsx)("h5",{className:"font-medium text-sm text-muted-foreground mb-3",children:"Available Spells:"}),0===d.length?(0,i.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"No spells available in this school yet."}):(0,i.jsx)("div",{className:"space-y-2",children:d.map(t=>{var a;let s=t.tier<=e.spellTierAccess;return(0,i.jsx)("div",{className:"border rounded p-3 ".concat(s?"bg-background":"bg-muted/50"),children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,i.jsx)("span",{className:"font-medium ".concat(s?"text-foreground":"text-muted-foreground"),children:t.name}),(0,i.jsxs)(aZ,{variant:"outline",className:1===(a=t.tier)?"bg-green-100 text-green-800 border-green-200":a<=3?"bg-blue-100 text-blue-800 border-blue-200":a<=6?"bg-purple-100 text-purple-800 border-purple-200":"bg-red-100 text-red-800 border-red-200",children:["Tier ",t.tier]}),void 0!==t.actionCost&&(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:0===t.actionCost?"Bonus Action":1===t.actionCost?"Action":"".concat(t.actionCost," Actions")}),t.resourceCost&&(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:"fixed"===t.resourceCost.type?"".concat(t.resourceCost.amount," ").concat(t.resourceCost.resourceId):"".concat(t.resourceCost.minAmount,"-").concat(t.resourceCost.maxAmount," ").concat(t.resourceCost.resourceId)})]}),(0,i.jsx)("p",{className:"text-sm ".concat(s?"text-muted-foreground":"text-muted-foreground/70"),children:t.description}),t.roll&&(0,i.jsxs)("div",{className:"text-xs ".concat(s?"text-muted-foreground":"text-muted-foreground/70"),children:["Roll: ",t.roll.dice.count,"d",t.roll.dice.sides,t.roll.modifier&&" + ".concat(t.roll.modifier),t.roll.attribute&&" + ".concat(t.roll.attribute)]})]}),(0,i.jsx)("div",{className:"ml-2",children:s?(0,i.jsx)(iA.A,{className:"w-4 h-4 text-green-600"}):(0,i.jsx)(i_.A,{className:"w-4 h-4 text-muted-foreground"})})]})},t.id)})})]})})]})},a)})})]}),g.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-cyan-600 flex items-center gap-2",children:[(0,i.jsx)(iS.A,{className:"w-5 h-5"}),"Spell Tier Access (",g.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:g.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),"spell_tier_access"===e.type&&e.maxTier&&(0,i.jsx)("div",{className:"flex gap-2 mt-2",children:(0,i.jsxs)(aZ,{variant:"secondary",className:"text-xs",children:["Max Tier: ",e.maxTier]})})]}),v(e.type)]})},t))})]}),x.length>0&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-yellow-600 flex items-center gap-2",children:[(0,i.jsx)(aJ.A,{className:"w-5 h-5"}),"Resources (",x.length,")"]}),(0,i.jsx)("div",{className:"space-y-3",children:x.map((e,t)=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-2",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:b(e.type),children:["Level ",e.level]})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),"resource"===e.type&&e.resourceDefinition&&(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsxs)(aZ,{variant:"secondary",className:"text-xs",children:[e.resourceDefinition.name,": ",e.resourceDefinition.maxValue]}),(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:e.resourceDefinition.resetCondition.replace("_"," ")}),(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:e.resourceDefinition.colorScheme})]})]}),v(e.type)]})},t))})]})]})})})})]})}var iT=a(9511);let iR=iT.bL,iD=iT.l9,iL=iT.ZL;iT.bm;let iE=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(iT.hJ,{ref:t,className:c("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});iE.displayName=iT.hJ.displayName;let iP=s.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,i.jsxs)(iL,{children:[(0,i.jsx)(iE,{}),(0,i.jsxs)(iT.UC,{ref:t,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r,children:[s,(0,i.jsxs)(iT.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,i.jsx)(ic.MKb,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});iP.displayName=iT.UC.displayName;let iF=e=>{let{className:t,...a}=e;return(0,i.jsx)("div",{className:c("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};iF.displayName="DialogHeader";let iB=e=>{let{className:t,...a}=e;return(0,i.jsx)("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};iB.displayName="DialogFooter";let iM=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(iT.hE,{ref:t,className:c("text-lg font-semibold leading-none tracking-tight",a),...s})});iM.displayName=iT.hE.displayName;let iW=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(iT.VY,{ref:t,className:c("text-sm text-muted-foreground",a),...s})});function iY(e){let{pickFeature:t,onClose:a}=e,{character:r}=t6(),[n,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(!1);if(!r)return null;let d=tJ(),u=d.getFeaturePool(r.classId,t.poolId),h=d.getAvailablePoolFeatures(r,t.poolId),p=d.getRemainingPoolSelections(r,t);if(!u)return(0,i.jsx)(iR,{open:!0,onOpenChange:a,children:(0,i.jsxs)(iP,{children:[(0,i.jsxs)(iF,{children:[(0,i.jsx)(iM,{children:"Pool Not Found"}),(0,i.jsxs)(iW,{children:["The feature pool ",t.poolId," could not be found."]})]}),(0,i.jsx)(iB,{children:(0,i.jsx)(m,{onClick:a,children:"Close"})})]})});let y=async()=>{if(n){c(!0);try{let e=d.generateFeatureId(r.classId,t.level,t.name);await d.selectPoolFeature(r,t.poolId,n,e),a()}catch(e){console.error("Failed to select pool feature:",e)}finally{c(!1)}}};return(0,i.jsx)(iR,{open:!0,onOpenChange:a,children:(0,i.jsxs)(iP,{className:"max-w-2xl max-h-[80vh]",children:[(0,i.jsxs)(iF,{children:[(0,i.jsxs)(iM,{children:["Select from ",u.name]}),(0,i.jsxs)(iW,{children:[u.description,(0,i.jsx)("br",{}),(0,i.jsxs)("span",{className:"font-medium",children:["Remaining selections: ",p]})]})]}),(0,i.jsx)("div",{className:"flex-1 pr-4 max-h-96 overflow-y-auto",children:(0,i.jsx)("div",{className:"space-y-3",children:0===h.length?(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No features available for selection"}):h.map((e,t)=>(0,i.jsxs)(t9,{className:"cursor-pointer transition-colors ".concat(n===e?"ring-2 ring-primary bg-accent":"hover:bg-accent/50"),onClick:()=>o(e),children:[(0,i.jsx)(ae,{className:"pb-2",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-lg",children:e.name}),(0,i.jsx)(aZ,{className:(e=>{switch(e.type){case"ability":return"bg-red-100 text-red-800";case"passive_feature":return"bg-blue-100 text-blue-800";case"stat_boost":return"bg-green-100 text-green-800";case"proficiency":return"bg-yellow-100 text-yellow-800";case"spell_school":return"bg-purple-100 text-purple-800";case"spell_tier_access":return"bg-indigo-100 text-indigo-800";case"resource":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}})(e),children:(e=>{switch(e.type){case"ability":return"Ability";case"passive_feature":return"Passive Feature";case"stat_boost":return"Stat Boost";case"proficiency":return"Proficiency";case"spell_school":return"Spell School";case"spell_tier_access":return"Spell Tier Access";case"resource":return"Resource";default:return"Feature"}})(e)})]})}),(0,i.jsxs)(ai,{children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),"ability"===e.type&&e.ability&&(0,i.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:[(0,i.jsxs)("div",{children:["Type: ",e.ability.type]}),"action"===e.ability.type&&e.ability.frequency&&(0,i.jsxs)("div",{children:["Frequency: ",e.ability.frequency.replace("_"," ")]})]}),"stat_boost"===e.type&&e.statBoosts&&(0,i.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Boosts: ",e.statBoosts.map(e=>"".concat(e.attribute," ").concat(e.amount>0?"+":"").concat(e.amount)).join(", ")]}),"proficiency"===e.type&&e.proficiencies&&(0,i.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Proficiencies: ",e.proficiencies.map(e=>e.name).join(", ")]})]})]},t))})}),(0,i.jsxs)(iB,{children:[(0,i.jsx)(m,{variant:"outline",onClick:a,children:"Cancel"}),(0,i.jsx)(m,{onClick:y,disabled:!n||l||p<=0,children:l?"Selecting...":"Select Feature"})]})]})})}function iz(){let{character:e}=t6(),[t,a]=(0,s.useState)(null);if(!e)return null;let r=tJ(),n=r.getAvailablePoolSelections(e);return 0===n.length?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t9,{className:"border-orange-200 bg-orange-50",children:[(0,i.jsx)(ae,{children:(0,i.jsxs)(at,{className:"text-lg flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-orange-600",children:""}),"Feature Selections Available",(0,i.jsx)(aZ,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:n.length})]})}),(0,i.jsx)(ai,{className:"space-y-3",children:n.map((t,s)=>{let n=r.getFeaturePool(e.classId,t.poolId),o=r.getRemainingPoolSelections(e,t);return(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium",children:t.name}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:t.description}),n&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["From: ",n.name,"  ",o," selection",1!==o?"s":""," remaining"]})]}),(0,i.jsx)(m,{size:"sm",onClick:()=>{a(t)},disabled:o<=0,children:"Select Feature"})]},s)})})]}),t&&(0,i.jsx)(iY,{pickFeature:t,onClose:()=>{a(null)}})]})}function iO(){return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(iz,{}),(0,i.jsx)(iv,{}),(0,i.jsx)(ii,{}),(0,i.jsx)(ik,{}),(0,i.jsx)(iN,{}),(0,i.jsx)(iI,{})]})}iW.displayName=iT.VY.displayName;var iU=a(3873);function iH(){let{character:e}=t6(),{uiState:t,updateCollapsibleState:a}=ak();if(!e)return null;let s=t.collapsibleSections.armor,r=e.inventory.items.filter(e=>"armor"===e.type&&!0===e.equipped),n=aV(e.inventory.items),o=e.inventory.items.filter(e=>"armor"===e.type&&!0===e.equipped&&!0!==e.isMainArmor),l=e.attributes.dexterity,c=r.map(e=>{var t;let a=e.armor||0,i=Math.min(l,null!=(t=e.maxDexBonus)?t:1/0);return{armor:e,baseArmor:a,dexBonus:i,totalValue:a+i}}),d=0===r.length?Math.max(0,l):c.reduce((e,t)=>e+t.totalValue,0),m=c.reduce((e,t)=>e+t.baseArmor,0),u=c.reduce((e,t)=>e+t.dexBonus,0);return(0,i.jsx)(aM,{open:s,onOpenChange:e=>a("armor",e),children:(0,i.jsxs)(t9,{children:[(0,i.jsx)(aW,{className:"w-full",children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:(0,i.jsxs)(at,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(aU.A,{className:"w-5 h-5"}),"Armor"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-lg font-bold",children:d}),s?(0,i.jsx)(az.A,{className:"w-4 h-4"}):(0,i.jsx)(aO.A,{className:"w-4 h-4"})]})]})})}),(0,i.jsx)(aY,{children:(0,i.jsx)(ai,{className:"space-y-3",children:0===r.length?(0,i.jsxs)("div",{className:"text-center py-4",children:[(0,i.jsx)("div",{className:"text-muted-foreground mb-3",children:"No armor equipped."}),(0,i.jsxs)("div",{className:"text-sm space-y-1",children:[(0,i.jsxs)("div",{children:["Armor Value: ",(0,i.jsx)("span",{className:"font-bold",children:Math.max(0,l)}),l>=0?(0,i.jsxs)("span",{className:"text-green-600 ml-1",children:["(from Dexterity: ",l,")"]}):(0,i.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(minimum: 0, Dex: ",l,")"]})]}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:"Equip armor in your inventory to improve protection."})]})]}):(0,i.jsxs)("div",{className:"space-y-3",children:[n&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Main Armor"}),(()=>{let e=c.find(e=>e.armor.id===n.id);if(!e)return null;let{armor:t,baseArmor:a,dexBonus:s,totalValue:r}=e;return(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-primary/5 border border-primary/20 rounded",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(iU.A,{className:"w-4 h-4 text-primary"}),(0,i.jsx)("span",{className:"font-medium",children:t.name}),t.properties&&t.properties.length>0&&(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",t.properties.join(", "),")"]}),void 0!==t.maxDexBonus&&t.maxDexBonus<1/0&&(0,i.jsxs)("span",{className:"text-xs text-blue-600",children:["(Max Dex: ",t.maxDexBonus,")"]})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"font-bold",children:r}),s>0&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a," + ",s," dex"]})]})]})})()]}),o.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Supplementary Armor"}),(0,i.jsx)("div",{className:"space-y-2",children:o.map(e=>{let t=c.find(t=>t.armor.id===e.id);if(!t)return null;let{baseArmor:a,dexBonus:s,totalValue:r}=t;return(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(aU.A,{className:"w-4 h-4"}),(0,i.jsx)("span",{className:"font-medium",children:e.name}),e.properties&&e.properties.length>0&&(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.properties.join(", "),")"]}),void 0!==e.maxDexBonus&&e.maxDexBonus<1/0&&(0,i.jsxs)("span",{className:"text-xs text-blue-600",children:["(Max Dex: ",e.maxDexBonus,")"]})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"font-bold",children:r}),s>0&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a," + ",s," dex"]})]})]},e.id)})})]}),r.length>1&&(0,i.jsx)("div",{className:"border-t pt-2 mt-2",children:(0,i.jsxs)("div",{className:"flex items-center justify-between font-bold",children:[(0,i.jsx)("span",{children:"Total Armor Value:"}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{children:d}),u>0&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground font-normal",children:[m," base + ",u," dex"]})]})]})})]})})})]})})}var iq=a(5589),iG=a(1190),iV=a(4661);function iK(e){let{isOpen:t,onClose:a,multiSelect:r=!1,selectedItems:n=[],onItemsChange:o,onItemAdd:l}=e,[c,d]=(0,s.useState)(""),[h,y]=(0,s.useState)("all"),[g,x]=(0,s.useState)("all"),[v,b]=(0,s.useState)("all"),[w,j]=(0,s.useState)({}),[N,k]=(0,s.useState)(""),S=t2(),C=tV(),A=(0,s.useMemo)(()=>{let e={};return"all"!==h&&(e.type=h),"all"!==g&&(e.category=g),"all"!==v&&(e.rarity=v),c.trim()&&(e.name=c.trim()),S.filterItems(e)},[c,h,g,v,S]),_=(0,s.useMemo)(()=>{let e={};return A.forEach(t=>{let a="".concat(t.item.type,"-").concat(t.category);e[a]||(e[a]=[]),e[a].push(t)}),e},[A]);return(0,i.jsx)(iR,{open:t,onOpenChange:a,children:(0,i.jsxs)(iP,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,i.jsx)(iF,{children:(0,i.jsxs)(iM,{className:"flex items-center gap-2",children:[(0,i.jsx)(f.A,{className:"h-5 w-5"}),"Item Repository"]})}),(0,i.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col space-y-4",children:[N&&(0,i.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:N}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:"search",className:"text-sm font-medium",children:"Search"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(a1.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,i.jsx)(it,{id:"search",placeholder:"Search items...",value:c,onChange:e=>d(e.target.value),className:"pl-10"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{className:"text-sm font-medium",children:"Type"}),(0,i.jsxs)(id,{value:h,onValueChange:e=>y(e),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"all",children:"All Types"}),(0,i.jsx)(ig,{value:"weapon",children:"Weapons"}),(0,i.jsx)(ig,{value:"armor",children:"Armor"}),(0,i.jsx)(ig,{value:"consumable",children:"Consumables"}),(0,i.jsx)(ig,{value:"ammunition",children:"Ammunition"}),(0,i.jsx)(ig,{value:"freeform",children:"Other Items"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{className:"text-sm font-medium",children:"Category"}),(0,i.jsxs)(id,{value:g,onValueChange:e=>x(e),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"all",children:"All Categories"}),(0,i.jsx)(ig,{value:"mundane",children:"Mundane"}),(0,i.jsx)(ig,{value:"magical",children:"Magical"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{className:"text-sm font-medium",children:"Rarity"}),(0,i.jsxs)(id,{value:v,onValueChange:e=>b(e),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"all",children:"All Rarities"}),(0,i.jsx)(ig,{value:"common",children:"Common"}),(0,i.jsx)(ig,{value:"uncommon",children:"Uncommon"}),(0,i.jsx)(ig,{value:"rare",children:"Rare"}),(0,i.jsx)(ig,{value:"very-rare",children:"Very Rare"}),(0,i.jsx)(ig,{value:"legendary",children:"Legendary"})]})]})]})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4",children:0===Object.keys(_).length?(0,i.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,i.jsx)(f.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,i.jsx)("p",{children:"No items found matching your criteria"})]}):Object.entries(_).map(e=>{var t;let[a,s]=e,c=null==(t=w[a])||t,d=(e=>{let[t,a]=e.split("-"),i=t.charAt(0).toUpperCase()+t.slice(1)+"s",s=a.charAt(0).toUpperCase()+a.slice(1);return"".concat(s," ").concat(i)})(a);return(0,i.jsx)(t9,{children:(0,i.jsxs)(aM,{open:c,onOpenChange:()=>{j(e=>({...e,[a]:!e[a]}))},children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50 pb-3",children:(0,i.jsxs)(at,{className:"flex items-center justify-between text-base",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{let t={className:"h-4 w-4"};switch(e){case"weapon":return(0,i.jsx)(u.A,{...t});case"armor":return(0,i.jsx)(aU.A,{...t});case"consumable":return(0,i.jsx)(iV.A,{...t});case"ammunition":return(0,i.jsx)(p.A,{...t});case"freeform":return(0,i.jsx)(iw.A,{...t});default:return(0,i.jsx)(f.A,{...t})}})(s[0].item.type),d,(0,i.jsx)(aZ,{variant:"secondary",children:s.length})]}),c?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})})}),(0,i.jsx)(aY,{children:(0,i.jsx)(ai,{className:"pt-0",children:(0,i.jsx)("div",{className:"grid gap-2",children:s.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded hover:bg-muted/30",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("span",{className:"font-medium",children:e.item.name}),(0,i.jsx)(aZ,{variant:"outline",className:"magical"===e.category?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800",children:e.category}),e.rarity&&(0,i.jsxs)("div",{className:"flex items-center gap-1 ".concat((e=>{switch(e){case"common":return"text-gray-600";case"uncommon":return"text-green-600";case"rare":return"text-blue-600";case"very-rare":return"text-purple-600";case"legendary":return"text-orange-600";default:return"text-gray-500"}})(e.rarity)),children:[(0,i.jsx)(iS.A,{className:"h-3 w-3"}),(0,i.jsx)("span",{className:"text-xs font-medium",children:e.rarity})]})]}),e.item.description&&(0,i.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.item.description}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,i.jsxs)("span",{children:["Size: ",e.item.size]}),"weapon"===e.item.type&&e.item.damage&&(0,i.jsxs)("span",{children:["Damage: ",e.item.damage]}),"armor"===e.item.type&&e.item.armor&&(0,i.jsxs)("span",{children:["AC: ",e.item.armor]}),("consumable"===e.item.type||"ammunition"===e.item.type)&&e.item.count&&(0,i.jsxs)("span",{children:["Count: ",e.item.count]}),("weapon"===e.item.type||"armor"===e.item.type)&&e.item.properties&&e.item.properties.length>0&&(0,i.jsxs)("span",{children:["Properties: ",e.item.properties.join(", ")]})]})]}),(0,i.jsx)(m,{size:"sm",variant:r&&n.includes(e.item.id)?"default":"outline",onClick:()=>(e=>{if(r&&o)n.includes(e)?o(n.filter(t=>t!==e)):o([...n,e]);else if(l)l(e);else{let t=S.createInventoryItem(e);if(!t)return void console.error("Failed to create inventory item");if(!C.getCurrentCharacter())return void console.error("No current character");try{C.addItemToInventory(t),k("Added ".concat(t.name," to inventory")),setTimeout(()=>k(""),2e3)}catch(e){console.error("Failed to add item to inventory:",e)}}})(e.item.id),className:"ml-4",children:r?n.includes(e.item.id)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"h-4 w-4 mr-1",children:""}),"Selected"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ah.A,{className:"h-4 w-4 mr-1"}),"Select"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ah.A,{className:"h-4 w-4 mr-1"}),"Add"]})})]},e.item.id))})})})]})},a)})}),(0,i.jsxs)("div",{className:"border-t pt-4 text-sm text-muted-foreground",children:["Showing ",A.length," items  Repository contains ",S.getAllItems().length," total items",r&&n.length>0&&(0,i.jsxs)("span",{className:"ml-2 text-primary font-medium",children:[" ",n.length," selected"]})]})]})]})})}function iJ(e){var t;let{item:a,onItemChange:s,idPrefix:r=""}=e,n=e=>r?"".concat(r,"-").concat(e):e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("item-name"),children:"Name"}),(0,i.jsx)(it,{id:n("item-name"),value:a.name,onChange:e=>s({...a,name:e.target.value}),placeholder:"Item name"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("item-description"),children:"Description"}),(0,i.jsx)(it,{id:n("item-description"),value:a.description||"",onChange:e=>s({...a,description:e.target.value}),placeholder:"Item description"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("item-size"),children:"Size"}),(0,i.jsx)(it,{id:n("item-size"),type:"number",min:"0",value:a.size,onChange:e=>s({...a,size:parseInt(e.target.value)||0}),placeholder:"Size"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("item-type"),children:"Type"}),(0,i.jsxs)(id,{value:a.type,onValueChange:e=>s({...a,type:e}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"Select type"})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"freeform",children:"Freeform"}),(0,i.jsx)(ig,{value:"weapon",children:"Weapon"}),(0,i.jsx)(ig,{value:"armor",children:"Armor"}),(0,i.jsx)(ig,{value:"consumable",children:"Consumable"}),(0,i.jsx)(ig,{value:"ammunition",children:"Ammunition"})]})]})]})]}),"weapon"===a.type&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("weapon-attribute"),children:"Attribute"}),(0,i.jsxs)(id,{value:a.attribute||"",onValueChange:e=>s({...a,attribute:e}),children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"Select attribute"})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"strength",children:"Strength"}),(0,i.jsx)(ig,{value:"dexterity",children:"Dexterity"}),(0,i.jsx)(ig,{value:"intelligence",children:"Intelligence"}),(0,i.jsx)(ig,{value:"will",children:"Will"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("weapon-damage"),children:"Damage"}),(0,i.jsx)(it,{id:n("weapon-damage"),value:a.damage||"",onChange:e=>s({...a,damage:e.target.value}),placeholder:"e.g., 1d8"})]})]}),"armor"===a.type&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("armor-value"),children:"Armor"}),(0,i.jsx)(it,{id:n("armor-value"),type:"number",value:a.armor||"",onChange:e=>s({...a,armor:parseInt(e.target.value)||void 0}),placeholder:"Armor value"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("max-dex-bonus"),children:"Max Dex Bonus"}),(0,i.jsx)(it,{id:n("max-dex-bonus"),type:"number",value:null!=(t=a.maxDexBonus)?t:"",onChange:e=>s({...a,maxDexBonus:""===e.target.value?void 0:parseInt(e.target.value)||0}),placeholder:"No limit"})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("input",{id:n("is-main-armor"),type:"checkbox",checked:a.isMainArmor||!1,onChange:e=>s({...a,isMainArmor:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,i.jsx)(io,{htmlFor:n("is-main-armor"),className:"text-sm",children:"Main Armor (suits of armor, not helmets or shields)"})]})]}),("consumable"===a.type||"ammunition"===a.type)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:n("item-count"),children:"Count"}),(0,i.jsx)(it,{id:n("item-count"),type:"number",min:"1",value:a.count||1,onChange:e=>s({...a,count:parseInt(e.target.value)||1}),placeholder:"1"})]})})]})}function iX(e){let{inventory:t,characterDexterity:r,onUpdateInventory:n}=e,[o,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[h,y]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),[v,b]=(0,s.useState)({name:"",size:1,type:"freeform"}),[w,j]=(0,s.useState)({name:"",size:1,type:"freeform"}),N=t.items.reduce((e,t)=>("weapon"===t.type||"armor"===t.type)&&t.equipped?e:e+t.size,0),k=t.maxSize>0?N/t.maxSize*100:0,S=(e,a)=>{let i=t.items.find(t=>t.id===e);if(!i||"consumable"!==i.type&&"ammunition"!==i.type)return;let s=Math.max(1,i.count+a),r=t.items.map(t=>t.id===e?{...t,count:s}:t);n({...t,items:r})},A=async e=>{let i,s=t.items.find(t=>t.id===e);if(!s||"consumable"!==s.type&&"ammunition"!==s.type)return;let r=s.count-1,o=r<=0,l={id:crypto.randomUUID(),timestamp:new Date,description:"Consumed ".concat(s.name).concat(o?" (last one)":" (".concat(r," remaining)")),type:"item_consumption",itemName:s.name,itemType:s.type,countBefore:s.count,countAfter:r,itemRemoved:o};try{let{ActivityLogService:e}=await Promise.resolve().then(a.bind(a,829)),t=new e;await t.addLogEntry(l)}catch(e){console.error("Failed to log item consumption:",e)}i=o?t.items.filter(t=>t.id!==e):t.items.map(t=>t.id===e?{...t,count:r}:t),n({...t,items:i})};return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(iR,{open:o,onOpenChange:l,children:[(0,i.jsx)(iD,{asChild:!0,children:(0,i.jsxs)(m,{size:"sm",children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),"Add Item"]})}),(0,i.jsxs)(iP,{children:[(0,i.jsx)(iF,{children:(0,i.jsx)(iM,{children:"Add New Item"})}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(iJ,{item:v,onItemChange:b,idPrefix:"add"}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,i.jsx)(m,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),(0,i.jsx)(m,{onClick:()=>{let e;v.name.trim()&&(e="weapon"===v.type?{id:crypto.randomUUID(),name:v.name,size:v.size,type:"weapon",attribute:v.attribute,damage:v.damage,properties:v.properties,description:v.description}:"armor"===v.type?{id:crypto.randomUUID(),name:v.name,size:v.size,type:"armor",armor:v.armor,maxDexBonus:v.maxDexBonus,isMainArmor:v.isMainArmor,properties:v.properties,description:v.description}:"consumable"===v.type?{id:crypto.randomUUID(),name:v.name,size:v.size,type:"consumable",count:v.count||1,description:v.description}:"ammunition"===v.type?{id:crypto.randomUUID(),name:v.name,size:v.size,type:"ammunition",count:v.count||1,description:v.description}:{id:crypto.randomUUID(),name:v.name,size:v.size,type:"freeform",description:v.description},n({...t,items:[...t.items,e]}),b({name:"",size:1,type:"freeform"}),l(!1))},disabled:!v.name.trim(),children:"Add Item"})]})]})]})]}),(0,i.jsxs)(m,{size:"sm",variant:"outline",onClick:()=>y(!0),children:[(0,i.jsx)(a1.A,{className:"w-4 h-4 mr-2"}),"Browse Items"]})]}),(0,i.jsx)(iR,{open:c,onOpenChange:d,children:(0,i.jsxs)(iP,{children:[(0,i.jsx)(iF,{children:(0,i.jsx)(iM,{children:"Edit Item"})}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(iJ,{item:w,onItemChange:j,idPrefix:"edit"}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,i.jsx)(m,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,i.jsx)(m,{onClick:()=>{var e,a;let i;w.name.trim()&&g&&(i="weapon"===w.type?{id:g,name:w.name,size:w.size,type:"weapon",attribute:w.attribute,damage:w.damage,properties:w.properties,description:w.description,equipped:(null==(e=t.items.find(e=>e.id===g))?void 0:e.equipped)||!1}:"armor"===w.type?{id:g,name:w.name,size:w.size,type:"armor",armor:w.armor,maxDexBonus:w.maxDexBonus,isMainArmor:w.isMainArmor,properties:w.properties,description:w.description,equipped:(null==(a=t.items.find(e=>e.id===g))?void 0:a.equipped)||!1}:"consumable"===w.type?{id:g,name:w.name,size:w.size,type:"consumable",count:w.count||1,description:w.description}:"ammunition"===w.type?{id:g,name:w.name,size:w.size,type:"ammunition",count:w.count||1,description:w.description}:{id:g,name:w.name,size:w.size,type:"freeform",description:w.description},n({...t,items:t.items.map(e=>e.id===g?i:e)}),j({name:"",size:1,type:"freeform"}),x(null),d(!1))},disabled:!w.name.trim(),children:"Save Changes"})]})]})]})})]}),t.maxSize>0&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"relative flex items-center justify-between text-sm",children:[(0,i.jsx)("span",{children:"Inventory Space"}),(0,i.jsxs)("span",{className:"absolute left-1/2 transform -translate-x-1/2 ".concat(N>t.maxSize?"text-destructive":"text-muted-foreground"),children:[N," / ",t.maxSize]}),(0,i.jsxs)("span",{className:N>t.maxSize?"text-destructive":"",children:[Math.round(k),"%"]})]}),(0,i.jsx)("div",{className:"w-full bg-muted rounded-full h-2",children:(0,i.jsx)("div",{className:"h-2 rounded-full transition-all ".concat(N>t.maxSize?"bg-destructive":k>80?"bg-yellow-500":"bg-primary"),style:{width:"".concat(Math.min(k,100),"%")}})})]}),(0,i.jsx)("div",{className:"space-y-2",children:0===t.items.length?(0,i.jsx)(t9,{children:(0,i.jsx)(ai,{className:"p-6 text-center text-muted-foreground",children:"No items in inventory. Click Add Item to get started."})}):t.items.map(e=>(0,i.jsx)(t9,{children:(0,i.jsx)(ai,{className:"p-3",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsxs)("div",{className:"shrink-0 mt-1 flex flex-col items-center",children:[(e=>{switch(e.type){case"weapon":return(0,i.jsx)(u.A,{className:"w-4 h-4"});case"armor":return e.isMainArmor?(0,i.jsx)(iU.A,{className:"w-4 h-4"}):(0,i.jsx)(aU.A,{className:"w-4 h-4"});case"consumable":return(0,i.jsx)(iq.A,{className:"w-4 h-4"});case"ammunition":return(0,i.jsx)(p.A,{className:"w-4 h-4"});default:return(0,i.jsx)(f.A,{className:"w-4 h-4"})}})(e),(0,i.jsx)("div",{className:"flex flex-col gap-0.5 mt-1",children:Array.from({length:e.size},(e,t)=>(0,i.jsx)("div",{className:"w-2 h-2 bg-muted border border-muted-foreground/20 rounded-sm"},t))})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"flex items-center space-x-2",children:(0,i.jsx)("span",{className:"font-medium",children:e.name})}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)("span",{className:"text-xs bg-muted px-2 py-1 rounded capitalize",children:e.type})}),(e=>{switch(e.type){case"weapon":return(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[e.attribute&&(0,i.jsxs)("div",{children:["Attribute: ",e.attribute.slice(0,3).toUpperCase()]}),e.damage&&(0,i.jsxs)("div",{children:["Damage: ",e.damage]}),e.properties&&e.properties.length>0&&(0,i.jsxs)("div",{children:["Properties: ",e.properties.join(", ")]})]});case"armor":var t;let a=e.armor||0,s=null!=(t=e.maxDexBonus)?t:1/0,n=Math.min(r,s);return(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 space-y-1",children:[e.isMainArmor&&(0,i.jsxs)("div",{className:"flex items-center gap-1 text-primary",children:[(0,i.jsx)(iU.A,{className:"w-3 h-3"}),(0,i.jsx)("span",{className:"font-medium",children:"Main Armor"})]}),(0,i.jsxs)("div",{children:["Armor: ",a,r>0&&s>0&&(0,i.jsxs)("span",{className:"text-green-600",children:[" ","+ ",n," dex = ",a+n]}),s<1/0&&(0,i.jsxs)("span",{className:"text-blue-600 ml-1",children:["(max dex: ",s,")"]})]}),e.properties&&e.properties.length>0&&(0,i.jsxs)("div",{children:["Properties: ",e.properties.join(", ")]})]});case"freeform":return e.description?(0,i.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.description}):null;case"consumable":case"ammunition":return(0,i.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[(0,i.jsxs)("div",{className:"font-medium text-primary",children:["Count: ",e.count]}),e.description&&(0,i.jsx)("div",{children:e.description})]})}})(e)]})]}),(0,i.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[("weapon"===e.type||"armor"===e.type)&&(0,i.jsx)(m,{variant:e.equipped?"default":"outline",size:"sm",onClick:()=>(e=>{let a,i=t.items.find(t=>t.id===e);if(!i||"weapon"!==i.type&&"armor"!==i.type)return;let s=!i.equipped;if(s){let e=function(e,t){if("weapon"===t.type){if(!(t.equipped||aK(e)+t.size<=C.L.equipment.maxWeaponSize)){let a=aK(e),i=C.L.equipment.maxWeaponSize;return"Cannot equip weapon: total weapon size would be ".concat(a+t.size,", maximum allowed is ").concat(i)}}else if("armor"===t.type){if(!function(e,t){if(t.equipped)return!0;if(t.isMainArmor){let a=aV(e);return null===a||a.id===t.id}return!0}(e,t))return"Cannot equip armor: only one main armor piece can be equipped at a time";if(t.isMainArmor&&!t.equipped){let t=aV(e);if(t)return"Equipping this main armor will unequip ".concat(t.name)}}return null}(t.items,i);if(e){if("armor"!==i.type||!i.isMainArmor)return void alert(e);else if(!confirm(e+". Continue?"))return}}a=s&&"armor"===i.type&&i.isMainArmor?function(e,t){if(t.isMainArmor){let a=aV(e);a&&a.id!==t.id&&(e=e.map(e=>e.id===a.id?{...e,equipped:!1}:e))}return e.map(e=>e.id===t.id?{...e,equipped:!0}:e)}(t.items,i):t.items.map(t=>t.id===e?{...t,equipped:s}:t),n({...t,items:a})})(e.id),className:e.equipped?"text-white":"",children:e.equipped?"Equipped":"Equip"}),"consumable"===e.type&&(0,i.jsxs)(m,{variant:"default",size:"sm",onClick:()=>A(e.id),className:"h-8 px-2",children:[(0,i.jsx)(aJ.A,{className:"w-3 h-3 mr-1"}),"Use"]}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>(e=>{x(e.id);let t={name:e.name,size:e.size,type:e.type};"weapon"===e.type?(t.attribute=e.attribute,t.damage=e.damage,t.properties=e.properties,t.description=e.description):"armor"===e.type?(t.armor=e.armor,t.maxDexBonus=e.maxDexBonus,t.isMainArmor=e.isMainArmor,t.properties=e.properties,t.description=e.description):"freeform"===e.type?t.description=e.description:("consumable"===e.type||"ammunition"===e.type)&&(t.count=e.count,t.description=e.description),j(t),d(!0)})(e),className:"text-muted-foreground hover:text-foreground",children:(0,i.jsx)(iG.A,{className:"w-4 h-4"})}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>{var a;return a=e.id,void n({...t,items:t.items.filter(e=>e.id!==a)})},className:"text-destructive hover:text-destructive",children:(0,i.jsx)(ij.A,{className:"w-4 h-4"})})]}),("consumable"===e.type||"ammunition"===e.type)&&(0,i.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>S(e.id,-1),disabled:e.count<=1,className:"h-7 w-7 p-0",children:(0,i.jsx)(au.A,{className:"w-3 h-3"})}),(0,i.jsx)("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:e.count}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>S(e.id,1),className:"h-7 w-7 p-0",children:(0,i.jsx)(ah.A,{className:"w-3 h-3"})})]})]})]})})},e.id))}),(0,i.jsx)(iK,{isOpen:h,onClose:()=>y(!1)})]})}function iZ(){let{character:e,updateCharacter:t}=t6(),{uiState:a,updateCollapsibleState:r}=ak(),n=(0,s.useCallback)(async a=>{if(!e)return;let i={...e,inventory:a};await t(i)},[e,t]);if(!e)return null;let o=a.collapsibleSections.inventory,l=e.inventory,c=e.attributes.dexterity;return(0,i.jsxs)(aM,{open:o,onOpenChange:e=>r("inventory",e),children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Inventory"}),o?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(iX,{inventory:l,characterDexterity:c,onUpdateInventory:n})})})]})}function iQ(){return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(iH,{}),(0,i.jsx)(iZ,{})]})}function i$(){let{character:e,performUseAbility:t}=t6(),{uiState:a,updateCollapsibleState:r}=ak(),[n,o]=(0,s.useState)({}),[l,c]=(0,s.useState)({}),d=tE.getInstance(),[u,p]=(0,s.useState)(!1);if(!e)return null;let y=e.abilities.filter(e=>"spell"===e.type),f=e.resources.find(e=>"mana"===e.definition.id.toLowerCase()||e.definition.name.toLowerCase().includes("mana")),g=d.getAllClassFeaturesUpToLevel(e.classId,e.level).filter(e=>"spell_school"===e.type),x=(()=>{let t={};return g.forEach(a=>{if("spell_school"===a.type&&a.spellSchool){let i=a.spellSchool.schoolId,s=d.getSpellsBySchool(i).filter(t=>t.tier>e.spellTierAccess);s.length>0&&(t[i]=s)}}),t})();if(0===y.length)return(0,i.jsxs)(t9,{className:"w-full",children:[(0,i.jsx)(ae,{children:(0,i.jsxs)(at,{className:"flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5 text-purple-500"}),"Spells"]})}),(0,i.jsx)(ai,{children:(0,i.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No spells available. Gain spell school access to learn spells!"})})]});let v=y.reduce((e,t)=>(e[t.school]||(e[t.school]=[]),e[t.school].push(t),e),{});Object.values(v).forEach(e=>{e.sort((e,t)=>e.tier!==t.tier?e.tier-t.tier:e.name.localeCompare(t.name))});let b=e=>{switch(e.toLowerCase()){case"fire":return"text-red-600";case"radiant":return"text-yellow-600";case"frost":return"text-blue-600";case"nature":return"text-green-600";case"shadow":return"text-purple-600";case"arcane":return"text-indigo-600";default:return"text-gray-600"}},w=e=>1===e?"bg-green-100 text-green-800 border-green-200":e<=3?"bg-blue-100 text-blue-800 border-blue-200":e<=6?"bg-purple-100 text-purple-800 border-purple-200":"bg-red-100 text-red-800 border-red-200",j=e=>e.charAt(0).toUpperCase()+e.slice(1)+" Magic",N=async e=>{await t(e.id)};return(0,i.jsxs)(t9,{className:"w-full",children:[(0,i.jsx)(ae,{children:(0,i.jsxs)(at,{className:"flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-5 h-5 text-purple-500"}),"Spells",(0,i.jsxs)(aZ,{variant:"secondary",className:"ml-2",children:["Tier ",e.spellTierAccess," Access"]})]})}),(0,i.jsxs)(ai,{className:"space-y-6",children:[f&&(0,i.jsxs)("div",{className:"border rounded-lg p-4 bg-muted/30",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(h.A,{className:"w-4 h-4 text-blue-500"}),(0,i.jsx)("span",{className:"font-medium",children:f.definition.name})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"text-lg font-bold",children:f.current}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:["/ ",f.definition.maxValue]})]})]}),(0,i.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:(0,i.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-200",style:{width:"".concat(Math.max(0,Math.min(100,f.current/f.definition.maxValue*100)),"%")}})})]}),Object.entries(v).map(t=>{var a;let[s,r]=t,l=null==(a=n[s])||a;return(0,i.jsxs)(aM,{open:l,onOpenChange:e=>{o(t=>({...t,[s]:e}))},children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 ".concat(b(s)),children:[(0,i.jsx)(h.A,{className:"w-5 h-5"}),j(s)," (",r.length,")"]}),l?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"space-y-3 pt-2",children:r.map(t=>{var a,s;let r=function(e,t){if(!t.resourceCost)return!0;let a=e.resources.find(e=>e.definition.id===t.resourceCost.resourceId);return!!a&&("fixed"===t.resourceCost.type?a.current>=t.resourceCost.amount:a.current>=t.resourceCost.minAmount)}(e,t),n=function(e,t){if(!t.resourceCost)return null;let a=e.resources.find(e=>e.definition.id===t.resourceCost.resourceId);if(!a)return"Missing required resource";if("fixed"===t.resourceCost.type){if(a.current<t.resourceCost.amount)return"Insufficient ".concat(a.definition.name," (").concat(a.current,"/").concat(t.resourceCost.amount," required)")}else if(a.current<t.resourceCost.minAmount)return"Insufficient ".concat(a.definition.name," (").concat(a.current,"/").concat(t.resourceCost.minAmount," minimum required)");return null}(e,t);return(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-3",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h4",{className:"font-semibold",children:t.name}),(0,i.jsxs)(aZ,{variant:"outline",className:w(t.tier),children:["Tier ",t.tier]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[void 0!==t.actionCost&&(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:void 0===(a=t.actionCost)?"":0===a?"Free Action":1===a?"Action":"".concat(a," Actions")}),t.resourceCost&&(0,i.jsx)(aZ,{variant:r?"secondary":"destructive",className:"text-xs",children:"fixed"===(s=t.resourceCost).type?"".concat(s.amount," ").concat(s.resourceId):"".concat(s.minAmount,"-").concat(s.maxAmount," ").concat(s.resourceId)})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:t.description}),t.roll&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Roll: ",t.roll.dice.count,"d",t.roll.dice.sides,t.roll.modifier&&" + ".concat(t.roll.modifier),t.roll.attribute&&" + ".concat(t.roll.attribute)]})]}),(0,i.jsx)(m,{size:"sm",variant:r?"outline":"ghost",onClick:()=>N(t),className:"ml-4",disabled:!r,title:n||"Cast spell",children:(0,i.jsx)(aJ.A,{className:"w-4 h-4"})})]})},t.id)})})})]},s)}),Object.keys(x).length>0&&(0,i.jsx)("div",{className:"pt-6 border-t",children:(0,i.jsxs)(aM,{open:u,onOpenChange:p,children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 text-muted-foreground",children:[(0,i.jsx)(i_.A,{className:"w-5 h-5"}),"Locked Spells"]}),u?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"space-y-4 pt-2",children:Object.entries(x).map(e=>{var t,a;let[s,r]=e,n=g.find(e=>{var t;return"spell_school"===e.type&&(null==(t=e.spellSchool)?void 0:t.schoolId)===s});null==n||null==(t=n.spellSchool)||t.name;let o=null!=(a=l[s])&&a;return(0,i.jsxs)(aM,{open:o,onOpenChange:e=>{c(t=>({...t,[s]:e}))},children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsxs)(m,{variant:"ghost",className:"w-full justify-between p-4 h-auto",children:[(0,i.jsxs)("h4",{className:"font-semibold flex items-center gap-2 ".concat(b(s)),children:[(0,i.jsx)(h.A,{className:"w-4 h-4"}),j(s)," (",r.length," locked)"]}),o?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)("div",{className:"space-y-3 pt-2 pl-4",children:r.map(e=>(0,i.jsx)("div",{className:"border rounded-lg p-4 space-y-3 bg-muted/30",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,i.jsx)("h5",{className:"font-semibold text-muted-foreground",children:e.name}),(0,i.jsxs)(aZ,{variant:"outline",className:w(e.tier),children:["Tier ",e.tier]}),(0,i.jsxs)(aZ,{variant:"outline",className:"text-red-600 border-red-600",children:["Requires Tier ",e.tier," Access"]}),void 0!==e.actionCost&&(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:0===e.actionCost?"Bonus Action":1===e.actionCost?"Action":"".concat(e.actionCost," Actions")}),e.resourceCost&&(0,i.jsx)(aZ,{variant:"secondary",className:"text-xs",children:"fixed"===e.resourceCost.type?"".concat(e.resourceCost.amount," ").concat(e.resourceCost.resourceId):"".concat(e.resourceCost.minAmount,"-").concat(e.resourceCost.maxAmount," ").concat(e.resourceCost.resourceId)})]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground/70",children:e.description}),e.roll&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground/70",children:["Roll: ",e.roll.dice.count,"d",e.roll.dice.sides,e.roll.modifier&&" + ".concat(e.roll.modifier),e.roll.attribute&&" + ".concat(e.roll.attribute)]})]}),(0,i.jsx)(i_.A,{className:"w-4 h-4 text-muted-foreground ml-4"})]})},e.id))})})]},s)})})})]})})]})]})}function i0(){return(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsx)(i$,{})})}function i1(e){let{entries:t,onClearRolls:a}=e,s=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,i.jsx)(ar,{children:(0,i.jsxs)(t9,{className:"w-full",children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(at,{children:"Character Log"}),t.length>0&&(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:a,children:"Clear"})]})}),(0,i.jsx)(ai,{children:0===t.length?(0,i.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No activity yet. Roll dice or take damage to see logs!"}):(0,i.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(e=>(0,i.jsx)("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded text-sm",children:"roll"===e.type?(0,i.jsx)(i2,{roll:e,formatTime:s}):(0,i.jsx)(i4,{entry:e,formatTime:s})},e.id))})})]})})}function i2(e){let{roll:t,formatTime:a}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"font-medium",children:t.description}),(0,i.jsxs)("span",{className:"text-muted-foreground",children:["(",(e=>{let t=1===e.dice.length?"d".concat(e.dice[0].type):"".concat(e.dice.length,"d").concat(e.dice[0].type),a=e.modifier>=0?"+".concat(e.modifier):"".concat(e.modifier);return"".concat(t).concat(a)})(t),")"]}),t.criticalHits&&t.criticalHits>0&&(0,i.jsxs)("span",{className:"text-yellow-600 font-semibold text-xs bg-yellow-100 px-2 py-1 rounded",children:["CRIT x",t.criticalHits]}),t.advantageLevel&&t.advantageLevel>0&&(0,i.jsxs)("span",{className:"text-green-600 font-semibold text-xs bg-green-100 px-2 py-1 rounded",children:["ADV ",t.advantageLevel]}),t.advantageLevel&&t.advantageLevel<0&&(0,i.jsxs)("span",{className:"text-red-600 font-semibold text-xs bg-red-100 px-2 py-1 rounded",children:["DIS ",Math.abs(t.advantageLevel)]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:a(t.timestamp)}),(0,i.jsxs)(an,{children:[(0,i.jsx)(ao,{asChild:!0,children:(0,i.jsx)("span",{className:"font-bold text-lg min-w-8 text-right cursor-help ".concat(t.isMiss?"text-destructive":""),children:t.isMiss?"MISS":t.total})}),(0,i.jsx)(al,{children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"font-semibold",children:"Roll Breakdown"}),t.isMiss&&(0,i.jsx)("div",{className:"text-destructive font-semibold",children:"MISS!"}),t.criticalHits&&t.criticalHits>0&&(0,i.jsxs)("div",{className:"text-yellow-600 font-semibold",children:["CRITICAL HIT! (",t.criticalHits," crits)"]}),t.advantageLevel&&0!==t.advantageLevel&&(0,i.jsx)("div",{className:t.advantageLevel>0?"text-green-600 font-semibold":"text-red-600 font-semibold",children:t.advantageLevel>0?"Advantage ".concat(t.advantageLevel):"Disadvantage ".concat(Math.abs(t.advantageLevel))}),(0,i.jsxs)("div",{className:"text-sm mt-1",children:[t.dice.map((e,t)=>(0,i.jsxs)("div",{className:e.isCritical?"text-yellow-600 font-semibold":"",children:["d",e.type,": ",e.result," ",e.isCritical?"(CRIT!)":""]},t)),t.droppedDice&&t.droppedDice.length>0&&(0,i.jsxs)("div",{className:"text-muted-foreground mt-1 pt-1 border-t",children:[(0,i.jsx)("div",{className:"text-xs font-semibold",children:"Dropped dice:"}),t.droppedDice.map((e,t)=>(0,i.jsxs)("div",{className:"text-xs line-through",children:["d",e.type,": ",e.result]},t))]})]}),0!==t.modifier&&(0,i.jsxs)("div",{className:"text-sm",children:["Modifier: ",t.modifier>=0?"+":"",t.modifier]}),(0,i.jsxs)("div",{className:"text-sm border-t pt-1 mt-1",children:["Total: ",t.total]})]})})]})]})]})}function i4(e){let{entry:t,formatTime:a}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-lg",children:(()=>{switch(t.type){case"damage":return"";case"healing":return"";case"temp_hp":return"\uD83D\uDEE1";case"initiative":return"";case"ability_usage":return"";case"safe_rest":return"\uD83C\uDFE0";case"catch_breath":return"\uD83D\uDCA8";case"make_camp":return"\uD83C\uDFD5";case"resource":return"\uD83D\uDC8E";case"spell_cast":return"\uD83D\uDD2E";case"item_consumption":return"\uD83E\uDDEA";default:return"\uD83D\uDCDD"}})()}),(0,i.jsx)("span",{className:"font-medium",children:t.description})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:a(t.timestamp)}),(0,i.jsx)("span",{className:"font-bold text-lg min-w-8 text-right ".concat((()=>{switch(t.type){case"damage":return"text-red-600";case"healing":return"text-green-600";case"temp_hp":case"catch_breath":return"text-blue-600";case"initiative":return"text-yellow-600";case"ability_usage":case"resource":return"text-purple-600";case"safe_rest":return"text-green-700";case"make_camp":return"text-orange-600";case"spell_cast":return"text-indigo-600";default:return"text-muted-foreground"}})()),children:"damage"===t.type?"-".concat(t.amount):"healing"===t.type||"temp_hp"===t.type?"+".concat(t.amount):"initiative"===t.type?"".concat(t.actionsGranted," acts"):"ability_usage"===t.type?"".concat(t.usesRemaining,"/").concat(t.maxUses):"safe_rest"===t.type?"REST":"catch_breath"===t.type||"make_camp"===t.type?"+".concat(t.healingAmount):"resource"===t.type?"spent"===t.action?"-".concat(t.amount):"+".concat(t.amount):""})]})]})}function i3(){let{logEntries:e,handleClearRolls:t}=ab();return(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsx)(i1,{entries:e,onClearRolls:t})})}function i5(){let{uiState:e,updateActiveTab:t}=ak(),{character:a}=t6(),r=e.activeTab,n=a&&a.spellTierAccess>=0&&a.abilities.some(e=>"spell"===e.type);return(0,s.useEffect)(()=>{"spells"!==r||n||t("combat")},[r,n,t]),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"pb-32 sm:pb-36 min-h-[calc(100vh-8rem)]",children:(()=>{switch(r){case"combat":default:return(0,i.jsx)(a0,{});case"skills":return(0,i.jsx)(ie,{});case"character":return(0,i.jsx)(iO,{});case"equipment":return(0,i.jsx)(iQ,{});case"spells":return(0,i.jsx)(i0,{});case"log":return(0,i.jsx)(i3,{})}})()}),(0,i.jsx)(t7,{activeTab:r,onTabChange:t}),(0,i.jsx)("div",{className:"fixed bottom-14 sm:bottom-16 left-0 right-0 border-t bg-muted/30 py-2 px-4 z-40",children:(0,i.jsx)("div",{className:"container mx-auto",children:(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Nimble Navigator is an independent product published under the Nimble 3rd Party Creator License and is not affiliated with Nimble Co. Nimble \xa9 2025 Nimble Co."})})})]})}var i6=a(368);function i8(e){let{open:t,onOpenChange:a,title:s,titleIcon:r,steps:n,currentStep:o,onStepChange:l,children:d,onNext:m,onPrevious:u,canProceed:h=!0,nextButtonText:p,previousButtonText:y,className:f,contentClassName:g,completedSteps:x=[]}=e,v=0===o,b=o===n.length-1;return(0,i.jsx)(iR,{open:t,onOpenChange:a,children:(0,i.jsxs)(iP,{className:c("max-w-2xl max-h-[90vh] overflow-hidden flex flex-col p-0",f),children:[(0,i.jsx)(iF,{className:"px-6 pt-6",children:(0,i.jsxs)(iM,{className:"flex items-center gap-2",children:[r,s]})}),(0,i.jsx)(i7,{steps:n,currentStep:o,completedSteps:x}),(0,i.jsx)("div",{className:c("flex-1 overflow-y-auto",g),children:d}),(0,i.jsx)(i9,{onPrevious:()=>{u?u():o>0&&l(o-1)},onNext:()=>{m?m():o<n.length-1&&l(o+1)},canProceed:h,isFirstStep:v,isLastStep:b,currentStep:o,totalSteps:n.length,nextButtonText:p,previousButtonText:y})]})})}function i7(e){let{steps:t,currentStep:a,completedSteps:r=[]}=e,n=s.useRef(null),o=s.useRef(null);return s.useEffect(()=>{if(o.current&&n.current){let e=n.current,t=o.current,a=e.clientWidth,i=t.offsetLeft,s=t.clientWidth;e.scrollTo({left:i-a/2+s/2,behavior:"smooth"})}},[a]),(0,i.jsx)("div",{className:"w-full py-4",children:(0,i.jsx)("div",{ref:n,className:"overflow-x-auto scrollbar-hide",children:(0,i.jsx)("div",{className:"flex items-center justify-center min-w-max px-4 sm:px-0",children:t.map((e,s)=>(0,i.jsxs)("div",{ref:s===a?o:null,className:"flex items-center shrink-0",children:[(0,i.jsx)("div",{className:c("w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm font-medium",s===a?"bg-primary text-primary-foreground":r.includes(s)?"bg-green-500 text-white":"bg-muted text-muted-foreground"),children:s+1}),(0,i.jsx)("span",{className:c("ml-1 sm:ml-2 text-xs sm:text-sm whitespace-nowrap",s===a?"font-medium":"text-muted-foreground"),children:e.label}),s<t.length-1&&(0,i.jsx)(aO.A,{className:"w-3 h-3 sm:w-4 sm:h-4 mx-2 sm:mx-3 text-muted-foreground shrink-0"})]},e.id))})})})}function i9(e){let{onPrevious:t,onNext:a,canProceed:s=!0,isFirstStep:r=!1,isLastStep:n=!1,currentStep:o,totalSteps:l,nextButtonText:c,previousButtonText:d}=e;return(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-t",children:[(0,i.jsxs)(m,{variant:"outline",onClick:t,disabled:r,children:[(0,i.jsx)(i6.A,{className:"h-4 w-4 mr-1"}),d||"Previous"]}),(0,i.jsxs)(m,{onClick:a,disabled:!s,children:[c||(n?"Complete":"Next"),(0,i.jsx)(aO.A,{className:"h-4 w-4 ml-1"})]})]})}function se(e){let{character:t,levelsToGain:a,onLevelsChange:s}=e,r=20-t.level;return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center space-y-2",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Level Up Your Character"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t.name," is currently level ",t.level]})]}),(0,i.jsx)(t9,{children:(0,i.jsx)(ai,{className:"pt-6",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:"levels",children:"How many levels would you like to gain?"}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[(0,i.jsx)(m,{type:"button",variant:"outline",size:"icon",onClick:()=>{a>1&&s(a-1)},disabled:a<=1,className:"h-10 w-10",children:(0,i.jsx)(au.A,{className:"h-4 w-4"})}),(0,i.jsx)(it,{id:"levels",type:"number",min:1,max:r,value:a,onChange:e=>{s(Math.min(Math.max(1,parseInt(e.target.value)||1),r))},className:"w-20 text-center text-lg font-semibold"}),(0,i.jsx)(m,{type:"button",variant:"outline",size:"icon",onClick:()=>{a<r&&s(a+1)},disabled:a>=r,className:"h-10 w-10",children:(0,i.jsx)(ah.A,{className:"h-4 w-4"})}),(0,i.jsxs)("span",{className:"text-sm text-muted-foreground ml-2",children:["(Max: ",r,")"]})]})]}),(0,i.jsx)("div",{className:"flex items-center justify-center py-4 bg-muted/50 rounded-lg",children:(0,i.jsxs)("div",{className:"text-2xl font-bold",children:["Level ",t.level,"  Level ",t.level+a]})}),(0,i.jsxs)("div",{className:"pt-4 border-t",children:[(0,i.jsx)("p",{className:"text-sm font-medium mb-2",children:"What you'll gain:"}),(0,i.jsxs)("div",{className:"space-y-1 text-sm text-muted-foreground",children:[(0,i.jsxs)("p",{children:[" ",a," additional hit ",1===a?"die":"dice"," to roll for HP"]}),(0,i.jsxs)("p",{children:[" ",a," skill ",1===a?"point":"points"," to allocate"]}),(0,i.jsx)("p",{children:" Increased maximum hit points"}),(0,i.jsx)("p",{children:" Possible new class features"}),(0,i.jsx)("p",{children:" Possible ability score improvements"})]})]})]})})})]})}function st(e){let{character:t,levelUpData:a,hitDieSize:s,onHpChange:r}=e;return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center space-y-2",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Roll for Hit Points"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Rolling ",s," with advantage for each level"]})]}),(0,i.jsx)(t9,{children:(0,i.jsxs)(ai,{className:"pt-6 space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{children:"Current HP"}),(0,i.jsx)("div",{className:"text-2xl font-bold",children:t.hitPoints.max})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(io,{htmlFor:"new-hp",children:"New HP"}),(0,i.jsx)(it,{id:"new-hp",type:"number",value:a.newMaxHp,onChange:e=>r(parseInt(e.target.value)||0),className:"text-2xl font-bold h-auto py-1"})]})]}),(0,i.jsxs)("div",{className:"pt-4 border-t",children:[(0,i.jsx)("p",{className:"text-sm font-medium mb-3",children:"Hit Die Rolls (with advantage):"}),(0,i.jsx)("div",{className:"space-y-2",children:a.hpRolls.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded",children:[(0,i.jsxs)("span",{className:"text-sm font-medium",children:["Level ",e.level,":"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Rolled: ",e.roll1," & ",e.roll2]}),(0,i.jsxs)(aZ,{variant:"default",children:["Result: ",e.result]})]})]},t))}),(0,i.jsxs)("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[(0,i.jsx)("span",{className:"font-medium",children:"Total HP Gain:"}),(0,i.jsxs)(aZ,{className:"text-lg px-3 py-1",children:["+",a.totalHpGain]})]})]}),(0,i.jsxs)("div",{className:"pt-4 border-t",children:[(0,i.jsx)("p",{className:"text-sm font-medium mb-2",children:"Hit Dice:"}),(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,i.jsxs)("span",{children:["Current: ",t.hitDice.current,"/",t.hitDice.max]}),(0,i.jsx)("span",{children:""}),(0,i.jsxs)("span",{className:"text-foreground font-medium",children:["New: ",a.newHitDice.current,"/",a.newHitDice.max]})]})]})]})})]})}function sa(e){let{skillAllocations:t,attributeValues:a,onSkillChange:s,maxPerSkill:r=C.L.character.skillModifierRange.max,availablePoints:n,readOnly:o=!1}=e,l=e=>a[e]||0,c=e=>{if(o)return!1;let a=t[e]||0;return(void 0===n||n>0)&&a<r},d=e=>!o&&(t[e]||0)>0,u=(e,a)=>{let i=Math.max(0,Math.min(r,(t[e]||0)+a));(!(a>0)||c(e))&&(!(a<0)||d(e))&&s(e,i)},h=e=>e>=0?"+".concat(e):"".concat(e);return(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:C.L.skills.map(e=>{var a;let s=l(e.attribute),r=t[e.name]||0,n=(a=e.name,l(e.attribute)+(t[a]||0));return(0,i.jsx)(t9,{className:"h-fit",children:(0,i.jsx)(ai,{className:"p-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,i.jsx)("div",{className:"text-sm font-medium truncate",children:e.label}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground capitalize",children:[h(s)," ",e.attribute.slice(0,3).toUpperCase()," + ",r]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1 ml-2 shrink-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-0.5 mr-1",children:[Array.from({length:r},(e,t)=>(0,i.jsx)(iS.A,{className:"w-2.5 h-2.5 fill-yellow-400 text-yellow-400"},t)),0===r&&(0,i.jsx)("div",{className:"w-2.5 h-2.5"})]}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>u(e.name,-1),disabled:!d(e.name),className:"w-6 h-6 p-0",children:(0,i.jsx)(au.A,{className:"w-3 h-3"})}),(0,i.jsx)(aZ,{variant:"outline",className:"text-sm font-mono min-w-8 justify-center",children:h(n)}),(0,i.jsx)(m,{variant:"outline",size:"sm",onClick:()=>u(e.name,1),disabled:!c(e.name),className:"w-6 h-6 p-0",children:(0,i.jsx)(ah.A,{className:"w-3 h-3"})})]})]})})},e.name)})})}function si(e){let{character:t,levelsToGain:a,skillAllocations:r,onSkillAllocationsChange:n}=e,[o,l]=(0,s.useState)({});(0,s.useEffect)(()=>{let e={};C.L.skills.forEach(t=>{e[t.name]=0}),l(e)},[]);let c=()=>Object.values(o).reduce((e,t)=>e+t,0),d=()=>a-c(),u=e=>{let a=t.skills[e];return(null==a?void 0:a.modifier)||0};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center space-y-2",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Allocate Skill Points"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["You gain 1 skill point per level (",a," ",1===a?"point":"points"," total)"]})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(at,{className:"text-base",children:"Points Available:"}),(0,i.jsxs)(aZ,{variant:0===d()?"default":"secondary",children:[d()," / ",a]}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground hidden sm:block",children:"Attribute + Points = Total"})]}),(0,i.jsxs)(m,{onClick:()=>{let e={};C.L.skills.forEach(t=>{e[t.name]=0}),l(e),n(e)},variant:"outline",size:"sm",disabled:0===c(),className:"h-7 px-2 text-xs",children:[(0,i.jsx)(ay.A,{className:"w-3 h-3 mr-1"}),"Reset"]})]})}),(0,i.jsx)(ai,{children:(0,i.jsx)(sa,{skillAllocations:(()=>{let e={};return C.L.skills.forEach(t=>{let a=u(t.name),i=o[t.name]||0;e[t.name]=a+i}),e})(),attributeValues:{strength:t.attributes.strength||0,dexterity:t.attributes.dexterity||0,intelligence:t.attributes.intelligence||0,will:t.attributes.will||0},onSkillChange:(e,t)=>{let a=t-u(e);if(t>C.L.character.skillModifierRange.max)return;let i=a-(o[e]||0);if(i>0&&d()<i)return;let s={...o,[e]:a};l(s),n(s)},availablePoints:d(),maxPerSkill:C.L.character.skillModifierRange.max})})]}),c()>0&&(0,i.jsx)(t9,{className:"bg-muted/50",children:(0,i.jsxs)(ai,{className:"pt-4",children:[(0,i.jsx)("p",{className:"text-sm font-medium mb-2",children:"New Skill Points:"}),(0,i.jsx)("div",{className:"space-y-1",children:C.L.skills.map(e=>{let t=o[e.name];return t>0?(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:[" ",e.label,": +",t," ",1===t?"point":"points"]},e.name):null})})]})})]})}var ss=a(4058);let sr=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(ss.bL,{className:c("grid gap-2",a),...s,ref:t})});sr.displayName=ss.bL.displayName;let sn=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(ss.q7,{ref:t,className:c("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),...s,children:(0,i.jsx)(ss.C1,{className:"flex items-center justify-center",children:(0,i.jsx)(ic.RiX,{className:"h-3.5 w-3.5 fill-primary"})})})});sn.displayName=ss.q7.displayName;var so=a(8162);let sl=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(so.bL,{ref:t,className:c("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,i.jsx)(so.C1,{className:c("flex items-center justify-center text-current"),children:(0,i.jsx)(ic.Srz,{className:"h-4 w-4"})})})});sl.displayName=so.bL.displayName;var sc=a(9034);let sd=s.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,i.jsxs)(sc.bL,{ref:t,className:c("relative overflow-hidden",a),...r,children:[(0,i.jsx)(sc.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,i.jsx)(sm,{}),(0,i.jsx)(sc.OK,{})]})});sd.displayName=sc.bL.displayName;let sm=s.forwardRef((e,t)=>{let{className:a,orientation:s="vertical",...r}=e;return(0,i.jsx)(sc.VM,{ref:t,orientation:s,className:c("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...r,children:(0,i.jsx)(sc.lr,{className:"relative flex-1 rounded-full bg-border"})})});sm.displayName=sc.VM.displayName;var su=a(8446),sh=a(7397),sp=a(3327);function sy(e){switch(e){case"ability":case"resource":return(0,i.jsx)(aJ.A,{className:"h-4 w-4"});case"passive_feature":return(0,i.jsx)(aU.A,{className:"h-4 w-4"});case"stat_boost":return(0,i.jsx)(ag.A,{className:"h-4 w-4"});case"spell_school":case"spell_school_choice":return(0,i.jsx)(h.A,{className:"h-4 w-4"});case"utility_spells":return(0,i.jsx)(su.A,{className:"h-4 w-4"});case"pick_feature_from_pool":return(0,i.jsx)(sh.A,{className:"h-4 w-4"});default:return(0,i.jsx)(sp.A,{className:"h-4 w-4"})}}function sf(e){switch(e){case"ability":return"Ability";case"passive_feature":return"Passive";case"stat_boost":return"Stat Boost";case"spell_school":return"Spell School";case"spell_school_choice":return"Spell School Choice";case"utility_spells":return"Utility Spells";case"resource":return"Resource";case"pick_feature_from_pool":return"Feature Selection";default:return e}}function sg(e){let{character:t,levelsToGain:a,featureSelections:r,onFeatureSelectionsChange:n}=e,[o,l]=(0,s.useState)([]),c=t1(),d=tJ();return(0,s.useEffect)(()=>{let e=[];for(let i=0;i<a;i++){let a=t.level+i+1,s={...t,level:a},r=d.getExpectedFeaturesForCharacter(s),n={...t,level:a-1},o=d.getExpectedFeaturesForCharacter(n),l=r.filter(e=>!o.some(t=>t.name===e.name&&t.level===e.level));l.length>0&&e.push({level:a,features:l})}l(e)},[t,a,d,c]),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Select Your Features"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review the features you'll gain and make selections where required"})]}),(0,i.jsx)(sd,{className:"h-[400px] pr-4",children:o.map(e=>{let{level:a,features:s}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("h4",{className:"text-md font-semibold mb-3 sticky top-0 bg-background py-2",children:["Level ",a," Features"]}),s.map(e=>((e,a)=>{let s=d.generateFeatureId(t.classId,a,e.name);switch(e.type){case"stat_boost":{let t=r[s],a=(null==t?void 0:t.type)==="stat_boost"?t.attribute:void 0;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sy(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sf(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Choose an attribute to boost:"}),(0,i.jsx)(sr,{value:a||"",onValueChange:e=>{n({...r,[s]:{type:"stat_boost",attribute:e}})},children:["strength","dexterity","intelligence","will"].map(t=>{var a;return(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,i.jsx)(sn,{value:t,id:"".concat(s,"-").concat(t)}),(0,i.jsxs)(io,{htmlFor:"".concat(s,"-").concat(t),className:"capitalize cursor-pointer",children:[t," (+",(null==(a=e.statBoosts[0])?void 0:a.amount)||1,")"]})]},t)})})]})]},s)}case"spell_school_choice":{let t=r[s],a=(null==t?void 0:t.type)==="spell_school_choice"?t.schoolId:void 0,o=e.availableSchools?c.getAllSpellSchools().filter(t=>e.availableSchools.includes(t.id)):c.getAllSpellSchools();return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sy(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sf(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Choose a spell school:"}),(0,i.jsxs)(id,{value:a||"",onValueChange:e=>{n({...r,[s]:{type:"spell_school_choice",schoolId:e}})},children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"Select a spell school"})}),(0,i.jsx)(iy,{children:o.map(e=>(0,i.jsx)(ig,{value:e.id,children:e.name},e.id))})]})]})]},s)}case"utility_spells":{let t=r[s],a=(null==t?void 0:t.type)==="utility_spells"?t.spellIds:[],o=[];if(e.schools.forEach(e=>{let t=c.getSpellsBySchool(e).filter(e=>0===e.tier);o.push(...t)}),0===o.length)return null;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sy(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sf(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Select utility spells:"}),(0,i.jsx)(sd,{className:"h-48 border rounded-md p-3",children:o.map(e=>(0,i.jsxs)("div",{className:"flex items-start space-x-2 mb-3",children:[(0,i.jsx)(sl,{id:"".concat(s,"-").concat(e.id),checked:a.includes(e.id),onCheckedChange:t=>((e,t,a)=>{let i=r[e],s=(null==i?void 0:i.type)==="utility_spells"?i.spellIds:[],o=a?[...s,t]:s.filter(e=>e!==t);n({...r,[e]:{type:"utility_spells",spellIds:o}})})(s,e.id,t)}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)(io,{htmlFor:"".concat(s,"-").concat(e.id),className:"cursor-pointer",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})})]},e.id))})]})]},s)}case"pick_feature_from_pool":{let a=r[s],o=(null==a?void 0:a.type)==="feature_pool"?a.selectedFeatureId:void 0,l=d.getFeaturePool(t.classId,e.poolId);if(!l)return null;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sy(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sf(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsxs)(io,{className:"text-sm mb-2 block",children:["Choose from ",l.name,":"]}),(0,i.jsx)(sr,{value:o||"",onValueChange:e=>{n({...r,[s]:{type:"feature_pool",selectedFeatureId:e}})},children:(0,i.jsx)(sd,{className:"h-48 border rounded-md p-3",children:l.features.map(e=>(0,i.jsxs)("div",{className:"flex items-start space-x-2 mb-3",children:[(0,i.jsx)(sn,{value:e.id,id:"".concat(s,"-").concat(e.id)}),(0,i.jsxs)(io,{htmlFor:"".concat(s,"-").concat(e.id),className:"cursor-pointer",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))})})]})]},s)}default:return(0,i.jsx)(t9,{className:"mb-4 bg-muted/30",children:(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sy(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"outline",className:"ml-auto",children:sf(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]})},s)}})(e,a))]},a)})}),0===o.length&&(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No new features available for the selected levels"})]})}let sx=[{id:"levels",label:"Choose Levels"},{id:"hp",label:"Roll Hit Points"},{id:"skills",label:"Allocate Skills"},{id:"features",label:"Select Features"}];function sv(e){let{open:t,onOpenChange:a}=e,{character:r,updateCharacter:n}=t6(),[o,l]=(0,s.useState)(0),[c,d]=(0,s.useState)({levelsToGain:1,hpRolls:[],totalHpGain:0,newMaxHp:(null==r?void 0:r.hitPoints.max)||0,newHitDice:r?{...r.hitDice}:{current:0,max:0},skillAllocations:{},featureSelections:{}}),m=t$(),u=t1();if(!r)return null;let p=u.getClassDefinition(r.classId),y=(null==p?void 0:p.hitDieSize)||8,f=async()=>{try{let t={...r.skills};Object.entries(c.skillAllocations).forEach(e=>{let[a,i]=e,s=t[a];i>0&&s&&(t[a]={...s,modifier:(s.modifier||0)+i})});let i={...r.attributes},s=[...r.abilities],o=[...r.resources],l=[...r.grantedFeatures],d=[...r.selectedFeatures||[]],m=r.spellTierAccess,h=tJ();for(let t=0;t<c.levelsToGain;t++){let a=r.level+t+1,n={...r,level:a},p=h.getExpectedFeaturesForCharacter(n),y={...r,level:a-1},f=h.getExpectedFeaturesForCharacter(y);for(let t of p.filter(e=>!f.some(t=>t.name===e.name&&t.level===e.level))){let n=h.generateFeatureId(r.classId,a,t.name);l.includes(n)||l.push(n);let p=c.featureSelections[n];switch(t.type){case"stat_boost":if((null==p?void 0:p.type)==="stat_boost"&&p.attribute){var e;let a=(null==(e=t.statBoosts[0])?void 0:e.amount)||1;i[p.attribute]=Math.min(10,i[p.attribute]+a),d.push({type:"stat_boost",attribute:p.attribute,amount:a,selectedAt:new Date,grantedByFeatureId:n})}break;case"spell_school_choice":if((null==p?void 0:p.type)==="spell_school_choice"&&p.schoolId&&u.getAllSpellSchools().find(e=>e.id===p.schoolId)){let e=u.getSpellsBySchool(p.schoolId).filter(e=>e.tier<=m),t=new Set(s.filter(e=>"spell"===e.type).map(e=>e.id)),a=e.filter(e=>!t.has(e.id));s.push(...a),d.push({type:"spell_school",schoolId:p.schoolId,selectedAt:new Date,grantedByFeatureId:n})}break;case"utility_spells":if((null==p?void 0:p.type)==="utility_spells"&&p.spellIds&&p.spellIds.length>0){let e=[];t.schools.forEach(t=>{let a=u.getSpellsBySchool(t).filter(e=>0===e.tier&&p.spellIds.includes(e.id)),i=new Set(s.filter(e=>"spell"===e.type).map(e=>e.id)),r=a.filter(e=>!i.has(e.id));s.push(...r),e.push(...r.map(e=>e.id))}),e.length>0&&d.push({type:"utility_spells",spellIds:e,fromSchools:t.schools,selectedAt:new Date,grantedByFeatureId:n})}break;case"pick_feature_from_pool":if((null==p?void 0:p.type)==="feature_pool"&&p.selectedFeatureId){let e=h.getFeaturePool(r.classId,t.poolId);if(e){let a=e.features.find(e=>e.id===p.selectedFeatureId);a&&("ability"===a.type&&a.ability&&!s.some(e=>e.id===a.ability.id)&&s.push(a.ability),d.push({type:"pool_feature",poolId:t.poolId,featureId:p.selectedFeatureId,feature:a,selectedAt:new Date,grantedByFeatureId:n}))}}break;case"spell_school":let y=u.getSpellsBySchool(t.spellSchool.schoolId).filter(e=>e.tier<=m),f=new Set(s.filter(e=>"spell"===e.type).map(e=>e.id)),g=y.filter(e=>!f.has(e.id));s.push(...g);break;case"spell_tier_access":m=Math.max(m,t.maxTier);break;case"resource":let x=t;if(x.resourceDefinition&&!o.some(e=>e.definition.id===x.resourceDefinition.id)){let e=ta(x.resourceDefinition,x.startingAmount,o.length);o.push(e)}break;case"ability":let v=t;v.ability&&!s.some(e=>e.id===v.ability.id)&&s.push(v.ability)}}}let p={...r,level:r.level+c.levelsToGain,hitPoints:{...r.hitPoints,max:c.newMaxHp,current:c.newMaxHp},hitDice:{...r.hitDice,current:c.newHitDice.current,max:c.newHitDice.max},skills:t,attributes:i,abilities:s,resources:o,grantedFeatures:l,selectedFeatures:d,spellTierAccess:m};await n(p),await h.syncCharacterFeatures(),a(!1)}catch(e){console.error("Failed to apply level up:",e)}};return(0,i.jsx)(i8,{open:t,onOpenChange:a,title:"Level Up Guide",titleIcon:(0,i.jsx)(h.A,{className:"h-5 w-5 text-yellow-500"}),steps:sx,currentStep:o,onStepChange:l,onNext:()=>{0===o?((()=>{let e=[],t=0;for(let a=0;a<c.levelsToGain;a++){let i=r.level+a+1,s=m.rollSingleDie(y),n=m.rollSingleDie(y),o=Math.max(s,n);e.push({level:i,roll1:s,roll2:n,result:o}),t+=o}d(a=>({...a,hpRolls:e,totalHpGain:t,newMaxHp:r.hitPoints.max+t,newHitDice:{current:r.hitDice.current+c.levelsToGain,max:r.hitDice.max+c.levelsToGain}}))})(),l(1)):1===o?l(2):2===o?l(3):o<sx.length-1?l(o+1):f()},onPrevious:()=>{o>0&&l(o-1)},canProceed:!0,className:"max-w-2xl",children:(0,i.jsx)("div",{className:"px-4 sm:px-6 py-4",children:(()=>{switch(sx[o].id){case"levels":return(0,i.jsx)(se,{character:r,levelsToGain:c.levelsToGain,onLevelsChange:e=>d(t=>({...t,levelsToGain:e}))});case"hp":return(0,i.jsx)(st,{character:r,levelUpData:c,hitDieSize:"d".concat(y),onHpChange:e=>d(t=>({...t,newMaxHp:e}))});case"skills":return(0,i.jsx)(si,{character:r,levelsToGain:c.levelsToGain,skillAllocations:c.skillAllocations,onSkillAllocationsChange:e=>d(t=>({...t,skillAllocations:e}))});case"features":return(0,i.jsx)(sg,{character:r,levelsToGain:c.levelsToGain,featureSelections:c.featureSelections,onFeatureSelectionsChange:e=>d(t=>({...t,featureSelections:e}))});default:return null}})()})})}function sb(e){let{name:t,onNameChange:a,onOpenConfig:r}=e,{character:n}=t6(),[o,l]=(0,s.useState)(!1);if(!n)return null;let c=tE.getInstance(),d=c.getClassDefinition(n.classId),u=(null==d?void 0:d.name)||n.classId,h=c.getAncestryDefinition(n.ancestry.ancestryId),p=(null==h?void 0:h.name)||n.ancestry.ancestryId,y=c.getBackgroundDefinition(n.background.backgroundId),f=(null==y?void 0:y.name)||n.background.backgroundId;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(it,{id:"character-name",value:t,onChange:e=>a(e.target.value),className:"text-xl font-bold flex-1",placeholder:"Character Name"}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>{n&&!(n.level>=20)&&l(!0)},disabled:n.level>=20,className:"h-10 w-10 p-0 shrink-0",title:n.level>=20?"Maximum level reached":"Open Level Up Guide",children:(0,i.jsx)(iC.A,{className:"h-4 w-4"})}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:r,className:"h-10 w-10 p-0 shrink-0",title:"Character Configuration",children:(0,i.jsx)(am.A,{className:"h-4 w-4"})})]}),(0,i.jsxs)("div",{className:"text-center text-lg text-muted-foreground",children:[p," ",f,"  ",u,"  Level ",n.level]})]}),o&&(0,i.jsx)(sv,{open:o,onOpenChange:l})]})}function sw(e){let{onNameChange:t,onOpenConfig:a}=e,{character:s}=t6();return s?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(sb,{name:s.name,onNameChange:t,onOpenConfig:a})}):null}let sj=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),sN=s.forwardRef((e,t)=>{let{className:a,variant:s,...r}=e;return(0,i.jsx)("div",{ref:t,role:"alert",className:c(sj({variant:s}),a),...r})});sN.displayName="Alert",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("h5",{ref:t,className:c("mb-1 font-medium leading-none tracking-tight",a),...s})}).displayName="AlertTitle";let sk=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)("div",{ref:t,className:c("text-sm [&_p]:leading-relaxed",a),...s})});sk.displayName="AlertDescription";var sS=a(2056),sC=a(6983),sA=a(6667);function s_(e){let{availableClasses:t,selectedClassId:a,onClassSelect:r}=e,[n,o]=(0,s.useState)(new Set),l=(e,t)=>{t.stopPropagation();let a=new Set(n);a.has(e)?a.delete(e):a.add(e),o(a)};return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-1",children:"Choose Your Class"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select the class that defines your character's role and abilities"})]}),(0,i.jsx)("div",{className:"space-y-2",children:t.map(e=>{var t,s;return(0,i.jsx)(t9,{className:"cursor-pointer transition-all ".concat(a===e.id?"ring-2 ring-primary bg-primary/5":"hover:shadow-md hover:bg-muted/50"),onClick:()=>{r(e.id)},children:(0,i.jsxs)(aM,{open:n.has(e.id),onOpenChange:t=>l(e.id,{}),children:[(0,i.jsx)(ae,{className:"pb-2 pt-3",children:(0,i.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,i.jsx)(at,{className:"text-base",children:e.name})}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2 break-words",children:e.description})]}),(0,i.jsx)("div",{className:"flex items-center gap-1 shrink-0",children:(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0",onClick:t=>l(e.id,t),children:n.has(e.id)?(0,i.jsx)(az.A,{className:"w-3 h-3"}):(0,i.jsx)(aO.A,{className:"w-3 h-3"})})})})]})}),(0,i.jsx)(aY,{children:(0,i.jsx)(ai,{className:"pt-0",children:(0,i.jsxs)("div",{className:"border-t pt-2",children:[(0,i.jsx)("h4",{className:"text-sm font-medium mb-1",children:"Key Attributes"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:e.keyAttributes.map(e=>(0,i.jsx)(aZ,{variant:"secondary",className:"capitalize text-xs px-1 py-0",children:e},e))}),(0,i.jsx)("h4",{className:"text-sm font-medium mb-1",children:"Starting Proficiencies"}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground break-words",children:["Armor: ",(null==(t=e.armorProficiencies)?void 0:t.map(e=>"freeform"===e.type?e.name:e.type).join(", "))||"None","  Weapons: ",(null==(s=e.weaponProficiencies)?void 0:s.map(e=>"freeform"===e.type?e.name:e.type.replace("_"," ")).join(", "))||"None"]})]})})})]})},e.id)})})]})}class sI{static getRandomElement(e){return e[Math.floor(Math.random()*e.length)]}static generateFromPattern(e,t){let a="";for(let i of t)switch(i){case"P":a+=this.getRandomElement(e.syllables.prefixes);break;case"M":a+=this.getRandomElement(e.syllables.middle);break;case"S":a+=this.getRandomElement(e.syllables.suffixes)}return a}static meetsConstraints(e,t){let a=e.length;return a>=t.constraints.minLength&&a<=t.constraints.maxLength}static generateName(e){let t=0;for(;t<50;){let a=this.getRandomElement(e.patterns),i=this.generateFromPattern(e,a);if(this.meetsConstraints(i,e))return i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();t++}let a=e.patterns[0],i=this.generateFromPattern(e,a);return i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()}static generateFirstName(e,t){if(e.unisex)return this.generateName(e.unisex);if("male"===t&&e.male)return this.generateName(e.male);if("female"===t&&e.female)return this.generateName(e.female);let a=[e.male,e.female].filter(Boolean);if(a.length>0)return this.generateName(this.getRandomElement(a));throw Error("No valid name configuration found")}static generateSurname(e){if(!e.surnames)throw Error("No surname configuration found");return this.generateName(e.surnames)}static generateFullName(e,t){let a=this.generateFirstName(e,t);if(e.surnames){let t=this.generateSurname(e);return"".concat(a," ").concat(t)}return a}}function sT(e){var t;let{availableAncestries:a,selectedAncestryId:s,characterName:r,onAncestrySelect:n,onNameChange:o}=e;return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-1",children:"Character Ancestry"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose your character's ancestry and name"})]}),(0,i.jsx)("div",{className:"sticky top-0 bg-background z-10 pb-4",children:(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{className:"pb-2",children:(0,i.jsx)(at,{className:"text-base",children:"Character Name"})}),(0,i.jsxs)(ai,{children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(it,{value:r,onChange:e=>o(e.target.value),placeholder:"Enter character name",className:"text-sm"})}),(0,i.jsxs)(m,{variant:"outline",onClick:()=>{if(s){let e=a.find(e=>e.id===s),t=(null==e?void 0:e.nameConfig)||tj;try{let e=Math.random()>.5?"male":"female",a=sI.generateFullName(t,e);o(a)}catch(e){console.error("Failed to generate name:",e)}}},disabled:!s,size:"sm",children:[(0,i.jsx)(h.A,{className:"w-3 h-3 mr-1"}),"Suggest"]})]}),s&&(0,i.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:['Click "Suggest" for ',null==(t=a.find(e=>e.id===s))?void 0:t.name," names"]})]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-base font-semibold mb-2",children:"Ancestry"}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:a.map(e=>(0,i.jsxs)(t9,{className:"cursor-pointer transition-all ".concat(s===e.id?"ring-2 ring-primary":"hover:shadow-md"),onClick:()=>n(e.id),children:[(0,i.jsx)(ae,{className:"pb-1 pt-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-sm",children:e.name}),s===e.id&&(0,i.jsx)(aZ,{className:"ml-1 text-xs px-1",children:"Selected"})]})}),(0,i.jsxs)(ai,{className:"pt-0",children:[(0,i.jsx)("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2 break-words",children:e.description}),(0,i.jsx)("div",{className:"flex flex-wrap gap-1",children:(0,i.jsx)(aZ,{variant:"outline",className:"text-xs capitalize px-1 py-0",children:e.size})})]})]},e.id))})]})]})}function sR(e){let{availableBackgrounds:t,selectedBackgroundId:a,onBackgroundSelect:s}=e;return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-1",children:"Character Background"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose your character's background and cultural origins"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-base font-semibold mb-2",children:"Background"}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:t.map(e=>(0,i.jsxs)(t9,{className:"cursor-pointer transition-all ".concat(a===e.id?"ring-2 ring-primary":"hover:shadow-md"),onClick:()=>s(e.id),children:[(0,i.jsx)(ae,{className:"pb-1 pt-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-sm",children:e.name}),a===e.id&&(0,i.jsx)(aZ,{className:"ml-1 text-xs px-1",children:"Selected"})]})}),(0,i.jsx)(ai,{className:"pt-0",children:(0,i.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-3 break-words",children:e.description})})]},e.id))})]})]})}let sD={standard:{name:"Standard",values:[2,2,0,-1]},balanced:{name:"Balanced",values:[2,1,1,0]},minMax:{name:"Min-Max",values:[3,1,-1,-1]}},sL=["strength","dexterity","intelligence","will"],sE={strength:"Strength",dexterity:"Dexterity",intelligence:"Intelligence",will:"Will"};function sP(e){let{attributes:t,onAttributesChange:a,classId:r,ancestryId:n}=e,[o,l]=(0,s.useState)("standard"),c=[t.strength,t.dexterity,t.intelligence,t.will],d=(e,i)=>{a({...t,[e]:i})};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Assign Attributes"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Distribute your attribute scores using a standard array or manual assignment"})]}),(0,i.jsxs)(m,{onClick:()=>{a({strength:0,dexterity:0,intelligence:0,will:0})},variant:"outline",size:"sm",children:[(0,i.jsx)(ay.A,{className:"w-4 h-4 mr-2"}),"Reset"]})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{children:(0,i.jsx)(at,{className:"text-base",children:"Standard Arrays"})}),(0,i.jsx)(ai,{className:"space-y-4",children:(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)(id,{value:o,onValueChange:e=>l(e),children:[(0,i.jsx)(iu,{className:"flex-1",children:(0,i.jsx)(im,{})}),(0,i.jsx)(iy,{children:Object.entries(sD).map(e=>{let[t,a]=e;return(0,i.jsxs)(ig,{value:t,children:[a.name," (",a.values.join(", "),")"]},t)})})]}),(0,i.jsx)(m,{onClick:()=>{let e=[...sD[o].values].sort((e,t)=>t-e);a({strength:e[0],dexterity:e[1],intelligence:e[2],will:e[3]})},disabled:!(()=>{let e=[...sD[o].values].sort((e,t)=>t-e),t=[...c].sort((e,t)=>t-e);return JSON.stringify(e)!==JSON.stringify(t)})(),children:"Apply Array"})]})})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{children:(0,i.jsx)(at,{className:"text-base",children:"Attribute Scores"})}),(0,i.jsx)(ai,{className:"space-y-4",children:sL.map(e=>(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)("label",{className:"w-24 text-sm font-medium",children:sE[e]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m,{size:"sm",variant:"outline",onClick:()=>d(e,Math.max(C.L.character.attributeRange.min,t[e]-1)),disabled:t[e]<=C.L.character.attributeRange.min,children:"-"}),(0,i.jsx)(it,{type:"number",value:t[e],onChange:t=>{let a=parseInt(t.target.value)||0;a>=C.L.character.attributeRange.min&&a<=C.L.character.attributeRange.max&&d(e,a)},className:"w-20 text-center",min:C.L.character.attributeRange.min,max:C.L.character.attributeRange.max}),(0,i.jsx)(m,{size:"sm",variant:"outline",onClick:()=>d(e,Math.min(C.L.character.attributeRange.max,t[e]+1)),disabled:t[e]>=C.L.character.attributeRange.max,children:"+"})]}),(0,i.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(Range: ",C.L.character.attributeRange.min," to ",C.L.character.attributeRange.max,")"]})]},e))})]})]})}function sF(e){let{skillAllocations:t,onSkillsChange:a,attributes:r}=e,[n,o]=(0,s.useState)({}),l=C.L.character.initialSkillPoints;(0,s.useEffect)(()=>{let e={};C.L.skills.forEach(a=>{e[a.name]=t[a.name]||0}),o(e)},[t]);let c=()=>Object.values(n).reduce((e,t)=>e+t,0),d=()=>l-c();return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Allocate Skill Points"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Distribute ",l," points among your skills (optional)"]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(m,{onClick:()=>{let e={},t=Math.floor(l/C.L.skills.length),i=l%C.L.skills.length;C.L.skills.forEach((a,s)=>{e[a.name]=t+ +(s<i)}),o(e),a(e)},variant:"outline",size:"sm",children:"Distribute Evenly"}),(0,i.jsxs)(m,{onClick:()=>{let e={};C.L.skills.forEach(t=>{e[t.name]=0}),o(e),a(e)},variant:"outline",size:"sm",children:[(0,i.jsx)(ay.A,{className:"w-4 h-4 mr-2"}),"Reset"]})]})]}),(0,i.jsx)(t9,{children:(0,i.jsxs)(ai,{className:"pt-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsxs)(aZ,{variant:0===d()?"default":"secondary",children:[d()," points remaining"]}),(0,i.jsxs)("span",{className:"text-sm text-muted-foreground",children:[c()," / ",l," allocated"]})]}),(0,i.jsx)(sa,{skillAllocations:n,attributeValues:r,onSkillChange:(e,t)=>{let i={...n,[e]:t};o(i),a(i)},maxPerSkill:C.L.character.skillModifierRange.max,availablePoints:d(),readOnly:!1})]})})]})}function sB(e){let{classId:t,selectedEquipment:a,onEquipmentReady:r}=e,[n,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),d=t2(),h=t1(),y=a.map(e=>d.createInventoryItem(e)).filter(e=>null!==e),g=(0,s.useCallback)(()=>{let e=h.getClassDefinition(t);(null==e?void 0:e.startingEquipment)?r(e.startingEquipment):r([])},[t,h,r]);return(0,s.useEffect)(()=>{!l&&t&&(g(),c(!0))},[t,l,g]),(0,s.useEffect)(()=>{},[a]),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Select Starting Equipment"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose your starting gear and equipment"})]}),(0,i.jsxs)(m,{onClick:()=>o(!0),variant:"outline",size:"sm",children:[(0,i.jsx)(a1.A,{className:"w-4 h-4 mr-2"}),"Browse Items"]})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{children:(0,i.jsxs)(at,{className:"text-base flex items-center justify-between",children:[(0,i.jsx)("span",{children:"Starting Equipment"}),(0,i.jsxs)(aZ,{variant:"outline",children:[y.length," ",1===y.length?"item":"items"]})]})}),(0,i.jsx)(ai,{children:0===y.length?(0,i.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,i.jsx)(f.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,i.jsx)("p",{className:"text-sm",children:"No equipment selected"}),(0,i.jsxs)(m,{onClick:()=>o(!0),variant:"outline",size:"sm",className:"mt-4",children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),"Add Equipment"]})]}):(0,i.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(e=>{switch(e.type){case"weapon":return(0,i.jsx)(u.A,{className:"w-4 h-4"});case"armor":return e.isMainArmor?(0,i.jsx)(aU.A,{className:"w-4 h-4"}):(0,i.jsx)(iU.A,{className:"w-4 h-4"});case"consumable":return(0,i.jsx)(iq.A,{className:"w-4 h-4"});case"ammunition":return(0,i.jsx)(p.A,{className:"w-4 h-4"});default:return(0,i.jsx)(f.A,{className:"w-4 h-4"})}})(e),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:e.name}),(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:(e=>{switch(e.type){case"weapon":return e.damage?"Damage: ".concat(e.damage):"";case"armor":return e.armor?"AC: ".concat(e.armor):"";case"consumable":case"ammunition":return"Count: ".concat(e.count);default:return e.description||""}})(e)})]})]}),(0,i.jsx)(m,{onClick:()=>(e=>{let t=y.findIndex(t=>t.id===e);t>=0&&r(a.filter((e,a)=>a!==t))})(e.id),variant:"ghost",size:"sm",children:(0,i.jsx)(ij.A,{className:"w-4 h-4"})})]},e.id))})})]}),(0,i.jsx)(iK,{isOpen:n,onClose:()=>o(!1),onItemAdd:e=>{r([...a,e]),o(!1)}})]})}var sM=a(7268);let sW=s.forwardRef((e,t)=>{let{className:a,orientation:s="horizontal",decorative:r=!0,...n}=e;return(0,i.jsx)(sM.b,{ref:t,decorative:r,orientation:s,className:c("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a),...n})});sW.displayName=sM.b.displayName;var sY=a(3164),sz=a(7828);function sO(e){switch(e){case"ability":case"resource":return(0,i.jsx)(aJ.A,{className:"h-4 w-4"});case"passive_feature":case"resistance":return(0,i.jsx)(aU.A,{className:"h-4 w-4"});case"stat_boost":return(0,i.jsx)(ag.A,{className:"h-4 w-4"});case"spell_school":case"spell_school_choice":return(0,i.jsx)(h.A,{className:"h-4 w-4"});case"utility_spells":return(0,i.jsx)(su.A,{className:"h-4 w-4"});case"pick_feature_from_pool":return(0,i.jsx)(sh.A,{className:"h-4 w-4"});case"size":return(0,i.jsx)(sY.A,{className:"h-4 w-4"});case"darkvision":return(0,i.jsx)(sz.A,{className:"h-4 w-4"});case"skill_proficiency":return(0,i.jsx)(a4.A,{className:"h-4 w-4"});default:return(0,i.jsx)(sp.A,{className:"h-4 w-4"})}}function sU(e){switch(e){case"ability":return"Ability";case"passive_feature":return"Passive";case"stat_boost":return"Stat Boost";case"spell_school":return"Spell School";case"spell_school_choice":return"Spell School Choice";case"utility_spells":return"Utility Spells";case"resource":return"Resource";case"pick_feature_from_pool":return"Feature Selection";case"size":return"Size";case"darkvision":return"Darkvision";case"resistance":return"Resistance";case"skill_proficiency":return"Skill Proficiency";default:return e}}function sH(e){let{classId:t,ancestryId:a,backgroundId:r,featureSelections:n,onFeatureSelectionsChange:o}=e,[l,c]=(0,s.useState)({class:[],ancestry:[],background:[]}),d=tE.getInstance();(0,s.useEffect)(()=>{let e=d.getClassDefinition(t),i=d.getAncestryDefinition(a),s=d.getBackgroundDefinition(r);c({class:(null==e?void 0:e.features.filter(e=>1===e.level))||[],ancestry:(null==i?void 0:i.features)||[],background:(null==s?void 0:s.features)||[]})},[t,a,r,d]);let m=(e,t)=>{o({...n,[e]:{type:"stat_boost",attribute:t}})},u=(e,t)=>"".concat(e,"-").concat(t.name.toLowerCase().replace(/\s+/g,"-")),h=l.class.length>0||l.ancestry.length>0||l.background.length>0;return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Your Starting Features"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review the features you'll start with and make selections where required"})]}),(0,i.jsxs)(sd,{className:"h-[500px] pr-4",children:[l.class.length>0&&(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("h4",{className:"text-md font-semibold mb-3 flex items-center gap-2",children:[(0,i.jsx)(sh.A,{className:"h-4 w-4"}),"Class Features"]}),l.class.map(e=>(e=>{let a=u(t,e);switch(e.type){case"stat_boost":{let t=n[a],s=(null==t?void 0:t.type)==="stat_boost"?t.attribute:void 0;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Choose an attribute to boost:"}),(0,i.jsx)(sr,{value:s||"",onValueChange:e=>m(a,e),children:["strength","dexterity","intelligence","will"].map(t=>{var s;return(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,i.jsx)(sn,{value:t,id:"".concat(a,"-").concat(t)}),(0,i.jsxs)(io,{htmlFor:"".concat(a,"-").concat(t),className:"capitalize cursor-pointer",children:[t," (+",(null==(s=e.statBoosts[0])?void 0:s.amount)||1,")"]})]},t)})})]})]},a)}case"spell_school_choice":{let t=n[a],s=(null==t?void 0:t.type)==="spell_school_choice"?t.schoolId:void 0,r=e.availableSchools?d.getAllSpellSchools().filter(t=>e.availableSchools.includes(t.id)):d.getAllSpellSchools();return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Choose a spell school:"}),(0,i.jsxs)(id,{value:s||"",onValueChange:e=>{o({...n,[a]:{type:"spell_school_choice",schoolId:e}})},children:[(0,i.jsx)(iu,{children:(0,i.jsx)(im,{placeholder:"Select a spell school"})}),(0,i.jsx)(iy,{children:r.map(e=>(0,i.jsx)(ig,{value:e.id,children:e.name},e.id))})]})]})]},a)}case"utility_spells":{let t=n[a],s=(null==t?void 0:t.type)==="utility_spells"?t.spellIds:[],r=[];if(e.schools.forEach(e=>{let t=d.getSpellsBySchool(e).filter(e=>0===e.tier);r.push(...t)}),0===r.length)return null;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Select utility spells:"}),(0,i.jsx)(sd,{className:"h-48 border rounded-md p-3",children:r.map(e=>(0,i.jsxs)("div",{className:"flex items-start space-x-2 mb-3",children:[(0,i.jsx)(sl,{id:"".concat(a,"-").concat(e.id),checked:s.includes(e.id),onCheckedChange:t=>((e,t,a)=>{let i=n[e],s=(null==i?void 0:i.type)==="utility_spells"?i.spellIds:[],r=a?[...s,t]:s.filter(e=>e!==t);o({...n,[e]:{type:"utility_spells",spellIds:r}})})(a,e.id,t)}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)(io,{htmlFor:"".concat(a,"-").concat(e.id),className:"cursor-pointer",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})})]},e.id))})]})]},a)}case"pick_feature_from_pool":{var s;let r=n[a],l=(null==r?void 0:r.type)==="feature_pool"?r.selectedFeatureId:void 0,c=d.getClassDefinition(t),m=null==c||null==(s=c.featurePools)?void 0:s.find(t=>t.id===e.poolId);if(!m)return null;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsxs)(io,{className:"text-sm mb-2 block",children:["Choose from ",m.name,":"]}),(0,i.jsx)(sr,{value:l||"",onValueChange:e=>{o({...n,[a]:{type:"feature_pool",selectedFeatureId:e}})},children:(0,i.jsx)(sd,{className:"h-48 border rounded-md p-3",children:m.features.map(e=>(0,i.jsxs)("div",{className:"flex items-start space-x-2 mb-3",children:[(0,i.jsx)(sn,{value:e.id,id:"".concat(a,"-").concat(e.id)}),(0,i.jsxs)(io,{htmlFor:"".concat(a,"-").concat(e.id),className:"cursor-pointer",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))})})]})]},a)}default:return(0,i.jsx)(t9,{className:"mb-4 bg-muted/30",children:(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"outline",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]})},a)}})(e))]}),l.ancestry.length>0&&(0,i.jsxs)(i.Fragment,{children:[l.class.length>0&&(0,i.jsx)(sW,{className:"my-4"}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("h4",{className:"text-md font-semibold mb-3 flex items-center gap-2",children:[(0,i.jsx)(sY.A,{className:"h-4 w-4"}),"Ancestry Features"]}),l.ancestry.map(e=>(e=>{let t=u(a,e);if("stat_boost"===e.type){let a=n[t],s=(null==a?void 0:a.type)==="stat_boost"?a.attribute:void 0;return(0,i.jsxs)(t9,{className:"mb-4",children:[(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"secondary",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]}),(0,i.jsxs)(ai,{children:[(0,i.jsx)(io,{className:"text-sm mb-2 block",children:"Choose an attribute to boost:"}),(0,i.jsx)(sr,{value:s||"",onValueChange:e=>m(t,e),children:["strength","dexterity","intelligence","will"].map(a=>{var s,r;return(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,i.jsx)(sn,{value:a,id:"".concat(t,"-").concat(a)}),(0,i.jsxs)(io,{htmlFor:"".concat(t,"-").concat(a),className:"capitalize cursor-pointer",children:[a," (+",(null==(r=e.statBoosts)||null==(s=r[0])?void 0:s.amount)||1,")"]})]},a)})})]})]},t)}return(0,i.jsx)(t9,{className:"mb-4 bg-muted/30",children:(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"outline",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]})},t)})(e))]})]}),l.background.length>0&&(0,i.jsxs)(i.Fragment,{children:[(l.class.length>0||l.ancestry.length>0)&&(0,i.jsx)(sW,{className:"my-4"}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("h4",{className:"text-md font-semibold mb-3 flex items-center gap-2",children:[(0,i.jsx)(su.A,{className:"h-4 w-4"}),"Background Features"]}),l.background.map(e=>(e=>{let t=u(r,e);return(0,i.jsx)(t9,{className:"mb-4 bg-muted/30",children:(0,i.jsxs)(ae,{className:"pb-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[sO(e.type),(0,i.jsx)(at,{className:"text-base",children:e.name}),(0,i.jsx)(aZ,{variant:"outline",className:"ml-auto",children:sU(e.type)})]}),(0,i.jsx)(aa,{className:"text-sm",children:e.description})]})},t)})(e))]})]}),!h&&(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No features available for the selected combination"})]})]})}async function sq(e){let t=[],a=new Date;for(let[i,s]of Object.entries(e))switch(s.type){case"stat_boost":t.push({type:"stat_boost",attribute:s.attribute,amount:1,selectedAt:a,grantedByFeatureId:i});break;case"spell_school_choice":t.push({type:"spell_school",schoolId:s.schoolId,selectedAt:a,grantedByFeatureId:i});break;case"utility_spells":s.spellIds.length>0&&t.push({type:"utility_spells",spellIds:s.spellIds,fromSchools:[],selectedAt:a,grantedByFeatureId:i});break;case"feature_pool":t.push({type:"pool_feature",poolId:"",featureId:s.selectedFeatureId,feature:{},selectedAt:a,grantedByFeatureId:i})}return t}let sG=[{id:"class",label:"Class"},{id:"ancestry",label:"Ancestry"},{id:"background",label:"Background"},{id:"features",label:"Features"},{id:"attributes",label:"Attributes"},{id:"skills",label:"Skills"},{id:"equipment",label:"Equipment"}];function sV(e){let{isOpen:t,onClose:a,onCharacterCreated:r,editingCharacterId:n}=e,[o,l]=(0,s.useState)(0),[c,d]=(0,s.useState)({name:"",featureSelections:{},attributes:{strength:0,dexterity:0,intelligence:0,will:0},skillAllocations:{},selectedEquipment:[],equipmentReady:!1}),m=tE.getInstance(),u=tQ(),h=tV(),p=m.getAllClasses(),y=m.getAllAncestries(),f=m.getAllBackgrounds(),g=e=>{d(t=>({...t,classId:e}))},x=e=>{d(t=>({...t,ancestryId:e}))},v=e=>{d(t=>({...t,backgroundId:e}))},b=e=>{d(t=>({...t,name:e}))},w=e=>{d(t=>({...t,selectedEquipment:e,equipmentReady:!0}))},j=e=>{d(t=>({...t,featureSelections:e}))},N=e=>{d(t=>({...t,attributes:e}))},k=e=>{d(t=>({...t,skillAllocations:e}))},S=()=>!!(c.ancestryId&&c.name.trim()),C=()=>!!(c.backgroundId&&S()),A=()=>!!(c.classId&&c.ancestryId&&c.backgroundId&&c.name.trim()),_=async()=>{if(C()&&c.classId&&c.ancestryId&&c.backgroundId)try{let e=await sq(c.featureSelections),t=await u.createCompleteCharacter({name:c.name.trim(),classId:c.classId,ancestryId:c.ancestryId,backgroundId:c.backgroundId,attributes:c.attributes,skillAllocations:c.skillAllocations,selectedFeatures:e,selectedEquipment:c.selectedEquipment});await h.loadCharacter(t.id),r(t.id),a()}catch(e){console.error("Failed to create character:",e)}},I=async()=>{await _()},T=async()=>{switch(sG[o].id){case"class":l(1);break;case"ancestry":l(2);break;case"background":l(3);break;case"features":l(4);break;case"attributes":l(5);break;case"skills":l(6);break;case"equipment":await I()}};return(0,i.jsx)(i8,{open:t,onOpenChange:a,title:"Character Builder",titleIcon:(0,i.jsx)(sA.A,{className:"h-5 w-5 text-primary"}),steps:sG,currentStep:o,onStepChange:e=>{(e<o||0===e||1===e&&c.classId||2===e&&S())&&l(e)},onNext:T,onPrevious:()=>{o>0&&l(o-1)},canProceed:(()=>{switch(sG[o].id){case"class":return!!c.classId;case"ancestry":return S();case"background":return C();case"features":return A();case"attributes":case"skills":return!0;case"equipment":return!!c.equipmentReady;default:return!1}})(),nextButtonText:(()=>{switch(sG[o].id){case"class":return"Next: Ancestry";case"ancestry":return"Next: Background";case"background":return"Next: Features";case"features":return"Next: Attributes";case"attributes":return"Next: Skills";case"skills":return"Next: Equipment";case"equipment":return"Finish Character";default:return"Next"}})(),previousButtonText:(()=>{switch(sG[o].id){case"ancestry":return"Back to Class";case"background":return"Back to Ancestry";case"features":return"Back to Background";case"attributes":return"Back to Features";case"skills":return"Back to Attributes";case"equipment":return"Back to Skills";default:return"Previous"}})(),className:"max-w-4xl w-[95vw]",completedSteps:(()=>{let e=[];return c.classId&&e.push(0),S()&&e.push(1),C()&&e.push(2),A()&&(e.push(3),o>3&&(e.push(4),e.push(5))),c.equipmentReady&&e.push(6),e})(),children:(0,i.jsx)("div",{className:"min-w-0 px-4 sm:px-6 py-4",children:(()=>{switch(sG[o].id){case"class":return(0,i.jsx)(s_,{availableClasses:p,selectedClassId:c.classId,onClassSelect:g});case"ancestry":return(0,i.jsx)(sT,{availableAncestries:y,selectedAncestryId:c.ancestryId,characterName:c.name,onAncestrySelect:x,onNameChange:b});case"background":return(0,i.jsx)(sR,{availableBackgrounds:f,selectedBackgroundId:c.backgroundId,onBackgroundSelect:v});case"features":if(!c.classId||!c.ancestryId||!c.backgroundId)return null;return(0,i.jsx)(sH,{classId:c.classId,ancestryId:c.ancestryId,backgroundId:c.backgroundId,featureSelections:c.featureSelections,onFeatureSelectionsChange:j});case"attributes":return(0,i.jsx)(sP,{attributes:c.attributes,onAttributesChange:N,classId:c.classId,ancestryId:c.ancestryId});case"skills":return(0,i.jsx)(sF,{skillAllocations:c.skillAllocations,onSkillsChange:k,attributes:c.attributes});case"equipment":return(0,i.jsx)(sB,{classId:c.classId,selectedEquipment:c.selectedEquipment,onEquipmentReady:w});default:return null}})()})})}function sK(e){let{onComplete:t,onCancel:a,showAsCard:r=!0,autoFocus:n=!0}=e,[o,l]=(0,s.useState)(""),[c,d]=(0,s.useState)("fighter"),[u,h]=(0,s.useState)(!1),[p,y]=(0,s.useState)(!1),f=tE.getInstance().getAllClasses(),{showError:g,showSuccess:x}=t5(),v=async()=>{if(o.trim()&&!p){y(!0);try{let e=tQ(),a=tV(),i=o.trim(),s=await e.createSampleCharacter(i,c);await a.loadCharacter(s.id),x("Character created","".concat(i," has been created successfully!")),l(""),d("fighter"),null==t||t()}catch(e){console.error("Failed to create character:",e),g("Failed to create character","Unable to create the character. Please try again.")}finally{y(!1)}}},b=()=>{l(""),d("fighter"),null==a||a()},w=e=>{h(!1),null==t||t()},j=(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)(m,{onClick:()=>h(!0),className:"w-full mb-4",variant:"default",children:[(0,i.jsx)(sA.A,{className:"w-4 h-4 mr-2"}),"Character Builder"]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,i.jsx)("span",{className:"w-full border-t"})}),(0,i.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,i.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:"or create quickly"})})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"character-name",children:"Character Name"}),(0,i.jsx)(it,{id:"character-name",value:o,onChange:e=>l(e.target.value),placeholder:"Enter character name",onKeyDown:e=>{"Enter"===e.key?v():"Escape"===e.key&&b()},autoFocus:n})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"character-class",children:"Class"}),(0,i.jsx)("select",{id:"character-class",value:c,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded-md",children:f.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(m,{onClick:v,disabled:!o.trim()||p,size:"sm",children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),p?"Creating...":"Quick Create"]}),a&&(0,i.jsx)(m,{variant:"outline",onClick:b,size:"sm",children:"Cancel"})]})]});return r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t9,{className:"border-dashed",children:(0,i.jsx)(ai,{className:"pt-4",children:j})}),(0,i.jsx)(sV,{isOpen:u,onClose:()=>h(!1),onCharacterCreated:w})]}):(0,i.jsxs)(i.Fragment,{children:[j,(0,i.jsx)(sV,{isOpen:u,onClose:()=>h(!1),onCharacterCreated:w})]})}function sJ(e){let{isOpen:t=!0,onClose:a,characters:r,activeCharacterId:n,errorMessage:o,fullScreen:l=!1}=e,[c,d]=(0,s.useState)(!1),{switchCharacter:u,deleteCharacter:h}=t6(),p=[...r].sort((e,t)=>t.updatedAt.getTime()-e.updatedAt.getTime()),f=(0,i.jsxs)("div",{className:"space-y-4",children:[o&&(0,i.jsxs)(sN,{variant:"destructive",children:[(0,i.jsx)(sS.A,{className:"h-4 w-4"}),(0,i.jsx)(sk,{children:o})]}),c?(0,i.jsx)(sK,{onComplete:()=>{d(!1)},onCancel:()=>{d(!1)},showAsCard:!0,autoFocus:!0}):(0,i.jsxs)(m,{variant:"outline",onClick:()=>d(!0),className:"w-full",children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),"Create New Character"]}),(0,i.jsx)("div",{className:"space-y-2",children:0===p.length?(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No characters found. Create your first character above!"}):p.map(e=>(0,i.jsx)(t9,{className:"cursor-pointer transition-colors ".concat(e.id===n?"ring-2 ring-primary bg-primary/5":"hover:bg-muted/50"),onClick:()=>{e.id!==n&&(u(e.id),null==a||a())},children:(0,i.jsx)(ai,{className:"p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"shrink-0",children:(0,i.jsx)(y.A,{className:"w-8 h-8 text-muted-foreground"})}),(0,i.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,i.jsxs)("h3",{className:"font-medium truncate",children:[e.name,e.id===n&&(0,i.jsx)("span",{className:"ml-2 text-xs bg-primary text-primary-foreground px-2 py-1 rounded",children:"Active"})]}),(0,i.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,i.jsx)(sC.A,{className:"w-3 h-3 mr-1"}),(e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4),a=Math.floor(t/60),i=Math.floor(a/24);return t<1?"Just now":t<60?"".concat(t,"m ago"):a<24?"".concat(a,"h ago"):i<7?"".concat(i,"d ago"):e.toLocaleDateString()})(e.updatedAt)]})]})]}),(0,i.jsx)("div",{className:"shrink-0",children:(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),(e=>{if(r.length<=1)return alert("Cannot delete the last character. Create another character first.");let t=r.find(t=>t.id===e);t&&confirm('Are you sure you want to delete "'.concat(t.name,'"?'))&&h(e)})(e.id)},className:"text-red-500 hover:text-red-700",disabled:e.id===n&&1===r.length,children:(0,i.jsx)(ij.A,{className:"w-4 h-4"})})})]})})},e.id))})]});return l?(0,i.jsxs)("main",{className:"min-h-screen bg-background flex flex-col",children:[(0,i.jsx)("div",{className:"container mx-auto py-8 flex-1",children:(0,i.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Nimble Navigator"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Select a character or create a new one"})]}),f]})}),(0,i.jsx)("footer",{className:"border-t bg-muted/30 py-3 px-4",children:(0,i.jsx)("div",{className:"container mx-auto",children:(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Nimble Navigator is an independent product published under the Nimble 3rd Party Creator License and is not affiliated with Nimble Co. Nimble \xa9 2025 Nimble Co."})})})]}):(0,i.jsx)(iR,{open:t,onOpenChange:a,children:(0,i.jsxs)(iP,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[(0,i.jsx)(iF,{children:(0,i.jsx)(iM,{children:"Characters"})}),f]})})}function sX(e){let{onClose:t}=e,{character:a,updateCharacter:r}=t6(),[n,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null);if(!a)return null;let h=()=>{o(null),c(!1),u(null),t()},p=async e=>{let t=Math.max(1,parseInt(e)||1),i={...a,wounds:{...a.wounds,max:t,current:Math.min(a.wounds.current,t)}};await r(i)},y=async e=>{let t=Math.max(1,parseInt(e)||1),i={...a,hitPoints:{...a.hitPoints,max:t,current:Math.min(a.hitPoints.current,t)}};await r(i)},f=async e=>{let t=Math.max(1,parseInt(e)||1),i={...a,config:{...a.config,maxInventorySize:t}};await r(i)},g=async e=>{let t=Math.max(-10,Math.min(10,parseInt(e)||0)),i={...a,initiative:{...a.initiative,modifier:t}};await r(i)},x=async e=>{let t=a.resources.filter(t=>t.definition.id!==e),i={...a,resources:t};await r(i)},v=()=>{u(null)},b=async(e,t,i)=>{let s=a.resources.map(a=>a.definition.id!==e?a:"current"===t||"sortOrder"===t?{...a,[t]:i}:{...a,definition:{...a.definition,[t]:i}}),n={...a,resources:s};await r(n)},w=async()=>{if(!n||!n.id||!n.name||a.resources.some(e=>e.definition.id===n.id))return;let e=ta({id:n.id,name:n.name,description:n.description||"",colorScheme:n.colorScheme||"blue-magic",icon:n.icon,resetCondition:n.resetCondition||"safe_rest",resetType:n.resetType||"to_max",resetValue:n.resetValue,minValue:n.minValue||0,maxValue:n.maxValue||10},n.maxValue||10,a.resources.length+1),t={...a,resources:[...a.resources,e]};await r(t),o(null),c(!1)},j=(e,t)=>{o(a=>a?{...a,[e]:t}:null)};return(0,i.jsx)(iR,{open:!0,onOpenChange:e=>!e&&h(),children:(0,i.jsxs)(iP,{className:"sm:max-w-[425px] max-h-[90vh] overflow-hidden flex flex-col",children:[(0,i.jsxs)(iF,{children:[(0,i.jsx)(iM,{children:"Character Configuration"}),(0,i.jsxs)(iW,{children:["Configure advanced settings for ",a.name,"."]})]}),(0,i.jsxs)("div",{className:"space-y-6 py-4 overflow-y-auto flex-1",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"max-wounds",className:"text-sm font-medium",children:"Maximum Wounds"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(it,{id:"max-wounds",type:"number",min:"1",max:"20",value:a.wounds.max,onChange:e=>p(e.target.value),className:"w-full"}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"Number of wounds the character can sustain before death."})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"max-hp",className:"text-sm font-medium",children:"Maximum Hit Points"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(it,{id:"max-hp",type:"number",min:"1",max:"1000",value:a.hitPoints.max,onChange:e=>y(e.target.value),className:"w-full"}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"Base maximum hit points for the character."})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"initiative-modifier",className:"text-sm font-medium",children:"Initiative Modifier"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(it,{id:"initiative-modifier",type:"number",min:"-10",max:"10",value:a.initiative.modifier,onChange:e=>g(e.target.value),className:"w-full"}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Additional modifier for initiative rolls (added to Dexterity). Current total: ",a.attributes.dexterity+a.initiative.modifier>=0?"+":"",a.attributes.dexterity+a.initiative.modifier,"."]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(io,{htmlFor:"max-inventory",className:"text-sm font-medium",children:"Base Inventory Size"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(it,{id:"max-inventory",type:"number",min:"1",max:"100",value:a.config.maxInventorySize,onChange:e=>f(e.target.value),className:"w-full"}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Base inventory slots (before strength bonus). Final size = ",a.config.maxInventorySize," + ",a.attributes.strength," (strength) = ",a.config.maxInventorySize+a.attributes.strength,"."]})]})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(at,{className:"text-base",children:"Resources"}),(0,i.jsxs)(m,{size:"sm",variant:"outline",onClick:()=>{o({id:"",name:"",description:"",colorScheme:"blue-magic",icon:"sparkles",resetCondition:"safe_rest",resetType:"to_max",minValue:0,maxValue:10}),c(!0)},disabled:l,children:[(0,i.jsx)(ah.A,{className:"h-4 w-4 mr-1"}),"Add Resource"]})]})}),(0,i.jsxs)(ai,{className:"space-y-4",children:[0===a.resources.length?(0,i.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No resources configured. Add a resource to get started."}):(0,i.jsx)("div",{className:"space-y-3",children:a.resources.map(e=>{let t=d===e.definition.id,a=a_(e.definition.icon||""),s=aA(e.definition.colorScheme);return(0,i.jsx)("div",{className:"p-3 border rounded-lg",children:t?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Name"}),(0,i.jsx)(it,{value:e.definition.name,onChange:t=>b(e.definition.id,"name",t.target.value),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"ID (read-only)"}),(0,i.jsx)(it,{value:e.definition.id,disabled:!0,className:"text-sm bg-muted"})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Description"}),(0,i.jsx)(ib,{value:e.definition.description||"",onChange:t=>b(e.definition.id,"description",t.target.value),rows:2,className:"text-sm resize-none"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Color Scheme"}),(0,i.jsxs)(id,{value:e.definition.colorScheme,onValueChange:t=>b(e.definition.id,"colorScheme",t),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsx)(iy,{children:aS.map(e=>(0,i.jsx)(ig,{value:e.id,children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded",style:{backgroundColor:e.colors.full}}),e.name]})},e.id))})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Icon"}),(0,i.jsxs)(id,{value:e.definition.icon||"",onValueChange:t=>b(e.definition.id,"icon",t),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsx)(iy,{children:Object.entries(aC.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"px-2 py-1 text-xs font-semibold text-muted-foreground capitalize",children:t}),a.map(e=>(0,i.jsx)(ig,{value:e.id,children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:e.icon}),e.name]})},e.id))]},t)})})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Reset Condition"}),(0,i.jsxs)(id,{value:e.definition.resetCondition,onValueChange:t=>b(e.definition.id,"resetCondition",t),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"safe_rest",children:"Safe Rest"}),(0,i.jsx)(ig,{value:"encounter_end",children:"Encounter End"}),(0,i.jsx)(ig,{value:"turn_end",children:"Turn End"}),(0,i.jsx)(ig,{value:"never",children:"Never"}),(0,i.jsx)(ig,{value:"manual",children:"Manual"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Reset Type"}),(0,i.jsxs)(id,{value:e.definition.resetType,onValueChange:t=>b(e.definition.id,"resetType",t),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"to_max",children:"To Maximum"}),(0,i.jsx)(ig,{value:"to_zero",children:"To Zero"}),(0,i.jsx)(ig,{value:"to_default",children:"To Default"})]})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Min"}),(0,i.jsx)(it,{type:"number",value:e.definition.minValue,onChange:t=>b(e.definition.id,"minValue",parseInt(t.target.value)||0),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Max"}),(0,i.jsx)(it,{type:"number",value:e.definition.maxValue,onChange:t=>b(e.definition.id,"maxValue",parseInt(t.target.value)||10),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Current"}),(0,i.jsx)(it,{type:"number",value:e.current,onChange:t=>b(e.definition.id,"current",parseInt(t.target.value)||0),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{className:"text-xs",children:"Default"}),(0,i.jsx)(it,{type:"number",value:e.definition.resetValue||"",onChange:t=>b(e.definition.id,"resetValue",t.target.value?parseInt(t.target.value):void 0),className:"text-sm",disabled:"to_default"!==e.definition.resetType})]})]}),(0,i.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,i.jsx)(m,{size:"sm",onClick:v,children:"Done Editing"}),(0,i.jsxs)(m,{size:"sm",variant:"outline",onClick:()=>x(e.definition.id),children:[(0,i.jsx)(ij.A,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}):(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("span",{className:"text-lg",children:(null==a?void 0:a.icon)||"\uD83D\uDC8E"}),(0,i.jsx)("span",{className:"font-medium",children:e.definition.name}),(0,i.jsx)("div",{className:"text-xs px-2 py-1 rounded text-white",style:{backgroundColor:(null==s?void 0:s.colors.full)||"#6b7280"},children:(null==s?void 0:s.name)||"Default"})]}),(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:["ID: ",e.definition.id," | ",e.current,"/",e.definition.maxValue," | Reset: ",e.definition.resetCondition,"  ",e.definition.resetType]}),e.definition.description&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.definition.description})]}),(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)(m,{size:"sm",variant:"ghost",onClick:()=>{u(e.definition.id)},children:"Edit"}),(0,i.jsx)(m,{size:"sm",variant:"ghost",onClick:()=>x(e.definition.id),className:"text-destructive hover:text-destructive",children:(0,i.jsx)(ij.A,{className:"h-4 w-4"})})]})]})},e.definition.id)})}),l&&n&&(0,i.jsxs)(t9,{className:"border-2 border-dashed",children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsx)(at,{className:"text-sm",children:"Create New Resource"})}),(0,i.jsxs)(ai,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-id",className:"text-xs",children:"ID*"}),(0,i.jsx)(it,{id:"resource-id",placeholder:"mana",value:n.id||"",onChange:e=>j("id",e.target.value),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-name",className:"text-xs",children:"Name*"}),(0,i.jsx)(it,{id:"resource-name",placeholder:"Mana",value:n.name||"",onChange:e=>j("name",e.target.value),className:"text-sm"})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-description",className:"text-xs",children:"Description"}),(0,i.jsx)(ib,{id:"resource-description",placeholder:"Optional description...",value:n.description||"",onChange:e=>j("description",e.target.value),rows:2,className:"text-sm resize-none"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-color-scheme",className:"text-xs",children:"Color Scheme"}),(0,i.jsxs)(id,{value:n.colorScheme||"blue-magic",onValueChange:e=>j("colorScheme",e),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsx)(iy,{children:aS.map(e=>(0,i.jsx)(ig,{value:e.id,children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded",style:{backgroundColor:e.colors.full}}),e.name]})},e.id))})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-icon",className:"text-xs",children:"Icon"}),(0,i.jsxs)(id,{value:n.icon||"sparkles",onValueChange:e=>{j("icon",e),n.colorScheme&&"blue-magic"!==n.colorScheme||j("colorScheme",(e=>{let t=a_(e);if(!t)return"blue-magic";switch(t.category){case"magic":default:return"blue-magic";case"energy":return"red-fury";case"physical":return"gray-stamina";case"special":return"purple-arcane"}})(e))},children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsx)(iy,{children:Object.entries(aC.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"px-2 py-1 text-xs font-semibold text-muted-foreground capitalize",children:t}),a.map(e=>(0,i.jsx)(ig,{value:e.id,children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{children:e.icon}),e.name]})},e.id))]},t)})})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-reset-condition",className:"text-xs",children:"Reset Condition"}),(0,i.jsxs)(id,{value:n.resetCondition||"safe_rest",onValueChange:e=>j("resetCondition",e),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"safe_rest",children:"Safe Rest"}),(0,i.jsx)(ig,{value:"encounter_end",children:"Encounter End"}),(0,i.jsx)(ig,{value:"turn_end",children:"Turn End"}),(0,i.jsx)(ig,{value:"never",children:"Never"}),(0,i.jsx)(ig,{value:"manual",children:"Manual"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-reset-type",className:"text-xs",children:"Reset Type"}),(0,i.jsxs)(id,{value:n.resetType||"to_max",onValueChange:e=>j("resetType",e),children:[(0,i.jsx)(iu,{className:"text-sm",children:(0,i.jsx)(im,{})}),(0,i.jsxs)(iy,{children:[(0,i.jsx)(ig,{value:"to_max",children:"To Maximum"}),(0,i.jsx)(ig,{value:"to_zero",children:"To Zero"}),(0,i.jsx)(ig,{value:"to_default",children:"To Default"})]})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-min",className:"text-xs",children:"Min"}),(0,i.jsx)(it,{id:"resource-min",type:"number",value:n.minValue||0,onChange:e=>j("minValue",parseInt(e.target.value)||0),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-max",className:"text-xs",children:"Max"}),(0,i.jsx)(it,{id:"resource-max",type:"number",value:n.maxValue||10,onChange:e=>j("maxValue",parseInt(e.target.value)||10),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"resource-default",className:"text-xs",children:"Default"}),(0,i.jsx)(it,{id:"resource-default",type:"number",value:n.resetValue||"",onChange:e=>j("resetValue",e.target.value?parseInt(e.target.value):void 0),className:"text-sm",disabled:"to_default"!==n.resetType})]})]}),(0,i.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,i.jsx)(m,{size:"sm",onClick:w,disabled:!n.id||!n.name||a.resources.some(e=>e.definition.id===n.id),children:"Save Resource"}),(0,i.jsx)(m,{size:"sm",variant:"outline",onClick:()=>{o(null),c(!1)},children:"Cancel"})]}),(!n.id||!n.name)&&(0,i.jsx)("p",{className:"text-xs text-destructive",children:"ID and Name are required"}),n.id&&a.resources.some(e=>e.definition.id===n.id)&&(0,i.jsx)("p",{className:"text-xs text-destructive",children:"Resource ID already exists"})]})]})]})]})]}),(0,i.jsx)(iB,{children:(0,i.jsx)(m,{onClick:h,children:"Close"})})]})})}var sZ=a(1221),sQ=a(7971);let s$=sQ.bL,s0=sQ.l9;sQ.YJ,sQ.ZL,sQ.Pb,sQ.z6,s.forwardRef((e,t)=>{let{className:a,inset:s,children:r,...n}=e;return(0,i.jsxs)(sQ.ZP,{ref:t,className:c("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...n,children:[r,(0,i.jsx)(ic.vKP,{className:"ml-auto"})]})}).displayName=sQ.ZP.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(sQ.G5,{ref:t,className:c("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin)",a),...s})}).displayName=sQ.G5.displayName;let s1=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...r}=e;return(0,i.jsx)(sQ.ZL,{children:(0,i.jsx)(sQ.UC,{ref:t,sideOffset:s,className:c("z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-32 overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin)",a),...r})})});s1.displayName=sQ.UC.displayName;let s2=s.forwardRef((e,t)=>{let{className:a,inset:s,...r}=e;return(0,i.jsx)(sQ.q7,{ref:t,className:c("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",a),...r})});s2.displayName=sQ.q7.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,checked:r,...n}=e;return(0,i.jsxs)(sQ.H_,{ref:t,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",a),checked:r,...n,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(sQ.VF,{children:(0,i.jsx)(ic.Srz,{className:"h-4 w-4"})})}),s]})}).displayName=sQ.H_.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,i.jsxs)(sQ.hN,{ref:t,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",a),...r,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(sQ.VF,{children:(0,i.jsx)(ic.RiX,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=sQ.hN.displayName,s.forwardRef((e,t)=>{let{className:a,inset:s,...r}=e;return(0,i.jsx)(sQ.JU,{ref:t,className:c("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...r})}).displayName=sQ.JU.displayName;let s4=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,i.jsx)(sQ.wv,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",a),...s})});s4.displayName=sQ.wv.displayName;var s3=a(5229);function s5(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L22 20 L2 20 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"16",textAnchor:"middle",fontSize:"8",fill:"currentColor",children:"4"})]})}function s6(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("circle",{cx:"8",cy:"8",r:"1",fill:"currentColor"}),(0,i.jsx)("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),(0,i.jsx)("circle",{cx:"16",cy:"16",r:"1",fill:"currentColor"}),(0,i.jsx)("circle",{cx:"8",cy:"16",r:"1",fill:"currentColor"}),(0,i.jsx)("circle",{cx:"16",cy:"8",r:"1",fill:"currentColor"}),(0,i.jsx)("circle",{cx:"12",cy:"8",r:"1",fill:"currentColor"})]})}function s8(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L20 8 L20 16 L12 22 L4 16 L4 8 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"14",textAnchor:"middle",fontSize:"8",fill:"currentColor",children:"8"})]})}function s7(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L20 6 L18 18 L6 18 L4 6 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"13",textAnchor:"middle",fontSize:"7",fill:"currentColor",children:"10"})]})}function s9(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L18 5 L21 11 L18 17 L12 22 L6 17 L3 11 L6 5 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"14",textAnchor:"middle",fontSize:"7",fill:"currentColor",children:"12"})]})}function re(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L19 7 L22 14 L19 19 L12 22 L5 19 L2 14 L5 7 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("path",{d:"M12 2 L5 7 L12 12 L19 7 Z",stroke:"currentColor",strokeWidth:"1",fill:"none"}),(0,i.jsx)("path",{d:"M12 12 L5 19 L12 22 L19 19 Z",stroke:"currentColor",strokeWidth:"1",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"14",textAnchor:"middle",fontSize:"7",fill:"currentColor",children:"20"})]})}function rt(e){let{className:t="w-4 h-4"}=e;return(0,i.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,children:[(0,i.jsx)("path",{d:"M12 2 L20 6 L18 18 L6 18 L4 6 Z",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,i.jsx)("text",{x:"12",y:"13",textAnchor:"middle",fontSize:"6",fill:"currentColor",children:"100"})]})}function ra(e){let{type:t,className:a="w-4 h-4"}=e;switch(t){case 4:return(0,i.jsx)(s5,{className:a});case 6:default:return(0,i.jsx)(s6,{className:a});case 8:return(0,i.jsx)(s8,{className:a});case 10:return(0,i.jsx)(s7,{className:a});case 12:return(0,i.jsx)(s9,{className:a});case 20:return(0,i.jsx)(re,{className:a});case 100:return(0,i.jsx)(rt,{className:a})}}function ri(){let{addLogEntry:e}=ab(),[t,a]=(0,s.useState)([]),r=()=>{a([])};return(0,i.jsxs)(s$,{children:[(0,i.jsx)(s0,{asChild:!0,children:(0,i.jsx)(m,{variant:"outline",size:"sm",children:(0,i.jsx)(ix.A,{className:"w-4 h-4"})})}),(0,i.jsx)(s1,{align:"start",className:"w-64 p-3",children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("div",{className:"text-sm font-medium",children:"Custom Dice Roll"}),(0,i.jsx)("div",{className:"grid grid-cols-3 gap-1",children:[4,6,8,10,12,20,100].map(e=>(0,i.jsxs)(m,{variant:"outline",size:"sm",className:"h-9 text-xs flex items-center gap-1 px-2",onClick:()=>(e=>{let t={id:crypto.randomUUID(),type:e};a(e=>[...e,t])})(e),children:[(0,i.jsx)(ra,{type:e,className:"w-3 h-3"}),"d",e]},e))}),t.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Pool:"}),(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:r,children:"Clear"})]}),(0,i.jsx)("div",{className:"flex flex-wrap gap-1 max-h-20 overflow-y-auto",children:t.map(e=>(0,i.jsxs)("div",{className:"flex items-center gap-1 bg-slate-50 border rounded px-1 py-0.5",children:[(0,i.jsx)(ra,{type:e.type,className:"w-3 h-3"}),(0,i.jsxs)("span",{className:"text-xs",children:["d",e.type]}),(0,i.jsx)("button",{onClick:()=>{var t;return t=e.id,void a(e=>e.filter(e=>e.id!==t))},className:"text-slate-400 hover:text-red-500",children:(0,i.jsx)(s3.A,{className:"w-3 h-3"})})]},e.id))})]}),(0,i.jsxs)(m,{onClick:()=>{if(0===t.length)return;let a=[],i=0;for(let e of t){let{dice:t}=tU.rollBasicDice(1,e.type);a.push(...t),i+=t.reduce((e,t)=>e+t.result,0)}let s=Object.entries(t.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})).map(e=>{let[t,a]=e;return"".concat(a,"d").concat(t)}).join(" + ");e({id:crypto.randomUUID(),type:"roll",timestamp:new Date,description:"Custom roll: ".concat(s),dice:a,droppedDice:[],total:i,modifier:0,criticalHits:0,isMiss:!1}),r()},disabled:0===t.length,className:"w-full",size:"sm",children:["Roll (",t.length," dice)"]})]})})]})}var rs=a(9540),rr=a(1169),rn=a(5710);function ro(e){let{isOpen:t,onClose:a,settings:s,onSettingsChange:r}=e;return(0,i.jsx)(iR,{open:t,onOpenChange:a,children:(0,i.jsxs)(iP,{className:"sm:max-w-md",children:[(0,i.jsx)(iF,{children:(0,i.jsx)(iM,{children:"Settings"})}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsx)(at,{className:"text-base",children:"App Mode"})}),(0,i.jsx)(ai,{className:"space-y-4",children:(0,i.jsxs)(sr,{value:s.mode,onValueChange:e=>{r({...s,mode:e})},className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)(sn,{value:"full",id:"full-mode",className:"mt-1"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"full-mode",className:"font-medium",children:"Full Mode"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Complete character sheet with inventory, abilities, actions, and all features."})]})]}),(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)(sn,{value:"basic",id:"basic-mode",className:"mt-1"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(io,{htmlFor:"basic-mode",className:"font-medium",children:"Basic Mode"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Simplified sheet with HP tracker, action tracker, and dice rolling only."})]})]})]})})]}),(0,i.jsxs)(t9,{children:[(0,i.jsx)(ae,{className:"pb-3",children:(0,i.jsx)(at,{className:"text-base",children:"Active Character"})}),(0,i.jsxs)(ai,{children:[(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Character ID: ",s.activeCharacterId]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Use the Characters menu to switch between characters"})]})]})]})]})})}var rl=a(3045),rc=a(5880),rd=a(1786),rm=a(2911);let ru=k.Ik({items:k.YO(k.Ik({item:k.Ik({id:k.Yj(),name:k.Yj(),type:k.k5(["weapon","armor","freeform","consumable","ammunition"]),size:k.ai(),description:k.Yj().optional(),damage:k.Yj().optional(),armor:k.ai().optional(),count:k.ai().optional(),properties:k.YO(k.Yj()).optional()}),category:k.k5(["mundane","magical"]),rarity:k.k5(["common","uncommon","rare","very-rare","legendary"]).optional()}))}),rh={[tx.CLASS_DEFINITION]:ef,[tx.SUBCLASS_DEFINITION]:eg,[tx.SPELL_SCHOOL_DEFINITION]:ex,[tx.ANCESTRY_DEFINITION]:Y,[tx.BACKGROUND_DEFINITION]:H,[tx.ACTION_ABILITY]:Z,[tx.SPELL_ABILITY]:Q,[tx.ITEM_REPOSITORY]:ru};var rp=a(5088);class ry{static generateExample(e){try{let t=rh[e];if(!t)throw Error("No schema found for content type: ".concat(e));let a=rm.b(t);return rp.N.generate(a)}catch(t){return console.warn("Failed to generate example for ".concat(e,":"),t),null}}static generateExampleJSON(e){let t=this.generateExample(e);return t?JSON.stringify(t,null,2):null}static generateAllExamples(){let e={};return Object.values(tx).forEach(t=>{e[t]=this.generateExample(t)}),e}}function rf(e){let{isOpen:t,onClose:a}=e,[r,n]=(0,s.useState)(""),[o,l]=(0,s.useState)(""),[c,d]=(0,s.useState)({}),[u,p]=(0,s.useState)({}),y=tE.getInstance(),g=y.getCustomContentStats();return(0,i.jsx)(iR,{open:t,onOpenChange:a,children:(0,i.jsxs)(iP,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,i.jsx)(iF,{children:(0,i.jsxs)(iM,{className:"flex items-center gap-2",children:[(0,i.jsx)(rn.A,{className:"h-5 w-5"}),"Manage Content"]})}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4",children:[r&&(0,i.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:r}),o&&(0,i.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:o}),(0,i.jsx)("div",{className:"space-y-4",children:Object.values(tx).map(e=>{let t=g[e]||0;return(0,i.jsx)("div",{children:((e,t)=>{let a=tv[e],s=(e=>{switch(e){case tx.CLASS_DEFINITION:return y.getAllClasses().filter(e=>!["fighter","wizard","cleric","rogue"].includes(e.id));case tx.SUBCLASS_DEFINITION:return y.getAllSubclasses();case tx.SPELL_SCHOOL_DEFINITION:return y.getAllSpellSchools();case tx.ANCESTRY_DEFINITION:return y.getAllAncestries().filter(e=>!["human","elf","dwarf","halfling"].includes(e.id));case tx.BACKGROUND_DEFINITION:return y.getAllBackgrounds().filter(e=>!["noble","scholar","soldier","folk-hero"].includes(e.id));case tx.ACTION_ABILITY:return y.getAllActionAbilities();case tx.SPELL_ABILITY:return y.getAllSpellSchools().flatMap(e=>y.getSpellsBySchool(e.id)).filter((e,t,a)=>a.findIndex(t=>t.id===e.id)===t);case tx.ITEM_REPOSITORY:return y.getAllItems();default:return[]}})(e),r=(e=>{let t={className:"h-4 w-4"};switch(e){case"Shield":return(0,i.jsx)(aU.A,{...t});case"Zap":return(0,i.jsx)(aJ.A,{...t});case"Sparkles":return(0,i.jsx)(h.A,{...t});case"Users":return(0,i.jsx)(rr.A,{...t});case"FileText":default:return(0,i.jsx)(iw.A,{...t});case"Wand2":return(0,i.jsx)(sA.A,{...t});case"BookOpen":return(0,i.jsx)(a5.A,{...t});case"Package":return(0,i.jsx)(f.A,{...t})}})(a.icon),o=c[e];return(0,i.jsx)(t9,{children:(0,i.jsxs)(aM,{open:o,onOpenChange:()=>{d(t=>({...t,[e]:!t[e]}))},children:[(0,i.jsx)(aW,{asChild:!0,children:(0,i.jsx)(ae,{className:"cursor-pointer hover:bg-muted/50",children:(0,i.jsxs)(at,{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[r,a.title,(0,i.jsx)(aZ,{variant:"secondary",className:"text-white ".concat(e===tx.CLASS_DEFINITION?"bg-blue-600":e===tx.SUBCLASS_DEFINITION?"bg-green-600":e===tx.SPELL_SCHOOL_DEFINITION?"bg-purple-600":e===tx.ANCESTRY_DEFINITION?"bg-teal-600":e===tx.BACKGROUND_DEFINITION?"bg-indigo-600":e===tx.ACTION_ABILITY?"bg-orange-600":e===tx.SPELL_ABILITY?"bg-red-600":e===tx.ITEM_REPOSITORY?"bg-yellow-600":"bg-gray-600"),children:t})]}),o?(0,i.jsx)(az.A,{className:"h-4 w-4"}):(0,i.jsx)(aO.A,{className:"h-4 w-4"})]})})}),(0,i.jsx)(aY,{children:(0,i.jsxs)(ai,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"border rounded-lg p-4 bg-muted/30",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsxs)(io,{className:"text-sm font-medium",children:["Upload ",a.title]}),(0,i.jsxs)(m,{variant:"ghost",size:"sm",onClick:()=>{e&&p(t=>({...t,[e]:!t[e]}))},className:"h-6 px-2",children:[(0,i.jsx)(a5.A,{className:"h-3 w-3 mr-1"}),"Schema"]})]}),(()=>{if(e&&u[e])try{let t=function(e){let t=rh[e];return rm.b(t)}(e),s=ry.generateExampleJSON(e),r=JSON.stringify(t,null,2);return(0,i.jsxs)("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:[(0,i.jsxs)("div",{className:"font-semibold text-blue-900 mb-1",children:[t.title||a.title," Format"]}),t.description&&(0,i.jsx)("div",{className:"text-blue-800 mb-2",children:t.description}),(0,i.jsxs)("details",{className:"mt-2",children:[(0,i.jsx)("summary",{className:"font-medium text-blue-900 cursor-pointer",children:"Example JSON"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>{navigator.clipboard.writeText(s||"")},children:(0,i.jsx)(rl.A,{className:"h-3 w-3"})}),(0,i.jsx)("pre",{className:"mt-1 p-2 pr-10 bg-green-100 rounded overflow-x-auto text-xs",children:s||"Failed to generate example"})]})]}),(0,i.jsxs)("details",{className:"mt-2",children:[(0,i.jsx)("summary",{className:"font-medium text-blue-900 cursor-pointer",children:"JSON Schema"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>{navigator.clipboard.writeText(r)},children:(0,i.jsx)(rl.A,{className:"h-3 w-3"})}),(0,i.jsx)("pre",{className:"mt-1 p-2 pr-10 bg-blue-100 rounded overflow-x-auto text-xs",children:r})]})]}),(0,i.jsx)("div",{className:"mt-2 flex items-center gap-1",children:(0,i.jsxs)("a",{href:"https://json-editor.github.io/json-editor/",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-700 hover:text-blue-900 flex items-center gap-1",children:[(0,i.jsx)(rc.A,{className:"h-3 w-3"}),"Use JSON Editor for easier data creation"]})})]})}catch(e){}return null})(),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("input",{type:"file",accept:".json",onChange:t=>((e,t)=>{var a;let i=null==(a=e.target.files)?void 0:a[0];if(!i)return;n(""),l("");let s=new FileReader;s.onload=async e=>{try{var a;let i,s=null==(a=e.target)?void 0:a.result;switch(t){case tx.CLASS_DEFINITION:i=y.uploadClasses(s);break;case tx.SUBCLASS_DEFINITION:i=y.uploadSubclasses(s);break;case tx.SPELL_SCHOOL_DEFINITION:i=y.uploadSpellSchools(s);break;case tx.ANCESTRY_DEFINITION:i=y.uploadAncestries(s);break;case tx.BACKGROUND_DEFINITION:i=y.uploadBackgrounds(s);break;case tx.ACTION_ABILITY:i=y.uploadAbilities(s);break;case tx.SPELL_ABILITY:i=y.uploadSpells(s);break;case tx.ITEM_REPOSITORY:i=y.uploadItems(s);break;default:i={success:!1,message:"Unknown content type"}}i.success?(n(i.message),setTimeout(()=>n(""),3e3)):(l(i.message),setTimeout(()=>l(""),5e3))}catch(e){l("Invalid JSON file"),setTimeout(()=>l(""),5e3)}},s.readAsText(i),e.target.value=""})(t,e),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),(0,i.jsxs)(m,{variant:"outline",size:"sm",className:"w-full",children:[(0,i.jsx)(rd.A,{className:"h-4 w-4 mr-2"}),"Choose JSON File"]})]})]}),s.length>0?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(io,{className:"text-sm font-medium",children:["Current ",a.title]}),(0,i.jsx)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:e===tx.ITEM_REPOSITORY?Object.entries(s.reduce((e,t)=>{"".concat(t.category,"-").concat(t.item.type);let a="".concat(t.category," ").concat(t.item.type,"s");return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{className:"border rounded p-2",children:[(0,i.jsxs)("div",{className:"font-medium text-sm text-yellow-600 mb-1",children:[t," (",a.length," items)"]}),(0,i.jsx)("div",{className:"space-y-1 ml-2",children:a.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:e.item.name}),e.rarity&&(0,i.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(",e.rarity,")"]}),e.item.damage&&(0,i.jsx)("span",{className:"text-muted-foreground ml-1",children:e.item.damage}),e.item.armor&&(0,i.jsxs)("span",{className:"text-muted-foreground ml-1",children:["AC ",e.item.armor]})]}),(0,i.jsx)("div",{className:"text-muted-foreground",children:e.item.id})]},e.item.id))})]},t)}):e===tx.SPELL_ABILITY?Object.entries(s.reduce((e,t)=>{let a=t.school||"Unknown";return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{className:"border rounded p-2",children:[(0,i.jsxs)("div",{className:"font-medium text-sm text-purple-600 mb-1",children:[t," (",a.length," spells)"]}),(0,i.jsx)("div",{className:"space-y-1 ml-2",children:a.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:e.name}),e.tier&&(0,i.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(Tier ",e.tier,")"]})]}),(0,i.jsx)("div",{className:"text-muted-foreground",children:e.id})]},e.id))})]},t)}):s.map((e,t)=>"item"in e?(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.item.name}),e.item.description&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground truncate max-w-md",children:e.item.description}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.category," ",e.item.type,e.rarity&&"  ".concat(e.rarity)]})]}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.item.id})]},e.item.id||t):(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),e.description&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground truncate max-w-md",children:e.description}),"spells"in e&&e.spells&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.spells.length," spells"]}),"size"in e&&e.size&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Size: ",e.size]}),"features"in e&&e.features&&(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.features.length," features"]})]}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:e.id})]},e.id||t))})]}):(0,i.jsxs)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:["No custom ",a.title.toLowerCase()," uploaded yet"]})]})})]})})})(e,t)},e)})}),(0,i.jsx)(t9,{className:"bg-muted/30",children:(0,i.jsx)(ai,{className:"pt-6",children:(0,i.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[(0,i.jsx)("p",{children:(0,i.jsx)("strong",{children:"Upload Instructions:"})}),(0,i.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,i.jsx)("li",{children:"Select JSON files containing properly formatted content definitions"}),(0,i.jsx)("li",{children:"Content will be validated before storage"}),(0,i.jsx)("li",{children:"Duplicate IDs will overwrite existing content"}),(0,i.jsx)("li",{children:"Custom content is stored locally in your browser"})]})]})})})]})]})})}function rg(e){let{settings:t,characters:a,onSettingsChange:r}=e,[n,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s$,{children:[(0,i.jsx)(s0,{asChild:!0,children:(0,i.jsx)(m,{variant:"outline",size:"sm",children:(0,i.jsx)(rs.A,{className:"w-4 h-4"})})}),(0,i.jsxs)(s1,{align:"end",className:"w-48",children:[(0,i.jsxs)(s2,{onClick:()=>c(!0),children:[(0,i.jsx)(rr.A,{className:"w-4 h-4 mr-2"}),"Characters"]}),(0,i.jsxs)(s2,{onClick:()=>p(!0),children:[(0,i.jsx)(rn.A,{className:"w-4 h-4 mr-2"}),"Manage Content"]}),(0,i.jsxs)(s2,{onClick:()=>o(!0),children:[(0,i.jsx)(am.A,{className:"w-4 h-4 mr-2"}),"Settings"]}),(0,i.jsx)(s4,{}),(0,i.jsxs)(s2,{onClick:()=>u(!0),children:[(0,i.jsx)(ah.A,{className:"w-4 h-4 mr-2"}),"New Character"]})]})]}),(0,i.jsx)(ro,{isOpen:n,onClose:()=>o(!1),settings:t,onSettingsChange:r}),(0,i.jsx)(sJ,{isOpen:l,onClose:()=>c(!1),characters:a,activeCharacterId:t.activeCharacterId}),(0,i.jsx)(rf,{isOpen:h,onClose:()=>p(!1)}),(0,i.jsx)(iR,{open:d,onOpenChange:u,children:(0,i.jsxs)(iP,{className:"sm:max-w-md",children:[(0,i.jsx)(iF,{children:(0,i.jsx)(iM,{children:"Create New Character"})}),(0,i.jsx)(sK,{onComplete:()=>u(!1),onCancel:()=>u(!1),showAsCard:!1,autoFocus:!0})]})})]})}function rx(){let{uiState:e,updateAdvantageLevel:t}=ak(),a=e.advantageLevel;return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium ".concat(a>0?"text-green-600":a<0?"text-red-600":"text-muted-foreground"),children:a>0?"Adv ".concat(a):a<0?"Dis ".concat(Math.abs(a)):"Normal"}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>{t(a-1)},className:"h-7 w-7 p-0",children:(0,i.jsx)(az.A,{className:"h-3 w-3"})}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>{t(0)},className:"h-7 w-7 p-0",disabled:0===a,children:(0,i.jsx)(sZ.A,{className:"h-3 w-3"})}),(0,i.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>{t(a+1)},className:"h-7 w-7 p-0",children:(0,i.jsx)(ia.A,{className:"h-3 w-3"})})]})]})}function rv(e){let{settings:t,characters:a,onSettingsChange:s}=e;return(0,i.jsx)("div",{className:"sticky top-0 z-50 bg-background border-b",children:(0,i.jsxs)("div",{className:"container mx-auto px-4 h-14 flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(rg,{settings:t,characters:a,onSettingsChange:s})}),(0,i.jsx)("div",{}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(rx,{}),(0,i.jsx)(ri,{})]})]})})}var rb=a(9559);class rw extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,i.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:(0,i.jsxs)(t9,{className:"w-full max-w-lg",children:[(0,i.jsx)(ae,{children:(0,i.jsxs)(at,{className:"flex items-center gap-2 text-destructive",children:[(0,i.jsx)(sS.A,{className:"w-5 h-5"}),"Something went wrong"]})}),(0,i.jsxs)(ai,{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-muted-foreground",children:"An unexpected error occurred in the application. This has been logged for review."}),!1,(0,i.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,i.jsxs)(m,{onClick:this.handleReset,variant:"outline",className:"flex-1",children:[(0,i.jsx)(rb.A,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,i.jsx)(m,{onClick:this.handleReload,className:"flex-1",children:"Reload Page"})]})]})]})}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1},this.handleReset=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleReload=()=>{window.location.reload()}}}var rj=a(5299);function rN(e){let{message:t="Loading...",showSpinner:a=!0}=e;return(0,i.jsx)("main",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[a&&(0,i.jsx)(rj.A,{className:"w-8 h-8 animate-spin mx-auto text-muted-foreground"}),(0,i.jsx)("p",{className:"text-lg text-muted-foreground",children:t})]})})}var rk=a(2529),rS=a(6132);function rC(){let{toasts:e,removeToast:t}=t5();return 0===e.length?null:(0,i.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:e.map(e=>(0,i.jsx)(rA,{toast:e,onRemove:t},e.id))})}function rA(e){let{toast:t,onRemove:a}=e;return(0,i.jsx)("div",{className:"bg-background border border-l-4 ".concat((()=>{switch(t.type){case"success":return"border-l-green-500";case"error":return"border-l-red-500";case"warning":return"border-l-yellow-500";case"info":return"border-l-blue-500"}})()," rounded-lg shadow-lg p-4 transition-all duration-300 hover:shadow-xl"),children:(0,i.jsxs)("div",{className:"flex items-start gap-3",children:[(()=>{switch(t.type){case"success":return(0,i.jsx)(rk.A,{className:"w-5 h-5 text-green-600"});case"error":return(0,i.jsx)(rS.A,{className:"w-5 h-5 text-red-600"});case"warning":return(0,i.jsx)(sS.A,{className:"w-5 h-5 text-yellow-600"});case"info":return(0,i.jsx)(sp.A,{className:"w-5 h-5 text-blue-600"})}})(),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("h4",{className:"font-medium text-sm",children:t.title}),t.description&&(0,i.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),(0,i.jsx)(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-muted",onClick:()=>a(t.id),children:(0,i.jsx)(s3.A,{className:"w-4 h-4"})})]})})}function r_(){let{characters:e,settings:t,isLoaded:a,loadError:r,showCharacterSelection:n,handleSettingsChange:o}=function(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)({mode:"full",activeCharacterId:"default-character"}),[r,n]=(0,s.useState)(!1),[o,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),m=tG.getService(v.CHARACTER_STORAGE);tQ();let u=t0(),{showError:h}=t5(),{subscribeToEvent:p}=t6();return(0,s.useEffect)(()=>{(async()=>{try{let e=await u.getSettings();i(e);let a=await m.getAllCharacters();if(t(a),0===a.length)d(!0),l("No characters found. Please create your first character.");else{let t=tV(),i=await t.loadCharacter(e.activeCharacterId);if(!i)try{let e=a[0];if(!(i=await t.loadCharacter(e.id)))throw Error("Failed to load first available character")}catch(e){console.error("Failed to load first character:",e),d(!0),l("Failed to load character. Please select or create a character.")}}}catch(e){console.error("Failed to load data:",e),h("Failed to load application","Unable to load character data. Please try again or create a new character."),d(!0),l("Failed to load application data. Please try selecting or creating a character.")}finally{n(!0)}})()},[]),(0,s.useEffect)(()=>{let e=p("created",async e=>{t(await m.getAllCharacters()),i(await u.getSettings()),d(!1),l(null)}),a=p("switched",async e=>{t(await m.getAllCharacters()),i(await u.getSettings()),d(!1),l(null)}),s=p("deleted",async e=>{let a=await m.getAllCharacters();t(a),i(await u.getSettings()),0===a.length&&(d(!0),l("No characters remaining. Please create a new character."))});return()=>{e(),a(),s()}},[p,m,u]),{characters:e,settings:a,isLoaded:r,loadError:o,showCharacterSelection:c,handleSettingsChange:async e=>{i(e),await u.saveSettings(e)}}}(),{character:l,updateCharacter:c}=t6(),[d,m]=(0,s.useState)(!1),u=(0,s.useCallback)(async e=>{if(l){let t={...l,name:e};await c(t)}},[l,c]),h=(0,s.useCallback)(()=>{m(!0)},[]),p=(0,s.useCallback)(()=>{m(!1)},[]);return((0,s.useEffect)(()=>{l?document.title="Nimble Navigator - ".concat(l.name):document.title="Nimble Navigator"},[l]),a)?n||!l?(0,i.jsx)(sJ,{fullScreen:!0,characters:e,activeCharacterId:null==l?void 0:l.id,errorMessage:r||void 0}):(0,i.jsxs)("main",{className:"min-h-screen bg-background flex flex-col",children:[(0,i.jsx)(rv,{settings:t,characters:e,onSettingsChange:o}),(0,i.jsxs)("div",{className:"container mx-auto py-6 px-4 space-y-6 flex-1",children:[(0,i.jsx)(sw,{onNameChange:u,onOpenConfig:h}),(0,i.jsx)(i5,{})]}),(0,i.jsx)("footer",{className:"border-t bg-muted/30 py-3 px-4",children:(0,i.jsx)("div",{className:"container mx-auto",children:(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Nimble Navigator is an independent product published under the Nimble 3rd Party Creator License and is not affiliated with Nimble Co. Nimble \xa9 2025 Nimble Co."})})}),d&&(0,i.jsx)(sX,{onClose:p})]}):(0,i.jsx)(rN,{message:"Loading character data..."})}function rI(){return(0,i.jsxs)(rw,{children:[(0,i.jsx)(r_,{}),(0,i.jsx)(rC,{})]})}},8152:(e,t,a)=>{Promise.resolve().then(a.bind(a,5705))}},e=>{e.O(0,[294,985,105,720,697,441,255,358],()=>e(e.s=8152)),_N_E=e.O()}]);